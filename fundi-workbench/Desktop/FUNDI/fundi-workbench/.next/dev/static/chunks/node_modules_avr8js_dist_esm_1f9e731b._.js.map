{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/cpu/interrupt.js"],"sourcesContent":["/**\r\n * AVR-8 Interrupt Handling\r\n * Part of AVR8js\r\n * Reference: http://ww1.microchip.com/downloads/en/devicedoc/atmel-0856-avr-instruction-set-manual.pdf\r\n *\r\n * Copyright (C) 2019, Uri Shaked\r\n */\r\nexport function avrInterrupt(cpu, addr) {\r\n    const sp = cpu.dataView.getUint16(93, true);\r\n    cpu.data[sp] = cpu.pc & 0xff;\r\n    cpu.data[sp - 1] = (cpu.pc >> 8) & 0xff;\r\n    if (cpu.pc22Bits) {\r\n        cpu.data[sp - 2] = (cpu.pc >> 16) & 0xff;\r\n    }\r\n    cpu.dataView.setUint16(93, sp - (cpu.pc22Bits ? 3 : 2), true);\r\n    cpu.data[95] &= 0x7f; // clear global interrupt flag\r\n    cpu.cycles += 2;\r\n    cpu.pc = addr;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;CAMC;;;;AACM,SAAS,aAAa,GAAG,EAAE,IAAI;IAClC,MAAM,KAAK,IAAI,QAAQ,CAAC,SAAS,CAAC,IAAI;IACtC,IAAI,IAAI,CAAC,GAAG,GAAG,IAAI,EAAE,GAAG;IACxB,IAAI,IAAI,CAAC,KAAK,EAAE,GAAG,AAAC,IAAI,EAAE,IAAI,IAAK;IACnC,IAAI,IAAI,QAAQ,EAAE;QACd,IAAI,IAAI,CAAC,KAAK,EAAE,GAAG,AAAC,IAAI,EAAE,IAAI,KAAM;IACxC;IACA,IAAI,QAAQ,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG;IACxD,IAAI,IAAI,CAAC,GAAG,IAAI,MAAM,8BAA8B;IACpD,IAAI,MAAM,IAAI;IACd,IAAI,EAAE,GAAG;AACb","ignoreList":[0]}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/cpu/cpu.js"],"sourcesContent":["/**\r\n * AVR 8 CPU data structures\r\n * Part of AVR8js\r\n *\r\n * Copyright (C) 2019, Uri Shaked\r\n */\r\nimport { avrInterrupt } from './interrupt';\r\nconst registerSpace = 0x100;\r\nconst MAX_INTERRUPTS = 128; // Enough for ATMega2560\r\nexport class CPU {\r\n    constructor(progMem, sramBytes = 8192) {\r\n        this.progMem = progMem;\r\n        this.sramBytes = sramBytes;\r\n        this.data = new Uint8Array(this.sramBytes + registerSpace);\r\n        this.data16 = new Uint16Array(this.data.buffer);\r\n        this.dataView = new DataView(this.data.buffer);\r\n        this.progBytes = new Uint8Array(this.progMem.buffer);\r\n        this.readHooks = [];\r\n        this.writeHooks = [];\r\n        this.pendingInterrupts = new Array(MAX_INTERRUPTS);\r\n        this.nextClockEvent = null;\r\n        this.clockEventPool = []; // helps avoid garbage collection\r\n        /**\r\n         * Whether the program counter (PC) can address 22 bits (the default is 16)\r\n         */\r\n        this.pc22Bits = this.progBytes.length > 0x20000;\r\n        this.gpioPorts = new Set();\r\n        this.gpioByPort = [];\r\n        /**\r\n         * This function is called by the WDR instruction. The Watchdog peripheral attaches\r\n         * to it to listen for WDR (watchdog reset).\r\n         */\r\n        this.onWatchdogReset = () => {\r\n            /* empty by default */\r\n        };\r\n        /**\r\n         * Program counter\r\n         */\r\n        this.pc = 0;\r\n        /**\r\n         * Clock cycle counter\r\n         */\r\n        this.cycles = 0;\r\n        this.nextInterrupt = -1;\r\n        this.maxInterrupt = 0;\r\n        this.reset();\r\n    }\r\n    reset() {\r\n        this.SP = this.data.length - 1;\r\n        this.pc = 0;\r\n        this.pendingInterrupts.fill(null);\r\n        this.nextInterrupt = -1;\r\n        this.nextClockEvent = null;\r\n    }\r\n    readData(addr) {\r\n        if (addr >= 32 && this.readHooks[addr]) {\r\n            return this.readHooks[addr](addr);\r\n        }\r\n        return this.data[addr];\r\n    }\r\n    writeData(addr, value, mask = 0xff) {\r\n        const hook = this.writeHooks[addr];\r\n        if (hook) {\r\n            if (hook(value, this.data[addr], addr, mask)) {\r\n                return;\r\n            }\r\n        }\r\n        this.data[addr] = value;\r\n    }\r\n    get SP() {\r\n        return this.dataView.getUint16(93, true);\r\n    }\r\n    set SP(value) {\r\n        this.dataView.setUint16(93, value, true);\r\n    }\r\n    get SREG() {\r\n        return this.data[95];\r\n    }\r\n    get interruptsEnabled() {\r\n        return this.SREG & 0x80 ? true : false;\r\n    }\r\n    setInterruptFlag(interrupt) {\r\n        const { flagRegister, flagMask, enableRegister, enableMask } = interrupt;\r\n        if (interrupt.inverseFlag) {\r\n            this.data[flagRegister] &= ~flagMask;\r\n        }\r\n        else {\r\n            this.data[flagRegister] |= flagMask;\r\n        }\r\n        if (this.data[enableRegister] & enableMask) {\r\n            this.queueInterrupt(interrupt);\r\n        }\r\n    }\r\n    updateInterruptEnable(interrupt, registerValue) {\r\n        const { enableMask, flagRegister, flagMask, inverseFlag } = interrupt;\r\n        if (registerValue & enableMask) {\r\n            const bitSet = this.data[flagRegister] & flagMask;\r\n            if (inverseFlag ? !bitSet : bitSet) {\r\n                this.queueInterrupt(interrupt);\r\n            }\r\n        }\r\n        else {\r\n            this.clearInterrupt(interrupt, false);\r\n        }\r\n    }\r\n    queueInterrupt(interrupt) {\r\n        const { address } = interrupt;\r\n        this.pendingInterrupts[address] = interrupt;\r\n        if (this.nextInterrupt === -1 || this.nextInterrupt > address) {\r\n            this.nextInterrupt = address;\r\n        }\r\n        if (address > this.maxInterrupt) {\r\n            this.maxInterrupt = address;\r\n        }\r\n    }\r\n    clearInterrupt({ address, flagRegister, flagMask }, clearFlag = true) {\r\n        if (clearFlag) {\r\n            this.data[flagRegister] &= ~flagMask;\r\n        }\r\n        const { pendingInterrupts, maxInterrupt } = this;\r\n        if (!pendingInterrupts[address]) {\r\n            return;\r\n        }\r\n        pendingInterrupts[address] = null;\r\n        if (this.nextInterrupt === address) {\r\n            this.nextInterrupt = -1;\r\n            for (let i = address + 1; i <= maxInterrupt; i++) {\r\n                if (pendingInterrupts[i]) {\r\n                    this.nextInterrupt = i;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    clearInterruptByFlag(interrupt, registerValue) {\r\n        const { flagRegister, flagMask } = interrupt;\r\n        if (registerValue & flagMask) {\r\n            this.data[flagRegister] &= ~flagMask;\r\n            this.clearInterrupt(interrupt);\r\n        }\r\n    }\r\n    addClockEvent(callback, cycles) {\r\n        const { clockEventPool } = this;\r\n        cycles = this.cycles + Math.max(1, cycles);\r\n        const maybeEntry = clockEventPool.pop();\r\n        const entry = maybeEntry !== null && maybeEntry !== void 0 ? maybeEntry : { cycles, callback, next: null };\r\n        entry.cycles = cycles;\r\n        entry.callback = callback;\r\n        let { nextClockEvent: clockEvent } = this;\r\n        let lastItem = null;\r\n        while (clockEvent && clockEvent.cycles < cycles) {\r\n            lastItem = clockEvent;\r\n            clockEvent = clockEvent.next;\r\n        }\r\n        if (lastItem) {\r\n            lastItem.next = entry;\r\n            entry.next = clockEvent;\r\n        }\r\n        else {\r\n            this.nextClockEvent = entry;\r\n            entry.next = clockEvent;\r\n        }\r\n        return callback;\r\n    }\r\n    updateClockEvent(callback, cycles) {\r\n        if (this.clearClockEvent(callback)) {\r\n            this.addClockEvent(callback, cycles);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    clearClockEvent(callback) {\r\n        let { nextClockEvent: clockEvent } = this;\r\n        if (!clockEvent) {\r\n            return false;\r\n        }\r\n        const { clockEventPool } = this;\r\n        let lastItem = null;\r\n        while (clockEvent) {\r\n            if (clockEvent.callback === callback) {\r\n                if (lastItem) {\r\n                    lastItem.next = clockEvent.next;\r\n                }\r\n                else {\r\n                    this.nextClockEvent = clockEvent.next;\r\n                }\r\n                if (clockEventPool.length < 10) {\r\n                    clockEventPool.push(clockEvent);\r\n                }\r\n                return true;\r\n            }\r\n            lastItem = clockEvent;\r\n            clockEvent = clockEvent.next;\r\n        }\r\n        return false;\r\n    }\r\n    tick() {\r\n        const { nextClockEvent } = this;\r\n        if (nextClockEvent && nextClockEvent.cycles <= this.cycles) {\r\n            nextClockEvent.callback();\r\n            this.nextClockEvent = nextClockEvent.next;\r\n            if (this.clockEventPool.length < 10) {\r\n                this.clockEventPool.push(nextClockEvent);\r\n            }\r\n        }\r\n        const { nextInterrupt } = this;\r\n        if (this.interruptsEnabled && nextInterrupt >= 0) {\r\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n            const interrupt = this.pendingInterrupts[nextInterrupt];\r\n            avrInterrupt(this, interrupt.address);\r\n            if (!interrupt.constant) {\r\n                this.clearInterrupt(interrupt);\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 249, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/cpu/instruction.js"],"sourcesContent":["/**\r\n * AVR-8 Instruction Simulation\r\n * Part of AVR8js\r\n *\r\n * Reference: http://ww1.microchip.com/downloads/en/devicedoc/atmel-0856-avr-instruction-set-manual.pdf\r\n *\r\n * Instruction timing is currently based on ATmega328p (see the Instruction Set Summary at the end of\r\n * the datasheet)\r\n *\r\n * Copyright (C) 2019, 2020 Uri Shaked\r\n */\r\nfunction isTwoWordInstruction(opcode) {\r\n    return (\r\n    /* LDS */\r\n    (opcode & 0xfe0f) === 0x9000 ||\r\n        /* STS */\r\n        (opcode & 0xfe0f) === 0x9200 ||\r\n        /* CALL */\r\n        (opcode & 0xfe0e) === 0x940e ||\r\n        /* JMP */\r\n        (opcode & 0xfe0e) === 0x940c);\r\n}\r\nexport function avrInstruction(cpu) {\r\n    const opcode = cpu.progMem[cpu.pc];\r\n    if ((opcode & 0xfc00) === 0x1c00) {\r\n        /* ADC, 0001 11rd dddd rrrr */\r\n        const d = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const r = cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        const sum = d + r + (cpu.data[95] & 1);\r\n        const R = sum & 255;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xc0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= (R ^ r) & (d ^ R) & 128 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= sum & 256 ? 1 : 0;\r\n        sreg |= 1 & ((d & r) | (r & ~R) | (~R & d)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0xc00) {\r\n        /* ADD, 0000 11rd dddd rrrr */\r\n        const d = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const r = cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        const R = (d + r) & 255;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xc0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= (R ^ r) & (R ^ d) & 128 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= (d + r) & 256 ? 1 : 0;\r\n        sreg |= 1 & ((d & r) | (r & ~R) | (~R & d)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xff00) === 0x9600) {\r\n        /* ADIW, 1001 0110 KKdd KKKK */\r\n        const addr = 2 * ((opcode & 0x30) >> 4) + 24;\r\n        const value = cpu.dataView.getUint16(addr, true);\r\n        const R = (value + ((opcode & 0xf) | ((opcode & 0xc0) >> 2))) & 0xffff;\r\n        cpu.dataView.setUint16(addr, R, true);\r\n        let sreg = cpu.data[95] & 0xe0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 0x8000 & R ? 4 : 0;\r\n        sreg |= ~value & R & 0x8000 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= ~R & value & 0x8000 ? 1 : 0;\r\n        cpu.data[95] = sreg;\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x2000) {\r\n        /* AND, 0010 00rd dddd rrrr */\r\n        const R = cpu.data[(opcode & 0x1f0) >> 4] & cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xe1;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xf000) === 0x7000) {\r\n        /* ANDI, 0111 KKKK dddd KKKK */\r\n        const R = cpu.data[((opcode & 0xf0) >> 4) + 16] & ((opcode & 0xf) | ((opcode & 0xf00) >> 4));\r\n        cpu.data[((opcode & 0xf0) >> 4) + 16] = R;\r\n        let sreg = cpu.data[95] & 0xe1;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9405) {\r\n        /* ASR, 1001 010d dddd 0101 */\r\n        const value = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const R = (value >>> 1) | (128 & value);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xe0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= value & 1;\r\n        sreg |= ((sreg >> 2) & 1) ^ (sreg & 1) ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xff8f) === 0x9488) {\r\n        /* BCLR, 1001 0100 1sss 1000 */\r\n        cpu.data[95] &= ~(1 << ((opcode & 0x70) >> 4));\r\n    }\r\n    else if ((opcode & 0xfe08) === 0xf800) {\r\n        /* BLD, 1111 100d dddd 0bbb */\r\n        const b = opcode & 7;\r\n        const d = (opcode & 0x1f0) >> 4;\r\n        cpu.data[d] = (~(1 << b) & cpu.data[d]) | (((cpu.data[95] >> 6) & 1) << b);\r\n    }\r\n    else if ((opcode & 0xfc00) === 0xf400) {\r\n        /* BRBC, 1111 01kk kkkk ksss */\r\n        if (!(cpu.data[95] & (1 << (opcode & 7)))) {\r\n            cpu.pc = cpu.pc + (((opcode & 0x1f8) >> 3) - (opcode & 0x200 ? 0x40 : 0));\r\n            cpu.cycles++;\r\n        }\r\n    }\r\n    else if ((opcode & 0xfc00) === 0xf000) {\r\n        /* BRBS, 1111 00kk kkkk ksss */\r\n        if (cpu.data[95] & (1 << (opcode & 7))) {\r\n            cpu.pc = cpu.pc + (((opcode & 0x1f8) >> 3) - (opcode & 0x200 ? 0x40 : 0));\r\n            cpu.cycles++;\r\n        }\r\n    }\r\n    else if ((opcode & 0xff8f) === 0x9408) {\r\n        /* BSET, 1001 0100 0sss 1000 */\r\n        cpu.data[95] |= 1 << ((opcode & 0x70) >> 4);\r\n    }\r\n    else if ((opcode & 0xfe08) === 0xfa00) {\r\n        /* BST, 1111 101d dddd 0bbb */\r\n        const d = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const b = opcode & 7;\r\n        cpu.data[95] = (cpu.data[95] & 0xbf) | ((d >> b) & 1 ? 0x40 : 0);\r\n    }\r\n    else if ((opcode & 0xfe0e) === 0x940e) {\r\n        /* CALL, 1001 010k kkkk 111k kkkk kkkk kkkk kkkk */\r\n        const k = cpu.progMem[cpu.pc + 1] | ((opcode & 1) << 16) | ((opcode & 0x1f0) << 13);\r\n        const ret = cpu.pc + 2;\r\n        const sp = cpu.dataView.getUint16(93, true);\r\n        const { pc22Bits } = cpu;\r\n        cpu.data[sp] = 255 & ret;\r\n        cpu.data[sp - 1] = (ret >> 8) & 255;\r\n        if (pc22Bits) {\r\n            cpu.data[sp - 2] = (ret >> 16) & 255;\r\n        }\r\n        cpu.dataView.setUint16(93, sp - (pc22Bits ? 3 : 2), true);\r\n        cpu.pc = k - 1;\r\n        cpu.cycles += pc22Bits ? 4 : 3;\r\n    }\r\n    else if ((opcode & 0xff00) === 0x9800) {\r\n        /* CBI, 1001 1000 AAAA Abbb */\r\n        const A = opcode & 0xf8;\r\n        const b = opcode & 7;\r\n        const R = cpu.readData((A >> 3) + 32);\r\n        const mask = 1 << b;\r\n        cpu.writeData((A >> 3) + 32, R & ~mask, mask);\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9400) {\r\n        /* COM, 1001 010d dddd 0000 */\r\n        const d = (opcode & 0x1f0) >> 4;\r\n        const R = 255 - cpu.data[d];\r\n        cpu.data[d] = R;\r\n        let sreg = (cpu.data[95] & 0xe1) | 1;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x1400) {\r\n        /* CP, 0001 01rd dddd rrrr */\r\n        const val1 = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const val2 = cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        const R = val1 - val2;\r\n        let sreg = cpu.data[95] & 0xc0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= 0 !== ((val1 ^ val2) & (val1 ^ R) & 128) ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= val2 > val1 ? 1 : 0;\r\n        sreg |= 1 & ((~val1 & val2) | (val2 & R) | (R & ~val1)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x400) {\r\n        /* CPC, 0000 01rd dddd rrrr */\r\n        const arg1 = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const arg2 = cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        let sreg = cpu.data[95];\r\n        const r = arg1 - arg2 - (sreg & 1);\r\n        sreg = (sreg & 0xc0) | (!r && (sreg >> 1) & 1 ? 2 : 0) | (arg2 + (sreg & 1) > arg1 ? 1 : 0);\r\n        sreg |= 128 & r ? 4 : 0;\r\n        sreg |= (arg1 ^ arg2) & (arg1 ^ r) & 128 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= 1 & ((~arg1 & arg2) | (arg2 & r) | (r & ~arg1)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xf000) === 0x3000) {\r\n        /* CPI, 0011 KKKK dddd KKKK */\r\n        const arg1 = cpu.data[((opcode & 0xf0) >> 4) + 16];\r\n        const arg2 = (opcode & 0xf) | ((opcode & 0xf00) >> 4);\r\n        const r = arg1 - arg2;\r\n        let sreg = cpu.data[95] & 0xc0;\r\n        sreg |= r ? 0 : 2;\r\n        sreg |= 128 & r ? 4 : 0;\r\n        sreg |= (arg1 ^ arg2) & (arg1 ^ r) & 128 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= arg2 > arg1 ? 1 : 0;\r\n        sreg |= 1 & ((~arg1 & arg2) | (arg2 & r) | (r & ~arg1)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x1000) {\r\n        /* CPSE, 0001 00rd dddd rrrr */\r\n        if (cpu.data[(opcode & 0x1f0) >> 4] === cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)]) {\r\n            const nextOpcode = cpu.progMem[cpu.pc + 1];\r\n            const skipSize = isTwoWordInstruction(nextOpcode) ? 2 : 1;\r\n            cpu.pc += skipSize;\r\n            cpu.cycles += skipSize;\r\n        }\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x940a) {\r\n        /* DEC, 1001 010d dddd 1010 */\r\n        const value = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const R = value - 1;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xe1;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= 128 === value ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if (opcode === 0x9519) {\r\n        /* EICALL, 1001 0101 0001 1001 */\r\n        const retAddr = cpu.pc + 1;\r\n        const sp = cpu.dataView.getUint16(93, true);\r\n        const eind = cpu.data[0x5c];\r\n        cpu.data[sp] = retAddr & 255;\r\n        cpu.data[sp - 1] = (retAddr >> 8) & 255;\r\n        cpu.data[sp - 2] = (retAddr >> 16) & 255;\r\n        cpu.dataView.setUint16(93, sp - 3, true);\r\n        cpu.pc = ((eind << 16) | cpu.dataView.getUint16(30, true)) - 1;\r\n        cpu.cycles += 3;\r\n    }\r\n    else if (opcode === 0x9419) {\r\n        /* EIJMP, 1001 0100 0001 1001 */\r\n        const eind = cpu.data[0x5c];\r\n        cpu.pc = ((eind << 16) | cpu.dataView.getUint16(30, true)) - 1;\r\n        cpu.cycles++;\r\n    }\r\n    else if (opcode === 0x95d8) {\r\n        /* ELPM, 1001 0101 1101 1000 */\r\n        const rampz = cpu.data[0x5b];\r\n        cpu.data[0] = cpu.progBytes[(rampz << 16) | cpu.dataView.getUint16(30, true)];\r\n        cpu.cycles += 2;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9006) {\r\n        /* ELPM(REG), 1001 000d dddd 0110 */\r\n        const rampz = cpu.data[0x5b];\r\n        cpu.data[(opcode & 0x1f0) >> 4] =\r\n            cpu.progBytes[(rampz << 16) | cpu.dataView.getUint16(30, true)];\r\n        cpu.cycles += 2;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9007) {\r\n        /* ELPM(INC), 1001 000d dddd 0111 */\r\n        const rampz = cpu.data[0x5b];\r\n        const i = cpu.dataView.getUint16(30, true);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.progBytes[(rampz << 16) | i];\r\n        cpu.dataView.setUint16(30, i + 1, true);\r\n        if (i === 0xffff) {\r\n            cpu.data[0x5b] = (rampz + 1) % (cpu.progBytes.length >> 16);\r\n        }\r\n        cpu.cycles += 2;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x2400) {\r\n        /* EOR, 0010 01rd dddd rrrr */\r\n        const R = cpu.data[(opcode & 0x1f0) >> 4] ^ cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xe1;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xff88) === 0x308) {\r\n        /* FMUL, 0000 0011 0ddd 1rrr */\r\n        const v1 = cpu.data[((opcode & 0x70) >> 4) + 16];\r\n        const v2 = cpu.data[(opcode & 7) + 16];\r\n        const R = (v1 * v2) << 1;\r\n        cpu.dataView.setUint16(0, R, true);\r\n        cpu.data[95] = (cpu.data[95] & 0xfc) | (0xffff & R ? 0 : 2) | ((v1 * v2) & 0x8000 ? 1 : 0);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xff88) === 0x380) {\r\n        /* FMULS, 0000 0011 1ddd 0rrr */\r\n        const v1 = cpu.dataView.getInt8(((opcode & 0x70) >> 4) + 16);\r\n        const v2 = cpu.dataView.getInt8((opcode & 7) + 16);\r\n        const R = (v1 * v2) << 1;\r\n        cpu.dataView.setInt16(0, R, true);\r\n        cpu.data[95] = (cpu.data[95] & 0xfc) | (0xffff & R ? 0 : 2) | ((v1 * v2) & 0x8000 ? 1 : 0);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xff88) === 0x388) {\r\n        /* FMULSU, 0000 0011 1ddd 1rrr */\r\n        const v1 = cpu.dataView.getInt8(((opcode & 0x70) >> 4) + 16);\r\n        const v2 = cpu.data[(opcode & 7) + 16];\r\n        const R = (v1 * v2) << 1;\r\n        cpu.dataView.setInt16(0, R, true);\r\n        cpu.data[95] = (cpu.data[95] & 0xfc) | (0xffff & R ? 2 : 0) | ((v1 * v2) & 0x8000 ? 1 : 0);\r\n        cpu.cycles++;\r\n    }\r\n    else if (opcode === 0x9509) {\r\n        /* ICALL, 1001 0101 0000 1001 */\r\n        const retAddr = cpu.pc + 1;\r\n        const sp = cpu.dataView.getUint16(93, true);\r\n        const { pc22Bits } = cpu;\r\n        cpu.data[sp] = retAddr & 255;\r\n        cpu.data[sp - 1] = (retAddr >> 8) & 255;\r\n        if (pc22Bits) {\r\n            cpu.data[sp - 2] = (retAddr >> 16) & 255;\r\n        }\r\n        cpu.dataView.setUint16(93, sp - (pc22Bits ? 3 : 2), true);\r\n        cpu.pc = cpu.dataView.getUint16(30, true) - 1;\r\n        cpu.cycles += pc22Bits ? 3 : 2;\r\n    }\r\n    else if (opcode === 0x9409) {\r\n        /* IJMP, 1001 0100 0000 1001 */\r\n        cpu.pc = cpu.dataView.getUint16(30, true) - 1;\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xf800) === 0xb000) {\r\n        /* IN, 1011 0AAd dddd AAAA */\r\n        const i = cpu.readData(((opcode & 0xf) | ((opcode & 0x600) >> 5)) + 32);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = i;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9403) {\r\n        /* INC, 1001 010d dddd 0011 */\r\n        const d = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const r = (d + 1) & 255;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = r;\r\n        let sreg = cpu.data[95] & 0xe1;\r\n        sreg |= r ? 0 : 2;\r\n        sreg |= 128 & r ? 4 : 0;\r\n        sreg |= 127 === d ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfe0e) === 0x940c) {\r\n        /* JMP, 1001 010k kkkk 110k kkkk kkkk kkkk kkkk */\r\n        cpu.pc = (cpu.progMem[cpu.pc + 1] | ((opcode & 1) << 16) | ((opcode & 0x1f0) << 13)) - 1;\r\n        cpu.cycles += 2;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9206) {\r\n        /* LAC, 1001 001r rrrr 0110 */\r\n        const r = (opcode & 0x1f0) >> 4;\r\n        const clear = cpu.data[r];\r\n        const value = cpu.readData(cpu.dataView.getUint16(30, true));\r\n        cpu.writeData(cpu.dataView.getUint16(30, true), value & (255 - clear));\r\n        cpu.data[r] = value;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9205) {\r\n        /* LAS, 1001 001r rrrr 0101 */\r\n        const r = (opcode & 0x1f0) >> 4;\r\n        const set = cpu.data[r];\r\n        const value = cpu.readData(cpu.dataView.getUint16(30, true));\r\n        cpu.writeData(cpu.dataView.getUint16(30, true), value | set);\r\n        cpu.data[r] = value;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9207) {\r\n        /* LAT, 1001 001r rrrr 0111 */\r\n        const r = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const R = cpu.readData(cpu.dataView.getUint16(30, true));\r\n        cpu.writeData(cpu.dataView.getUint16(30, true), r ^ R);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n    }\r\n    else if ((opcode & 0xf000) === 0xe000) {\r\n        /* LDI, 1110 KKKK dddd KKKK */\r\n        cpu.data[((opcode & 0xf0) >> 4) + 16] = (opcode & 0xf) | ((opcode & 0xf00) >> 4);\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9000) {\r\n        /* LDS, 1001 000d dddd 0000 kkkk kkkk kkkk kkkk */\r\n        cpu.cycles++;\r\n        const value = cpu.readData(cpu.progMem[cpu.pc + 1]);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = value;\r\n        cpu.pc++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x900c) {\r\n        /* LDX, 1001 000d dddd 1100 */\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(cpu.dataView.getUint16(26, true));\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x900d) {\r\n        /* LDX(INC), 1001 000d dddd 1101 */\r\n        const x = cpu.dataView.getUint16(26, true);\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(x);\r\n        cpu.dataView.setUint16(26, x + 1, true);\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x900e) {\r\n        /* LDX(DEC), 1001 000d dddd 1110 */\r\n        const x = cpu.dataView.getUint16(26, true) - 1;\r\n        cpu.dataView.setUint16(26, x, true);\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(x);\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x8008) {\r\n        /* LDY, 1000 000d dddd 1000 */\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(cpu.dataView.getUint16(28, true));\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9009) {\r\n        /* LDY(INC), 1001 000d dddd 1001 */\r\n        const y = cpu.dataView.getUint16(28, true);\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(y);\r\n        cpu.dataView.setUint16(28, y + 1, true);\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x900a) {\r\n        /* LDY(DEC), 1001 000d dddd 1010 */\r\n        const y = cpu.dataView.getUint16(28, true) - 1;\r\n        cpu.dataView.setUint16(28, y, true);\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(y);\r\n    }\r\n    else if ((opcode & 0xd208) === 0x8008 &&\r\n        (opcode & 7) | ((opcode & 0xc00) >> 7) | ((opcode & 0x2000) >> 8)) {\r\n        /* LDDY, 10q0 qq0d dddd 1qqq */\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(cpu.dataView.getUint16(28, true) +\r\n            ((opcode & 7) | ((opcode & 0xc00) >> 7) | ((opcode & 0x2000) >> 8)));\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x8000) {\r\n        /* LDZ, 1000 000d dddd 0000 */\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(cpu.dataView.getUint16(30, true));\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9001) {\r\n        /* LDZ(INC), 1001 000d dddd 0001 */\r\n        const z = cpu.dataView.getUint16(30, true);\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(z);\r\n        cpu.dataView.setUint16(30, z + 1, true);\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9002) {\r\n        /* LDZ(DEC), 1001 000d dddd 0010 */\r\n        const z = cpu.dataView.getUint16(30, true) - 1;\r\n        cpu.dataView.setUint16(30, z, true);\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(z);\r\n    }\r\n    else if ((opcode & 0xd208) === 0x8000 &&\r\n        (opcode & 7) | ((opcode & 0xc00) >> 7) | ((opcode & 0x2000) >> 8)) {\r\n        /* LDDZ, 10q0 qq0d dddd 0qqq */\r\n        cpu.cycles++;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.readData(cpu.dataView.getUint16(30, true) +\r\n            ((opcode & 7) | ((opcode & 0xc00) >> 7) | ((opcode & 0x2000) >> 8)));\r\n    }\r\n    else if (opcode === 0x95c8) {\r\n        /* LPM, 1001 0101 1100 1000 */\r\n        cpu.data[0] = cpu.progBytes[cpu.dataView.getUint16(30, true)];\r\n        cpu.cycles += 2;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9004) {\r\n        /* LPM(REG), 1001 000d dddd 0100 */\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.progBytes[cpu.dataView.getUint16(30, true)];\r\n        cpu.cycles += 2;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9005) {\r\n        /* LPM(INC), 1001 000d dddd 0101 */\r\n        const i = cpu.dataView.getUint16(30, true);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.progBytes[i];\r\n        cpu.dataView.setUint16(30, i + 1, true);\r\n        cpu.cycles += 2;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9406) {\r\n        /* LSR, 1001 010d dddd 0110 */\r\n        const value = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const R = value >>> 1;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xe0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= value & 1;\r\n        sreg |= ((sreg >> 2) & 1) ^ (sreg & 1) ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x2c00) {\r\n        /* MOV, 0010 11rd dddd rrrr */\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n    }\r\n    else if ((opcode & 0xff00) === 0x100) {\r\n        /* MOVW, 0000 0001 dddd rrrr */\r\n        const r2 = 2 * (opcode & 0xf);\r\n        const d2 = 2 * ((opcode & 0xf0) >> 4);\r\n        cpu.data[d2] = cpu.data[r2];\r\n        cpu.data[d2 + 1] = cpu.data[r2 + 1];\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x9c00) {\r\n        /* MUL, 1001 11rd dddd rrrr */\r\n        const R = cpu.data[(opcode & 0x1f0) >> 4] * cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        cpu.dataView.setUint16(0, R, true);\r\n        cpu.data[95] = (cpu.data[95] & 0xfc) | (0xffff & R ? 0 : 2) | (0x8000 & R ? 1 : 0);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xff00) === 0x200) {\r\n        /* MULS, 0000 0010 dddd rrrr */\r\n        const R = cpu.dataView.getInt8(((opcode & 0xf0) >> 4) + 16) * cpu.dataView.getInt8((opcode & 0xf) + 16);\r\n        cpu.dataView.setInt16(0, R, true);\r\n        cpu.data[95] = (cpu.data[95] & 0xfc) | (0xffff & R ? 0 : 2) | (0x8000 & R ? 1 : 0);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xff88) === 0x300) {\r\n        /* MULSU, 0000 0011 0ddd 0rrr */\r\n        const R = cpu.dataView.getInt8(((opcode & 0x70) >> 4) + 16) * cpu.data[(opcode & 7) + 16];\r\n        cpu.dataView.setInt16(0, R, true);\r\n        cpu.data[95] = (cpu.data[95] & 0xfc) | (0xffff & R ? 0 : 2) | (0x8000 & R ? 1 : 0);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9401) {\r\n        /* NEG, 1001 010d dddd 0001 */\r\n        const d = (opcode & 0x1f0) >> 4;\r\n        const value = cpu.data[d];\r\n        const R = 0 - value;\r\n        cpu.data[d] = R;\r\n        let sreg = cpu.data[95] & 0xc0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= 128 === R ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= R ? 1 : 0;\r\n        sreg |= 1 & (R | value) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if (opcode === 0) {\r\n        /* NOP, 0000 0000 0000 0000 */\r\n        /* NOP */\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x2800) {\r\n        /* OR, 0010 10rd dddd rrrr */\r\n        const R = cpu.data[(opcode & 0x1f0) >> 4] | cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xe1;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xf000) === 0x6000) {\r\n        /* SBR, 0110 KKKK dddd KKKK */\r\n        const R = cpu.data[((opcode & 0xf0) >> 4) + 16] | ((opcode & 0xf) | ((opcode & 0xf00) >> 4));\r\n        cpu.data[((opcode & 0xf0) >> 4) + 16] = R;\r\n        let sreg = cpu.data[95] & 0xe1;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xf800) === 0xb800) {\r\n        /* OUT, 1011 1AAr rrrr AAAA */\r\n        cpu.writeData(((opcode & 0xf) | ((opcode & 0x600) >> 5)) + 32, cpu.data[(opcode & 0x1f0) >> 4]);\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x900f) {\r\n        /* POP, 1001 000d dddd 1111 */\r\n        const value = cpu.dataView.getUint16(93, true) + 1;\r\n        cpu.dataView.setUint16(93, value, true);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = cpu.data[value];\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x920f) {\r\n        /* PUSH, 1001 001d dddd 1111 */\r\n        const value = cpu.dataView.getUint16(93, true);\r\n        cpu.data[value] = cpu.data[(opcode & 0x1f0) >> 4];\r\n        cpu.dataView.setUint16(93, value - 1, true);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xf000) === 0xd000) {\r\n        /* RCALL, 1101 kkkk kkkk kkkk */\r\n        const k = (opcode & 0x7ff) - (opcode & 0x800 ? 0x800 : 0);\r\n        const retAddr = cpu.pc + 1;\r\n        const sp = cpu.dataView.getUint16(93, true);\r\n        const { pc22Bits } = cpu;\r\n        cpu.data[sp] = 255 & retAddr;\r\n        cpu.data[sp - 1] = (retAddr >> 8) & 255;\r\n        if (pc22Bits) {\r\n            cpu.data[sp - 2] = (retAddr >> 16) & 255;\r\n        }\r\n        cpu.dataView.setUint16(93, sp - (pc22Bits ? 3 : 2), true);\r\n        cpu.pc += k;\r\n        cpu.cycles += pc22Bits ? 3 : 2;\r\n    }\r\n    else if (opcode === 0x9508) {\r\n        /* RET, 1001 0101 0000 1000 */\r\n        const { pc22Bits } = cpu;\r\n        const i = cpu.dataView.getUint16(93, true) + (pc22Bits ? 3 : 2);\r\n        cpu.dataView.setUint16(93, i, true);\r\n        cpu.pc = (cpu.data[i - 1] << 8) + cpu.data[i] - 1;\r\n        if (pc22Bits) {\r\n            cpu.pc |= cpu.data[i - 2] << 16;\r\n        }\r\n        cpu.cycles += pc22Bits ? 4 : 3;\r\n    }\r\n    else if (opcode === 0x9518) {\r\n        /* RETI, 1001 0101 0001 1000 */\r\n        const { pc22Bits } = cpu;\r\n        const i = cpu.dataView.getUint16(93, true) + (pc22Bits ? 3 : 2);\r\n        cpu.dataView.setUint16(93, i, true);\r\n        cpu.pc = (cpu.data[i - 1] << 8) + cpu.data[i] - 1;\r\n        if (pc22Bits) {\r\n            cpu.pc |= cpu.data[i - 2] << 16;\r\n        }\r\n        cpu.cycles += pc22Bits ? 4 : 3;\r\n        cpu.data[95] |= 0x80; // Enable interrupts\r\n    }\r\n    else if ((opcode & 0xf000) === 0xc000) {\r\n        /* RJMP, 1100 kkkk kkkk kkkk */\r\n        cpu.pc = cpu.pc + ((opcode & 0x7ff) - (opcode & 0x800 ? 0x800 : 0));\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9407) {\r\n        /* ROR, 1001 010d dddd 0111 */\r\n        const d = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const r = (d >>> 1) | ((cpu.data[95] & 1) << 7);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = r;\r\n        let sreg = cpu.data[95] & 0xe0;\r\n        sreg |= r ? 0 : 2;\r\n        sreg |= 128 & r ? 4 : 0;\r\n        sreg |= 1 & d ? 1 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ (sreg & 1) ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x800) {\r\n        /* SBC, 0000 10rd dddd rrrr */\r\n        const val1 = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const val2 = cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        let sreg = cpu.data[95];\r\n        const R = val1 - val2 - (sreg & 1);\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        sreg = (sreg & 0xc0) | (!R && (sreg >> 1) & 1 ? 2 : 0) | (val2 + (sreg & 1) > val1 ? 1 : 0);\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= (val1 ^ val2) & (val1 ^ R) & 128 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= 1 & ((~val1 & val2) | (val2 & R) | (R & ~val1)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xf000) === 0x4000) {\r\n        /* SBCI, 0100 KKKK dddd KKKK */\r\n        const val1 = cpu.data[((opcode & 0xf0) >> 4) + 16];\r\n        const val2 = (opcode & 0xf) | ((opcode & 0xf00) >> 4);\r\n        let sreg = cpu.data[95];\r\n        const R = val1 - val2 - (sreg & 1);\r\n        cpu.data[((opcode & 0xf0) >> 4) + 16] = R;\r\n        sreg = (sreg & 0xc0) | (!R && (sreg >> 1) & 1 ? 2 : 0) | (val2 + (sreg & 1) > val1 ? 1 : 0);\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= (val1 ^ val2) & (val1 ^ R) & 128 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= 1 & ((~val1 & val2) | (val2 & R) | (R & ~val1)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xff00) === 0x9a00) {\r\n        /* SBI, 1001 1010 AAAA Abbb */\r\n        const target = ((opcode & 0xf8) >> 3) + 32;\r\n        const mask = 1 << (opcode & 7);\r\n        cpu.writeData(target, cpu.readData(target) | mask, mask);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xff00) === 0x9900) {\r\n        /* SBIC, 1001 1001 AAAA Abbb */\r\n        const value = cpu.readData(((opcode & 0xf8) >> 3) + 32);\r\n        if (!(value & (1 << (opcode & 7)))) {\r\n            const nextOpcode = cpu.progMem[cpu.pc + 1];\r\n            const skipSize = isTwoWordInstruction(nextOpcode) ? 2 : 1;\r\n            cpu.cycles += skipSize;\r\n            cpu.pc += skipSize;\r\n        }\r\n    }\r\n    else if ((opcode & 0xff00) === 0x9b00) {\r\n        /* SBIS, 1001 1011 AAAA Abbb */\r\n        const value = cpu.readData(((opcode & 0xf8) >> 3) + 32);\r\n        if (value & (1 << (opcode & 7))) {\r\n            const nextOpcode = cpu.progMem[cpu.pc + 1];\r\n            const skipSize = isTwoWordInstruction(nextOpcode) ? 2 : 1;\r\n            cpu.cycles += skipSize;\r\n            cpu.pc += skipSize;\r\n        }\r\n    }\r\n    else if ((opcode & 0xff00) === 0x9700) {\r\n        /* SBIW, 1001 0111 KKdd KKKK */\r\n        const i = 2 * ((opcode & 0x30) >> 4) + 24;\r\n        const a = cpu.dataView.getUint16(i, true);\r\n        const l = (opcode & 0xf) | ((opcode & 0xc0) >> 2);\r\n        const R = a - l;\r\n        cpu.dataView.setUint16(i, R, true);\r\n        let sreg = cpu.data[95] & 0xc0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 0x8000 & R ? 4 : 0;\r\n        sreg |= a & ~R & 0x8000 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= l > a ? 1 : 0;\r\n        sreg |= 1 & ((~a & l) | (l & R) | (R & ~a)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe08) === 0xfc00) {\r\n        /* SBRC, 1111 110r rrrr 0bbb */\r\n        if (!(cpu.data[(opcode & 0x1f0) >> 4] & (1 << (opcode & 7)))) {\r\n            const nextOpcode = cpu.progMem[cpu.pc + 1];\r\n            const skipSize = isTwoWordInstruction(nextOpcode) ? 2 : 1;\r\n            cpu.cycles += skipSize;\r\n            cpu.pc += skipSize;\r\n        }\r\n    }\r\n    else if ((opcode & 0xfe08) === 0xfe00) {\r\n        /* SBRS, 1111 111r rrrr 0bbb */\r\n        if (cpu.data[(opcode & 0x1f0) >> 4] & (1 << (opcode & 7))) {\r\n            const nextOpcode = cpu.progMem[cpu.pc + 1];\r\n            const skipSize = isTwoWordInstruction(nextOpcode) ? 2 : 1;\r\n            cpu.cycles += skipSize;\r\n            cpu.pc += skipSize;\r\n        }\r\n    }\r\n    else if (opcode === 0x9588) {\r\n        /* SLEEP, 1001 0101 1000 1000 */\r\n        /* not implemented */\r\n    }\r\n    else if (opcode === 0x95e8) {\r\n        /* SPM, 1001 0101 1110 1000 */\r\n        /* not implemented */\r\n    }\r\n    else if (opcode === 0x95f8) {\r\n        /* SPM(INC), 1001 0101 1111 1000 */\r\n        /* not implemented */\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9200) {\r\n        /* STS, 1001 001d dddd 0000 kkkk kkkk kkkk kkkk */\r\n        const value = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const addr = cpu.progMem[cpu.pc + 1];\r\n        cpu.writeData(addr, value);\r\n        cpu.pc++;\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x920c) {\r\n        /* STX, 1001 001r rrrr 1100 */\r\n        cpu.writeData(cpu.dataView.getUint16(26, true), cpu.data[(opcode & 0x1f0) >> 4]);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x920d) {\r\n        /* STX(INC), 1001 001r rrrr 1101 */\r\n        const x = cpu.dataView.getUint16(26, true);\r\n        cpu.writeData(x, cpu.data[(opcode & 0x1f0) >> 4]);\r\n        cpu.dataView.setUint16(26, x + 1, true);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x920e) {\r\n        /* STX(DEC), 1001 001r rrrr 1110 */\r\n        const i = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const x = cpu.dataView.getUint16(26, true) - 1;\r\n        cpu.dataView.setUint16(26, x, true);\r\n        cpu.writeData(x, i);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x8208) {\r\n        /* STY, 1000 001r rrrr 1000 */\r\n        cpu.writeData(cpu.dataView.getUint16(28, true), cpu.data[(opcode & 0x1f0) >> 4]);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9209) {\r\n        /* STY(INC), 1001 001r rrrr 1001 */\r\n        const i = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const y = cpu.dataView.getUint16(28, true);\r\n        cpu.writeData(y, i);\r\n        cpu.dataView.setUint16(28, y + 1, true);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x920a) {\r\n        /* STY(DEC), 1001 001r rrrr 1010 */\r\n        const i = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const y = cpu.dataView.getUint16(28, true) - 1;\r\n        cpu.dataView.setUint16(28, y, true);\r\n        cpu.writeData(y, i);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xd208) === 0x8208 &&\r\n        (opcode & 7) | ((opcode & 0xc00) >> 7) | ((opcode & 0x2000) >> 8)) {\r\n        /* STDY, 10q0 qq1r rrrr 1qqq */\r\n        cpu.writeData(cpu.dataView.getUint16(28, true) +\r\n            ((opcode & 7) | ((opcode & 0xc00) >> 7) | ((opcode & 0x2000) >> 8)), cpu.data[(opcode & 0x1f0) >> 4]);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x8200) {\r\n        /* STZ, 1000 001r rrrr 0000 */\r\n        cpu.writeData(cpu.dataView.getUint16(30, true), cpu.data[(opcode & 0x1f0) >> 4]);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9201) {\r\n        /* STZ(INC), 1001 001r rrrr 0001 */\r\n        const z = cpu.dataView.getUint16(30, true);\r\n        cpu.writeData(z, cpu.data[(opcode & 0x1f0) >> 4]);\r\n        cpu.dataView.setUint16(30, z + 1, true);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9202) {\r\n        /* STZ(DEC), 1001 001r rrrr 0010 */\r\n        const i = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const z = cpu.dataView.getUint16(30, true) - 1;\r\n        cpu.dataView.setUint16(30, z, true);\r\n        cpu.writeData(z, i);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xd208) === 0x8200 &&\r\n        (opcode & 7) | ((opcode & 0xc00) >> 7) | ((opcode & 0x2000) >> 8)) {\r\n        /* STDZ, 10q0 qq1r rrrr 0qqq */\r\n        cpu.writeData(cpu.dataView.getUint16(30, true) +\r\n            ((opcode & 7) | ((opcode & 0xc00) >> 7) | ((opcode & 0x2000) >> 8)), cpu.data[(opcode & 0x1f0) >> 4]);\r\n        cpu.cycles++;\r\n    }\r\n    else if ((opcode & 0xfc00) === 0x1800) {\r\n        /* SUB, 0001 10rd dddd rrrr */\r\n        const val1 = cpu.data[(opcode & 0x1f0) >> 4];\r\n        const val2 = cpu.data[(opcode & 0xf) | ((opcode & 0x200) >> 5)];\r\n        const R = val1 - val2;\r\n        cpu.data[(opcode & 0x1f0) >> 4] = R;\r\n        let sreg = cpu.data[95] & 0xc0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= (val1 ^ val2) & (val1 ^ R) & 128 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= val2 > val1 ? 1 : 0;\r\n        sreg |= 1 & ((~val1 & val2) | (val2 & R) | (R & ~val1)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xf000) === 0x5000) {\r\n        /* SUBI, 0101 KKKK dddd KKKK */\r\n        const val1 = cpu.data[((opcode & 0xf0) >> 4) + 16];\r\n        const val2 = (opcode & 0xf) | ((opcode & 0xf00) >> 4);\r\n        const R = val1 - val2;\r\n        cpu.data[((opcode & 0xf0) >> 4) + 16] = R;\r\n        let sreg = cpu.data[95] & 0xc0;\r\n        sreg |= R ? 0 : 2;\r\n        sreg |= 128 & R ? 4 : 0;\r\n        sreg |= (val1 ^ val2) & (val1 ^ R) & 128 ? 8 : 0;\r\n        sreg |= ((sreg >> 2) & 1) ^ ((sreg >> 3) & 1) ? 0x10 : 0;\r\n        sreg |= val2 > val1 ? 1 : 0;\r\n        sreg |= 1 & ((~val1 & val2) | (val2 & R) | (R & ~val1)) ? 0x20 : 0;\r\n        cpu.data[95] = sreg;\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9402) {\r\n        /* SWAP, 1001 010d dddd 0010 */\r\n        const d = (opcode & 0x1f0) >> 4;\r\n        const i = cpu.data[d];\r\n        cpu.data[d] = ((15 & i) << 4) | ((240 & i) >>> 4);\r\n    }\r\n    else if (opcode === 0x95a8) {\r\n        /* WDR, 1001 0101 1010 1000 */\r\n        cpu.onWatchdogReset();\r\n    }\r\n    else if ((opcode & 0xfe0f) === 0x9204) {\r\n        /* XCH, 1001 001r rrrr 0100 */\r\n        const r = (opcode & 0x1f0) >> 4;\r\n        const val1 = cpu.data[r];\r\n        const val2 = cpu.data[cpu.dataView.getUint16(30, true)];\r\n        cpu.data[cpu.dataView.getUint16(30, true)] = val1;\r\n        cpu.data[r] = val2;\r\n    }\r\n    cpu.pc = (cpu.pc + 1) % cpu.progMem.length;\r\n    cpu.cycles++;\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 906, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/adc.js"],"sourcesContent":["/**\r\n * AVR-8 ADC\r\n * Part of AVR8js\r\n * Reference: http://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061A.pdf\r\n *\r\n * Copyright (C) 2019, 2020, 2021 Uri Shaked\r\n */\r\nexport var ADCReference;\r\n(function (ADCReference) {\r\n    ADCReference[ADCReference[\"AVCC\"] = 0] = \"AVCC\";\r\n    ADCReference[ADCReference[\"AREF\"] = 1] = \"AREF\";\r\n    ADCReference[ADCReference[\"Internal1V1\"] = 2] = \"Internal1V1\";\r\n    ADCReference[ADCReference[\"Internal2V56\"] = 3] = \"Internal2V56\";\r\n    ADCReference[ADCReference[\"Reserved\"] = 4] = \"Reserved\";\r\n})(ADCReference || (ADCReference = {}));\r\nexport var ADCMuxInputType;\r\n(function (ADCMuxInputType) {\r\n    ADCMuxInputType[ADCMuxInputType[\"SingleEnded\"] = 0] = \"SingleEnded\";\r\n    ADCMuxInputType[ADCMuxInputType[\"Differential\"] = 1] = \"Differential\";\r\n    ADCMuxInputType[ADCMuxInputType[\"Constant\"] = 2] = \"Constant\";\r\n    ADCMuxInputType[ADCMuxInputType[\"Temperature\"] = 3] = \"Temperature\";\r\n})(ADCMuxInputType || (ADCMuxInputType = {}));\r\nexport const atmega328Channels = {\r\n    0: { type: ADCMuxInputType.SingleEnded, channel: 0 },\r\n    1: { type: ADCMuxInputType.SingleEnded, channel: 1 },\r\n    2: { type: ADCMuxInputType.SingleEnded, channel: 2 },\r\n    3: { type: ADCMuxInputType.SingleEnded, channel: 3 },\r\n    4: { type: ADCMuxInputType.SingleEnded, channel: 4 },\r\n    5: { type: ADCMuxInputType.SingleEnded, channel: 5 },\r\n    6: { type: ADCMuxInputType.SingleEnded, channel: 6 },\r\n    7: { type: ADCMuxInputType.SingleEnded, channel: 7 },\r\n    8: { type: ADCMuxInputType.Temperature },\r\n    14: { type: ADCMuxInputType.Constant, voltage: 1.1 },\r\n    15: { type: ADCMuxInputType.Constant, voltage: 0 },\r\n};\r\nconst fallbackMuxInput = {\r\n    type: ADCMuxInputType.Constant,\r\n    voltage: 0,\r\n};\r\nexport const adcConfig = {\r\n    ADMUX: 0x7c,\r\n    ADCSRA: 0x7a,\r\n    ADCSRB: 0x7b,\r\n    ADCL: 0x78,\r\n    ADCH: 0x79,\r\n    DIDR0: 0x7e,\r\n    adcInterrupt: 0x2a,\r\n    numChannels: 8,\r\n    muxInputMask: 0xf,\r\n    muxChannels: atmega328Channels,\r\n    adcReferences: [\r\n        ADCReference.AREF,\r\n        ADCReference.AVCC,\r\n        ADCReference.Reserved,\r\n        ADCReference.Internal1V1,\r\n    ],\r\n};\r\n// Register bits:\r\nconst ADPS_MASK = 0x7;\r\nconst ADIE = 0x8;\r\nconst ADIF = 0x10;\r\nconst ADSC = 0x40;\r\nconst ADEN = 0x80;\r\nconst MUX_MASK = 0x1f;\r\nconst ADLAR = 0x20;\r\nconst MUX5 = 0x8;\r\nconst REFS2 = 0x8;\r\nconst REFS_MASK = 0x3;\r\nconst REFS_SHIFT = 6;\r\nexport class AVRADC {\r\n    constructor(cpu, config) {\r\n        this.cpu = cpu;\r\n        this.config = config;\r\n        /**\r\n         * ADC Channel values, in voltage (0..5). The number of channels depends on the chip.\r\n         *\r\n         * Changing the values here will change the ADC reading, unless you override onADCRead() with a custom implementation.\r\n         */\r\n        this.channelValues = new Array(this.config.numChannels);\r\n        /** AVCC Reference voltage */\r\n        this.avcc = 5;\r\n        /** AREF Reference voltage */\r\n        this.aref = 5;\r\n        /**\r\n         * Invoked whenever the code performs an ADC read.\r\n         *\r\n         * The default implementation reads the result from the `channelValues` array, and then calls\r\n         * `completeADCRead()` after `sampleCycles` CPU cycles.\r\n         *\r\n         * If you override the default implementation, make sure to call `completeADCRead()` after\r\n         * `sampleCycles` cycles (or else the ADC read will never complete).\r\n         */\r\n        this.onADCRead = (input) => {\r\n            var _a;\r\n            // Default implementation\r\n            let voltage = 0;\r\n            switch (input.type) {\r\n                case ADCMuxInputType.Constant:\r\n                    voltage = input.voltage;\r\n                    break;\r\n                case ADCMuxInputType.SingleEnded:\r\n                    voltage = (_a = this.channelValues[input.channel]) !== null && _a !== void 0 ? _a : 0;\r\n                    break;\r\n                case ADCMuxInputType.Differential:\r\n                    voltage =\r\n                        input.gain *\r\n                            ((this.channelValues[input.positiveChannel] || 0) -\r\n                                (this.channelValues[input.negativeChannel] || 0));\r\n                    break;\r\n                case ADCMuxInputType.Temperature:\r\n                    voltage = 0.378125; // 25 celcius\r\n                    break;\r\n            }\r\n            const rawValue = (voltage / this.referenceVoltage) * 1024;\r\n            const result = Math.min(Math.max(Math.floor(rawValue), 0), 1023);\r\n            this.cpu.addClockEvent(() => this.completeADCRead(result), this.sampleCycles);\r\n        };\r\n        this.converting = false;\r\n        this.conversionCycles = 25;\r\n        // Interrupts\r\n        this.ADC = {\r\n            address: this.config.adcInterrupt,\r\n            flagRegister: this.config.ADCSRA,\r\n            flagMask: ADIF,\r\n            enableRegister: this.config.ADCSRA,\r\n            enableMask: ADIE,\r\n        };\r\n        cpu.writeHooks[config.ADCSRA] = (value, oldValue) => {\r\n            var _a;\r\n            if (value & ADEN && !(oldValue && ADEN)) {\r\n                this.conversionCycles = 25;\r\n            }\r\n            cpu.data[config.ADCSRA] = value;\r\n            cpu.updateInterruptEnable(this.ADC, value);\r\n            if (!this.converting && value & ADSC) {\r\n                if (!(value & ADEN)) {\r\n                    // Special case: reading while the ADC is not enabled should return 0\r\n                    this.cpu.addClockEvent(() => this.completeADCRead(0), this.sampleCycles);\r\n                    return true;\r\n                }\r\n                let channel = this.cpu.data[this.config.ADMUX] & MUX_MASK;\r\n                if (cpu.data[config.ADCSRB] & MUX5) {\r\n                    channel |= 0x20;\r\n                }\r\n                channel &= config.muxInputMask;\r\n                const muxInput = (_a = config.muxChannels[channel]) !== null && _a !== void 0 ? _a : fallbackMuxInput;\r\n                this.converting = true;\r\n                this.onADCRead(muxInput);\r\n                return true; // don't update\r\n            }\r\n        };\r\n    }\r\n    completeADCRead(value) {\r\n        const { ADCL, ADCH, ADMUX, ADCSRA } = this.config;\r\n        this.converting = false;\r\n        this.conversionCycles = 13;\r\n        if (this.cpu.data[ADMUX] & ADLAR) {\r\n            this.cpu.data[ADCL] = (value << 6) & 0xff;\r\n            this.cpu.data[ADCH] = value >> 2;\r\n        }\r\n        else {\r\n            this.cpu.data[ADCL] = value & 0xff;\r\n            this.cpu.data[ADCH] = (value >> 8) & 0x3;\r\n        }\r\n        this.cpu.data[ADCSRA] &= ~ADSC;\r\n        this.cpu.setInterruptFlag(this.ADC);\r\n    }\r\n    get prescaler() {\r\n        const { ADCSRA } = this.config;\r\n        const adcsra = this.cpu.data[ADCSRA];\r\n        const adps = adcsra & ADPS_MASK;\r\n        switch (adps) {\r\n            case 0:\r\n            case 1:\r\n                return 2;\r\n            case 2:\r\n                return 4;\r\n            case 3:\r\n                return 8;\r\n            case 4:\r\n                return 16;\r\n            case 5:\r\n                return 32;\r\n            case 6:\r\n                return 64;\r\n            case 7:\r\n            default:\r\n                return 128;\r\n        }\r\n    }\r\n    get referenceVoltageType() {\r\n        var _a;\r\n        const { ADMUX, adcReferences } = this.config;\r\n        let refs = (this.cpu.data[ADMUX] >> REFS_SHIFT) & REFS_MASK;\r\n        if (adcReferences.length > 4 && this.cpu.data[ADMUX] & REFS2) {\r\n            refs |= 0x4;\r\n        }\r\n        return (_a = adcReferences[refs]) !== null && _a !== void 0 ? _a : ADCReference.Reserved;\r\n    }\r\n    get referenceVoltage() {\r\n        switch (this.referenceVoltageType) {\r\n            case ADCReference.AVCC:\r\n                return this.avcc;\r\n            case ADCReference.AREF:\r\n                return this.aref;\r\n            case ADCReference.Internal1V1:\r\n                return 1.1;\r\n            case ADCReference.Internal2V56:\r\n                return 2.56;\r\n            default:\r\n                return this.avcc;\r\n        }\r\n    }\r\n    get sampleCycles() {\r\n        return this.conversionCycles * this.prescaler;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1162, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/clock.js"],"sourcesContent":["/**\r\n * AVR8 Clock\r\n * Part of AVR8js\r\n * Reference: http://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061A.pdf\r\n *\r\n * Copyright (C) 2020, Uri Shaked\r\n */\r\nconst CLKPCE = 128;\r\nexport const clockConfig = {\r\n    CLKPR: 0x61,\r\n};\r\nconst prescalers = [\r\n    1, 2, 4, 8, 16, 32, 64, 128, 256,\r\n    // The following values are \"reserved\" according to the datasheet, so we measured\r\n    // with a scope to figure them out (on ATmega328p)\r\n    2, 4, 8, 16, 32, 64, 128,\r\n];\r\nexport class AVRClock {\r\n    constructor(cpu, baseFreqHz, config = clockConfig) {\r\n        this.cpu = cpu;\r\n        this.baseFreqHz = baseFreqHz;\r\n        this.config = config;\r\n        this.clockEnabledCycles = 0;\r\n        this.prescalerValue = 1;\r\n        this.cyclesDelta = 0;\r\n        this.cpu.writeHooks[this.config.CLKPR] = (clkpr) => {\r\n            if ((!this.clockEnabledCycles || this.clockEnabledCycles < cpu.cycles) && clkpr === CLKPCE) {\r\n                this.clockEnabledCycles = this.cpu.cycles + 4;\r\n            }\r\n            else if (this.clockEnabledCycles && this.clockEnabledCycles >= cpu.cycles) {\r\n                this.clockEnabledCycles = 0;\r\n                const index = clkpr & 0xf;\r\n                const oldPrescaler = this.prescalerValue;\r\n                this.prescalerValue = prescalers[index];\r\n                this.cpu.data[this.config.CLKPR] = index;\r\n                if (oldPrescaler !== this.prescalerValue) {\r\n                    this.cyclesDelta =\r\n                        (cpu.cycles + this.cyclesDelta) * (oldPrescaler / this.prescalerValue) - cpu.cycles;\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n    }\r\n    get frequency() {\r\n        return this.baseFreqHz / this.prescalerValue;\r\n    }\r\n    get prescaler() {\r\n        return this.prescalerValue;\r\n    }\r\n    get timeNanos() {\r\n        return ((this.cpu.cycles + this.cyclesDelta) / this.frequency) * 1e9;\r\n    }\r\n    get timeMicros() {\r\n        return ((this.cpu.cycles + this.cyclesDelta) / this.frequency) * 1e6;\r\n    }\r\n    get timeMillis() {\r\n        return ((this.cpu.cycles + this.cyclesDelta) / this.frequency) * 1e3;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;CAMC,GACD,MAAM,SAAS;AACR,MAAM,cAAc;IACvB,OAAO;AACX;AACA,MAAM,aAAa;IACf;IAAG;IAAG;IAAG;IAAG;IAAI;IAAI;IAAI;IAAK;IAC7B,iFAAiF;IACjF,kDAAkD;IAClD;IAAG;IAAG;IAAG;IAAI;IAAI;IAAI;CACxB;AACM,MAAM;IACT,YAAY,GAAG,EAAE,UAAU,EAAE,SAAS,WAAW,CAAE;QAC/C,IAAI,CAAC,GAAG,GAAG;QACX,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,kBAAkB,GAAG;QAC1B,IAAI,CAAC,cAAc,GAAG;QACtB,IAAI,CAAC,WAAW,GAAG;QACnB,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC;YACtC,IAAI,CAAC,CAAC,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,kBAAkB,GAAG,IAAI,MAAM,KAAK,UAAU,QAAQ;gBACxF,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG;YAChD,OACK,IAAI,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,kBAAkB,IAAI,IAAI,MAAM,EAAE;gBACvE,IAAI,CAAC,kBAAkB,GAAG;gBAC1B,MAAM,QAAQ,QAAQ;gBACtB,MAAM,eAAe,IAAI,CAAC,cAAc;gBACxC,IAAI,CAAC,cAAc,GAAG,UAAU,CAAC,MAAM;gBACvC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG;gBACnC,IAAI,iBAAiB,IAAI,CAAC,cAAc,EAAE;oBACtC,IAAI,CAAC,WAAW,GACZ,CAAC,IAAI,MAAM,GAAG,IAAI,CAAC,WAAW,IAAI,CAAC,eAAe,IAAI,CAAC,cAAc,IAAI,IAAI,MAAM;gBAC3F;YACJ;YACA,OAAO;QACX;IACJ;IACA,IAAI,YAAY;QACZ,OAAO,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,cAAc;IAChD;IACA,IAAI,YAAY;QACZ,OAAO,IAAI,CAAC,cAAc;IAC9B;IACA,IAAI,YAAY;QACZ,OAAO,AAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,SAAS,GAAI;IACrE;IACA,IAAI,aAAa;QACb,OAAO,AAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,SAAS,GAAI;IACrE;IACA,IAAI,aAAa;QACb,OAAO,AAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,SAAS,GAAI;IACrE;AACJ","ignoreList":[0]}},
    {"offset": {"line": 1242, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/eeprom.js"],"sourcesContent":["export class EEPROMMemoryBackend {\r\n    constructor(size) {\r\n        this.memory = new Uint8Array(size);\r\n        this.memory.fill(0xff);\r\n    }\r\n    readMemory(addr) {\r\n        return this.memory[addr];\r\n    }\r\n    writeMemory(addr, value) {\r\n        this.memory[addr] &= value;\r\n    }\r\n    eraseMemory(addr) {\r\n        this.memory[addr] = 0xff;\r\n    }\r\n}\r\nexport const eepromConfig = {\r\n    eepromReadyInterrupt: 0x2c,\r\n    EECR: 0x3f,\r\n    EEDR: 0x40,\r\n    EEARL: 0x41,\r\n    EEARH: 0x42,\r\n    eraseCycles: 28800,\r\n    writeCycles: 28800, // 1.8ms at 16MHz\r\n};\r\nconst EERE = 1 << 0;\r\nconst EEPE = 1 << 1;\r\nconst EEMPE = 1 << 2;\r\nconst EERIE = 1 << 3;\r\nconst EEPM0 = 1 << 4;\r\nconst EEPM1 = 1 << 5;\r\nconst EECR_WRITE_MASK = EEPE | EEMPE | EERIE | EEPM0 | EEPM1;\r\nexport class AVREEPROM {\r\n    constructor(cpu, backend, config = eepromConfig) {\r\n        this.cpu = cpu;\r\n        this.backend = backend;\r\n        this.config = config;\r\n        /**\r\n         * Used to keep track on the last write to EEMPE. From the datasheet:\r\n         * The EEMPE bit determines whether setting EEPE to one causes the EEPROM to be written.\r\n         * When EEMPE is set, setting EEPE within four clock cycles will write data to the EEPROM\r\n         * at the selected address If EEMPE is zero, setting EEPE will have no effect.\r\n         */\r\n        this.writeEnabledCycles = 0;\r\n        this.writeCompleteCycles = 0;\r\n        // Interrupts\r\n        this.EER = {\r\n            address: this.config.eepromReadyInterrupt,\r\n            flagRegister: this.config.EECR,\r\n            flagMask: EEPE,\r\n            enableRegister: this.config.EECR,\r\n            enableMask: EERIE,\r\n            constant: true,\r\n            inverseFlag: true,\r\n        };\r\n        this.cpu.writeHooks[this.config.EECR] = (eecr) => {\r\n            const { EEARH, EEARL, EECR, EEDR } = this.config;\r\n            const addr = (this.cpu.data[EEARH] << 8) | this.cpu.data[EEARL];\r\n            this.cpu.data[EECR] = (this.cpu.data[EECR] & ~EECR_WRITE_MASK) | (eecr & EECR_WRITE_MASK);\r\n            this.cpu.updateInterruptEnable(this.EER, eecr);\r\n            if (eecr & EERE) {\r\n                this.cpu.clearInterrupt(this.EER);\r\n            }\r\n            if (eecr & EEMPE) {\r\n                const eempeCycles = 4;\r\n                this.writeEnabledCycles = this.cpu.cycles + eempeCycles;\r\n                this.cpu.addClockEvent(() => {\r\n                    this.cpu.data[EECR] &= ~EEMPE;\r\n                }, eempeCycles);\r\n            }\r\n            // Read\r\n            if (eecr & EERE) {\r\n                this.cpu.data[EEDR] = this.backend.readMemory(addr);\r\n                // When the EEPROM is read, the CPU is halted for four cycles before the\r\n                // next instruction is executed.\r\n                this.cpu.cycles += 4;\r\n                return true;\r\n            }\r\n            // Write\r\n            if (eecr & EEPE) {\r\n                //  If EEMPE is zero, setting EEPE will have no effect.\r\n                if (this.cpu.cycles >= this.writeEnabledCycles) {\r\n                    this.cpu.data[EECR] &= ~EEPE;\r\n                    return true;\r\n                }\r\n                // Check for write-in-progress\r\n                if (this.cpu.cycles < this.writeCompleteCycles) {\r\n                    return true;\r\n                }\r\n                const eedr = this.cpu.data[EEDR];\r\n                this.writeCompleteCycles = this.cpu.cycles;\r\n                // Erase\r\n                if (!(eecr & EEPM1)) {\r\n                    this.backend.eraseMemory(addr);\r\n                    this.writeCompleteCycles += this.config.eraseCycles;\r\n                }\r\n                // Write\r\n                if (!(eecr & EEPM0)) {\r\n                    this.backend.writeMemory(addr, eedr);\r\n                    this.writeCompleteCycles += this.config.writeCycles;\r\n                }\r\n                this.cpu.data[EECR] |= EEPE;\r\n                this.cpu.addClockEvent(() => {\r\n                    this.cpu.setInterruptFlag(this.EER);\r\n                }, this.writeCompleteCycles - this.cpu.cycles);\r\n                // When EEPE has been set, the CPU is halted for two cycles before the\r\n                // next instruction is executed.\r\n                this.cpu.cycles += 2;\r\n            }\r\n            return true;\r\n        };\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1365, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/gpio.js"],"sourcesContent":["export const INT0 = {\r\n    EICR: 0x69,\r\n    EIMSK: 0x3d,\r\n    EIFR: 0x3c,\r\n    index: 0,\r\n    iscOffset: 0,\r\n    interrupt: 2,\r\n};\r\nexport const INT1 = {\r\n    EICR: 0x69,\r\n    EIMSK: 0x3d,\r\n    EIFR: 0x3c,\r\n    index: 1,\r\n    iscOffset: 2,\r\n    interrupt: 4,\r\n};\r\nexport const PCINT0 = {\r\n    PCIE: 0,\r\n    PCICR: 0x68,\r\n    PCIFR: 0x3b,\r\n    PCMSK: 0x6b,\r\n    pinChangeInterrupt: 6,\r\n    mask: 0xff,\r\n    offset: 0,\r\n};\r\nexport const PCINT1 = {\r\n    PCIE: 1,\r\n    PCICR: 0x68,\r\n    PCIFR: 0x3b,\r\n    PCMSK: 0x6c,\r\n    pinChangeInterrupt: 8,\r\n    mask: 0xff,\r\n    offset: 0,\r\n};\r\nexport const PCINT2 = {\r\n    PCIE: 2,\r\n    PCICR: 0x68,\r\n    PCIFR: 0x3b,\r\n    PCMSK: 0x6d,\r\n    pinChangeInterrupt: 10,\r\n    mask: 0xff,\r\n    offset: 0,\r\n};\r\nexport const portAConfig = {\r\n    PIN: 0x20,\r\n    DDR: 0x21,\r\n    PORT: 0x22,\r\n    externalInterrupts: [],\r\n};\r\nexport const portBConfig = {\r\n    PIN: 0x23,\r\n    DDR: 0x24,\r\n    PORT: 0x25,\r\n    // Interrupt settings\r\n    pinChange: PCINT0,\r\n    externalInterrupts: [],\r\n};\r\nexport const portCConfig = {\r\n    PIN: 0x26,\r\n    DDR: 0x27,\r\n    PORT: 0x28,\r\n    // Interrupt settings\r\n    pinChange: PCINT1,\r\n    externalInterrupts: [],\r\n};\r\nexport const portDConfig = {\r\n    PIN: 0x29,\r\n    DDR: 0x2a,\r\n    PORT: 0x2b,\r\n    // Interrupt settings\r\n    pinChange: PCINT2,\r\n    externalInterrupts: [null, null, INT0, INT1],\r\n};\r\nexport const portEConfig = {\r\n    PIN: 0x2c,\r\n    DDR: 0x2d,\r\n    PORT: 0x2e,\r\n    externalInterrupts: [],\r\n};\r\nexport const portFConfig = {\r\n    PIN: 0x2f,\r\n    DDR: 0x30,\r\n    PORT: 0x31,\r\n    externalInterrupts: [],\r\n};\r\nexport const portGConfig = {\r\n    PIN: 0x32,\r\n    DDR: 0x33,\r\n    PORT: 0x34,\r\n    externalInterrupts: [],\r\n};\r\nexport const portHConfig = {\r\n    PIN: 0x100,\r\n    DDR: 0x101,\r\n    PORT: 0x102,\r\n    externalInterrupts: [],\r\n};\r\nexport const portJConfig = {\r\n    PIN: 0x103,\r\n    DDR: 0x104,\r\n    PORT: 0x105,\r\n    externalInterrupts: [],\r\n};\r\nexport const portKConfig = {\r\n    PIN: 0x106,\r\n    DDR: 0x107,\r\n    PORT: 0x108,\r\n    externalInterrupts: [],\r\n};\r\nexport const portLConfig = {\r\n    PIN: 0x109,\r\n    DDR: 0x10a,\r\n    PORT: 0x10b,\r\n    externalInterrupts: [],\r\n};\r\nexport var PinState;\r\n(function (PinState) {\r\n    PinState[PinState[\"Low\"] = 0] = \"Low\";\r\n    PinState[PinState[\"High\"] = 1] = \"High\";\r\n    PinState[PinState[\"Input\"] = 2] = \"Input\";\r\n    PinState[PinState[\"InputPullUp\"] = 3] = \"InputPullUp\";\r\n})(PinState || (PinState = {}));\r\n/* This mechanism allows timers to override specific GPIO pins */\r\nexport var PinOverrideMode;\r\n(function (PinOverrideMode) {\r\n    PinOverrideMode[PinOverrideMode[\"None\"] = 0] = \"None\";\r\n    PinOverrideMode[PinOverrideMode[\"Enable\"] = 1] = \"Enable\";\r\n    PinOverrideMode[PinOverrideMode[\"Set\"] = 2] = \"Set\";\r\n    PinOverrideMode[PinOverrideMode[\"Clear\"] = 3] = \"Clear\";\r\n    PinOverrideMode[PinOverrideMode[\"Toggle\"] = 4] = \"Toggle\";\r\n})(PinOverrideMode || (PinOverrideMode = {}));\r\nvar InterruptMode;\r\n(function (InterruptMode) {\r\n    InterruptMode[InterruptMode[\"LowLevel\"] = 0] = \"LowLevel\";\r\n    InterruptMode[InterruptMode[\"Change\"] = 1] = \"Change\";\r\n    InterruptMode[InterruptMode[\"FallingEdge\"] = 2] = \"FallingEdge\";\r\n    InterruptMode[InterruptMode[\"RisingEdge\"] = 3] = \"RisingEdge\";\r\n})(InterruptMode || (InterruptMode = {}));\r\nexport class AVRIOPort {\r\n    constructor(cpu, portConfig) {\r\n        var _a, _b, _c, _d;\r\n        this.cpu = cpu;\r\n        this.portConfig = portConfig;\r\n        this.externalClockListeners = [];\r\n        this.listeners = [];\r\n        this.pinValue = 0;\r\n        this.overrideMask = 0xff;\r\n        this.overrideValue = 0;\r\n        this.lastValue = 0;\r\n        this.lastDdr = 0;\r\n        this.lastPin = 0;\r\n        this.openCollector = 0;\r\n        cpu.gpioPorts.add(this);\r\n        cpu.gpioByPort[portConfig.PORT] = this;\r\n        cpu.writeHooks[portConfig.DDR] = (value) => {\r\n            const portValue = cpu.data[portConfig.PORT];\r\n            cpu.data[portConfig.DDR] = value;\r\n            this.writeGpio(portValue, value);\r\n            this.updatePinRegister(value);\r\n            return true;\r\n        };\r\n        cpu.writeHooks[portConfig.PORT] = (value) => {\r\n            const ddrMask = cpu.data[portConfig.DDR];\r\n            cpu.data[portConfig.PORT] = value;\r\n            this.writeGpio(value, ddrMask);\r\n            this.updatePinRegister(ddrMask);\r\n            return true;\r\n        };\r\n        cpu.writeHooks[portConfig.PIN] = (value, oldValue, addr, mask) => {\r\n            // Writing to 1 PIN toggles PORT bits\r\n            const oldPortValue = cpu.data[portConfig.PORT];\r\n            const ddrMask = cpu.data[portConfig.DDR];\r\n            const portValue = oldPortValue ^ (value & mask);\r\n            cpu.data[portConfig.PORT] = portValue;\r\n            this.writeGpio(portValue, ddrMask);\r\n            this.updatePinRegister(ddrMask);\r\n            return true;\r\n        };\r\n        // External interrupts\r\n        const { externalInterrupts } = portConfig;\r\n        this.externalInts = externalInterrupts.map((externalConfig) => externalConfig\r\n            ? {\r\n                address: externalConfig.interrupt,\r\n                flagRegister: externalConfig.EIFR,\r\n                flagMask: 1 << externalConfig.index,\r\n                enableRegister: externalConfig.EIMSK,\r\n                enableMask: 1 << externalConfig.index,\r\n            }\r\n            : null);\r\n        const EICR = new Set(externalInterrupts.map((item) => item === null || item === void 0 ? void 0 : item.EICR));\r\n        for (const EICRx of EICR) {\r\n            this.attachInterruptHook(EICRx || 0);\r\n        }\r\n        const EIMSK = (_b = (_a = externalInterrupts.find((item) => item && item.EIMSK)) === null || _a === void 0 ? void 0 : _a.EIMSK) !== null && _b !== void 0 ? _b : 0;\r\n        this.attachInterruptHook(EIMSK, 'mask');\r\n        const EIFR = (_d = (_c = externalInterrupts.find((item) => item && item.EIFR)) === null || _c === void 0 ? void 0 : _c.EIFR) !== null && _d !== void 0 ? _d : 0;\r\n        this.attachInterruptHook(EIFR, 'flag');\r\n        // Pin change interrupts\r\n        const { pinChange } = portConfig;\r\n        this.PCINT = pinChange\r\n            ? {\r\n                address: pinChange.pinChangeInterrupt,\r\n                flagRegister: pinChange.PCIFR,\r\n                flagMask: 1 << pinChange.PCIE,\r\n                enableRegister: pinChange.PCICR,\r\n                enableMask: 1 << pinChange.PCIE,\r\n            }\r\n            : null;\r\n        if (pinChange) {\r\n            const { PCIFR, PCMSK } = pinChange;\r\n            cpu.writeHooks[PCIFR] = (value) => {\r\n                for (const gpio of this.cpu.gpioPorts) {\r\n                    const { PCINT } = gpio;\r\n                    if (PCINT) {\r\n                        cpu.clearInterruptByFlag(PCINT, value);\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n            cpu.writeHooks[PCMSK] = (value) => {\r\n                cpu.data[PCMSK] = value;\r\n                for (const gpio of this.cpu.gpioPorts) {\r\n                    const { PCINT } = gpio;\r\n                    if (PCINT) {\r\n                        cpu.updateInterruptEnable(PCINT, value);\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n        }\r\n    }\r\n    addListener(listener) {\r\n        this.listeners.push(listener);\r\n    }\r\n    removeListener(listener) {\r\n        this.listeners = this.listeners.filter((l) => l !== listener);\r\n    }\r\n    /**\r\n     * Get the state of a given GPIO pin\r\n     *\r\n     * @param index Pin index to return from 0 to 7\r\n     * @returns PinState.Low or PinState.High if the pin is set to output, PinState.Input if the pin is set\r\n     *   to input, and PinState.InputPullUp if the pin is set to input and the internal pull-up resistor has\r\n     *   been enabled.\r\n     */\r\n    pinState(index) {\r\n        const ddr = this.cpu.data[this.portConfig.DDR];\r\n        const port = this.cpu.data[this.portConfig.PORT];\r\n        const bitMask = 1 << index;\r\n        const openState = port & bitMask ? PinState.InputPullUp : PinState.Input;\r\n        const highValue = this.openCollector & bitMask ? openState : PinState.High;\r\n        if (ddr & bitMask) {\r\n            return this.lastValue & bitMask ? highValue : PinState.Low;\r\n        }\r\n        else {\r\n            return openState;\r\n        }\r\n    }\r\n    /**\r\n     * Sets the input value for the given pin. This is the value that\r\n     * will be returned when reading from the PIN register.\r\n     */\r\n    setPin(index, value) {\r\n        const bitMask = 1 << index;\r\n        this.pinValue &= ~bitMask;\r\n        if (value) {\r\n            this.pinValue |= bitMask;\r\n        }\r\n        this.updatePinRegister(this.cpu.data[this.portConfig.DDR]);\r\n    }\r\n    /**\r\n     * Internal method - do not call this directly!\r\n     * Used by the timer compare output units to override GPIO pins.\r\n     */\r\n    timerOverridePin(pin, mode) {\r\n        const { cpu, portConfig } = this;\r\n        const pinMask = 1 << pin;\r\n        if (mode === PinOverrideMode.None) {\r\n            this.overrideMask |= pinMask;\r\n            this.overrideValue &= ~pinMask;\r\n        }\r\n        else {\r\n            this.overrideMask &= ~pinMask;\r\n            switch (mode) {\r\n                case PinOverrideMode.Enable:\r\n                    this.overrideValue &= ~pinMask;\r\n                    this.overrideValue |= cpu.data[portConfig.PORT] & pinMask;\r\n                    break;\r\n                case PinOverrideMode.Set:\r\n                    this.overrideValue |= pinMask;\r\n                    break;\r\n                case PinOverrideMode.Clear:\r\n                    this.overrideValue &= ~pinMask;\r\n                    break;\r\n                case PinOverrideMode.Toggle:\r\n                    this.overrideValue ^= pinMask;\r\n                    break;\r\n            }\r\n        }\r\n        const ddrMask = cpu.data[portConfig.DDR];\r\n        this.writeGpio(cpu.data[portConfig.PORT], ddrMask);\r\n        this.updatePinRegister(ddrMask);\r\n    }\r\n    updatePinRegister(ddr) {\r\n        var _a, _b;\r\n        const newPin = (this.pinValue & ~ddr) | (this.lastValue & ddr);\r\n        this.cpu.data[this.portConfig.PIN] = newPin;\r\n        if (this.lastPin !== newPin) {\r\n            for (let index = 0; index < 8; index++) {\r\n                if ((newPin & (1 << index)) !== (this.lastPin & (1 << index))) {\r\n                    const value = !!(newPin & (1 << index));\r\n                    this.toggleInterrupt(index, value);\r\n                    (_b = (_a = this.externalClockListeners)[index]) === null || _b === void 0 ? void 0 : _b.call(_a, value);\r\n                }\r\n            }\r\n            this.lastPin = newPin;\r\n        }\r\n    }\r\n    toggleInterrupt(pin, risingEdge) {\r\n        const { cpu, portConfig, externalInts, PCINT } = this;\r\n        const { externalInterrupts, pinChange } = portConfig;\r\n        const externalConfig = externalInterrupts[pin];\r\n        const external = externalInts[pin];\r\n        if (external && externalConfig) {\r\n            const { EIMSK, index, EICR, iscOffset } = externalConfig;\r\n            if (cpu.data[EIMSK] & (1 << index)) {\r\n                const configuration = (cpu.data[EICR] >> iscOffset) & 0x3;\r\n                let generateInterrupt = false;\r\n                external.constant = false;\r\n                switch (configuration) {\r\n                    case InterruptMode.LowLevel:\r\n                        generateInterrupt = !risingEdge;\r\n                        external.constant = true;\r\n                        break;\r\n                    case InterruptMode.Change:\r\n                        generateInterrupt = true;\r\n                        break;\r\n                    case InterruptMode.FallingEdge:\r\n                        generateInterrupt = !risingEdge;\r\n                        break;\r\n                    case InterruptMode.RisingEdge:\r\n                        generateInterrupt = risingEdge;\r\n                        break;\r\n                }\r\n                if (generateInterrupt) {\r\n                    cpu.setInterruptFlag(external);\r\n                }\r\n                else if (external.constant) {\r\n                    cpu.clearInterrupt(external, true);\r\n                }\r\n            }\r\n        }\r\n        if (pinChange && PCINT && pinChange.mask & (1 << pin)) {\r\n            const { PCMSK } = pinChange;\r\n            if (cpu.data[PCMSK] & (1 << (pin + pinChange.offset))) {\r\n                cpu.setInterruptFlag(PCINT);\r\n            }\r\n        }\r\n    }\r\n    attachInterruptHook(register, registerType = 'other') {\r\n        if (!register) {\r\n            return;\r\n        }\r\n        const { cpu } = this;\r\n        cpu.writeHooks[register] = (value) => {\r\n            if (registerType !== 'flag') {\r\n                cpu.data[register] = value;\r\n            }\r\n            for (const gpio of cpu.gpioPorts) {\r\n                for (const external of gpio.externalInts) {\r\n                    if (external && registerType === 'mask') {\r\n                        cpu.updateInterruptEnable(external, value);\r\n                    }\r\n                    if (external && !external.constant && registerType === 'flag') {\r\n                        cpu.clearInterruptByFlag(external, value);\r\n                    }\r\n                }\r\n                gpio.checkExternalInterrupts();\r\n            }\r\n            return true;\r\n        };\r\n    }\r\n    checkExternalInterrupts() {\r\n        const { cpu } = this;\r\n        const { externalInterrupts } = this.portConfig;\r\n        for (let pin = 0; pin < 8; pin++) {\r\n            const external = externalInterrupts[pin];\r\n            if (!external) {\r\n                continue;\r\n            }\r\n            const pinValue = !!(this.lastPin & (1 << pin));\r\n            const { EIFR, EIMSK, index, EICR, iscOffset, interrupt } = external;\r\n            if (!(cpu.data[EIMSK] & (1 << index)) || pinValue) {\r\n                continue;\r\n            }\r\n            const configuration = (cpu.data[EICR] >> iscOffset) & 0x3;\r\n            if (configuration === InterruptMode.LowLevel) {\r\n                cpu.queueInterrupt({\r\n                    address: interrupt,\r\n                    flagRegister: EIFR,\r\n                    flagMask: 1 << index,\r\n                    enableRegister: EIMSK,\r\n                    enableMask: 1 << index,\r\n                    constant: true,\r\n                });\r\n            }\r\n        }\r\n    }\r\n    writeGpio(value, ddr) {\r\n        const newValue = (((value & this.overrideMask) | this.overrideValue) & ddr) | (value & ~ddr);\r\n        const prevValue = this.lastValue;\r\n        if (newValue !== prevValue || ddr !== this.lastDdr) {\r\n            this.lastValue = newValue;\r\n            this.lastDdr = ddr;\r\n            for (const listener of this.listeners) {\r\n                listener(newValue, prevValue);\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1823, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/spi.js"],"sourcesContent":["// Register bits:\r\nconst SPCR_SPIE = 0x80; // SPI Interrupt Enable\r\nconst SPCR_SPE = 0x40; // SPI Enable\r\nconst SPCR_DORD = 0x20; // Data Order\r\nconst SPCR_MSTR = 0x10; // Master/Slave Select\r\nconst SPCR_CPOL = 0x8; // Clock Polarity\r\nconst SPCR_CPHA = 0x4; // Clock Phase\r\nconst SPCR_SPR1 = 0x2; // SPI Clock Rate Select 1\r\nconst SPCR_SPR0 = 0x1; // SPI Clock Rate Select 0\r\nconst SPSR_SPR_MASK = SPCR_SPR1 | SPCR_SPR0;\r\nconst SPSR_SPIF = 0x80; // SPI Interrupt Flag\r\nconst SPSR_WCOL = 0x40; // Write COLlision Flag\r\nconst SPSR_SPI2X = 0x1; // Double SPI Speed Bit\r\nexport const spiConfig = {\r\n    spiInterrupt: 0x22,\r\n    SPCR: 0x4c,\r\n    SPSR: 0x4d,\r\n    SPDR: 0x4e,\r\n};\r\nconst bitsPerByte = 8;\r\nexport class AVRSPI {\r\n    constructor(cpu, config, freqHz) {\r\n        this.cpu = cpu;\r\n        this.config = config;\r\n        this.freqHz = freqHz;\r\n        /** @deprecated Use onByte() instead */\r\n        this.onTransfer = () => 0;\r\n        /**\r\n         * SPI byte transfer callback. Invoked whenever the user code starts an SPI transaction.\r\n         * You can override this with your own SPI handler logic.\r\n         *\r\n         * The callback receives a argument: the byte sent over the SPI MOSI line.\r\n         * It should call `completeTransfer()` within `transferCycles` CPU cycles.\r\n         */\r\n        this.onByte = (value) => {\r\n            const valueIn = this.onTransfer(value);\r\n            this.cpu.addClockEvent(() => this.completeTransfer(valueIn), this.transferCycles);\r\n        };\r\n        this.transmissionActive = false;\r\n        // Interrupts\r\n        this.SPI = {\r\n            address: this.config.spiInterrupt,\r\n            flagRegister: this.config.SPSR,\r\n            flagMask: SPSR_SPIF,\r\n            enableRegister: this.config.SPCR,\r\n            enableMask: SPCR_SPIE,\r\n        };\r\n        const { SPCR, SPSR, SPDR } = config;\r\n        cpu.writeHooks[SPDR] = (value) => {\r\n            if (!(cpu.data[SPCR] & SPCR_SPE)) {\r\n                // SPI not enabled, ignore write\r\n                return;\r\n            }\r\n            // Write collision\r\n            if (this.transmissionActive) {\r\n                cpu.data[SPSR] |= SPSR_WCOL;\r\n                return true;\r\n            }\r\n            // Clear write collision / interrupt flags\r\n            cpu.data[SPSR] &= ~SPSR_WCOL;\r\n            this.cpu.clearInterrupt(this.SPI);\r\n            this.transmissionActive = true;\r\n            this.onByte(value);\r\n            return true;\r\n        };\r\n        cpu.writeHooks[SPCR] = (value) => {\r\n            this.cpu.updateInterruptEnable(this.SPI, value);\r\n        };\r\n        cpu.writeHooks[SPSR] = (value) => {\r\n            this.cpu.data[SPSR] = value;\r\n            this.cpu.clearInterruptByFlag(this.SPI, value);\r\n        };\r\n    }\r\n    reset() {\r\n        this.transmissionActive = false;\r\n    }\r\n    /**\r\n     * Completes an SPI transaction. Call this method only from the `onByte` callback.\r\n     *\r\n     * @param receivedByte Byte read from the SPI MISO line.\r\n     */\r\n    completeTransfer(receivedByte) {\r\n        const { SPDR } = this.config;\r\n        this.cpu.data[SPDR] = receivedByte;\r\n        this.cpu.setInterruptFlag(this.SPI);\r\n        this.transmissionActive = false;\r\n    }\r\n    get isMaster() {\r\n        return this.cpu.data[this.config.SPCR] & SPCR_MSTR ? true : false;\r\n    }\r\n    get dataOrder() {\r\n        return this.cpu.data[this.config.SPCR] & SPCR_DORD ? 'lsbFirst' : 'msbFirst';\r\n    }\r\n    get spiMode() {\r\n        const CPHA = this.cpu.data[this.config.SPCR] & SPCR_CPHA;\r\n        const CPOL = this.cpu.data[this.config.SPCR] & SPCR_CPOL;\r\n        return ((CPHA ? 2 : 0) | (CPOL ? 1 : 0));\r\n    }\r\n    /**\r\n     * The clock divider is only relevant for Master mode\r\n     */\r\n    get clockDivider() {\r\n        const base = this.cpu.data[this.config.SPSR] & SPSR_SPI2X ? 2 : 4;\r\n        switch (this.cpu.data[this.config.SPCR] & SPSR_SPR_MASK) {\r\n            case 0b00:\r\n                return base;\r\n            case 0b01:\r\n                return base * 4;\r\n            case 0b10:\r\n                return base * 16;\r\n            case 0b11:\r\n                return base * 32;\r\n        }\r\n        // We should never get here:\r\n        throw new Error('Invalid divider value!');\r\n    }\r\n    /** Number of cycles to complete a single byte SPI transaction */\r\n    get transferCycles() {\r\n        return this.clockDivider * bitsPerByte;\r\n    }\r\n    /**\r\n     * The SPI freqeuncy is only relevant to Master mode.\r\n     * In slave mode, the frequency can be as high as F(osc) / 4.\r\n     */\r\n    get spiFrequency() {\r\n        return this.freqHz / this.clockDivider;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1955, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/timer.js"],"sourcesContent":["/**\r\n * AVR-8 Timers\r\n * Part of AVR8js\r\n * Reference: http://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061A.pdf\r\n *\r\n * Copyright (C) 2019, 2020, 2021 Uri Shaked\r\n */\r\nimport { PinOverrideMode, portBConfig, portDConfig } from './gpio';\r\nconst timer01Dividers = {\r\n    0: 0,\r\n    1: 1,\r\n    2: 8,\r\n    3: 64,\r\n    4: 256,\r\n    5: 1024,\r\n    6: 0,\r\n    7: 0, // Ditto\r\n};\r\nvar ExternalClockMode;\r\n(function (ExternalClockMode) {\r\n    ExternalClockMode[ExternalClockMode[\"FallingEdge\"] = 6] = \"FallingEdge\";\r\n    ExternalClockMode[ExternalClockMode[\"RisingEdge\"] = 7] = \"RisingEdge\";\r\n})(ExternalClockMode || (ExternalClockMode = {}));\r\n/** These are differnet for some devices (e.g. ATtiny85) */\r\nconst defaultTimerBits = {\r\n    // TIFR bits\r\n    TOV: 1,\r\n    OCFA: 2,\r\n    OCFB: 4,\r\n    OCFC: 0,\r\n    // TIMSK bits\r\n    TOIE: 1,\r\n    OCIEA: 2,\r\n    OCIEB: 4,\r\n    OCIEC: 0, // Unused\r\n};\r\nexport const timer0Config = Object.assign({ bits: 8, captureInterrupt: 0, compAInterrupt: 0x1c, compBInterrupt: 0x1e, compCInterrupt: 0, ovfInterrupt: 0x20, TIFR: 0x35, OCRA: 0x47, OCRB: 0x48, OCRC: 0, ICR: 0, TCNT: 0x46, TCCRA: 0x44, TCCRB: 0x45, TCCRC: 0, TIMSK: 0x6e, dividers: timer01Dividers, compPortA: portDConfig.PORT, compPinA: 6, compPortB: portDConfig.PORT, compPinB: 5, compPortC: 0, compPinC: 0, externalClockPort: portDConfig.PORT, externalClockPin: 4 }, defaultTimerBits);\r\nexport const timer1Config = Object.assign({ bits: 16, captureInterrupt: 0x14, compAInterrupt: 0x16, compBInterrupt: 0x18, compCInterrupt: 0, ovfInterrupt: 0x1a, TIFR: 0x36, OCRA: 0x88, OCRB: 0x8a, OCRC: 0, ICR: 0x86, TCNT: 0x84, TCCRA: 0x80, TCCRB: 0x81, TCCRC: 0x82, TIMSK: 0x6f, dividers: timer01Dividers, compPortA: portBConfig.PORT, compPinA: 1, compPortB: portBConfig.PORT, compPinB: 2, compPortC: 0, compPinC: 0, externalClockPort: portDConfig.PORT, externalClockPin: 5 }, defaultTimerBits);\r\nexport const timer2Config = Object.assign({ bits: 8, captureInterrupt: 0, compAInterrupt: 0x0e, compBInterrupt: 0x10, compCInterrupt: 0, ovfInterrupt: 0x12, TIFR: 0x37, OCRA: 0xb3, OCRB: 0xb4, OCRC: 0, ICR: 0, TCNT: 0xb2, TCCRA: 0xb0, TCCRB: 0xb1, TCCRC: 0, TIMSK: 0x70, dividers: {\r\n        0: 0,\r\n        1: 1,\r\n        2: 8,\r\n        3: 32,\r\n        4: 64,\r\n        5: 128,\r\n        6: 256,\r\n        7: 1024,\r\n    }, compPortA: portBConfig.PORT, compPinA: 3, compPortB: portDConfig.PORT, compPinB: 3, compPortC: 0, compPinC: 0, externalClockPort: 0, externalClockPin: 0 }, defaultTimerBits);\r\n/* All the following types and constants are related to WGM (Waveform Generation Mode) bits: */\r\nvar TimerMode;\r\n(function (TimerMode) {\r\n    TimerMode[TimerMode[\"Normal\"] = 0] = \"Normal\";\r\n    TimerMode[TimerMode[\"PWMPhaseCorrect\"] = 1] = \"PWMPhaseCorrect\";\r\n    TimerMode[TimerMode[\"CTC\"] = 2] = \"CTC\";\r\n    TimerMode[TimerMode[\"FastPWM\"] = 3] = \"FastPWM\";\r\n    TimerMode[TimerMode[\"PWMPhaseFrequencyCorrect\"] = 4] = \"PWMPhaseFrequencyCorrect\";\r\n    TimerMode[TimerMode[\"Reserved\"] = 5] = \"Reserved\";\r\n})(TimerMode || (TimerMode = {}));\r\nvar TOVUpdateMode;\r\n(function (TOVUpdateMode) {\r\n    TOVUpdateMode[TOVUpdateMode[\"Max\"] = 0] = \"Max\";\r\n    TOVUpdateMode[TOVUpdateMode[\"Top\"] = 1] = \"Top\";\r\n    TOVUpdateMode[TOVUpdateMode[\"Bottom\"] = 2] = \"Bottom\";\r\n})(TOVUpdateMode || (TOVUpdateMode = {}));\r\nvar OCRUpdateMode;\r\n(function (OCRUpdateMode) {\r\n    OCRUpdateMode[OCRUpdateMode[\"Immediate\"] = 0] = \"Immediate\";\r\n    OCRUpdateMode[OCRUpdateMode[\"Top\"] = 1] = \"Top\";\r\n    OCRUpdateMode[OCRUpdateMode[\"Bottom\"] = 2] = \"Bottom\";\r\n})(OCRUpdateMode || (OCRUpdateMode = {}));\r\nconst TopOCRA = 1;\r\nconst TopICR = 2;\r\n// Enable Toggle mode for OCxA in PWM Wave Generation mode\r\nconst OCToggle = 1;\r\nconst { Normal, PWMPhaseCorrect, CTC, FastPWM, Reserved, PWMPhaseFrequencyCorrect } = TimerMode;\r\nconst wgmModes8Bit = [\r\n    /*0*/ [Normal, 0xff, OCRUpdateMode.Immediate, TOVUpdateMode.Max, 0],\r\n    /*1*/ [PWMPhaseCorrect, 0xff, OCRUpdateMode.Top, TOVUpdateMode.Bottom, 0],\r\n    /*2*/ [CTC, TopOCRA, OCRUpdateMode.Immediate, TOVUpdateMode.Max, 0],\r\n    /*3*/ [FastPWM, 0xff, OCRUpdateMode.Bottom, TOVUpdateMode.Max, 0],\r\n    /*4*/ [Reserved, 0xff, OCRUpdateMode.Immediate, TOVUpdateMode.Max, 0],\r\n    /*5*/ [PWMPhaseCorrect, TopOCRA, OCRUpdateMode.Top, TOVUpdateMode.Bottom, OCToggle],\r\n    /*6*/ [Reserved, 0xff, OCRUpdateMode.Immediate, TOVUpdateMode.Max, 0],\r\n    /*7*/ [FastPWM, TopOCRA, OCRUpdateMode.Bottom, TOVUpdateMode.Top, OCToggle],\r\n];\r\n// Table 16-4 in the datasheet\r\nconst wgmModes16Bit = [\r\n    /*0 */ [Normal, 0xffff, OCRUpdateMode.Immediate, TOVUpdateMode.Max, 0],\r\n    /*1 */ [PWMPhaseCorrect, 0x00ff, OCRUpdateMode.Top, TOVUpdateMode.Bottom, 0],\r\n    /*2 */ [PWMPhaseCorrect, 0x01ff, OCRUpdateMode.Top, TOVUpdateMode.Bottom, 0],\r\n    /*3 */ [PWMPhaseCorrect, 0x03ff, OCRUpdateMode.Top, TOVUpdateMode.Bottom, 0],\r\n    /*4 */ [CTC, TopOCRA, OCRUpdateMode.Immediate, TOVUpdateMode.Max, 0],\r\n    /*5 */ [FastPWM, 0x00ff, OCRUpdateMode.Bottom, TOVUpdateMode.Top, 0],\r\n    /*6 */ [FastPWM, 0x01ff, OCRUpdateMode.Bottom, TOVUpdateMode.Top, 0],\r\n    /*7 */ [FastPWM, 0x03ff, OCRUpdateMode.Bottom, TOVUpdateMode.Top, 0],\r\n    /*8 */ [PWMPhaseFrequencyCorrect, TopICR, OCRUpdateMode.Bottom, TOVUpdateMode.Bottom, 0],\r\n    /*9 */ [PWMPhaseFrequencyCorrect, TopOCRA, OCRUpdateMode.Bottom, TOVUpdateMode.Bottom, OCToggle],\r\n    /*10*/ [PWMPhaseCorrect, TopICR, OCRUpdateMode.Top, TOVUpdateMode.Bottom, 0],\r\n    /*11*/ [PWMPhaseCorrect, TopOCRA, OCRUpdateMode.Top, TOVUpdateMode.Bottom, OCToggle],\r\n    /*12*/ [CTC, TopICR, OCRUpdateMode.Immediate, TOVUpdateMode.Max, 0],\r\n    /*13*/ [Reserved, 0xffff, OCRUpdateMode.Immediate, TOVUpdateMode.Max, 0],\r\n    /*14*/ [FastPWM, TopICR, OCRUpdateMode.Bottom, TOVUpdateMode.Top, OCToggle],\r\n    /*15*/ [FastPWM, TopOCRA, OCRUpdateMode.Bottom, TOVUpdateMode.Top, OCToggle],\r\n];\r\nfunction compToOverride(comp) {\r\n    switch (comp) {\r\n        case 1:\r\n            return PinOverrideMode.Toggle;\r\n        case 2:\r\n            return PinOverrideMode.Clear;\r\n        case 3:\r\n            return PinOverrideMode.Set;\r\n        default:\r\n            return PinOverrideMode.Enable;\r\n    }\r\n}\r\n// Force Output Compare (FOC) bits\r\nconst FOCA = 1 << 7;\r\nconst FOCB = 1 << 6;\r\nconst FOCC = 1 << 5;\r\nexport class AVRTimer {\r\n    constructor(cpu, config) {\r\n        this.cpu = cpu;\r\n        this.config = config;\r\n        this.MAX = this.config.bits === 16 ? 0xffff : 0xff;\r\n        this.lastCycle = 0;\r\n        this.ocrA = 0;\r\n        this.nextOcrA = 0;\r\n        this.ocrB = 0;\r\n        this.nextOcrB = 0;\r\n        this.hasOCRC = this.config.OCRC > 0;\r\n        this.ocrC = 0;\r\n        this.nextOcrC = 0;\r\n        this.ocrUpdateMode = OCRUpdateMode.Immediate;\r\n        this.tovUpdateMode = TOVUpdateMode.Max;\r\n        this.icr = 0; // only for 16-bit timers\r\n        this.tcnt = 0;\r\n        this.tcntNext = 0;\r\n        this.tcntUpdated = false;\r\n        this.updateDivider = false;\r\n        this.countingUp = true;\r\n        this.divider = 0;\r\n        this.externalClockRisingEdge = false;\r\n        // This is the temporary register used to access 16-bit registers (section 16.3 of the datasheet)\r\n        this.highByteTemp = 0;\r\n        // Interrupts\r\n        this.OVF = {\r\n            address: this.config.ovfInterrupt,\r\n            flagRegister: this.config.TIFR,\r\n            flagMask: this.config.TOV,\r\n            enableRegister: this.config.TIMSK,\r\n            enableMask: this.config.TOIE,\r\n        };\r\n        this.OCFA = {\r\n            address: this.config.compAInterrupt,\r\n            flagRegister: this.config.TIFR,\r\n            flagMask: this.config.OCFA,\r\n            enableRegister: this.config.TIMSK,\r\n            enableMask: this.config.OCIEA,\r\n        };\r\n        this.OCFB = {\r\n            address: this.config.compBInterrupt,\r\n            flagRegister: this.config.TIFR,\r\n            flagMask: this.config.OCFB,\r\n            enableRegister: this.config.TIMSK,\r\n            enableMask: this.config.OCIEB,\r\n        };\r\n        this.OCFC = {\r\n            address: this.config.compCInterrupt,\r\n            flagRegister: this.config.TIFR,\r\n            flagMask: this.config.OCFC,\r\n            enableRegister: this.config.TIMSK,\r\n            enableMask: this.config.OCIEC,\r\n        };\r\n        this.count = (reschedule = true, external = false) => {\r\n            const { divider, lastCycle, cpu } = this;\r\n            const { cycles } = cpu;\r\n            const delta = cycles - lastCycle;\r\n            if ((divider && delta >= divider) || external) {\r\n                const counterDelta = external ? 1 : Math.floor(delta / divider);\r\n                this.lastCycle += counterDelta * divider;\r\n                const val = this.tcnt;\r\n                const { timerMode, TOP } = this;\r\n                const phasePwm = timerMode === PWMPhaseCorrect || timerMode === PWMPhaseFrequencyCorrect;\r\n                const newVal = phasePwm\r\n                    ? this.phasePwmCount(val, counterDelta)\r\n                    : (val + counterDelta) % (TOP + 1);\r\n                const overflow = val + counterDelta > TOP;\r\n                // A CPU write overrides (has priority over) all counter clear or count operations.\r\n                if (!this.tcntUpdated) {\r\n                    this.tcnt = newVal;\r\n                    if (!phasePwm) {\r\n                        this.timerUpdated(newVal, val);\r\n                    }\r\n                }\r\n                if (!phasePwm) {\r\n                    if (timerMode === FastPWM && overflow) {\r\n                        const { compA, compB } = this;\r\n                        if (compA) {\r\n                            this.updateCompPin(compA, 'A', true);\r\n                        }\r\n                        if (compB) {\r\n                            this.updateCompPin(compB, 'B', true);\r\n                        }\r\n                    }\r\n                    if (this.ocrUpdateMode == OCRUpdateMode.Bottom && overflow) {\r\n                        // OCRUpdateMode.Top only occurs in Phase Correct modes, handled by phasePwmCount()\r\n                        this.ocrA = this.nextOcrA;\r\n                        this.ocrB = this.nextOcrB;\r\n                        this.ocrC = this.nextOcrC;\r\n                    }\r\n                    // OCRUpdateMode.Bottom only occurs in Phase Correct modes, handled by phasePwmCount().\r\n                    // Thus we only handle TOVUpdateMode.Top or TOVUpdateMode.Max here.\r\n                    if (overflow && (this.tovUpdateMode == TOVUpdateMode.Top || TOP === this.MAX)) {\r\n                        cpu.setInterruptFlag(this.OVF);\r\n                    }\r\n                }\r\n            }\r\n            if (this.tcntUpdated) {\r\n                this.tcnt = this.tcntNext;\r\n                this.tcntUpdated = false;\r\n                if ((this.tcnt === 0 && this.ocrUpdateMode === OCRUpdateMode.Bottom) ||\r\n                    (this.tcnt === this.TOP && this.ocrUpdateMode === OCRUpdateMode.Top)) {\r\n                    this.ocrA = this.nextOcrA;\r\n                    this.ocrB = this.nextOcrB;\r\n                    this.ocrC = this.nextOcrC;\r\n                }\r\n            }\r\n            if (this.updateDivider) {\r\n                const { CS } = this;\r\n                const { externalClockPin } = this.config;\r\n                const newDivider = this.config.dividers[CS];\r\n                this.lastCycle = newDivider ? this.cpu.cycles : 0;\r\n                this.updateDivider = false;\r\n                this.divider = newDivider;\r\n                if (this.config.externalClockPort && !this.externalClockPort) {\r\n                    this.externalClockPort = this.cpu.gpioByPort[this.config.externalClockPort];\r\n                }\r\n                if (this.externalClockPort) {\r\n                    this.externalClockPort.externalClockListeners[externalClockPin] = null;\r\n                }\r\n                if (newDivider) {\r\n                    cpu.addClockEvent(this.count, this.lastCycle + newDivider - cpu.cycles);\r\n                }\r\n                else if (this.externalClockPort &&\r\n                    (CS === ExternalClockMode.FallingEdge || CS === ExternalClockMode.RisingEdge)) {\r\n                    this.externalClockPort.externalClockListeners[externalClockPin] =\r\n                        this.externalClockCallback;\r\n                    this.externalClockRisingEdge = CS === ExternalClockMode.RisingEdge;\r\n                }\r\n                return;\r\n            }\r\n            if (reschedule && divider) {\r\n                cpu.addClockEvent(this.count, this.lastCycle + divider - cpu.cycles);\r\n            }\r\n        };\r\n        this.externalClockCallback = (value) => {\r\n            if (value === this.externalClockRisingEdge) {\r\n                this.count(false, true);\r\n            }\r\n        };\r\n        this.updateWGMConfig();\r\n        this.cpu.readHooks[config.TCNT] = (addr) => {\r\n            this.count(false);\r\n            if (this.config.bits === 16) {\r\n                this.cpu.data[addr + 1] = this.tcnt >> 8;\r\n            }\r\n            return (this.cpu.data[addr] = this.tcnt & 0xff);\r\n        };\r\n        this.cpu.writeHooks[config.TCNT] = (value) => {\r\n            this.tcntNext = (this.highByteTemp << 8) | value;\r\n            this.countingUp = true;\r\n            this.tcntUpdated = true;\r\n            this.cpu.updateClockEvent(this.count, 0);\r\n            if (this.divider) {\r\n                this.timerUpdated(this.tcntNext, this.tcntNext);\r\n            }\r\n        };\r\n        this.cpu.writeHooks[config.OCRA] = (value) => {\r\n            this.nextOcrA = (this.highByteTemp << 8) | value;\r\n            if (this.ocrUpdateMode === OCRUpdateMode.Immediate) {\r\n                this.ocrA = this.nextOcrA;\r\n            }\r\n        };\r\n        this.cpu.writeHooks[config.OCRB] = (value) => {\r\n            this.nextOcrB = (this.highByteTemp << 8) | value;\r\n            if (this.ocrUpdateMode === OCRUpdateMode.Immediate) {\r\n                this.ocrB = this.nextOcrB;\r\n            }\r\n        };\r\n        if (this.hasOCRC) {\r\n            this.cpu.writeHooks[config.OCRC] = (value) => {\r\n                this.nextOcrC = (this.highByteTemp << 8) | value;\r\n                if (this.ocrUpdateMode === OCRUpdateMode.Immediate) {\r\n                    this.ocrC = this.nextOcrC;\r\n                }\r\n            };\r\n        }\r\n        if (this.config.bits === 16) {\r\n            this.cpu.writeHooks[config.ICR] = (value) => {\r\n                this.icr = (this.highByteTemp << 8) | value;\r\n            };\r\n            const updateTempRegister = (value) => {\r\n                this.highByteTemp = value;\r\n            };\r\n            const updateOCRHighRegister = (value, old, addr) => {\r\n                this.highByteTemp = value & (this.ocrMask >> 8);\r\n                cpu.data[addr] = this.highByteTemp;\r\n                return true;\r\n            };\r\n            this.cpu.writeHooks[config.TCNT + 1] = updateTempRegister;\r\n            this.cpu.writeHooks[config.OCRA + 1] = updateOCRHighRegister;\r\n            this.cpu.writeHooks[config.OCRB + 1] = updateOCRHighRegister;\r\n            if (this.hasOCRC) {\r\n                this.cpu.writeHooks[config.OCRC + 1] = updateOCRHighRegister;\r\n            }\r\n            this.cpu.writeHooks[config.ICR + 1] = updateTempRegister;\r\n        }\r\n        cpu.writeHooks[config.TCCRA] = (value) => {\r\n            this.cpu.data[config.TCCRA] = value;\r\n            this.updateWGMConfig();\r\n            return true;\r\n        };\r\n        cpu.writeHooks[config.TCCRB] = (value) => {\r\n            if (!config.TCCRC) {\r\n                this.checkForceCompare(value);\r\n                value &= ~(FOCA | FOCB);\r\n            }\r\n            this.cpu.data[config.TCCRB] = value;\r\n            this.updateDivider = true;\r\n            this.cpu.clearClockEvent(this.count);\r\n            this.cpu.addClockEvent(this.count, 0);\r\n            this.updateWGMConfig();\r\n            return true;\r\n        };\r\n        if (config.TCCRC) {\r\n            cpu.writeHooks[config.TCCRC] = (value) => {\r\n                this.checkForceCompare(value);\r\n            };\r\n        }\r\n        cpu.writeHooks[config.TIFR] = (value) => {\r\n            this.cpu.data[config.TIFR] = value;\r\n            this.cpu.clearInterruptByFlag(this.OVF, value);\r\n            this.cpu.clearInterruptByFlag(this.OCFA, value);\r\n            this.cpu.clearInterruptByFlag(this.OCFB, value);\r\n            return true;\r\n        };\r\n        cpu.writeHooks[config.TIMSK] = (value) => {\r\n            this.cpu.updateInterruptEnable(this.OVF, value);\r\n            this.cpu.updateInterruptEnable(this.OCFA, value);\r\n            this.cpu.updateInterruptEnable(this.OCFB, value);\r\n        };\r\n    }\r\n    reset() {\r\n        this.divider = 0;\r\n        this.lastCycle = 0;\r\n        this.ocrA = 0;\r\n        this.nextOcrA = 0;\r\n        this.ocrB = 0;\r\n        this.nextOcrB = 0;\r\n        this.ocrC = 0;\r\n        this.nextOcrC = 0;\r\n        this.icr = 0;\r\n        this.tcnt = 0;\r\n        this.tcntNext = 0;\r\n        this.tcntUpdated = false;\r\n        this.countingUp = false;\r\n        this.updateDivider = true;\r\n    }\r\n    get TCCRA() {\r\n        return this.cpu.data[this.config.TCCRA];\r\n    }\r\n    get TCCRB() {\r\n        return this.cpu.data[this.config.TCCRB];\r\n    }\r\n    get TIMSK() {\r\n        return this.cpu.data[this.config.TIMSK];\r\n    }\r\n    get CS() {\r\n        return (this.TCCRB & 0x7);\r\n    }\r\n    get WGM() {\r\n        const mask = this.config.bits === 16 ? 0x18 : 0x8;\r\n        return ((this.TCCRB & mask) >> 1) | (this.TCCRA & 0x3);\r\n    }\r\n    get TOP() {\r\n        switch (this.topValue) {\r\n            case TopOCRA:\r\n                return this.ocrA;\r\n            case TopICR:\r\n                return this.icr;\r\n            default:\r\n                return this.topValue;\r\n        }\r\n    }\r\n    get ocrMask() {\r\n        switch (this.topValue) {\r\n            case TopOCRA:\r\n            case TopICR:\r\n                return 0xffff;\r\n            default:\r\n                return this.topValue;\r\n        }\r\n    }\r\n    /** Expose the raw value of TCNT, for use by the unit tests */\r\n    get debugTCNT() {\r\n        return this.tcnt;\r\n    }\r\n    updateWGMConfig() {\r\n        const { config, WGM } = this;\r\n        const wgmModes = config.bits === 16 ? wgmModes16Bit : wgmModes8Bit;\r\n        const TCCRA = this.cpu.data[config.TCCRA];\r\n        const [timerMode, topValue, ocrUpdateMode, tovUpdateMode, flags] = wgmModes[WGM];\r\n        this.timerMode = timerMode;\r\n        this.topValue = topValue;\r\n        this.ocrUpdateMode = ocrUpdateMode;\r\n        this.tovUpdateMode = tovUpdateMode;\r\n        const pwmMode = timerMode === FastPWM ||\r\n            timerMode === PWMPhaseCorrect ||\r\n            timerMode === PWMPhaseFrequencyCorrect;\r\n        const prevCompA = this.compA;\r\n        this.compA = ((TCCRA >> 6) & 0x3);\r\n        if (this.compA === 1 && pwmMode && !(flags & OCToggle)) {\r\n            this.compA = 0;\r\n        }\r\n        if (!!prevCompA !== !!this.compA) {\r\n            this.updateCompA(this.compA ? PinOverrideMode.Enable : PinOverrideMode.None);\r\n        }\r\n        const prevCompB = this.compB;\r\n        this.compB = ((TCCRA >> 4) & 0x3);\r\n        if (this.compB === 1 && pwmMode) {\r\n            this.compB = 0; // Reserved, according to the datasheet\r\n        }\r\n        if (!!prevCompB !== !!this.compB) {\r\n            this.updateCompB(this.compB ? PinOverrideMode.Enable : PinOverrideMode.None);\r\n        }\r\n        if (this.hasOCRC) {\r\n            const prevCompC = this.compC;\r\n            this.compC = ((TCCRA >> 2) & 0x3);\r\n            if (this.compC === 1 && pwmMode) {\r\n                this.compC = 0; // Reserved, according to the datasheet\r\n            }\r\n            if (!!prevCompC !== !!this.compC) {\r\n                this.updateCompC(this.compC ? PinOverrideMode.Enable : PinOverrideMode.None);\r\n            }\r\n        }\r\n    }\r\n    phasePwmCount(value, delta) {\r\n        const { ocrA, ocrB, ocrC, hasOCRC, TOP, MAX, tcntUpdated } = this;\r\n        if (!value && !TOP) {\r\n            delta = 0;\r\n            if (this.ocrUpdateMode === OCRUpdateMode.Top) {\r\n                this.ocrA = this.nextOcrA;\r\n                this.ocrB = this.nextOcrB;\r\n                this.ocrC = this.nextOcrC;\r\n            }\r\n        }\r\n        while (delta > 0) {\r\n            if (this.countingUp) {\r\n                value++;\r\n                if (value === TOP && !tcntUpdated) {\r\n                    this.countingUp = false;\r\n                    if (this.ocrUpdateMode === OCRUpdateMode.Top) {\r\n                        this.ocrA = this.nextOcrA;\r\n                        this.ocrB = this.nextOcrB;\r\n                        this.ocrC = this.nextOcrC;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                value--;\r\n                if (!value && !tcntUpdated) {\r\n                    this.countingUp = true;\r\n                    this.cpu.setInterruptFlag(this.OVF);\r\n                    if (this.ocrUpdateMode === OCRUpdateMode.Bottom) {\r\n                        this.ocrA = this.nextOcrA;\r\n                        this.ocrB = this.nextOcrB;\r\n                        this.ocrC = this.nextOcrC;\r\n                    }\r\n                }\r\n            }\r\n            if (!tcntUpdated) {\r\n                if (value === ocrA) {\r\n                    this.cpu.setInterruptFlag(this.OCFA);\r\n                    if (this.compA) {\r\n                        this.updateCompPin(this.compA, 'A');\r\n                    }\r\n                }\r\n                if (value === ocrB) {\r\n                    this.cpu.setInterruptFlag(this.OCFB);\r\n                    if (this.compB) {\r\n                        this.updateCompPin(this.compB, 'B');\r\n                    }\r\n                }\r\n                if (hasOCRC && value === ocrC) {\r\n                    this.cpu.setInterruptFlag(this.OCFC);\r\n                    if (this.compC) {\r\n                        this.updateCompPin(this.compC, 'C');\r\n                    }\r\n                }\r\n            }\r\n            delta--;\r\n        }\r\n        return value & MAX;\r\n    }\r\n    timerUpdated(value, prevValue) {\r\n        const { ocrA, ocrB, ocrC, hasOCRC } = this;\r\n        const overflow = prevValue > value;\r\n        if (((prevValue < ocrA || overflow) && value >= ocrA) || (prevValue < ocrA && overflow)) {\r\n            this.cpu.setInterruptFlag(this.OCFA);\r\n            if (this.compA) {\r\n                this.updateCompPin(this.compA, 'A');\r\n            }\r\n        }\r\n        if (((prevValue < ocrB || overflow) && value >= ocrB) || (prevValue < ocrB && overflow)) {\r\n            this.cpu.setInterruptFlag(this.OCFB);\r\n            if (this.compB) {\r\n                this.updateCompPin(this.compB, 'B');\r\n            }\r\n        }\r\n        if (hasOCRC &&\r\n            (((prevValue < ocrC || overflow) && value >= ocrC) || (prevValue < ocrC && overflow))) {\r\n            this.cpu.setInterruptFlag(this.OCFC);\r\n            if (this.compC) {\r\n                this.updateCompPin(this.compC, 'C');\r\n            }\r\n        }\r\n    }\r\n    checkForceCompare(value) {\r\n        if (this.timerMode == TimerMode.FastPWM ||\r\n            this.timerMode == TimerMode.PWMPhaseCorrect ||\r\n            this.timerMode == TimerMode.PWMPhaseFrequencyCorrect) {\r\n            // The FOCnA/FOCnB/FOCnC bits are only active when the WGMn3:0 bits specifies a non-PWM mode\r\n            return;\r\n        }\r\n        if (value & FOCA) {\r\n            this.updateCompPin(this.compA, 'A');\r\n        }\r\n        if (value & FOCB) {\r\n            this.updateCompPin(this.compB, 'B');\r\n        }\r\n        if (this.config.compPortC && value & FOCC) {\r\n            this.updateCompPin(this.compC, 'C');\r\n        }\r\n    }\r\n    updateCompPin(compValue, pinName, bottom = false) {\r\n        let newValue = PinOverrideMode.None;\r\n        const invertingMode = compValue === 3;\r\n        const isSet = this.countingUp === invertingMode;\r\n        switch (this.timerMode) {\r\n            case Normal:\r\n            case CTC:\r\n                newValue = compToOverride(compValue);\r\n                break;\r\n            case FastPWM:\r\n                if (compValue === 1) {\r\n                    newValue = bottom ? PinOverrideMode.None : PinOverrideMode.Toggle;\r\n                }\r\n                else {\r\n                    newValue = invertingMode !== bottom ? PinOverrideMode.Set : PinOverrideMode.Clear;\r\n                }\r\n                break;\r\n            case PWMPhaseCorrect:\r\n            case PWMPhaseFrequencyCorrect:\r\n                if (compValue === 1) {\r\n                    newValue = PinOverrideMode.Toggle;\r\n                }\r\n                else {\r\n                    newValue = isSet ? PinOverrideMode.Set : PinOverrideMode.Clear;\r\n                }\r\n                break;\r\n        }\r\n        if (newValue !== PinOverrideMode.None) {\r\n            if (pinName === 'A') {\r\n                this.updateCompA(newValue);\r\n            }\r\n            else if (pinName === 'B') {\r\n                this.updateCompB(newValue);\r\n            }\r\n            else {\r\n                this.updateCompC(newValue);\r\n            }\r\n        }\r\n    }\r\n    updateCompA(value) {\r\n        const { compPortA, compPinA } = this.config;\r\n        const port = this.cpu.gpioByPort[compPortA];\r\n        port === null || port === void 0 ? void 0 : port.timerOverridePin(compPinA, value);\r\n    }\r\n    updateCompB(value) {\r\n        const { compPortB, compPinB } = this.config;\r\n        const port = this.cpu.gpioByPort[compPortB];\r\n        port === null || port === void 0 ? void 0 : port.timerOverridePin(compPinB, value);\r\n    }\r\n    updateCompC(value) {\r\n        const { compPortC, compPinC } = this.config;\r\n        const port = this.cpu.gpioByPort[compPortC];\r\n        port === null || port === void 0 ? void 0 : port.timerOverridePin(compPinC, value);\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2772, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/twi.js"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n// Register bits:\r\nconst TWCR_TWINT = 0x80; // TWI Interrupt Flag\r\nconst TWCR_TWEA = 0x40; // TWI Enable Acknowledge Bit\r\nconst TWCR_TWSTA = 0x20; // TWI START Condition Bit\r\nconst TWCR_TWSTO = 0x10; // TWI STOP Condition Bit\r\nconst TWCR_TWWC = 0x8; //TWI Write Collision Flag\r\nconst TWCR_TWEN = 0x4; //  TWI Enable Bit\r\nconst TWCR_TWIE = 0x1; // TWI Interrupt Enable\r\nconst TWSR_TWS_MASK = 0xf8; // TWI Status\r\nconst TWSR_TWPS1 = 0x2; // TWI Prescaler Bits\r\nconst TWSR_TWPS0 = 0x1; // TWI Prescaler Bits\r\nconst TWSR_TWPS_MASK = TWSR_TWPS1 | TWSR_TWPS0; // TWI Prescaler mask\r\nconst TWAR_TWA_MASK = 0xfe; //  TWI (Slave) Address Register\r\nconst TWAR_TWGCE = 0x1; // TWI General Call Recognition Enable Bit\r\nconst STATUS_BUS_ERROR = 0x0;\r\nconst STATUS_TWI_IDLE = 0xf8;\r\n// Master states\r\nconst STATUS_START = 0x08;\r\nconst STATUS_REPEATED_START = 0x10;\r\nconst STATUS_SLAW_ACK = 0x18;\r\nconst STATUS_SLAW_NACK = 0x20;\r\nconst STATUS_DATA_SENT_ACK = 0x28;\r\nconst STATUS_DATA_SENT_NACK = 0x30;\r\nconst STATUS_DATA_LOST_ARBITRATION = 0x38;\r\nconst STATUS_SLAR_ACK = 0x40;\r\nconst STATUS_SLAR_NACK = 0x48;\r\nconst STATUS_DATA_RECEIVED_ACK = 0x50;\r\nconst STATUS_DATA_RECEIVED_NACK = 0x58;\r\n// TODO: add slave states\r\n/* eslint-enable @typescript-eslint/no-unused-vars */\r\nexport const twiConfig = {\r\n    twiInterrupt: 0x30,\r\n    TWBR: 0xb8,\r\n    TWSR: 0xb9,\r\n    TWAR: 0xba,\r\n    TWDR: 0xbb,\r\n    TWCR: 0xbc,\r\n    TWAMR: 0xbd,\r\n};\r\n// A simple TWI Event Handler that sends a NACK for all events\r\nexport class NoopTWIEventHandler {\r\n    constructor(twi) {\r\n        this.twi = twi;\r\n    }\r\n    start() {\r\n        this.twi.completeStart();\r\n    }\r\n    stop() {\r\n        this.twi.completeStop();\r\n    }\r\n    connectToSlave() {\r\n        this.twi.completeConnect(false);\r\n    }\r\n    writeByte() {\r\n        this.twi.completeWrite(false);\r\n    }\r\n    readByte() {\r\n        this.twi.completeRead(0xff);\r\n    }\r\n}\r\nexport class AVRTWI {\r\n    constructor(cpu, config, freqHz) {\r\n        this.cpu = cpu;\r\n        this.config = config;\r\n        this.freqHz = freqHz;\r\n        this.eventHandler = new NoopTWIEventHandler(this);\r\n        this.busy = false;\r\n        // Interrupts\r\n        this.TWI = {\r\n            address: this.config.twiInterrupt,\r\n            flagRegister: this.config.TWCR,\r\n            flagMask: TWCR_TWINT,\r\n            enableRegister: this.config.TWCR,\r\n            enableMask: TWCR_TWIE,\r\n        };\r\n        this.updateStatus(STATUS_TWI_IDLE);\r\n        this.cpu.writeHooks[config.TWCR] = (value) => {\r\n            this.cpu.data[config.TWCR] = value;\r\n            const clearInt = value & TWCR_TWINT;\r\n            this.cpu.clearInterruptByFlag(this.TWI, value);\r\n            this.cpu.updateInterruptEnable(this.TWI, value);\r\n            const { status } = this;\r\n            if (clearInt && value & TWCR_TWEN && !this.busy) {\r\n                const twdrValue = this.cpu.data[this.config.TWDR];\r\n                this.cpu.addClockEvent(() => {\r\n                    if (value & TWCR_TWSTA) {\r\n                        this.busy = true;\r\n                        this.eventHandler.start(status !== STATUS_TWI_IDLE);\r\n                    }\r\n                    else if (value & TWCR_TWSTO) {\r\n                        this.busy = true;\r\n                        this.eventHandler.stop();\r\n                    }\r\n                    else if (status === STATUS_START || status === STATUS_REPEATED_START) {\r\n                        this.busy = true;\r\n                        this.eventHandler.connectToSlave(twdrValue >> 1, twdrValue & 0x1 ? false : true);\r\n                    }\r\n                    else if (status === STATUS_SLAW_ACK || status === STATUS_DATA_SENT_ACK) {\r\n                        this.busy = true;\r\n                        this.eventHandler.writeByte(twdrValue);\r\n                    }\r\n                    else if (status === STATUS_SLAR_ACK || status === STATUS_DATA_RECEIVED_ACK) {\r\n                        this.busy = true;\r\n                        const ack = !!(value & TWCR_TWEA);\r\n                        this.eventHandler.readByte(ack);\r\n                    }\r\n                }, 0);\r\n                return true;\r\n            }\r\n        };\r\n    }\r\n    get prescaler() {\r\n        switch (this.cpu.data[this.config.TWSR] & TWSR_TWPS_MASK) {\r\n            case 0:\r\n                return 1;\r\n            case 1:\r\n                return 4;\r\n            case 2:\r\n                return 16;\r\n            case 3:\r\n                return 64;\r\n        }\r\n        // We should never get here:\r\n        throw new Error('Invalid prescaler value!');\r\n    }\r\n    get sclFrequency() {\r\n        return this.freqHz / (16 + 2 * this.cpu.data[this.config.TWBR] * this.prescaler);\r\n    }\r\n    completeStart() {\r\n        this.busy = false;\r\n        this.updateStatus(this.status === STATUS_TWI_IDLE ? STATUS_START : STATUS_REPEATED_START);\r\n    }\r\n    completeStop() {\r\n        this.busy = false;\r\n        this.cpu.data[this.config.TWCR] &= ~TWCR_TWSTO;\r\n        this.updateStatus(STATUS_TWI_IDLE);\r\n    }\r\n    completeConnect(ack) {\r\n        this.busy = false;\r\n        if (this.cpu.data[this.config.TWDR] & 0x1) {\r\n            this.updateStatus(ack ? STATUS_SLAR_ACK : STATUS_SLAR_NACK);\r\n        }\r\n        else {\r\n            this.updateStatus(ack ? STATUS_SLAW_ACK : STATUS_SLAW_NACK);\r\n        }\r\n    }\r\n    completeWrite(ack) {\r\n        this.busy = false;\r\n        this.updateStatus(ack ? STATUS_DATA_SENT_ACK : STATUS_DATA_SENT_NACK);\r\n    }\r\n    completeRead(value) {\r\n        this.busy = false;\r\n        const ack = !!(this.cpu.data[this.config.TWCR] & TWCR_TWEA);\r\n        this.cpu.data[this.config.TWDR] = value;\r\n        this.updateStatus(ack ? STATUS_DATA_RECEIVED_ACK : STATUS_DATA_RECEIVED_NACK);\r\n    }\r\n    get status() {\r\n        return this.cpu.data[this.config.TWSR] & TWSR_TWS_MASK;\r\n    }\r\n    updateStatus(value) {\r\n        const { TWSR } = this.config;\r\n        this.cpu.data[TWSR] = (this.cpu.data[TWSR] & ~TWSR_TWS_MASK) | value;\r\n        this.cpu.setInterruptFlag(this.TWI);\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2941, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/usart.js"],"sourcesContent":["/**\r\n * AVR-8 USART Peripheral\r\n * Part of AVR8js\r\n * Reference: http://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061A.pdf\r\n *\r\n * Copyright (C) 2019, 2020, 2021 Uri Shaked\r\n */\r\nexport const usart0Config = {\r\n    rxCompleteInterrupt: 0x24,\r\n    dataRegisterEmptyInterrupt: 0x26,\r\n    txCompleteInterrupt: 0x28,\r\n    UCSRA: 0xc0,\r\n    UCSRB: 0xc1,\r\n    UCSRC: 0xc2,\r\n    UBRRL: 0xc4,\r\n    UBRRH: 0xc5,\r\n    UDR: 0xc6,\r\n};\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n// Register bits:\r\nconst UCSRA_RXC = 0x80; // USART Receive Complete\r\nconst UCSRA_TXC = 0x40; // USART Transmit Complete\r\nconst UCSRA_UDRE = 0x20; // USART Data Register Empty\r\nconst UCSRA_FE = 0x10; // Frame Error\r\nconst UCSRA_DOR = 0x8; // Data OverRun\r\nconst UCSRA_UPE = 0x4; // USART Parity Error\r\nconst UCSRA_U2X = 0x2; // Double the USART Transmission Speed\r\nconst UCSRA_MPCM = 0x1; // Multi-processor Communication Mode\r\nconst UCSRA_CFG_MASK = UCSRA_U2X;\r\nconst UCSRB_RXCIE = 0x80; // RX Complete Interrupt Enable\r\nconst UCSRB_TXCIE = 0x40; // TX Complete Interrupt Enable\r\nconst UCSRB_UDRIE = 0x20; // USART Data Register Empty Interrupt Enable\r\nconst UCSRB_RXEN = 0x10; // Receiver Enable\r\nconst UCSRB_TXEN = 0x8; // Transmitter Enable\r\nconst UCSRB_UCSZ2 = 0x4; // Character Size 2\r\nconst UCSRB_RXB8 = 0x2; // Receive Data Bit 8\r\nconst UCSRB_TXB8 = 0x1; // Transmit Data Bit 8\r\nconst UCSRB_CFG_MASK = UCSRB_UCSZ2 | UCSRB_RXEN | UCSRB_TXEN;\r\nconst UCSRC_UMSEL1 = 0x80; // USART Mode Select 1\r\nconst UCSRC_UMSEL0 = 0x40; // USART Mode Select 0\r\nconst UCSRC_UPM1 = 0x20; // Parity Mode 1\r\nconst UCSRC_UPM0 = 0x10; // Parity Mode 0\r\nconst UCSRC_USBS = 0x8; // Stop Bit Select\r\nconst UCSRC_UCSZ1 = 0x4; // Character Size 1\r\nconst UCSRC_UCSZ0 = 0x2; // Character Size 0\r\nconst UCSRC_UCPOL = 0x1; // Clock Polarity\r\n/* eslint-enable @typescript-eslint/no-unused-vars */\r\nconst rxMasks = {\r\n    5: 0x1f,\r\n    6: 0x3f,\r\n    7: 0x7f,\r\n    8: 0xff,\r\n    9: 0xff,\r\n};\r\nexport class AVRUSART {\r\n    constructor(cpu, config, freqHz) {\r\n        this.cpu = cpu;\r\n        this.config = config;\r\n        this.freqHz = freqHz;\r\n        this.onByteTransmit = null;\r\n        this.onLineTransmit = null;\r\n        this.onRxComplete = null;\r\n        this.onConfigurationChange = null;\r\n        this.rxBusyValue = false;\r\n        this.rxByte = 0;\r\n        this.lineBuffer = '';\r\n        // Interrupts\r\n        this.RXC = {\r\n            address: this.config.rxCompleteInterrupt,\r\n            flagRegister: this.config.UCSRA,\r\n            flagMask: UCSRA_RXC,\r\n            enableRegister: this.config.UCSRB,\r\n            enableMask: UCSRB_RXCIE,\r\n            constant: true,\r\n        };\r\n        this.UDRE = {\r\n            address: this.config.dataRegisterEmptyInterrupt,\r\n            flagRegister: this.config.UCSRA,\r\n            flagMask: UCSRA_UDRE,\r\n            enableRegister: this.config.UCSRB,\r\n            enableMask: UCSRB_UDRIE,\r\n        };\r\n        this.TXC = {\r\n            address: this.config.txCompleteInterrupt,\r\n            flagRegister: this.config.UCSRA,\r\n            flagMask: UCSRA_TXC,\r\n            enableRegister: this.config.UCSRB,\r\n            enableMask: UCSRB_TXCIE,\r\n        };\r\n        this.reset();\r\n        this.cpu.writeHooks[config.UCSRA] = (value, oldValue) => {\r\n            var _a;\r\n            cpu.data[config.UCSRA] = value & (UCSRA_MPCM | UCSRA_U2X);\r\n            cpu.clearInterruptByFlag(this.TXC, value);\r\n            if ((value & UCSRA_CFG_MASK) !== (oldValue & UCSRA_CFG_MASK)) {\r\n                (_a = this.onConfigurationChange) === null || _a === void 0 ? void 0 : _a.call(this);\r\n            }\r\n            return true;\r\n        };\r\n        this.cpu.writeHooks[config.UCSRB] = (value, oldValue) => {\r\n            var _a;\r\n            cpu.updateInterruptEnable(this.RXC, value);\r\n            cpu.updateInterruptEnable(this.UDRE, value);\r\n            cpu.updateInterruptEnable(this.TXC, value);\r\n            if (value & UCSRB_RXEN && oldValue & UCSRB_RXEN) {\r\n                cpu.clearInterrupt(this.RXC);\r\n            }\r\n            if (value & UCSRB_TXEN && !(oldValue & UCSRB_TXEN)) {\r\n                // Enabling the transmission - mark UDR as empty\r\n                cpu.setInterruptFlag(this.UDRE);\r\n            }\r\n            cpu.data[config.UCSRB] = value;\r\n            if ((value & UCSRB_CFG_MASK) !== (oldValue & UCSRB_CFG_MASK)) {\r\n                (_a = this.onConfigurationChange) === null || _a === void 0 ? void 0 : _a.call(this);\r\n            }\r\n            return true;\r\n        };\r\n        this.cpu.writeHooks[config.UCSRC] = (value) => {\r\n            var _a;\r\n            cpu.data[config.UCSRC] = value;\r\n            (_a = this.onConfigurationChange) === null || _a === void 0 ? void 0 : _a.call(this);\r\n            return true;\r\n        };\r\n        this.cpu.readHooks[config.UDR] = () => {\r\n            var _a;\r\n            const mask = (_a = rxMasks[this.bitsPerChar]) !== null && _a !== void 0 ? _a : 0xff;\r\n            const result = this.rxByte & mask;\r\n            this.rxByte = 0;\r\n            this.cpu.clearInterrupt(this.RXC);\r\n            return result;\r\n        };\r\n        this.cpu.writeHooks[config.UDR] = (value) => {\r\n            if (this.onByteTransmit) {\r\n                this.onByteTransmit(value);\r\n            }\r\n            if (this.onLineTransmit) {\r\n                const ch = String.fromCharCode(value);\r\n                if (ch === '\\n') {\r\n                    this.onLineTransmit(this.lineBuffer);\r\n                    this.lineBuffer = '';\r\n                }\r\n                else {\r\n                    this.lineBuffer += ch;\r\n                }\r\n            }\r\n            this.cpu.addClockEvent(() => {\r\n                cpu.setInterruptFlag(this.UDRE);\r\n                cpu.setInterruptFlag(this.TXC);\r\n            }, this.cyclesPerChar);\r\n            this.cpu.clearInterrupt(this.TXC);\r\n            this.cpu.clearInterrupt(this.UDRE);\r\n        };\r\n        this.cpu.writeHooks[config.UBRRH] = (value) => {\r\n            var _a;\r\n            this.cpu.data[config.UBRRH] = value;\r\n            (_a = this.onConfigurationChange) === null || _a === void 0 ? void 0 : _a.call(this);\r\n            return true;\r\n        };\r\n        this.cpu.writeHooks[config.UBRRL] = (value) => {\r\n            var _a;\r\n            this.cpu.data[config.UBRRL] = value;\r\n            (_a = this.onConfigurationChange) === null || _a === void 0 ? void 0 : _a.call(this);\r\n            return true;\r\n        };\r\n    }\r\n    reset() {\r\n        this.cpu.data[this.config.UCSRA] = UCSRA_UDRE;\r\n        this.cpu.data[this.config.UCSRB] = 0;\r\n        this.cpu.data[this.config.UCSRC] = UCSRC_UCSZ1 | UCSRC_UCSZ0; // default: 8 bits per byte\r\n        this.rxBusyValue = false;\r\n        this.rxByte = 0;\r\n        this.lineBuffer = '';\r\n    }\r\n    get rxBusy() {\r\n        return this.rxBusyValue;\r\n    }\r\n    writeByte(value, immediate = false) {\r\n        var _a;\r\n        const { cpu } = this;\r\n        if (this.rxBusyValue || !this.rxEnable) {\r\n            return false;\r\n        }\r\n        if (immediate) {\r\n            this.rxByte = value;\r\n            cpu.setInterruptFlag(this.RXC);\r\n            (_a = this.onRxComplete) === null || _a === void 0 ? void 0 : _a.call(this);\r\n        }\r\n        else {\r\n            this.rxBusyValue = true;\r\n            cpu.addClockEvent(() => {\r\n                this.rxBusyValue = false;\r\n                this.writeByte(value, true);\r\n            }, this.cyclesPerChar);\r\n            return true;\r\n        }\r\n    }\r\n    get cyclesPerChar() {\r\n        const symbolsPerChar = 1 + this.bitsPerChar + this.stopBits + (this.parityEnabled ? 1 : 0);\r\n        return (this.UBRR + 1) * this.multiplier * symbolsPerChar;\r\n    }\r\n    get UBRR() {\r\n        const { UBRRH, UBRRL } = this.config;\r\n        return (this.cpu.data[UBRRH] << 8) | this.cpu.data[UBRRL];\r\n    }\r\n    get multiplier() {\r\n        return this.cpu.data[this.config.UCSRA] & UCSRA_U2X ? 8 : 16;\r\n    }\r\n    get rxEnable() {\r\n        return !!(this.cpu.data[this.config.UCSRB] & UCSRB_RXEN);\r\n    }\r\n    get txEnable() {\r\n        return !!(this.cpu.data[this.config.UCSRB] & UCSRB_TXEN);\r\n    }\r\n    get baudRate() {\r\n        return Math.floor(this.freqHz / (this.multiplier * (1 + this.UBRR)));\r\n    }\r\n    get bitsPerChar() {\r\n        const ucsz = ((this.cpu.data[this.config.UCSRC] & (UCSRC_UCSZ1 | UCSRC_UCSZ0)) >> 1) |\r\n            (this.cpu.data[this.config.UCSRB] & UCSRB_UCSZ2);\r\n        switch (ucsz) {\r\n            case 0:\r\n                return 5;\r\n            case 1:\r\n                return 6;\r\n            case 2:\r\n                return 7;\r\n            case 3:\r\n                return 8;\r\n            default: // 4..6 are reserved\r\n            case 7:\r\n                return 9;\r\n        }\r\n    }\r\n    get stopBits() {\r\n        return this.cpu.data[this.config.UCSRC] & UCSRC_USBS ? 2 : 1;\r\n    }\r\n    get parityEnabled() {\r\n        return this.cpu.data[this.config.UCSRC] & UCSRC_UPM1 ? true : false;\r\n    }\r\n    get parityOdd() {\r\n        return this.cpu.data[this.config.UCSRC] & UCSRC_UPM0 ? true : false;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/usi.js"],"sourcesContent":["const USICR = 0x2d;\r\nconst USISR = 0x2e;\r\nconst USIDR = 0x2f;\r\nconst USIBR = 0x30;\r\n// USISR bits\r\nconst USICNT_MASK = 0xf;\r\nconst USIDC = 1 << 4;\r\nconst USIPF = 1 << 5;\r\nconst USIOIF = 1 << 6;\r\nconst USISIF = 1 << 7;\r\n// USICR bits\r\nconst USITC = 1 << 0;\r\nconst USICLK = 1 << 1;\r\nconst USICS0 = 1 << 2;\r\nconst USICS1 = 1 << 3;\r\nconst USIWM0 = 1 << 4;\r\nconst USIWM1 = 1 << 5;\r\nconst USIOIE = 1 << 6;\r\nconst USISIE = 1 << 7;\r\nexport class AVRUSI {\r\n    constructor(cpu, port, portPin, dataPin, clockPin) {\r\n        // Interrupts\r\n        this.START = {\r\n            address: 0xd,\r\n            flagRegister: USISR,\r\n            flagMask: USISIF,\r\n            enableRegister: USICR,\r\n            enableMask: USISIE,\r\n        };\r\n        this.OVF = {\r\n            address: 0xe,\r\n            flagRegister: USISR,\r\n            flagMask: USIOIF,\r\n            enableRegister: USICR,\r\n            enableMask: USIOIE,\r\n        };\r\n        const PIN = portPin;\r\n        const PORT = PIN + 2;\r\n        port.addListener((value) => {\r\n            const twoWire = (cpu.data[USICR] & USIWM1) === USIWM1;\r\n            if (twoWire) {\r\n                if (value & (1 << clockPin) && !(value & (1 << dataPin))) {\r\n                    // Start condition detected\r\n                    cpu.setInterruptFlag(this.START);\r\n                }\r\n                if (value & (1 << clockPin) && value & (1 << dataPin)) {\r\n                    // Stop condition detected\r\n                    cpu.data[USISR] |= USIPF;\r\n                }\r\n            }\r\n        });\r\n        const updateOutput = () => {\r\n            const oldValue = cpu.data[PORT];\r\n            const newValue = cpu.data[USIDR] & 0x80 ? oldValue | (1 << dataPin) : oldValue & ~(1 << dataPin);\r\n            cpu.writeHooks[PORT](newValue, oldValue, PORT, 0xff);\r\n            if (newValue & 0x80 && !(cpu.data[PIN] & 0x80)) {\r\n                cpu.data[USISR] |= USIDC; // Shout output HIGH (pulled-up), but input is LOW\r\n            }\r\n            else {\r\n                cpu.data[USISR] &= ~USIDC;\r\n            }\r\n        };\r\n        const count = () => {\r\n            const counter = (cpu.data[USISR] + 1) & USICNT_MASK;\r\n            cpu.data[USISR] = (cpu.data[USISR] & ~USICNT_MASK) | counter;\r\n            if (!counter) {\r\n                cpu.data[USIBR] = cpu.data[USIDR];\r\n                cpu.setInterruptFlag(this.OVF);\r\n            }\r\n        };\r\n        const shift = (inputValue) => {\r\n            cpu.data[USIDR] = (cpu.data[USIDR] << 1) | inputValue;\r\n            updateOutput();\r\n        };\r\n        cpu.writeHooks[USIDR] = (value) => {\r\n            cpu.data[USIDR] = value;\r\n            updateOutput();\r\n            return true;\r\n        };\r\n        cpu.writeHooks[USISR] = (value) => {\r\n            const writeClearMask = USISIF | USIOIF | USIPF;\r\n            cpu.data[USISR] = (cpu.data[USISR] & writeClearMask & ~value) | (value & 0xf);\r\n            cpu.clearInterruptByFlag(this.START, value);\r\n            cpu.clearInterruptByFlag(this.OVF, value);\r\n            return true;\r\n        };\r\n        cpu.writeHooks[USICR] = (value) => {\r\n            cpu.data[USICR] = value & ~(USICLK | USITC);\r\n            cpu.updateInterruptEnable(this.START, value);\r\n            cpu.updateInterruptEnable(this.OVF, value);\r\n            const clockSrc = value & ((USICS1 | USICS0) >> 2);\r\n            const mode = value & ((USIWM1 | USIWM0) >> 4);\r\n            const usiClk = value & USICLK;\r\n            port.openCollector = mode >= 2 ? 1 << dataPin : 0;\r\n            const inputValue = cpu.data[PIN] & (1 << dataPin) ? 1 : 0;\r\n            if (usiClk && !clockSrc) {\r\n                shift(inputValue);\r\n                count();\r\n            }\r\n            if (value & USITC) {\r\n                cpu.writeHooks[PIN](1 << clockPin, cpu.data[PIN], PIN, 0xff);\r\n                const newValue = cpu.data[PIN] & (1 << clockPin);\r\n                if (usiClk && (clockSrc === 2 || clockSrc === 3)) {\r\n                    if (clockSrc === 2 && newValue) {\r\n                        shift(inputValue);\r\n                    }\r\n                    if (clockSrc === 3 && !newValue) {\r\n                        shift(inputValue);\r\n                    }\r\n                    count();\r\n                }\r\n                return true;\r\n            }\r\n        };\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3311, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/peripherals/watchdog.js"],"sourcesContent":["/**\r\n * AVR8 Watchdog Timer\r\n * Part of AVR8js\r\n * Reference: http://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061A.pdf\r\n *\r\n * Copyright (C) 2021 Uri Shaked\r\n */\r\n// Register bits:\r\nconst MCUSR_WDRF = 0x8; //  Watchdog System Reset Flag\r\nconst WDTCSR_WDIF = 0x80;\r\nconst WDTCSR_WDIE = 0x40;\r\nconst WDTCSR_WDP3 = 0x20;\r\nconst WDTCSR_WDCE = 0x10; // Watchdog Change Enable\r\nconst WDTCSR_WDE = 0x8;\r\nconst WDTCSR_WDP2 = 0x4;\r\nconst WDTCSR_WDP1 = 0x2;\r\nconst WDTCSR_WDP0 = 0x1;\r\nconst WDTCSR_WDP210 = WDTCSR_WDP2 | WDTCSR_WDP1 | WDTCSR_WDP0;\r\nconst WDTCSR_PROTECT_MASK = WDTCSR_WDE | WDTCSR_WDP3 | WDTCSR_WDP210;\r\nexport const watchdogConfig = {\r\n    watchdogInterrupt: 0x0c,\r\n    MCUSR: 0x54,\r\n    WDTCSR: 0x60,\r\n};\r\nexport class AVRWatchdog {\r\n    constructor(cpu, config, clock) {\r\n        this.cpu = cpu;\r\n        this.config = config;\r\n        this.clock = clock;\r\n        this.clockFrequency = 128000;\r\n        /**\r\n         * Used to keep track on the last write to WDCE. Once written, the WDE/WDP* bits can be changed.\r\n         */\r\n        this.changeEnabledCycles = 0;\r\n        this.watchdogTimeout = 0;\r\n        this.enabledValue = false;\r\n        this.scheduled = false;\r\n        // Interrupts\r\n        this.Watchdog = {\r\n            address: this.config.watchdogInterrupt,\r\n            flagRegister: this.config.WDTCSR,\r\n            flagMask: WDTCSR_WDIF,\r\n            enableRegister: this.config.WDTCSR,\r\n            enableMask: WDTCSR_WDIE,\r\n        };\r\n        this.checkWatchdog = () => {\r\n            if (this.enabled && this.cpu.cycles >= this.watchdogTimeout) {\r\n                // Watchdog timed out!\r\n                const wdtcsr = this.cpu.data[this.config.WDTCSR];\r\n                if (wdtcsr & WDTCSR_WDIE) {\r\n                    this.cpu.setInterruptFlag(this.Watchdog);\r\n                }\r\n                if (wdtcsr & WDTCSR_WDE) {\r\n                    if (wdtcsr & WDTCSR_WDIE) {\r\n                        this.cpu.data[this.config.WDTCSR] &= ~WDTCSR_WDIE;\r\n                    }\r\n                    else {\r\n                        this.cpu.reset();\r\n                        this.scheduled = false;\r\n                        this.cpu.data[this.config.MCUSR] |= MCUSR_WDRF;\r\n                        return;\r\n                    }\r\n                }\r\n                this.resetWatchdog();\r\n            }\r\n            if (this.enabled) {\r\n                this.scheduled = true;\r\n                this.cpu.addClockEvent(this.checkWatchdog, this.watchdogTimeout - this.cpu.cycles);\r\n            }\r\n            else {\r\n                this.scheduled = false;\r\n            }\r\n        };\r\n        const { WDTCSR } = config;\r\n        this.cpu.onWatchdogReset = () => {\r\n            this.resetWatchdog();\r\n        };\r\n        cpu.writeHooks[WDTCSR] = (value, oldValue) => {\r\n            if (value & WDTCSR_WDCE && value & WDTCSR_WDE) {\r\n                this.changeEnabledCycles = this.cpu.cycles + 4;\r\n                value = value & ~WDTCSR_PROTECT_MASK;\r\n            }\r\n            else {\r\n                if (this.cpu.cycles >= this.changeEnabledCycles) {\r\n                    value = (value & ~WDTCSR_PROTECT_MASK) | (oldValue & WDTCSR_PROTECT_MASK);\r\n                }\r\n                this.enabledValue = !!(value & WDTCSR_WDE || value & WDTCSR_WDIE);\r\n                this.cpu.data[WDTCSR] = value;\r\n            }\r\n            if (this.enabled) {\r\n                this.resetWatchdog();\r\n            }\r\n            if (this.enabled && !this.scheduled) {\r\n                this.cpu.addClockEvent(this.checkWatchdog, this.watchdogTimeout - this.cpu.cycles);\r\n            }\r\n            this.cpu.clearInterruptByFlag(this.Watchdog, value);\r\n            return true;\r\n        };\r\n    }\r\n    resetWatchdog() {\r\n        const cycles = Math.floor((this.clock.frequency / this.clockFrequency) * this.prescaler);\r\n        this.watchdogTimeout = this.cpu.cycles + cycles;\r\n    }\r\n    get enabled() {\r\n        return this.enabledValue;\r\n    }\r\n    /**\r\n     * The base clock frequency is 128KHz. Thus, a prescaler of 2048 gives 16ms timeout.\r\n     */\r\n    get prescaler() {\r\n        const wdtcsr = this.cpu.data[this.config.WDTCSR];\r\n        const value = ((wdtcsr & WDTCSR_WDP3) >> 2) | (wdtcsr & WDTCSR_WDP210);\r\n        return 2048 << value;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3430, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/node_modules/avr8js/dist/esm/index.js"],"sourcesContent":["/**\r\n * AVR8js\r\n *\r\n * Copyright (C) 2019, 2020, Uri Shaked\r\n */\r\nexport { CPU } from './cpu/cpu';\r\nexport { avrInstruction } from './cpu/instruction';\r\nexport { avrInterrupt } from './cpu/interrupt';\r\nexport { adcConfig, ADCMuxInputType, ADCReference, atmega328Channels, AVRADC, } from './peripherals/adc';\r\nexport { AVRClock, clockConfig } from './peripherals/clock';\r\nexport { AVREEPROM, eepromConfig, EEPROMMemoryBackend } from './peripherals/eeprom';\r\nexport { AVRIOPort, INT0, INT1, PCINT0, PCINT1, PCINT2, PinState, portAConfig, portBConfig, portCConfig, portDConfig, portEConfig, portFConfig, portGConfig, portHConfig, portJConfig, portKConfig, portLConfig, } from './peripherals/gpio';\r\nexport { AVRSPI, spiConfig } from './peripherals/spi';\r\nexport { AVRTimer, timer0Config, timer1Config, timer2Config } from './peripherals/timer';\r\nexport * from './peripherals/twi';\r\nexport { AVRUSART, usart0Config } from './peripherals/usart';\r\nexport { AVRUSI } from './peripherals/usi';\r\nexport { AVRWatchdog, watchdogConfig } from './peripherals/watchdog';\r\n"],"names":[],"mappings":";AAAA;;;;CAIC,GACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","ignoreList":[0]}}]
}