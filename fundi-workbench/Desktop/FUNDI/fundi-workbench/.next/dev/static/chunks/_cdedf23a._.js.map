{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/nodes/ArduinoNode.tsx"],"sourcesContent":["'use client';\r\n\r\nimport '@wokwi/elements';\r\nimport { memo, useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Handle, Position } from '@xyflow/react';\r\nimport type { WirePoint } from '@/types/wire';\r\n\r\ninterface PinData {\r\n    id: string;\r\n    x: number;\r\n    y: number;\r\n    row: 'top' | 'bottom';\r\n}\r\n\r\ninterface ArduinoNodeData {\r\n    onPinClick?: (nodeId: string, pinId: string, position: WirePoint) => void;\r\n    getCanvasRect?: () => DOMRect | null;\r\n}\r\n\r\ninterface ArduinoNodeProps {\r\n    id: string; // React Flow node ID\r\n    data: ArduinoNodeData;\r\n}\r\n\r\n// Wokwi approach: pinInfo coords are at 96 DPI\r\n// Reference dimensions: 72.58mm x 53.34mm = 274.32px x 201.56px at 96 DPI\r\nconst REFERENCE_WIDTH = 72.58 * (96 / 25.4);  // ~274.32 px\r\nconst REFERENCE_HEIGHT = 53.34 * (96 / 25.4); // ~201.56 px\r\n\r\nfunction ArduinoNode({ id: nodeId, data }: ArduinoNodeProps) {\r\n    const onPinClick = data?.onPinClick;\r\n    const getCanvasRect = data?.getCanvasRect;\r\n    const [hoveredPin, setHoveredPin] = useState<string | null>(null);\r\n    const [pins, setPins] = useState<PinData[]>([]);\r\n    const [svgDimensions, setSvgDimensions] = useState({ width: 274, height: 201 });\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const elementRef = useRef<HTMLElement | null>(null);\r\n\r\n\r\n\r\n    const calculatePins = useCallback(() => {\r\n        const element = elementRef.current as HTMLElement & {\r\n            pinInfo?: { name: string; x: number; y: number }[]\r\n        };\r\n\r\n        if (!element || !element.shadowRoot || !element.pinInfo) return;\r\n\r\n        const svg = element.shadowRoot.querySelector('svg');\r\n        if (!svg) return;\r\n\r\n        const viewBoxAttr = svg.getAttribute('viewBox');\r\n        if (!viewBoxAttr) return;\r\n\r\n        // ViewBox: \"-4 0 72.58 53.34\" (mm)\r\n        const [, , vbW_mm, vbH_mm] = viewBoxAttr.split(/[\\s,]+/).map(parseFloat);\r\n        if (vbW_mm === 0 || vbH_mm === 0) return;\r\n\r\n        // Convert mm to px (96 DPI)\r\n        const MM_TO_PX = 96 / 25.4;\r\n        const vbW_px = vbW_mm * MM_TO_PX;\r\n        const vbH_px = vbH_mm * MM_TO_PX;\r\n\r\n        setSvgDimensions({ width: vbW_px, height: vbH_px });\r\n\r\n        // Use pinInfo coordinates DIRECTLY - they're likely already in the right space\r\n        const mappedPins: PinData[] = element.pinInfo.map((pin) => {\r\n            const isTop = pin.y < vbH_px / 2;\r\n            return {\r\n                id: pin.name,\r\n                x: pin.x,  // Use directly\r\n                y: pin.y,  // Use directly\r\n                row: isTop ? 'top' : 'bottom',\r\n            };\r\n        });\r\n\r\n        setPins(mappedPins);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const initElement = async () => {\r\n            await customElements.whenDefined('wokwi-arduino-uno');\r\n\r\n            const element = containerRef.current?.querySelector('wokwi-arduino-uno');\r\n            if (!element) return;\r\n\r\n            elementRef.current = element as HTMLElement;\r\n\r\n            requestAnimationFrame(() => {\r\n                calculatePins();\r\n                setTimeout(calculatePins, 100);\r\n                setTimeout(calculatePins, 300);\r\n            });\r\n        };\r\n\r\n        initElement();\r\n\r\n        const observer = new ResizeObserver(calculatePins);\r\n        if (containerRef.current) observer.observe(containerRef.current);\r\n\r\n        window.addEventListener('resize', calculatePins);\r\n\r\n        return () => {\r\n            observer.disconnect();\r\n            window.removeEventListener('resize', calculatePins);\r\n        };\r\n    }, [calculatePins]);\r\n\r\n    const handlePinClick = useCallback(\r\n        (e: React.MouseEvent, pin: PinData) => {\r\n            e.stopPropagation();\r\n            if (!onPinClick || !elementRef.current) return;\r\n\r\n            const element = elementRef.current;\r\n            const elementRect = element.getBoundingClientRect();\r\n\r\n            // Calculate scale: how much the element is scaled from reference\r\n            // Reference: 72.58mm x 53.34mm = 274.32px x 201.56px at 96 DPI\r\n            const REFERENCE_WIDTH = 72.58 * (96 / 25.4);\r\n            const REFERENCE_HEIGHT = 53.34 * (96 / 25.4);\r\n            const scaleX = elementRect.width / REFERENCE_WIDTH;\r\n            const scaleY = elementRect.height / REFERENCE_HEIGHT;\r\n\r\n            // Transform pin coordinates (96 DPI) to screen coordinates\r\n            const screenX = elementRect.left + pin.x * scaleX;\r\n            const screenY = elementRect.top + pin.y * scaleY;\r\n\r\n            const canvasRect = getCanvasRect?.();\r\n            const canvasRelative = canvasRect\r\n                ? { x: screenX - canvasRect.left, y: screenY - canvasRect.top }\r\n                : { x: screenX, y: screenY };\r\n\r\n            onPinClick(nodeId, pin.id, canvasRelative);\r\n        },\r\n        [onPinClick, nodeId, getCanvasRect]\r\n    );\r\n\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            className=\"relative\"\r\n            style={{\r\n                display: 'inline-block',\r\n                lineHeight: 0,\r\n            }}\r\n        >\r\n            {/* The Arduino Board */}\r\n            <wokwi-arduino-uno style={{ display: 'block' }} />\r\n\r\n            {/* Pin hitboxes (Wokwi-style): big invisible clickable targets */}\r\n            <div\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 20,\r\n                }}\r\n            >\r\n                {pins.map((pin) => {\r\n                    const leftPct = svgDimensions.width\r\n                        ? (pin.x / svgDimensions.width) * 100\r\n                        : 0;\r\n                    const topPct = svgDimensions.height\r\n                        ? (pin.y / svgDimensions.height) * 100\r\n                        : 0;\r\n\r\n                    return (\r\n                        <div\r\n                            key={pin.id}\r\n                            className=\"nodrag\"\r\n                            data-fundi-pin=\"true\"\r\n                            data-node-id={nodeId}\r\n                            data-pin-id={pin.id}\r\n                            style={{\r\n                                position: 'absolute',\r\n                                left: `${leftPct}%`,\r\n                                top: `${topPct}%`,\r\n                                width: 14,\r\n                                height: 14,\r\n                                transform: 'translate(-50%, -50%)',\r\n                                borderRadius: 9999,\r\n                                pointerEvents: 'auto',\r\n                                cursor: 'pointer',\r\n                                background: 'transparent',\r\n                                touchAction: 'none',\r\n                                zIndex: 30,\r\n                            }}\r\n                            onPointerDown={(e) => {\r\n                                // Prevent ReactFlow node dragging from stealing the interaction\r\n                                e.stopPropagation();\r\n                            }}\r\n                            onMouseEnter={() => setHoveredPin(pin.id)}\r\n                            onMouseLeave={() => setHoveredPin(null)}\r\n                            onClick={(e) => handlePinClick(e, pin)}\r\n                            aria-label={`Pin ${pin.id}`}\r\n                        />\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* SVG Overlay (visual only) */}\r\n            <svg\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    overflow: 'visible',\r\n                    zIndex: 10,\r\n                }}\r\n                viewBox={`0 0 ${svgDimensions.width} ${svgDimensions.height}`}\r\n            >\r\n                {pins.map((pin) => {\r\n                    const isHovered = hoveredPin === pin.id;\r\n\r\n                    return (\r\n                        <g key={pin.id}>\r\n                            <circle\r\n                                cx={pin.x}\r\n                                cy={pin.y}\r\n                                r={isHovered ? 3 : 2}\r\n                                fill={isHovered ? '#22c55e' : 'rgba(34, 197, 94, 0.5)'}\r\n                                stroke={isHovered ? '#16a34a' : 'rgba(22, 163, 74, 0.7)'}\r\n                                strokeWidth={0.5}\r\n                                style={{ transition: 'all 0.1s ease' }}\r\n                            />\r\n                            {isHovered && (\r\n                                <g>\r\n                                    <rect\r\n                                        x={pin.x - 15}\r\n                                        y={pin.row === 'top' ? pin.y + 5 : pin.y - 15}\r\n                                        width={30}\r\n                                        height={10}\r\n                                        rx={2}\r\n                                        fill=\"rgba(15, 23, 42, 0.95)\"\r\n                                        stroke=\"rgba(34, 197, 94, 0.5)\"\r\n                                        strokeWidth={0.5}\r\n                                    />\r\n                                    <text\r\n                                        x={pin.x}\r\n                                        y={pin.row === 'top' ? pin.y + 12.5 : pin.y - 7.5}\r\n                                        textAnchor=\"middle\"\r\n                                        fill=\"#4ade80\"\r\n                                        fontSize={5}\r\n                                        fontFamily=\"monospace\"\r\n                                    >\r\n                                        {pin.id}\r\n                                    </text>\r\n                                </g>\r\n                            )}\r\n                        </g>\r\n                    );\r\n                })}\r\n            </svg>\r\n\r\n            {pins.map((pin) => (\r\n                <Handle\r\n                    key={pin.id}\r\n                    id={pin.id}\r\n                    type=\"source\"\r\n                    position={pin.row === 'top' ? Position.Top : Position.Bottom}\r\n                    style={{ opacity: 0, pointerEvents: 'none' }}\r\n                />\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default memo(ArduinoNode);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 309, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/lib/wokwiParts.ts"],"sourcesContent":["/**\r\n * Registry of available Wokwi parts\r\n */\r\nexport type ComponentCategory = 'mcu' | 'displays' | 'leds' | 'input' | 'output' | 'passive' | 'logic' | 'motors';\r\n\r\nexport interface WokwiPartConfig {\r\n    name: string;\r\n    element: string;\r\n    description?: string;\r\n    category?: ComponentCategory;\r\n    /** Optional inline SVG for component preview in the library */\r\n    svg?: string;\r\n}\r\n\r\n\r\nexport const WOKWI_PARTS: Record<string, WokwiPartConfig> = {\r\n    'arduino-uno': {\r\n        name: 'Arduino Uno',\r\n        element: 'wokwi-arduino-uno',\r\n        description: 'ATmega328P-based microcontroller board',\r\n        category: 'mcu',\r\n    },\r\n    'esp32-devkit-v1': {\r\n        name: 'ESP32 DevKit V1',\r\n        element: 'wokwi-esp32-devkit-v1',\r\n        description: 'ESP32 development board with WiFi & Bluetooth',\r\n        category: 'mcu',\r\n    },\r\n    'arduino-mega': {\r\n        name: 'Arduino Mega',\r\n        element: 'wokwi-arduino-mega',\r\n        description: 'ATmega2560-based board with more pins',\r\n        category: 'mcu',\r\n    },\r\n    'arduino-nano': {\r\n        name: 'Arduino Nano',\r\n        element: 'wokwi-arduino-nano',\r\n        description: 'Compact ATmega328P board',\r\n        category: 'mcu',\r\n    },\r\n\r\n    'nano-rp2040-connect': {\r\n        name: 'Nano RP2040 Connect',\r\n        element: 'wokwi-nano-rp2040-connect',\r\n        description: 'RP2040-based Arduino Nano form factor',\r\n        category: 'mcu',\r\n    },\r\n\r\n    'franzininho': {\r\n        name: 'Franzininho',\r\n        element: 'wokwi-franzininho',\r\n        description: 'ATtiny85-based development board',\r\n        category: 'mcu',\r\n    },\r\n\r\n    // Displays\r\n    'oled-128x64-i2c': {\r\n        name: 'OLED 128x64 (I2C)',\r\n        element: 'wokwi-ssd1306',\r\n        description: 'SSD1306 monochrome OLED display',\r\n        category: 'displays',\r\n    },\r\n    'lcd1602': {\r\n        name: 'LCD 1602',\r\n        element: 'wokwi-lcd1602',\r\n        description: '16x2 character LCD',\r\n        category: 'displays',\r\n    },\r\n    'seven-segment': {\r\n        name: '7-Segment Display',\r\n        element: 'wokwi-7segment',\r\n        description: 'Single-digit 7-segment display',\r\n        category: 'displays',\r\n    },\r\n\r\n    'lcd2004': {\r\n        name: 'LCD 2004',\r\n        element: 'wokwi-lcd2004',\r\n        description: '20x4 character LCD',\r\n        category: 'displays',\r\n    },\r\n\r\n    'ili9341': {\r\n        name: 'ILI9341 TFT',\r\n        element: 'wokwi-ili9341',\r\n        description: 'SPI TFT display (ILI9341)',\r\n        category: 'displays',\r\n    },\r\n\r\n    // LEDs\r\n    'led': {\r\n        name: 'LED',\r\n        element: 'wokwi-led',\r\n        description: 'Basic single-color LED',\r\n        category: 'leds',\r\n    },\r\n    'rgb-led': {\r\n        name: 'RGB LED',\r\n        element: 'wokwi-rgb-led',\r\n        description: 'Common-cathode RGB LED',\r\n        category: 'leds',\r\n    },\r\n    'neopixel': {\r\n        name: 'NeoPixel (WS2812)',\r\n        element: 'wokwi-neopixel',\r\n        description: 'Addressable RGB LED (single)',\r\n        category: 'leds',\r\n    },\r\n\r\n    'neopixel-matrix': {\r\n        name: 'NeoPixel Matrix',\r\n        element: 'wokwi-neopixel-matrix',\r\n        description: 'Addressable RGB LED matrix',\r\n        category: 'leds',\r\n    },\r\n\r\n    'led-bar-graph': {\r\n        name: 'LED Bar Graph',\r\n        element: 'wokwi-led-bar-graph',\r\n        description: '10-segment LED bar graph',\r\n        category: 'leds',\r\n    },\r\n\r\n    'led-ring': {\r\n        name: 'LED Ring',\r\n        element: 'wokwi-led-ring',\r\n        description: 'Addressable LED ring',\r\n        category: 'leds',\r\n    },\r\n\r\n    // Sensors\r\n    'dht22': {\r\n        name: 'DHT22',\r\n        element: 'wokwi-dht22',\r\n        description: 'Temperature & humidity sensor',\r\n        category: 'input',\r\n    },\r\n    'hc-sr04': {\r\n        name: 'HC-SR04',\r\n        element: 'wokwi-hc-sr04',\r\n        description: 'Ultrasonic distance sensor',\r\n        category: 'input',\r\n    },\r\n    'pir-motion': {\r\n        name: 'PIR Motion Sensor',\r\n        element: 'wokwi-pir-motion-sensor',\r\n        description: 'Passive infrared motion sensor',\r\n        category: 'input',\r\n    },\r\n    'photoresistor': {\r\n        name: 'Photoresistor (LDR)',\r\n        element: 'wokwi-photoresistor-sensor',\r\n        description: 'Light-dependent resistor sensor',\r\n        category: 'input',\r\n    },\r\n\r\n    'mpu6050': {\r\n        name: 'MPU6050',\r\n        element: 'wokwi-mpu6050',\r\n        description: 'Accelerometer + gyroscope (I2C)',\r\n        category: 'input',\r\n    },\r\n\r\n    'ds1307': {\r\n        name: 'DS1307 RTC',\r\n        element: 'wokwi-ds1307',\r\n        description: 'Real-time clock module (I2C)',\r\n        category: 'input',\r\n    },\r\n\r\n    'ir-receiver': {\r\n        name: 'IR Receiver',\r\n        element: 'wokwi-ir-receiver',\r\n        description: 'Infrared receiver',\r\n        category: 'input',\r\n    },\r\n\r\n    'ir-remote': {\r\n        name: 'IR Remote',\r\n        element: 'wokwi-ir-remote',\r\n        description: 'Infrared remote control',\r\n        category: 'input',\r\n    },\r\n\r\n    'analog-joystick': {\r\n        name: 'Analog Joystick',\r\n        element: 'wokwi-analog-joystick',\r\n        description: '2-axis analog joystick',\r\n        category: 'input',\r\n    },\r\n\r\n    'rotary-encoder': {\r\n        name: 'Rotary Encoder (KY-040)',\r\n        element: 'wokwi-ky-040',\r\n        description: 'Incremental rotary encoder',\r\n        category: 'input',\r\n    },\r\n\r\n    'pushbutton': {\r\n        name: 'Pushbutton',\r\n        element: 'wokwi-pushbutton',\r\n        description: 'Momentary pushbutton',\r\n        category: 'input',\r\n    },\r\n\r\n    'pushbutton-6mm': {\r\n        name: 'Pushbutton (6mm)',\r\n        element: 'wokwi-pushbutton-6mm',\r\n        description: 'Tactile 6mm pushbutton',\r\n        category: 'input',\r\n    },\r\n\r\n    'resistor': {\r\n        name: 'Resistor',\r\n        element: 'wokwi-resistor',\r\n        description: 'Generic resistor',\r\n        category: 'passive',\r\n    },\r\n\r\n    'potentiometer': {\r\n        name: 'Potentiometer',\r\n        element: 'wokwi-potentiometer',\r\n        description: 'Rotary potentiometer',\r\n        category: 'input',\r\n    },\r\n\r\n    'slide-potentiometer': {\r\n        name: 'Slide Potentiometer',\r\n        element: 'wokwi-slide-potentiometer',\r\n        description: 'Linear slide potentiometer',\r\n        category: 'input',\r\n    },\r\n\r\n    'slide-switch': {\r\n        name: 'Slide Switch',\r\n        element: 'wokwi-slide-switch',\r\n        description: '2-position slide switch',\r\n        category: 'input',\r\n    },\r\n\r\n    'dip-switch-8': {\r\n        name: 'DIP Switch (8)',\r\n        element: 'wokwi-dip-switch-8',\r\n        description: '8-position DIP switch',\r\n        category: 'input',\r\n    },\r\n\r\n    'buzzer': {\r\n        name: 'Buzzer',\r\n        element: 'wokwi-buzzer',\r\n        description: 'Piezo buzzer',\r\n        category: 'output',\r\n    },\r\n\r\n    'servo': {\r\n        name: 'Servo',\r\n        element: 'wokwi-servo',\r\n        description: 'RC servo motor',\r\n        category: 'motors',\r\n    },\r\n\r\n    'membrane-keypad': {\r\n        name: 'Membrane Keypad',\r\n        element: 'wokwi-membrane-keypad',\r\n        description: 'Matrix keypad',\r\n        category: 'input',\r\n    },\r\n\r\n    'microsd-card': {\r\n        name: 'MicroSD Card',\r\n        element: 'wokwi-microsd-card',\r\n        description: 'MicroSD card module',\r\n        category: 'passive',\r\n    },\r\n\r\n    // ==========================================\r\n    // BREADBOARDS (Critical - was missing!)\r\n    // ==========================================\r\n    'breadboard': {\r\n        name: 'Breadboard',\r\n        element: 'wokwi-breadboard',\r\n        description: 'Full-size breadboard (830 tie points)',\r\n        category: 'passive',\r\n    },\r\n    'breadboard-mini': {\r\n        name: 'Mini Breadboard',\r\n        element: 'wokwi-breadboard-mini',\r\n        description: 'Mini breadboard (170 tie points)',\r\n        category: 'passive',\r\n    },\r\n\r\n    // ==========================================\r\n    // LOGIC ICs\r\n    // ==========================================\r\n    '74hc595': {\r\n        name: '74HC595 Shift Register',\r\n        element: 'wokwi-74hc595',\r\n        description: '8-bit serial-in, parallel-out shift register',\r\n        category: 'logic',\r\n    },\r\n    '74hc165': {\r\n        name: '74HC165 Shift Register',\r\n        element: 'wokwi-74hc165',\r\n        description: '8-bit parallel-in, serial-out shift register',\r\n        category: 'logic',\r\n    },\r\n\r\n    // ==========================================\r\n    // MOTORS & DRIVERS\r\n    // ==========================================\r\n    'stepper-motor': {\r\n        name: 'Stepper Motor',\r\n        element: 'wokwi-stepper-motor',\r\n        description: 'Bipolar stepper motor',\r\n        category: 'motors',\r\n    },\r\n    'a4988': {\r\n        name: 'A4988 Driver',\r\n        element: 'wokwi-a4988',\r\n        description: 'Stepper motor driver',\r\n        category: 'motors',\r\n    },\r\n    'biaxial-stepper': {\r\n        name: 'Biaxial Stepper',\r\n        element: 'wokwi-biaxial-stepper',\r\n        description: 'Biaxial stepper motor',\r\n        category: 'motors',\r\n    },\r\n\r\n    // ==========================================\r\n    // ADDITIONAL SENSORS\r\n    // ==========================================\r\n    'hx711': {\r\n        name: 'HX711 Load Cell',\r\n        element: 'wokwi-hx711',\r\n        description: 'Load cell amplifier',\r\n        category: 'input',\r\n    },\r\n    'ds18b20': {\r\n        name: 'DS18B20',\r\n        element: 'wokwi-ds18b20',\r\n        description: 'Digital temperature sensor (1-Wire)',\r\n        category: 'input',\r\n    },\r\n    'ntc-temperature-sensor': {\r\n        name: 'NTC Thermistor',\r\n        element: 'wokwi-ntc-temperature-sensor',\r\n        description: 'Analog temperature sensor',\r\n        category: 'input',\r\n    },\r\n\r\n    // ==========================================\r\n    // ADDITIONAL DISPLAYS\r\n    // ==========================================\r\n    'max7219-matrix': {\r\n        name: 'MAX7219 Matrix',\r\n        element: 'wokwi-max7219-matrix',\r\n        description: '8x8 LED dot matrix display',\r\n        category: 'displays',\r\n    },\r\n    'tm1637-7segment': {\r\n        name: 'TM1637 Display',\r\n        element: 'wokwi-tm1637-7segment',\r\n        description: '4-digit 7-segment display with driver',\r\n        category: 'displays',\r\n    },\r\n\r\n    // ==========================================\r\n    // OUTPUT DEVICES\r\n    // ==========================================\r\n    'relay-module': {\r\n        name: 'Relay Module',\r\n        element: 'wokwi-relay-module',\r\n        description: 'Single channel relay module',\r\n        category: 'output',\r\n    },\r\n    'nlsf595': {\r\n        name: 'NLSF595 LED Driver',\r\n        element: 'wokwi-nlsf595',\r\n        description: 'LED driver with shift register',\r\n        category: 'leds',\r\n    },\r\n\r\n    // ==========================================\r\n    // ADDITIONAL MICROCONTROLLERS\r\n    // ==========================================\r\n    'attiny85': {\r\n        name: 'ATtiny85',\r\n        element: 'wokwi-attiny85',\r\n        description: 'Small 8-pin microcontroller',\r\n        category: 'mcu',\r\n    },\r\n    'pi-pico': {\r\n        name: 'Raspberry Pi Pico',\r\n        element: 'wokwi-pi-pico',\r\n        description: 'RP2040-based microcontroller',\r\n        category: 'mcu',\r\n    },\r\n};\r\n\r\nexport type WokwiPartType = keyof typeof WOKWI_PARTS;\r\n\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AAaM,MAAM,cAA+C;IACxD,eAAe;QACX,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,mBAAmB;QACf,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,gBAAgB;QACZ,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,gBAAgB;QACZ,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,uBAAuB;QACnB,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,eAAe;QACX,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,WAAW;IACX,mBAAmB;QACf,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,iBAAiB;QACb,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,OAAO;IACP,OAAO;QACH,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,YAAY;QACR,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,mBAAmB;QACf,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,iBAAiB;QACb,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,YAAY;QACR,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,UAAU;IACV,SAAS;QACL,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,cAAc;QACV,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,iBAAiB;QACb,MAAM;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"}},
    {"offset": {"line": 672, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/simulation/audio.ts"],"sourcesContent":["'use client';\r\n\r\n/**\r\n * Audio simulation utilities for FUNDI Workbench\r\n * Uses Web Audio API to generate tones for buzzer/speaker simulation\r\n */\r\n\r\nclass AudioSimulation {\r\n    private audioContext: AudioContext | null = null;\r\n    private oscillators: Map<string, OscillatorNode> = new Map();\r\n    private gainNodes: Map<string, GainNode> = new Map();\r\n    private masterGain: GainNode | null = null;\r\n    private muted: boolean = false;\r\n    private volume: number = 0.3; // Default volume (0-1)\r\n\r\n    /**\r\n     * Initialize the audio context (must be called after user interaction)\r\n     */\r\n    initialize(): void {\r\n        if (this.audioContext) return;\r\n\r\n        try {\r\n            this.audioContext = new (window.AudioContext || (window as unknown as { webkitAudioContext: typeof AudioContext }).webkitAudioContext)();\r\n            this.masterGain = this.audioContext.createGain();\r\n            this.masterGain.gain.value = this.volume;\r\n            this.masterGain.connect(this.audioContext.destination);\r\n            console.log('[AudioSimulation] Initialized');\r\n        } catch (e) {\r\n            console.warn('[AudioSimulation] Web Audio API not supported:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resume audio context if suspended (required by browser autoplay policies)\r\n     */\r\n    async resume(): Promise<void> {\r\n        if (this.audioContext?.state === 'suspended') {\r\n            await this.audioContext.resume();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Play a tone at a specific frequency\r\n     * @param id Unique identifier for this tone source\r\n     * @param frequency Frequency in Hz (e.g., 440 for A4)\r\n     * @param waveform Oscillator waveform type\r\n     */\r\n    playTone(\r\n        id: string,\r\n        frequency: number,\r\n        waveform: OscillatorType = 'square'\r\n    ): void {\r\n        if (!this.audioContext || !this.masterGain || this.muted) return;\r\n\r\n        // Stop existing tone with this ID\r\n        this.stopTone(id);\r\n\r\n        try {\r\n            const oscillator = this.audioContext.createOscillator();\r\n            const gainNode = this.audioContext.createGain();\r\n\r\n            oscillator.type = waveform;\r\n            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);\r\n\r\n            // Soft start to avoid clicks\r\n            gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);\r\n            gainNode.gain.linearRampToValueAtTime(1, this.audioContext.currentTime + 0.01);\r\n\r\n            oscillator.connect(gainNode);\r\n            gainNode.connect(this.masterGain);\r\n            oscillator.start();\r\n\r\n            this.oscillators.set(id, oscillator);\r\n            this.gainNodes.set(id, gainNode);\r\n\r\n            console.log(`[AudioSimulation] Playing tone: ${frequency}Hz on ${id}`);\r\n        } catch (e) {\r\n            console.warn('[AudioSimulation] Failed to play tone:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Stop a specific tone\r\n     * @param id Unique identifier for the tone to stop\r\n     */\r\n    stopTone(id: string): void {\r\n        const oscillator = this.oscillators.get(id);\r\n        const gainNode = this.gainNodes.get(id);\r\n\r\n        if (oscillator && gainNode && this.audioContext) {\r\n            try {\r\n                // Soft stop to avoid clicks\r\n                gainNode.gain.linearRampToValueAtTime(0, this.audioContext.currentTime + 0.01);\r\n                setTimeout(() => {\r\n                    try {\r\n                        oscillator.stop();\r\n                        oscillator.disconnect();\r\n                        gainNode.disconnect();\r\n                    } catch {\r\n                        // Already stopped\r\n                    }\r\n                }, 20);\r\n            } catch {\r\n                // Already stopped\r\n            }\r\n        }\r\n\r\n        this.oscillators.delete(id);\r\n        this.gainNodes.delete(id);\r\n    }\r\n\r\n    /**\r\n     * Stop all playing tones\r\n     */\r\n    stopAll(): void {\r\n        for (const id of this.oscillators.keys()) {\r\n            this.stopTone(id);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set master volume\r\n     * @param volume Volume level (0-1)\r\n     */\r\n    setVolume(volume: number): void {\r\n        this.volume = Math.max(0, Math.min(1, volume));\r\n        if (this.masterGain && this.audioContext) {\r\n            this.masterGain.gain.setValueAtTime(this.volume, this.audioContext.currentTime);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current volume\r\n     */\r\n    getVolume(): number {\r\n        return this.volume;\r\n    }\r\n\r\n    /**\r\n     * Mute/unmute all audio\r\n     */\r\n    setMuted(muted: boolean): void {\r\n        this.muted = muted;\r\n        if (muted) {\r\n            this.stopAll();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if audio is muted\r\n     */\r\n    isMuted(): boolean {\r\n        return this.muted;\r\n    }\r\n\r\n    /**\r\n     * Play a beep (short tone)\r\n     * @param frequency Frequency in Hz\r\n     * @param duration Duration in milliseconds\r\n     */\r\n    beep(frequency: number = 1000, duration: number = 100): void {\r\n        const id = `beep-${Date.now()}`;\r\n        this.playTone(id, frequency);\r\n        setTimeout(() => this.stopTone(id), duration);\r\n    }\r\n\r\n    /**\r\n     * Clean up resources\r\n     */\r\n    dispose(): void {\r\n        this.stopAll();\r\n        if (this.audioContext) {\r\n            this.audioContext.close();\r\n            this.audioContext = null;\r\n            this.masterGain = null;\r\n        }\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nlet audioSimulationInstance: AudioSimulation | null = null;\r\n\r\n/**\r\n * Get the audio simulation singleton (creates it if needed)\r\n */\r\nexport function getAudioSimulation(): AudioSimulation {\r\n    if (!audioSimulationInstance) {\r\n        audioSimulationInstance = new AudioSimulation();\r\n    }\r\n    return audioSimulationInstance;\r\n}\r\n\r\n/**\r\n * Helper to calculate frequency from PWM value\r\n * Maps PWM duty cycle to audible frequency range\r\n */\r\nexport function pwmToFrequency(pwm: number, minFreq: number = 100, maxFreq: number = 4000): number {\r\n    // PWM 0-255 maps to frequency range\r\n    const normalized = pwm / 255;\r\n    return minFreq + normalized * (maxFreq - minFreq);\r\n}\r\n\r\nexport type { AudioSimulation };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 837, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/nodes/WokwiPartNode.tsx"],"sourcesContent":["'use client';\r\n\r\nimport '@wokwi/elements';\r\nimport { memo, useEffect, useRef, useState, useCallback } from 'react';\r\nimport type { ElementType } from 'react';\r\nimport { Trash2 } from 'lucide-react';\r\nimport { WOKWI_PARTS, WokwiPartType } from '@/lib/wokwiParts';\r\nimport type { WirePoint } from '@/types/wire';\r\nimport { getAudioSimulation, pwmToFrequency } from '@/utils/simulation/audio';\r\n\r\ninterface PinData {\r\n    id: string;\r\n    x: number;\r\n    y: number;\r\n    row: 'top' | 'bottom' | 'left' | 'right';\r\n}\r\n\r\ninterface WokwiPartNodeData {\r\n    onPinClick?: (nodeId: string, pinId: string, position: WirePoint) => void;\r\n    getCanvasRect?: () => DOMRect | null;\r\n    onDeletePart?: (nodeId: string) => void;\r\n    /** \r\n     * Pin states from simulation - maps pin ID to:\r\n     * - boolean: HIGH/LOW digital state\r\n     * - number (0-255): PWM duty cycle for brightness control\r\n     */\r\n    simulationPinStates?: Record<string, boolean | number>;\r\n    /** PWM duty cycle value for the component (0-255) - for LED brightness */\r\n    pwmValue?: number;\r\n    /** Part type for this component */\r\n    partType?: WokwiPartType;\r\n\r\n    /** Element attributes for Wokwi custom elements (e.g., { color: 'green' }, { value: '220' }) */\r\n    attrs?: Record<string, string>;\r\n    /** Button interaction handlers */\r\n    onButtonPress?: (partId: string) => void;\r\n    onButtonRelease?: (partId: string) => void;\r\n    /** Interactive component value change (potentiometers, sensors, etc.) */\r\n    onValueChange?: (partId: string, value: number) => void;\r\n    /** Current interactive component value (for display) */\r\n    interactiveValue?: number;\r\n    /** Slide switch toggle callback */\r\n    onSwitchToggle?: (partId: string, isOn: boolean) => void;\r\n    /** Current switch state (for display) */\r\n    switchState?: boolean;\r\n}\r\n\r\ninterface WokwiPartNodeProps {\r\n    id?: string;\r\n    data?: WokwiPartNodeData;\r\n    partType?: WokwiPartType; // Can be passed directly or via data\r\n}\r\n\r\nfunction getPartTypeFromData(data: WokwiPartNodeData | undefined): WokwiPartType | null {\r\n    const maybe = (data as unknown as { partType?: unknown } | undefined)?.partType;\r\n    return typeof maybe === 'string' ? (maybe as WokwiPartType) : null;\r\n}\r\n\r\n/**\r\n * Generic Wokwi Part Node - renders any Wokwi element with pin overlays\r\n */\r\nfunction WokwiPartNode({ id: nodeId = 'preview', data, partType: propPartType }: WokwiPartNodeProps) {\r\n    const onPinClick = data?.onPinClick;\r\n    const getCanvasRect = data?.getCanvasRect;\r\n    const onDeletePart = data?.onDeletePart;\r\n    const simulationPinStates = data?.simulationPinStates;\r\n    const pwmValue = data?.pwmValue;\r\n    const partType = propPartType ?? getPartTypeFromData(data) ?? 'arduino-uno';\r\n\r\n    const [hoveredPin, setHoveredPin] = useState<string | null>(null);\r\n    const [pins, setPins] = useState<PinData[]>([]);\r\n    const [svgDimensions, setSvgDimensions] = useState({ width: 100, height: 100 });\r\n    const [isSelected, setIsSelected] = useState(false);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const elementRef = useRef<HTMLElement | null>(null);\r\n\r\n    const partConfig = WOKWI_PARTS[partType];\r\n    const partElementTag = partConfig?.element;\r\n    const PartElement = (partElementTag ?? null) as ElementType | null;\r\n    const isUnknownPart = !partConfig || !partElementTag || !PartElement;\r\n\r\n    const applyStaticAttrs = useCallback(() => {\r\n        const element = elementRef.current;\r\n        if (!element) return;\r\n\r\n        const attrs = data?.attrs;\r\n        if (!attrs) return;\r\n\r\n        for (const [key, value] of Object.entries(attrs)) {\r\n            // Avoid clobbering simulation-driven runtime properties.\r\n            if ((partType === 'led' || partType === 'wokwi-led') && (key === 'value' || key === 'brightness')) {\r\n                continue;\r\n            }\r\n\r\n            try {\r\n                element.setAttribute(key, String(value));\r\n            } catch {\r\n                // Ignore invalid attributes\r\n            }\r\n        }\r\n\r\n        const maybeLit = element as unknown as { requestUpdate?: () => void };\r\n        if (typeof maybeLit.requestUpdate === 'function') {\r\n            maybeLit.requestUpdate();\r\n        }\r\n    }, [data?.attrs, partType]);\r\n\r\n    // Handle click to select/deselect component\r\n    const handleClick = useCallback(\r\n        (e: React.MouseEvent) => {\r\n            // Don't select if clicking on a pin\r\n            const target = e.target as HTMLElement;\r\n            if (target.hasAttribute('data-fundi-pin')) return;\r\n\r\n            e.stopPropagation();\r\n            if (nodeId === 'preview') return;\r\n\r\n            setIsSelected(prev => !prev);\r\n        },\r\n        [nodeId]\r\n    );\r\n\r\n    // Handle delete button click\r\n    const handleDelete = useCallback(\r\n        (e: React.MouseEvent) => {\r\n            e.stopPropagation();\r\n            if (!onDeletePart || nodeId === 'preview') return;\r\n            onDeletePart(nodeId);\r\n        },\r\n        [onDeletePart, nodeId]\r\n    );\r\n\r\n    // Click outside to deselect\r\n    useEffect(() => {\r\n        if (!isSelected) return;\r\n\r\n        const handleClickOutside = (e: MouseEvent) => {\r\n            if (containerRef.current && !containerRef.current.contains(e.target as Node)) {\r\n                setIsSelected(false);\r\n            }\r\n        };\r\n\r\n        // Delay adding listener to avoid immediate deselection\r\n        const timer = setTimeout(() => {\r\n            document.addEventListener('click', handleClickOutside);\r\n        }, 0);\r\n\r\n        return () => {\r\n            clearTimeout(timer);\r\n            document.removeEventListener('click', handleClickOutside);\r\n        };\r\n    }, [isSelected]);\r\n\r\n    const handlePinClick = useCallback(\r\n        (e: React.MouseEvent, pin: PinData) => {\r\n            e.stopPropagation();\r\n            if (!onPinClick || !elementRef.current) return;\r\n\r\n            const element = elementRef.current;\r\n            const elementRect = element.getBoundingClientRect();\r\n\r\n            // Calculate scale: how much the element is scaled from its internal coordinate space\r\n            const scaleX = elementRect.width / svgDimensions.width;\r\n            const scaleY = elementRect.height / svgDimensions.height;\r\n\r\n            // Transform pin coordinates to screen coordinates\r\n            const screenX = elementRect.left + pin.x * scaleX;\r\n            const screenY = elementRect.top + pin.y * scaleY;\r\n\r\n            const canvasRect = getCanvasRect?.();\r\n            const canvasRelative = canvasRect\r\n                ? { x: screenX - canvasRect.left, y: screenY - canvasRect.top }\r\n                : { x: screenX, y: screenY };\r\n\r\n            onPinClick(nodeId, pin.id, canvasRelative);\r\n        },\r\n        [onPinClick, nodeId, getCanvasRect, svgDimensions]\r\n    );\r\n\r\n    const calculatePins = useCallback(() => {\r\n        const element = elementRef.current as HTMLElement & {\r\n            pinInfo?: { name: string; x: number; y: number }[]\r\n        };\r\n\r\n        if (!element || !element.shadowRoot || !element.pinInfo) return;\r\n\r\n        const svg = element.shadowRoot.querySelector('svg');\r\n        if (!svg) return;\r\n\r\n        const viewBoxAttr = svg.getAttribute('viewBox');\r\n        const widthAttr = svg.getAttribute('width') || '';\r\n        const heightAttr = svg.getAttribute('height') || '';\r\n\r\n        if (!viewBoxAttr) return;\r\n\r\n        // Parse viewBox: \"minX minY width height\"\r\n        const [, , vbW, vbH] = viewBoxAttr.split(/[\\s,]+/).map(parseFloat);\r\n        if (!vbW || !vbH) return;\r\n\r\n        // Parse mm dimensions if present\r\n        const widthMM = widthAttr.includes('mm') ? parseFloat(widthAttr) : null;\r\n        const heightMM = heightAttr.includes('mm') ? parseFloat(heightAttr) : null;\r\n\r\n        // Detect if viewBox is in mm by checking if it matches the mm dimensions\r\n        // Arduino: viewBox=\"-4 0 72.58 53.34\" with width=\"72.58mm\" height=\"53.34mm\" -> viewBox IS in mm\r\n        // ESP32: viewBox=\"0 0 107 201\" with width=\"28.2mm\" height=\"54.053mm\" -> viewBox is NOT in mm\r\n        const viewBoxMatchesMM =\r\n            widthMM !== null &&\r\n            heightMM !== null &&\r\n            Math.abs(vbW - widthMM) < 1 &&\r\n            Math.abs(vbH - heightMM) < 1;\r\n\r\n        const MM_TO_PX = 96 / 25.4;\r\n\r\n        let overlayWidth: number;\r\n        let overlayHeight: number;\r\n\r\n        if (viewBoxMatchesMM) {\r\n            // ViewBox is in mm, convert to pixels to match pinInfo coordinates\r\n            overlayWidth = vbW * MM_TO_PX;\r\n            overlayHeight = vbH * MM_TO_PX;\r\n        } else {\r\n            // ViewBox is already in the correct coordinate space (like ESP32)\r\n            overlayWidth = vbW;\r\n            overlayHeight = vbH;\r\n        }\r\n\r\n        setSvgDimensions({ width: overlayWidth, height: overlayHeight });\r\n\r\n        // Map pins - pinInfo coordinates work directly in the overlay's space\r\n        const mappedPins: PinData[] = element.pinInfo.map((pin) => {\r\n            // Determine which edge the pin is closest to\r\n            const relX = pin.x / overlayWidth;\r\n            const relY = pin.y / overlayHeight;\r\n\r\n            let row: 'top' | 'bottom' | 'left' | 'right';\r\n            if (relX < 0.15) row = 'left';\r\n            else if (relX > 0.85) row = 'right';\r\n            else if (relY < 0.5) row = 'top';\r\n            else row = 'bottom';\r\n\r\n            return {\r\n                id: pin.name,\r\n                x: pin.x,\r\n                y: pin.y,\r\n                row,\r\n            };\r\n        });\r\n\r\n        setPins(mappedPins);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const initElement = async () => {\r\n            if (!partElementTag) return;\r\n            await customElements.whenDefined(partElementTag);\r\n\r\n            const element = containerRef.current?.querySelector(partElementTag);\r\n            if (!element) return;\r\n\r\n            elementRef.current = element as HTMLElement;\r\n            applyStaticAttrs();\r\n\r\n            requestAnimationFrame(() => {\r\n                calculatePins();\r\n                setTimeout(calculatePins, 100);\r\n                setTimeout(calculatePins, 300);\r\n            });\r\n        };\r\n\r\n        initElement();\r\n\r\n        const observer = new ResizeObserver(calculatePins);\r\n        if (containerRef.current) observer.observe(containerRef.current);\r\n\r\n        window.addEventListener('resize', calculatePins);\r\n\r\n        return () => {\r\n            observer.disconnect();\r\n            window.removeEventListener('resize', calculatePins);\r\n        };\r\n    }, [applyStaticAttrs, calculatePins, partElementTag]);\r\n\r\n    // Apply static Wokwi element attributes from circuit state (colors, values, labels, etc.)\r\n    useEffect(() => {\r\n        applyStaticAttrs();\r\n    }, [applyStaticAttrs]);\r\n\r\n    // Update element properties based on simulation pin states\r\n    useEffect(() => {\r\n        const element = elementRef.current;\r\n        if (!element) return;\r\n\r\n        // Debug log when simulation states are received\r\n        if (simulationPinStates && Object.keys(simulationPinStates).length > 0) {\r\n            console.log('[WokwiPartNode] Applying simulation states:', { partType, simulationPinStates, pwmValue });\r\n        }\r\n\r\n        // For LED elements: if anode (A) is HIGH and cathode (C) is LOW or ground, turn ON\r\n        // LED element has a 'value' property (boolean) to control on/off state\r\n        // For PWM: use 'brightness' property (0-1) with gamma correction\r\n        if (partType === 'led' || partType === 'wokwi-led') {\r\n            const anodeState = simulationPinStates?.['A'];\r\n            const ledEl = element as HTMLElement & {\r\n                value?: boolean;\r\n                brightness?: number;\r\n                requestUpdate?: () => void\r\n            };\r\n\r\n            // Apply gamma correction for realistic LED brightness\r\n            // Wokwi uses gamma=2.8 by default\r\n            const GAMMA = 2.8;\r\n\r\n            // Check for PWM value first (from componentPwmStates), then fall back to pin state\r\n            if (typeof pwmValue === 'number' && pwmValue > 0) {\r\n                // PWM mode from componentPwmStates\r\n                const normalized = pwmValue / 255;\r\n                const gammaCorrected = Math.pow(normalized, 1 / GAMMA);\r\n                console.log('[LED] PWM brightness from pwmValue:', pwmValue, '-> gamma:', gammaCorrected.toFixed(2));\r\n                ledEl.value = true;\r\n                element.style.setProperty('--led-brightness', gammaCorrected.toString());\r\n                element.style.opacity = (0.3 + gammaCorrected * 0.7).toString();\r\n            } else if (typeof anodeState === 'number') {\r\n                // PWM mode: anodeState is 0-255\r\n                const normalized = anodeState / 255;\r\n                const gammaCorrected = Math.pow(normalized, 1 / GAMMA);\r\n                console.log('[LED] PWM brightness from pin:', anodeState, '-> gamma:', gammaCorrected.toFixed(2));\r\n                ledEl.value = anodeState > 0;\r\n                element.style.setProperty('--led-brightness', gammaCorrected.toString());\r\n                element.style.opacity = (0.3 + gammaCorrected * 0.7).toString();\r\n            } else {\r\n                // Boolean mode: simple on/off\r\n                const anodeHigh = anodeState === true;\r\n                console.log('[LED] Setting value:', anodeHigh, 'current:', ledEl.value);\r\n                ledEl.value = anodeHigh;\r\n                element.style.removeProperty('--led-brightness');\r\n                element.style.opacity = anodeHigh ? '1' : '0.3';\r\n            }\r\n\r\n            // Force Lit element to re-render\r\n            if (typeof ledEl.requestUpdate === 'function') {\r\n                ledEl.requestUpdate();\r\n            }\r\n        }\r\n\r\n        // For RGB LED elements\r\n        if (partType === 'rgb-led' || partType === 'wokwi-rgb-led') {\r\n            // RGB LED has pins: R.A, R.C, G.A, G.C, B.A, B.C (common anode/cathode)\r\n            // For common cathode: individual anodes HIGH = that color on\r\n            // Supports both boolean and PWM values\r\n            const GAMMA = 2.8;\r\n            const element_rgb = element as HTMLElement & {\r\n                redValue?: boolean;\r\n                greenValue?: boolean;\r\n                blueValue?: boolean;\r\n                requestUpdate?: () => void;\r\n            };\r\n\r\n            // Handle each color channel\r\n            for (const [pin, prop] of [['R.A', 'redValue'], ['G.A', 'greenValue'], ['B.A', 'blueValue']] as const) {\r\n                const state = simulationPinStates?.[pin];\r\n                if (state !== undefined) {\r\n                    if (typeof state === 'number') {\r\n                        // PWM mode\r\n                        const normalized = state / 255;\r\n                        (element_rgb as unknown as Record<string, boolean>)[prop] = normalized > 0.5;\r\n                    } else {\r\n                        // Boolean mode\r\n                        (element_rgb as unknown as Record<string, boolean>)[prop] = state;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (typeof element_rgb.requestUpdate === 'function') {\r\n                element_rgb.requestUpdate();\r\n            }\r\n        }\r\n\r\n        // For 7-segment display elements\r\n        if (partType === '7segment' || partType === 'wokwi-7segment') {\r\n            const segmentEl = element as HTMLElement & {\r\n                a?: boolean;\r\n                b?: boolean;\r\n                c?: boolean;\r\n                d?: boolean;\r\n                e?: boolean;\r\n                f?: boolean;\r\n                g?: boolean;\r\n                dp?: boolean;\r\n                requestUpdate?: () => void;\r\n            };\r\n\r\n            // Map pin states to segments (a-g and dp)\r\n            const segmentPins = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'dp'];\r\n            for (const seg of segmentPins) {\r\n                const pinState = simulationPinStates?.[seg.toUpperCase()] ?? simulationPinStates?.[seg];\r\n                if (pinState !== undefined) {\r\n                    (segmentEl as unknown as Record<string, boolean>)[seg] =\r\n                        typeof pinState === 'boolean' ? pinState : pinState > 0;\r\n                }\r\n            }\r\n\r\n            if (typeof segmentEl.requestUpdate === 'function') {\r\n                segmentEl.requestUpdate();\r\n            }\r\n        }\r\n\r\n        // For servo elements - convert PWM value to angle (0-180)\r\n        if (partType === 'servo' || partType === 'wokwi-servo') {\r\n            const pwmValue = simulationPinStates?.['PWM'];\r\n            const servoEl = element as HTMLElement & {\r\n                angle?: number;\r\n                requestUpdate?: () => void\r\n            };\r\n\r\n            if (typeof pwmValue === 'number') {\r\n                // PWM value (0-255) maps to servo angle (0-180)\r\n                // In real servos, pulse width 1000-2000s = 0-180\r\n                // For simulation, we use direct mapping from PWM duty cycle\r\n                const angle = (pwmValue / 255) * 180;\r\n                console.log('[Servo] PWM value:', pwmValue, '-> angle:', angle.toFixed(1));\r\n                servoEl.angle = angle;\r\n            } else if (pwmValue === true) {\r\n                // Digital HIGH might mean 90 (center position)\r\n                servoEl.angle = 90;\r\n            }\r\n\r\n            if (typeof servoEl.requestUpdate === 'function') {\r\n                servoEl.requestUpdate();\r\n            }\r\n        }\r\n\r\n        // For buzzer elements - both visual and audio feedback\r\n        if (partType === 'buzzer' || partType === 'wokwi-buzzer') {\r\n            const signalState = simulationPinStates?.['1'];\r\n            const buzzerEl = element as HTMLElement & { hasSignal?: boolean; requestUpdate?: () => void };\r\n            const audioSimulation = getAudioSimulation();\r\n            const buzzerId = `buzzer-${nodeId}`;\r\n\r\n            if (typeof signalState === 'boolean') {\r\n                buzzerEl.hasSignal = signalState;\r\n\r\n                // Play/stop audio based on boolean state\r\n                if (signalState) {\r\n                    audioSimulation.initialize();\r\n                    audioSimulation.resume().then(() => {\r\n                        audioSimulation.playTone(buzzerId, 1000, 'square'); // 1kHz square wave\r\n                    });\r\n                } else {\r\n                    audioSimulation.stopTone(buzzerId);\r\n                }\r\n            } else if (typeof signalState === 'number') {\r\n                // PWM on buzzer - indicates tone is playing with variable frequency\r\n                const isActive = signalState > 0;\r\n                buzzerEl.hasSignal = isActive;\r\n\r\n                if (isActive) {\r\n                    audioSimulation.initialize();\r\n                    audioSimulation.resume().then(() => {\r\n                        // Map PWM value to frequency (100Hz - 4000Hz range)\r\n                        const frequency = pwmToFrequency(signalState, 100, 4000);\r\n                        audioSimulation.playTone(buzzerId, frequency, 'square');\r\n                    });\r\n                } else {\r\n                    audioSimulation.stopTone(buzzerId);\r\n                }\r\n            } else {\r\n                // No signal - stop audio\r\n                audioSimulation.stopTone(buzzerId);\r\n            }\r\n\r\n            if (typeof buzzerEl.requestUpdate === 'function') {\r\n                buzzerEl.requestUpdate();\r\n            }\r\n        }\r\n\r\n    }, [simulationPinStates, pwmValue, partType, nodeId]);\r\n\r\n    // Listen for button press/release events\r\n    useEffect(() => {\r\n        const element = elementRef.current;\r\n        if (!element) return;\r\n\r\n        const onButtonPress = data?.onButtonPress;\r\n        const onButtonRelease = data?.onButtonRelease;\r\n\r\n        if (!onButtonPress || !onButtonRelease) return;\r\n\r\n        // Only attach listeners if this is a button component\r\n        if (partType.toLowerCase().includes('pushbutton') || partType.toLowerCase().includes('button')) {\r\n            const handlePress = () => {\r\n                console.log('[WokwiPartNode] Button press detected:', nodeId);\r\n                onButtonPress(nodeId);\r\n            };\r\n\r\n            const handleRelease = () => {\r\n                console.log('[WokwiPartNode] Button release detected:', nodeId);\r\n                onButtonRelease(nodeId);\r\n            };\r\n\r\n            element.addEventListener('button-press', handlePress);\r\n            element.addEventListener('button-release', handleRelease);\r\n\r\n            return () => {\r\n                element.removeEventListener('button-press', handlePress);\r\n                element.removeEventListener('button-release', handleRelease);\r\n            };\r\n        }\r\n    }, [data, nodeId, partType]);\r\n\r\n    // Handle potentiometer/slider drag interaction\r\n    useEffect(() => {\r\n        const element = elementRef.current;\r\n        if (!element) return;\r\n\r\n        const onValueChange = data?.onValueChange;\r\n        if (!onValueChange) return;\r\n\r\n        const isPotentiometer = partType.toLowerCase().includes('potentiometer') ||\r\n            partType.toLowerCase().includes('slide-potentiometer');\r\n\r\n        if (!isPotentiometer) return;\r\n\r\n        let isDragging = false;\r\n        let startY = 0;\r\n        let startValue = data?.interactiveValue ?? 512;\r\n\r\n        const handleMouseDown = (e: MouseEvent) => {\r\n            isDragging = true;\r\n            startY = e.clientY;\r\n            startValue = data?.interactiveValue ?? 512;\r\n            e.preventDefault();\r\n            document.addEventListener('mousemove', handleMouseMove);\r\n            document.addEventListener('mouseup', handleMouseUp);\r\n        };\r\n\r\n        const handleMouseMove = (e: MouseEvent) => {\r\n            if (!isDragging) return;\r\n\r\n            // Calculate delta and new value\r\n            const deltaY = startY - e.clientY; // Inverted so dragging up increases value\r\n            const sensitivity = 5; // Pixels per value change\r\n            const deltaValue = Math.round(deltaY * sensitivity);\r\n            const newValue = Math.max(0, Math.min(1023, startValue + deltaValue));\r\n\r\n            onValueChange(nodeId, newValue);\r\n        };\r\n\r\n        const handleMouseUp = () => {\r\n            isDragging = false;\r\n            document.removeEventListener('mousemove', handleMouseMove);\r\n            document.removeEventListener('mouseup', handleMouseUp);\r\n        };\r\n\r\n        // For rotary potentiometer - also handle wheel events\r\n        const handleWheel = (e: WheelEvent) => {\r\n            e.preventDefault();\r\n            const currentValue = data?.interactiveValue ?? 512;\r\n            const delta = e.deltaY > 0 ? -50 : 50;\r\n            const newValue = Math.max(0, Math.min(1023, currentValue + delta));\r\n            onValueChange(nodeId, newValue);\r\n        };\r\n\r\n        element.addEventListener('mousedown', handleMouseDown);\r\n        element.addEventListener('wheel', handleWheel, { passive: false });\r\n\r\n        return () => {\r\n            element.removeEventListener('mousedown', handleMouseDown);\r\n            element.removeEventListener('wheel', handleWheel);\r\n            document.removeEventListener('mousemove', handleMouseMove);\r\n            document.removeEventListener('mouseup', handleMouseUp);\r\n        };\r\n    }, [data, nodeId, partType]);\r\n\r\n    // Handle slide switch click-to-toggle\r\n    useEffect(() => {\r\n        const element = elementRef.current;\r\n        if (!element) return;\r\n\r\n        const onSwitchToggle = data?.onSwitchToggle;\r\n        if (!onSwitchToggle) return;\r\n\r\n        const isSwitch = partType.toLowerCase().includes('slide-switch') ||\r\n            partType.toLowerCase().includes('switch') &&\r\n            !partType.toLowerCase().includes('push');\r\n\r\n        if (!isSwitch) return;\r\n\r\n        const handleClick = () => {\r\n            const currentState = data?.switchState ?? false;\r\n            const newState = !currentState;\r\n            console.log('[WokwiPartNode] Switch toggle:', nodeId, '-> ', newState);\r\n            onSwitchToggle(nodeId, newState);\r\n        };\r\n\r\n        element.addEventListener('click', handleClick);\r\n\r\n        return () => {\r\n            element.removeEventListener('click', handleClick);\r\n        };\r\n    }, [data, nodeId, partType]);\r\n\r\n    if (isUnknownPart) {\r\n        console.warn(`[WokwiPartNode] Unknown part type: ${partType}`);\r\n        return (\r\n            <div className=\"relative glass-panel border-alchemist rounded-md p-4 text-amber-500 text-sm\">\r\n                Unknown component: {partType}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            className={`relative rounded-md transition-all duration-200 ${isSelected\r\n                    ? 'ring-2 ring-cyan-500/70 ring-offset-2 ring-offset-transparent shadow-lg shadow-cyan-500/20'\r\n                    : 'glass-panel border-alchemist hover:ring-1 hover:ring-amber-500/30'\r\n                }`}\r\n            style={{\r\n                display: 'inline-block',\r\n                lineHeight: 0,\r\n            }}\r\n            onClick={handleClick}\r\n        >\r\n            {/* Delete button - appears when selected */}\r\n            {isSelected && nodeId !== 'preview' && onDeletePart && (\r\n                <button\r\n                    onClick={handleDelete}\r\n                    className=\"absolute -top-3 -right-3 z-50 p-1.5 bg-red-500/90 hover:bg-red-600 text-white rounded-full shadow-lg transition-all duration-150 hover:scale-110\"\r\n                    title=\"Delete component\"\r\n                >\r\n                    <Trash2 className=\"w-3.5 h-3.5\" />\r\n                </button>\r\n            )}\r\n\r\n            {/* Selection indicator label */}\r\n            {isSelected && (\r\n                <div className=\"absolute -top-6 left-0 right-0 flex justify-center pointer-events-none z-40\">\r\n                    <span className=\"px-2 py-0.5 text-[10px] font-medium bg-cyan-500/90 text-white rounded shadow-sm\">\r\n                        {partConfig?.name || partType}\r\n                    </span>\r\n                </div>\r\n            )}\r\n\r\n            {/* Render the Wokwi custom element */}\r\n            {PartElement ? <PartElement style={{ display: 'block' }} /> : null}\r\n\r\n            {/* Pin hitboxes (Wokwi-style): big invisible clickable targets */}\r\n            <div\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 20,\r\n                }}\r\n            >\r\n                {pins.map((pin) => {\r\n                    const leftPct = svgDimensions.width\r\n                        ? (pin.x / svgDimensions.width) * 100\r\n                        : 0;\r\n                    const topPct = svgDimensions.height\r\n                        ? (pin.y / svgDimensions.height) * 100\r\n                        : 0;\r\n\r\n                    return (\r\n                        <div\r\n                            key={pin.id}\r\n                            className=\"nodrag\"\r\n                            data-fundi-pin=\"true\"\r\n                            data-node-id={nodeId}\r\n                            data-pin-id={pin.id}\r\n                            style={{\r\n                                position: 'absolute',\r\n                                left: `${leftPct}%`,\r\n                                top: `${topPct}%`,\r\n                                width: 14,\r\n                                height: 14,\r\n                                transform: 'translate(-50%, -50%)',\r\n                                borderRadius: 9999,\r\n                                pointerEvents: 'auto',\r\n                                cursor: 'pointer',\r\n                                background: 'transparent',\r\n                                touchAction: 'none',\r\n                                zIndex: 30,\r\n                            }}\r\n                            onPointerDown={(e) => {\r\n                                // Prevent ReactFlow node dragging from stealing the interaction\r\n                                e.stopPropagation();\r\n                            }}\r\n                            onMouseEnter={() => setHoveredPin(pin.id)}\r\n                            onMouseLeave={() => setHoveredPin(null)}\r\n                            onClick={(e) => handlePinClick(e, pin)}\r\n                            aria-label={`Pin ${pin.id}`}\r\n                        />\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* SVG Overlay - viewBox matches the pinInfo coordinate space */}\r\n            <svg\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    overflow: 'visible',\r\n                    zIndex: 10,\r\n                }}\r\n                viewBox={`0 0 ${svgDimensions.width} ${svgDimensions.height}`}\r\n            >\r\n                {pins.map((pin) => {\r\n                    const isHovered = hoveredPin === pin.id;\r\n\r\n                    return (\r\n                        <g key={pin.id}>\r\n                            {/* Visual pin indicator - Copper Pad style */}\r\n                            <circle\r\n                                cx={pin.x}\r\n                                cy={pin.y}\r\n                                r={isHovered ? 3.5 : 2.5}\r\n                                fill={isHovered ? '#D4AF37' : '#B87333'}\r\n                                stroke={isHovered ? '#00F0FF' : '#8B4513'}\r\n                                strokeWidth={isHovered ? 1 : 0.75}\r\n                                style={{\r\n                                    transition: 'all 0.1s ease',\r\n                                    pointerEvents: 'none',\r\n                                    filter: isHovered ? 'drop-shadow(0 0 3px #00F0FF)' : 'none'\r\n                                }}\r\n                            />\r\n                            {isHovered && (\r\n                                <g>\r\n                                    <rect\r\n                                        x={pin.x - 15}\r\n                                        y={pin.row === 'top' || pin.row === 'left' ? pin.y + 6 : pin.y - 18}\r\n                                        width={30}\r\n                                        height={12}\r\n                                        rx={2}\r\n                                        fill=\"rgba(21, 27, 43, 0.95)\"\r\n                                        stroke=\"rgba(212, 175, 55, 0.5)\"\r\n                                        strokeWidth={0.5}\r\n                                    />\r\n                                    <text\r\n                                        x={pin.x}\r\n                                        y={pin.row === 'top' || pin.row === 'left' ? pin.y + 15 : pin.y - 9}\r\n                                        textAnchor=\"middle\"\r\n                                        fill=\"#D4AF37\"\r\n                                        fontSize={6}\r\n                                        fontFamily=\"monospace\"\r\n                                        fontWeight=\"bold\"\r\n                                    >\r\n                                        {pin.id}\r\n                                    </text>\r\n                                </g>\r\n                            )}\r\n                        </g>\r\n                    );\r\n                })}\r\n            </svg>\r\n        </div>\r\n    );\r\n}\r\n\r\n// Custom memo comparison to ensure simulationPinStates changes trigger re-renders\r\nexport default memo(WokwiPartNode, (prevProps, nextProps) => {\r\n    const prevStates = prevProps.data?.simulationPinStates;\r\n    const nextStates = nextProps.data?.simulationPinStates;\r\n\r\n    // Always re-render if simulationPinStates changed\r\n    if (JSON.stringify(prevStates) !== JSON.stringify(nextStates)) {\r\n        return false; // Should re-render\r\n    }\r\n\r\n    // Default comparison for other props\r\n    const prevPartType = prevProps.partType ?? (prevProps.data as Record<string, unknown> | undefined)?.partType;\r\n    const nextPartType = nextProps.partType ?? (nextProps.data as Record<string, unknown> | undefined)?.partType;\r\n\r\n    return prevProps.id === nextProps.id && prevPartType === nextPartType;\r\n});\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1633, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/cn.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx'\r\nimport { twMerge } from 'tailwind-merge'\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs))\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB"}},
    {"offset": {"line": 1651, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/ComponentLibrary.tsx"],"sourcesContent":["'use client';\r\n\r\nimport '@wokwi/elements';\r\nimport { memo, useMemo, useState, useRef, useEffect, useCallback } from 'react';\r\nimport { Cpu, Lightbulb, Gauge, Monitor, Zap, CircuitBoard, Settings, Cog, ChevronLeft, ChevronRight } from 'lucide-react';\r\nimport type { WokwiPartType } from '@/lib/wokwiParts';\r\nimport { WOKWI_PARTS, type ComponentCategory } from '@/lib/wokwiParts';\r\nimport { cn } from '@/utils/cn';\r\n\r\nexport const FUNDI_PART_MIME = 'application/x-fundi-part';\r\n\r\ntype PartCatalogItem = {\r\n  id: WokwiPartType;\r\n  name: string;\r\n  description?: string;\r\n};\r\n\r\ntype CatalogCategory = {\r\n  key: ComponentCategory;\r\n  title: string;\r\n  items: PartCatalogItem[];\r\n  icon: React.ComponentType<{ className?: string }>;\r\n};\r\n\r\n/**\r\n * Cache for extracted SVG content from Wokwi elements\r\n */\r\nconst svgCache = new Map<string, string | null>();\r\n\r\n/**\r\n * Extract SVG content from a Wokwi custom element's shadow DOM\r\n */\r\nfunction extractSvgFromElement(element: Element): string | null {\r\n  // Try to get SVG from shadow root\r\n  const shadowRoot = element.shadowRoot;\r\n  if (shadowRoot) {\r\n    const svg = shadowRoot.querySelector('svg');\r\n    if (svg) {\r\n      return svg.outerHTML;\r\n    }\r\n  }\r\n  // Try direct child SVG\r\n  const directSvg = element.querySelector('svg');\r\n  if (directSvg) {\r\n    return directSvg.outerHTML;\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Renders an actual Wokwi element as a preview icon with SVG extraction\r\n */\r\nfunction WokwiElementPreview({\r\n  elementTag,\r\n  partId,\r\n  fallbackIcon: FallbackIcon,\r\n}: {\r\n  elementTag: string;\r\n  partId: string;\r\n  fallbackIcon: React.ComponentType<{ className?: string }>;\r\n}) {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [svgContent, setSvgContent] = useState<string | null>(null);\r\n  const [usesFallback, setUsesFallback] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Check cache first\r\n    if (svgCache.has(partId)) {\r\n      const cached = svgCache.get(partId);\r\n      if (cached) {\r\n        setSvgContent(cached);\r\n      } else {\r\n        setUsesFallback(true);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    // Clear any existing content\r\n    container.innerHTML = '';\r\n\r\n    try {\r\n      // Create the wokwi element\r\n      const element = document.createElement(elementTag);\r\n\r\n      // Set common attributes for better preview appearance\r\n      if (elementTag === 'wokwi-led') {\r\n        element.setAttribute('color', 'red');\r\n        element.setAttribute('value', '1'); // Show lit state\r\n      } else if (elementTag === 'wokwi-pushbutton') {\r\n        element.setAttribute('color', 'red');\r\n      } else if (elementTag === 'wokwi-rgb-led') {\r\n        element.setAttribute('r', '1');\r\n        element.setAttribute('g', '0');\r\n        element.setAttribute('b', '0');\r\n      } else if (elementTag === 'wokwi-neopixel') {\r\n        element.setAttribute('r', '255');\r\n        element.setAttribute('g', '100');\r\n        element.setAttribute('b', '0');\r\n      }\r\n\r\n      container.appendChild(element);\r\n\r\n      // Wait for custom element to be defined and render\r\n      const tryExtractSvg = () => {\r\n        const svg = extractSvgFromElement(element);\r\n        if (svg) {\r\n          svgCache.set(partId, svg);\r\n          setSvgContent(svg);\r\n        } else {\r\n          // Mark as fallback needed if no SVG after delay\r\n          svgCache.set(partId, null);\r\n          setUsesFallback(true);\r\n        }\r\n      };\r\n\r\n      // Try immediately, then with delays for custom elements that render async\r\n      requestAnimationFrame(() => {\r\n        if (!extractSvgFromElement(element)) {\r\n          setTimeout(tryExtractSvg, 100);\r\n        } else {\r\n          tryExtractSvg();\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error(`Failed to create wokwi element: ${elementTag}`, error);\r\n      svgCache.set(partId, null);\r\n      setUsesFallback(true);\r\n    }\r\n  }, [elementTag, partId]);\r\n\r\n  // If we have extracted SVG, render it directly\r\n  if (svgContent) {\r\n    return (\r\n      <div \r\n        className=\"relative h-10 w-10 flex items-center justify-center overflow-hidden [&_svg]:max-w-full [&_svg]:max-h-full [&_svg]:w-auto [&_svg]:h-auto\"\r\n        dangerouslySetInnerHTML={{ __html: svgContent }}\r\n        style={{\r\n          transform: 'scale(0.6)',\r\n          transformOrigin: 'center',\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  // Render the actual element (for elements that don't expose SVG or while loading)\r\n  return (\r\n    <div className=\"relative h-10 w-10 flex items-center justify-center overflow-hidden\">\r\n      {/* Wokwi element container - scaled down */}\r\n      <div\r\n        ref={containerRef}\r\n        className=\"transition-all group-hover:scale-110\"\r\n        style={{\r\n          transform: 'scale(0.5)',\r\n          transformOrigin: 'center',\r\n        }}\r\n      />\r\n      {/* Fallback icon if element fails to load */}\r\n      {usesFallback && (\r\n        <FallbackIcon className=\"absolute h-8 w-8 text-ide-text-muted transition-colors group-hover:text-ide-accent\" />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function buildPartCatalog(): CatalogCategory[] {\r\n  const base: Record<ComponentCategory, PartCatalogItem[]> = {\r\n    mcu: [],\r\n    displays: [],\r\n    leds: [],\r\n    input: [],\r\n    output: [],\r\n    passive: [],\r\n    logic: [],\r\n    motors: [],\r\n  };\r\n\r\n  for (const id of Object.keys(WOKWI_PARTS) as WokwiPartType[]) {\r\n    const cfg = WOKWI_PARTS[id];\r\n    const cat = cfg.category ?? 'mcu';\r\n    if (base[cat]) {\r\n      base[cat].push({ id, name: cfg.name, description: cfg.description });\r\n    }\r\n  }\r\n\r\n  return [\r\n    { key: 'mcu', title: 'MCU', items: base.mcu, icon: Cpu },\r\n    { key: 'displays', title: 'Display', items: base.displays, icon: Monitor },\r\n    { key: 'leds', title: 'LEDs', items: base.leds, icon: Lightbulb },\r\n    { key: 'input', title: 'Input', items: base.input, icon: Gauge },\r\n    { key: 'output', title: 'Output', items: base.output, icon: Zap },\r\n    { key: 'passive', title: 'Wiring', items: base.passive, icon: CircuitBoard },\r\n    { key: 'logic', title: 'Logic', items: base.logic, icon: Settings },\r\n    { key: 'motors', title: 'Motors', items: base.motors, icon: Cog },\r\n  ] satisfies CatalogCategory[];\r\n}\r\n\r\nfunction ComponentLibrary() {\r\n  const categories = useMemo(() => buildPartCatalog(), []);\r\n  const [active, setActive] = useState<CatalogCategory['key']>('mcu');\r\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\r\n  const [canScrollLeft, setCanScrollLeft] = useState(false);\r\n  const [canScrollRight, setCanScrollRight] = useState(false);\r\n\r\n  const activeCategory = categories.find((c) => c.key === active) ?? categories[0];\r\n\r\n  // Check scroll state\r\n  const updateScrollButtons = useCallback(() => {\r\n    const container = scrollContainerRef.current;\r\n    if (!container) return;\r\n    \r\n    const { scrollLeft, scrollWidth, clientWidth } = container;\r\n    setCanScrollLeft(scrollLeft > 0);\r\n    setCanScrollRight(scrollLeft + clientWidth < scrollWidth - 1);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    updateScrollButtons();\r\n    const container = scrollContainerRef.current;\r\n    if (!container) return;\r\n    \r\n    container.addEventListener('scroll', updateScrollButtons);\r\n    window.addEventListener('resize', updateScrollButtons);\r\n    \r\n    return () => {\r\n      container.removeEventListener('scroll', updateScrollButtons);\r\n      window.removeEventListener('resize', updateScrollButtons);\r\n    };\r\n  }, [updateScrollButtons]);\r\n\r\n  const scroll = useCallback((direction: 'left' | 'right') => {\r\n    const container = scrollContainerRef.current;\r\n    if (!container) return;\r\n    \r\n    const scrollAmount = 120;\r\n    container.scrollBy({\r\n      left: direction === 'left' ? -scrollAmount : scrollAmount,\r\n      behavior: 'smooth',\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden\">\r\n      {/* Category Tabs - Horizontal Scrollable */}\r\n      <div className=\"shrink-0 border-b border-ide-border pb-3 mb-3\">\r\n        <div className=\"relative flex items-center\">\r\n          {/* Left scroll arrow */}\r\n          {canScrollLeft && (\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => scroll('left')}\r\n              className=\"absolute left-0 z-10 h-full px-1 bg-gradient-to-r from-ide-panel-bg via-ide-panel-bg to-transparent\"\r\n              aria-label=\"Scroll left\"\r\n            >\r\n              <ChevronLeft className=\"h-4 w-4 text-ide-text-muted hover:text-ide-accent transition-colors\" />\r\n            </button>\r\n          )}\r\n          \r\n          {/* Scrollable tabs container */}\r\n          <div\r\n            ref={scrollContainerRef}\r\n            className=\"flex gap-1 overflow-x-auto scrollbar-hide scroll-smooth snap-x snap-mandatory px-1\"\r\n            style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}\r\n          >\r\n            {categories.map((cat) => {\r\n              const isActive = cat.key === active;\r\n              const Icon = cat.icon;\r\n\r\n              return (\r\n                <button\r\n                  key={cat.key}\r\n                  type=\"button\"\r\n                  onClick={() => setActive(cat.key)}\r\n                  className={cn(\r\n                    'snap-start shrink-0 min-w-[60px] flex flex-col items-center gap-1 rounded-md px-2 py-1.5 text-xs font-medium transition-all',\r\n                    isActive\r\n                      ? 'bg-ide-accent/20 text-ide-accent border-b-2 border-ide-accent'\r\n                      : 'text-ide-text-muted hover:text-ide-text hover:bg-ide-panel-hover'\r\n                  )}\r\n                  title={cat.title}\r\n                >\r\n                  <Icon className=\"h-4 w-4\" />\r\n                  <span className=\"text-[10px] leading-tight\">{cat.title}</span>\r\n                </button>\r\n              );\r\n            })}\r\n          </div>\r\n          \r\n          {/* Right scroll arrow */}\r\n          {canScrollRight && (\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => scroll('right')}\r\n              className=\"absolute right-0 z-10 h-full px-1 bg-gradient-to-l from-ide-panel-bg via-ide-panel-bg to-transparent\"\r\n              aria-label=\"Scroll right\"\r\n            >\r\n              <ChevronRight className=\"h-4 w-4 text-ide-text-muted hover:text-ide-accent transition-colors\" />\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Component Grid */}\r\n      <div className=\"min-h-0 flex-1 overflow-auto\">\r\n        {activeCategory.items.length === 0 ? (\r\n          <div className=\"flex h-full items-center justify-center text-xs text-ide-text-subtle\">\r\n            No components in this category yet.\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-3 gap-1.5\">\r\n            {activeCategory.items.map((item) => {\r\n              const wokwiConfig = WOKWI_PARTS[item.id];\r\n              const Icon = activeCategory.icon;\r\n\r\n              return (\r\n                <div\r\n                  key={item.id}\r\n                  role=\"button\"\r\n                  tabIndex={0}\r\n                  aria-label={`Add ${item.name} component`}\r\n                  draggable\r\n                  onDragStart={(e) => {\r\n                    e.dataTransfer.effectAllowed = 'copy';\r\n                    e.dataTransfer.setData(FUNDI_PART_MIME, item.id);\r\n                  }}\r\n                  onKeyDown={(e) => {\r\n                    // Allow keyboard users to trigger component addition\r\n                    if (e.key === 'Enter' || e.key === ' ') {\r\n                      e.preventDefault();\r\n                      // Show component info on keyboard activation\r\n                      alert(`Drag '${item.name}' to the canvas to add it.\\n\\n${item.description || 'No description available.'}`);\r\n                    }\r\n                  }}\r\n                  className={cn(\r\n                    'group relative flex cursor-grab flex-col items-center justify-center',\r\n                    'rounded-lg border p-2 transition-all duration-200',\r\n                    'bg-ide-panel-surface border-ide-border',\r\n                    'hover:border-ide-accent/50 hover:bg-ide-panel-hover',\r\n                    'focus:outline-none focus:ring-2 focus:ring-ide-accent focus:ring-offset-2 focus:ring-offset-ide-panel-bg',\r\n                    'active:cursor-grabbing active:scale-95'\r\n                  )}\r\n                  title={item.description ?? item.name}\r\n                >\r\n                  {/* Actual Wokwi Element Preview */}\r\n                  <WokwiElementPreview elementTag={wokwiConfig.element} partId={item.id} fallbackIcon={Icon} />\r\n\r\n                  {/* Label */}\r\n                  <div className=\"mt-1.5 text-center\">\r\n                    <div className=\"font-mono text-[9px] text-ide-text-muted group-hover:text-ide-text transition-colors leading-tight\">\r\n                      {item.name}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(ComponentLibrary);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2142, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/StatusBadge.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { Cpu, Wifi, WifiOff } from 'lucide-react';\r\nimport { cn } from '@/utils/cn';\r\n\r\ninterface StatusBadgeProps {\r\n  deviceName?: string;\r\n  isConnected?: boolean;\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * StatusBadge - Pill component showing device connection status\r\n * Dark IDE theme compatible\r\n */\r\nexport default function StatusBadge({\r\n  deviceName = 'Arduino Uno',\r\n  isConnected = true,\r\n  className,\r\n}: StatusBadgeProps) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'inline-flex items-center gap-2 rounded-md',\r\n        'bg-ide-panel-bg border border-ide-border',\r\n        'px-2.5 py-1',\r\n        'transition-all duration-200',\r\n        className,\r\n      )}\r\n    >\r\n      {/* Device Icon */}\r\n      <Cpu className=\"h-3.5 w-3.5 text-ide-text-muted\" aria-hidden={true} />\r\n\r\n      {/* Device Name */}\r\n      <span className=\"text-xs font-medium text-ide-text\">{deviceName}</span>\r\n\r\n      {/* Divider */}\r\n      <div className=\"h-3 w-px bg-ide-border\" />\r\n\r\n      {/* Connection Status */}\r\n      <div className=\"flex items-center gap-1.5\">\r\n        {isConnected ? (\r\n          <>\r\n            <Wifi className=\"h-3 w-3 text-ide-success\" aria-hidden={true} />\r\n            <span className=\"text-xs font-medium text-ide-success\">Connected</span>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <WifiOff className=\"h-3 w-3 text-ide-text-subtle\" aria-hidden={true} />\r\n            <span className=\"text-xs font-medium text-ide-text-subtle\">Disconnected</span>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Active indicator dot when connected */}\r\n      {isConnected && (\r\n        <div className=\"relative ml-0.5\">\r\n          <div className=\"h-1.5 w-1.5 rounded-full bg-ide-success\" />\r\n          <div className=\"absolute inset-0 h-1.5 w-1.5 rounded-full bg-ide-success animate-ping opacity-75\" />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AACA;AAHA;;;;AAee,SAAS,YAAY,EAClC,aAAa,aAAa,EAC1B,cAAc,IAAI,EAClB,SAAS,EACQ;IACjB,qBACE,6LAAC;QACC,WAAW,IAAA,oHAAE,EACX,6CACA,4CACA,eACA,+BACA;;0BAIF,6LAAC,0MAAG;gBAAC,WAAU;gBAAkC,eAAa;;;;;;0BAG9D,6LAAC;gBAAK,WAAU;0BAAqC;;;;;;0BAGrD,6LAAC;gBAAI,WAAU;;;;;;0BAGf,6LAAC;gBAAI,WAAU;0BACZ,4BACC;;sCACE,6LAAC,6MAAI;4BAAC,WAAU;4BAA2B,eAAa;;;;;;sCACxD,6LAAC;4BAAK,WAAU;sCAAuC;;;;;;;iDAGzD;;sCACE,6LAAC,0NAAO;4BAAC,WAAU;4BAA+B,eAAa;;;;;;sCAC/D,6LAAC;4BAAK,WAAU;sCAA2C;;;;;;;;;;;;;YAMhE,6BACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;;;;;kCACf,6LAAC;wBAAI,WAAU;;;;;;;;;;;;;;;;;;AAKzB;KAhDwB"}},
    {"offset": {"line": 2268, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/circuitLayout.ts"],"sourcesContent":["'use client';\r\n\r\n/**\r\n * Smart Circuit Layout Algorithm\r\n * \r\n * Positions AI-generated circuit components in a neat, organized layout.\r\n * Places microcontroller at center-left, peripherals arranged around it by type.\r\n */\r\n\r\nimport type { CircuitPart, Connection } from '@/store/useAppStore';\r\n\r\n// Layout configuration constants\r\nconst GRID_SIZE = 20; // Match ReactFlow snap grid\r\nconst MCU_POSITION = { x: 0, y: 0 };\r\nconst COLUMN_WIDTH = 160; // Horizontal spacing between columns\r\nconst VERTICAL_SPACING = 100; // Vertical spacing between components\r\nconst MIN_VERTICAL_SPACING = 80; // Minimum spacing for densely packed columns\r\nconst MAX_COMPONENTS_PER_COLUMN = 5;\r\n\r\n// Microcontroller part types\r\nconst MCU_TYPES = new Set([\r\n    'arduino-uno', 'wokwi-arduino-uno',\r\n    'arduino-nano', 'wokwi-arduino-nano',\r\n    'arduino-mega', 'wokwi-arduino-mega',\r\n    'esp32-devkit-v1', 'wokwi-esp32-devkit-v1',\r\n    'pi-pico', 'wokwi-pi-pico',\r\n    'attiny85', 'wokwi-attiny85',\r\n    'franzininho', 'wokwi-franzininho',\r\n    'nano-rp2040-connect', 'wokwi-nano-rp2040-connect',\r\n]);\r\n\r\n// Component categories for layout grouping\r\ntype ComponentLayoutCategory = 'mcu' | 'power' | 'output' | 'input' | 'display' | 'other';\r\n\r\nconst CATEGORY_PATTERNS: Record<ComponentLayoutCategory, RegExp> = {\r\n    mcu: /arduino|esp32|pi-pico|attiny|franzininho|rp2040/i,\r\n    power: /resistor|capacitor|vcc|gnd|power|breadboard/i,\r\n    output: /led|buzzer|relay|speaker|rgb|neopixel|servo|motor|stepper/i,\r\n    input: /button|pushbutton|switch|potentiometer|sensor|dht|hc-sr|pir|ldr|joystick|encoder|keypad|ir-receiver|ir-remote/i,\r\n    display: /lcd|oled|ssd1306|segment|ili9341|max7219|tm1637|matrix/i,\r\n    other: /.*/,\r\n};\r\n\r\n// Column X positions for each category (relative to MCU)\r\nconst CATEGORY_COLUMNS: Record<ComponentLayoutCategory, number> = {\r\n    mcu: 0,\r\n    power: 1,      // Column 1: Power/Passive (x = 160)\r\n    output: 2,     // Column 2: LEDs/Outputs (x = 320)\r\n    input: 3,      // Column 3: Buttons/Inputs (x = 480)\r\n    display: 4,    // Column 4: Displays (x = 640)\r\n    other: 5,      // Column 5: Other (x = 800)\r\n};\r\n\r\n/**\r\n * Snap a coordinate to the grid\r\n */\r\nfunction snapToGrid(value: number): number {\r\n    return Math.round(value / GRID_SIZE) * GRID_SIZE;\r\n}\r\n\r\n/**\r\n * Check if a part is a microcontroller\r\n */\r\nfunction isMicrocontroller(partType: string): boolean {\r\n    const normalized = partType.toLowerCase().replace('wokwi-', '');\r\n    return MCU_TYPES.has(partType) || MCU_TYPES.has(`wokwi-${normalized}`) || MCU_TYPES.has(normalized);\r\n}\r\n\r\n/**\r\n * Categorize a component based on its type\r\n */\r\nfunction categorizeComponent(partType: string): ComponentLayoutCategory {\r\n    const normalized = partType.toLowerCase();\r\n    \r\n    if (CATEGORY_PATTERNS.mcu.test(normalized)) return 'mcu';\r\n    if (CATEGORY_PATTERNS.display.test(normalized)) return 'display';\r\n    if (CATEGORY_PATTERNS.input.test(normalized)) return 'input';\r\n    if (CATEGORY_PATTERNS.output.test(normalized)) return 'output';\r\n    if (CATEGORY_PATTERNS.power.test(normalized)) return 'power';\r\n    return 'other';\r\n}\r\n\r\n/**\r\n * Calculate connection count for each part to determine layout priority\r\n */\r\nfunction getConnectionCounts(\r\n    parts: CircuitPart[],\r\n    connections: Connection[]\r\n): Map<string, number> {\r\n    const counts = new Map<string, number>();\r\n\r\n    for (const part of parts) {\r\n        counts.set(part.id, 0);\r\n    }\r\n\r\n    for (const conn of connections) {\r\n        counts.set(conn.from.partId, (counts.get(conn.from.partId) || 0) + 1);\r\n        counts.set(conn.to.partId, (counts.get(conn.to.partId) || 0) + 1);\r\n    }\r\n\r\n    return counts;\r\n}\r\n\r\n/**\r\n * Group parts by their layout category\r\n */\r\nfunction groupPartsByCategory(\r\n    parts: CircuitPart[]\r\n): Map<ComponentLayoutCategory, CircuitPart[]> {\r\n    const groups = new Map<ComponentLayoutCategory, CircuitPart[]>();\r\n    \r\n    for (const category of Object.keys(CATEGORY_COLUMNS) as ComponentLayoutCategory[]) {\r\n        groups.set(category, []);\r\n    }\r\n    \r\n    for (const part of parts) {\r\n        const category = categorizeComponent(part.type);\r\n        const group = groups.get(category) || [];\r\n        group.push(part);\r\n        groups.set(category, group);\r\n    }\r\n    \r\n    return groups;\r\n}\r\n\r\n/**\r\n * Main layout function - calculates optimal positions for all circuit parts\r\n */\r\nexport function calculateCircuitLayout(\r\n    parts: CircuitPart[],\r\n    connections: Connection[]\r\n): CircuitPart[] {\r\n    if (parts.length === 0) return parts;\r\n\r\n    // Get connection counts for sorting within categories\r\n    const connectionCounts = getConnectionCounts(parts, connections);\r\n    \r\n    // Group parts by category\r\n    const categoryGroups = groupPartsByCategory(parts);\r\n    \r\n    // Calculate positions\r\n    const positioned: CircuitPart[] = [];\r\n    \r\n    // Position MCUs first at center-left\r\n    const mcus = categoryGroups.get('mcu') || [];\r\n    let mcuYOffset = 0;\r\n    for (const mcu of mcus) {\r\n        positioned.push({\r\n            ...mcu,\r\n            position: { \r\n                x: snapToGrid(MCU_POSITION.x), \r\n                y: snapToGrid(MCU_POSITION.y + mcuYOffset) \r\n            },\r\n        });\r\n        mcuYOffset += VERTICAL_SPACING * 2; // MCUs are taller\r\n    }\r\n\r\n    // Position other categories in their designated columns\r\n    const categories: ComponentLayoutCategory[] = ['power', 'output', 'input', 'display', 'other'];\r\n    \r\n    for (const category of categories) {\r\n        const partsInCategory = categoryGroups.get(category) || [];\r\n        if (partsInCategory.length === 0) continue;\r\n        \r\n        // Sort by connection count (most connected first)\r\n        partsInCategory.sort((a, b) => \r\n            (connectionCounts.get(b.id) || 0) - (connectionCounts.get(a.id) || 0)\r\n        );\r\n        \r\n        const columnIndex = CATEGORY_COLUMNS[category];\r\n        const baseX = MCU_POSITION.x + COLUMN_WIDTH * columnIndex;\r\n        \r\n        // Center the column vertically around MCU\r\n        const totalHeight = (partsInCategory.length - 1) * VERTICAL_SPACING;\r\n        const startY = MCU_POSITION.y - totalHeight / 2;\r\n        \r\n        let columnCount = 0;\r\n        let subColumnIndex = 0;\r\n        \r\n        for (let i = 0; i < partsInCategory.length; i++) {\r\n            const part = partsInCategory[i];\r\n            const rowInColumn = columnCount % MAX_COMPONENTS_PER_COLUMN;\r\n            \r\n            const x = snapToGrid(baseX + subColumnIndex * COLUMN_WIDTH);\r\n            const y = snapToGrid(startY + rowInColumn * VERTICAL_SPACING);\r\n            \r\n            positioned.push({\r\n                ...part,\r\n                position: { x, y },\r\n            });\r\n            \r\n            columnCount++;\r\n            if (columnCount % MAX_COMPONENTS_PER_COLUMN === 0) {\r\n                subColumnIndex++;\r\n            }\r\n        }\r\n    }\r\n\r\n    return positioned;\r\n}\r\n\r\n/**\r\n * Calculate bounding box of all parts for viewport fitting\r\n */\r\nexport function getCircuitBounds(parts: CircuitPart[]): {\r\n    minX: number;\r\n    minY: number;\r\n    maxX: number;\r\n    maxY: number;\r\n    width: number;\r\n    height: number;\r\n} {\r\n    if (parts.length === 0) {\r\n        return { minX: 0, minY: 0, maxX: 0, maxY: 0, width: 0, height: 0 };\r\n    }\r\n\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n\r\n    for (const part of parts) {\r\n        minX = Math.min(minX, part.position.x);\r\n        minY = Math.min(minY, part.position.y);\r\n        // Estimate component size (varies by type, using reasonable defaults)\r\n        maxX = Math.max(maxX, part.position.x + 150);\r\n        maxY = Math.max(maxY, part.position.y + 100);\r\n    }\r\n\r\n    return {\r\n        minX,\r\n        minY,\r\n        maxX,\r\n        maxY,\r\n        width: maxX - minX,\r\n        height: maxY - minY,\r\n    };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2470, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/store/useAppStore.ts"],"sourcesContent":["import { create } from 'zustand'\r\nimport { persist, createJSONStorage } from 'zustand/middleware'\r\nimport { nanoid } from 'nanoid'\r\nimport { calculateCircuitLayout } from '@/utils/circuitLayout'\r\n\r\nexport type CircuitPart = {\r\n  id: string\r\n  /** Wokwi part key (e.g. 'arduino-uno') or element type (e.g. 'wokwi-arduino-uno') */\r\n  type: string\r\n  position: {\r\n    x: number\r\n    y: number\r\n  }\r\n  rotate?: number\r\n  attrs?: Record<string, string>\r\n}\r\n\r\nexport type CircuitConnection = {\r\n  source: string\r\n  target: string\r\n  color: string\r\n}\r\n\r\nexport interface Connection {\r\n  id: string\r\n  from: { partId: string; pinId: string }\r\n  to: { partId: string; pinId: string }\r\n  color: string\r\n  points?: { x: number; y: number }[]\r\n}\r\n\r\n/** Terminal history entry for CLI-style AI chat */\r\nexport type TerminalEntry = {\r\n  id: string\r\n  type: 'cmd' | 'log' | 'ai' | 'error'\r\n  content: string\r\n  timestamp: number\r\n}\r\n\r\n/** Project file for multi-file support */\r\nexport type ProjectFile = {\r\n  path: string\r\n  content: string\r\n  isMain: boolean\r\n  includeInSimulation: boolean\r\n  isReadOnly?: boolean\r\n}\r\n\r\n/** Project structure for workspace management */\r\nexport type Project = {\r\n  id: string\r\n  name: string\r\n  lastModified: number\r\n  files: ProjectFile[]\r\n  circuitParts: CircuitPart[]\r\n  connections: Connection[]\r\n}\r\n\r\n/** Settings stored in local storage */\r\nexport type AppSettings = {\r\n  editorFontSize: number\r\n  editorTheme: 'light' | 'dark'\r\n  editorTabSize: number\r\n  defaultBoardTarget: string\r\n  geminiApiKeyOverride: string | null\r\n}\r\n\r\nexport type AppState = {\r\n  // Multi-project management\r\n  projects: Project[]\r\n  currentProjectId: string | null\r\n\r\n  // Legacy code support - now derived from current project's main file\r\n  code: string\r\n  diagramJson: string\r\n  circuitParts: CircuitPart[]\r\n  circuitConnections: CircuitConnection[]\r\n  connections: Connection[]\r\n  isRunning: boolean\r\n\r\n  // Multi-file support\r\n  files: ProjectFile[]\r\n  activeFilePath: string | null\r\n  openFilePaths: string[]\r\n\r\n  isCompiling: boolean\r\n  compilationError: string | null\r\n  hex: string | null\r\n  compiledBoard: string | null\r\n\r\n  nextWireColorIndex: number\r\n\r\n  selectedPartIds: string[]\r\n\r\n  // Counter to trigger auto-fit after AI generates a circuit\r\n  circuitGeneratedVersion: number\r\n\r\n  // Terminal/AI Chat state\r\n  terminalHistory: TerminalEntry[]\r\n  isAiLoading: boolean\r\n\r\n  // Teacher mode toggle (Socratic Tutor feature)\r\n  teacherMode: boolean\r\n\r\n  // Image staging for AI\r\n  stagedImageData: string | null\r\n\r\n  // Settings\r\n  settings: AppSettings\r\n\r\n  // Project management actions\r\n  createProject: (name: string) => string\r\n  deleteProject: (id: string) => void\r\n  loadProject: (id: string) => void\r\n  saveCurrentProject: () => void\r\n  getCurrentProject: () => Project | null\r\n\r\n  // File management actions\r\n  addFile: (path: string, content?: string, isMain?: boolean) => void\r\n  deleteFile: (path: string) => void\r\n  renameFile: (oldPath: string, newPath: string) => void\r\n  updateFileContent: (path: string, content: string) => void\r\n  setActiveFile: (path: string | null) => void\r\n  openFile: (path: string) => void\r\n  closeFile: (path: string) => void\r\n  toggleFileSimulation: (path: string) => void\r\n\r\n  updateCode: (newCode: string) => void\r\n  setDiagramJson: (json: string) => void\r\n  updateCircuit: (nodes: unknown, edges: unknown) => void\r\n  toggleSimulation: () => void\r\n\r\n  compileAndRun: () => Promise<void>\r\n\r\n  addPart: (part: {\r\n    type: string\r\n    position: { x: number; y: number }\r\n    rotate?: number\r\n    attrs?: Record<string, string>\r\n  }) => string\r\n  removePart: (id: string) => void\r\n  updatePartsPositions: (updates: Array<{ id: string; x: number; y: number }>) => void\r\n\r\n  setSelectedPartIds: (ids: string[]) => void\r\n  toggleSelectedPartId: (id: string) => void\r\n  clearSelectedParts: () => void\r\n\r\n  addConnection: (conn: Omit<Connection, 'id'>) => string\r\n  allocateNextWireColor: () => string\r\n  removeConnection: (id: string) => void\r\n  updateWireColor: (id: string, color: string) => void\r\n  updateWire: (id: string, points: { x: number; y: number }[] | undefined) => void\r\n\r\n  // Terminal/AI Chat actions\r\n  submitCommand: (text: string, imageData?: string) => Promise<void>\r\n  addTerminalEntry: (entry: Omit<TerminalEntry, 'id' | 'timestamp'>) => void\r\n  clearTerminalHistory: () => void\r\n  setTeacherMode: (enabled: boolean) => void\r\n\r\n  // Image staging actions\r\n  stageImage: (imageData: string) => void\r\n  clearStagedImage: () => void\r\n\r\n  // Settings actions\r\n  updateSettings: (settings: Partial<AppSettings>) => void\r\n\r\n  // Apply AI-generated circuit to canvas\r\n  applyGeneratedCircuit: (parts: CircuitPart[], connections: Connection[]) => void\r\n}\r\n\r\nconst DEFAULT_WIRE_COLOR_CYCLE = [\r\n  '#B87333', // copper (default)\r\n  '#22c55e', // green\r\n  '#3b82f6', // blue\r\n  '#ef4444', // red\r\n  '#eab308', // yellow\r\n  '#8b5cf6', // violet\r\n  '#f97316', // orange\r\n  '#06b6d4', // cyan\r\n  '#ec4899', // pink\r\n  '#000000', // black\r\n  '#ffffff', // white\r\n] as const\r\n\r\nconst defaultCode =\r\n  'void setup() { pinMode(13, OUTPUT); } void loop() { digitalWrite(13, HIGH); delay(1000); digitalWrite(13, LOW); delay(1000); }'\r\n\r\nconst defaultSettings: AppSettings = {\r\n  editorFontSize: 14,\r\n  editorTheme: 'dark',\r\n  editorTabSize: 2,\r\n  defaultBoardTarget: 'wokwi-arduino-uno',\r\n  geminiApiKeyOverride: null,\r\n}\r\n\r\nfunction createDefaultProject(name: string = 'Untitled Project'): Project {\r\n  return {\r\n    id: nanoid(),\r\n    name,\r\n    lastModified: Date.now(),\r\n    files: [\r\n      {\r\n        path: 'main.cpp',\r\n        content: defaultCode,\r\n        isMain: true,\r\n        includeInSimulation: true,\r\n      },\r\n    ],\r\n    circuitParts: [],\r\n    connections: [],\r\n  }\r\n}\r\n\r\nfunction isRecord(value: unknown): value is Record<string, unknown> {\r\n  return typeof value === 'object' && value !== null\r\n}\r\n\r\nfunction isNotNull<T>(value: T | null): value is T {\r\n  return value !== null\r\n}\r\n\r\nfunction toCircuitParts(nodes: unknown): CircuitPart[] {\r\n  if (!Array.isArray(nodes)) return []\r\n\r\n  return nodes\r\n    .map((node) => {\r\n      if (!isRecord(node)) return null\r\n\r\n      const id = typeof node.id === 'string' ? node.id : ''\r\n      const nodeType = typeof node.type === 'string' ? node.type : 'unknown'\r\n\r\n      // Try to carry Wokwi partType from node data (for node.type === 'wokwi').\r\n      const data = isRecord(node.data) ? node.data : null\r\n      const dataPartType = data && typeof data.partType === 'string' ? data.partType : null\r\n\r\n      // Preserve per-part attributes (e.g., LED color, resistor value)\r\n      const dataAttrsRaw = data && isRecord(data.attrs) ? data.attrs : null\r\n      const attrs: Record<string, string> = dataAttrsRaw\r\n        ? Object.fromEntries(\r\n          Object.entries(dataAttrsRaw)\r\n            .filter(([k, v]) => typeof k === 'string' && (typeof v === 'string' || typeof v === 'number' || typeof v === 'boolean'))\r\n            .map(([k, v]) => [k, String(v)])\r\n        )\r\n        : {}\r\n\r\n      const type =\r\n        (nodeType === 'wokwi' && dataPartType) ? dataPartType :\r\n          (nodeType === 'arduino' ? 'arduino-uno' : nodeType)\r\n      const position = isRecord(node.position) ? node.position : {}\r\n      const x = typeof position.x === 'number' ? position.x : 0\r\n      const y = typeof position.y === 'number' ? position.y : 0\r\n\r\n      if (!id) return null\r\n\r\n      return {\r\n        id,\r\n        type,\r\n        position: { x, y },\r\n        rotate: 0,\r\n        attrs,\r\n      } satisfies CircuitPart\r\n    })\r\n    .filter(isNotNull)\r\n}\r\n\r\nfunction toCircuitConnections(edges: unknown): CircuitConnection[] {\r\n  if (!Array.isArray(edges)) return []\r\n\r\n  return edges\r\n    .map((edge) => {\r\n      if (!isRecord(edge)) return null\r\n\r\n      const source = typeof edge.source === 'string' ? edge.source : ''\r\n      const target = typeof edge.target === 'string' ? edge.target : ''\r\n\r\n      // Try common React Flow / XYFlow shapes for a stroke color.\r\n      const style = isRecord(edge.style) ? edge.style : null\r\n      const data = isRecord(edge.data) ? edge.data : null\r\n\r\n      const colorCandidate =\r\n        (typeof edge.color === 'string' && edge.color) ||\r\n        (style && typeof style.stroke === 'string' && style.stroke) ||\r\n        (data && typeof data.color === 'string' && data.color)\r\n\r\n      if (!source || !target) return null\r\n\r\n      return {\r\n        source,\r\n        target,\r\n        color: colorCandidate || 'currentColor',\r\n      } satisfies CircuitConnection\r\n    })\r\n    .filter(isNotNull)\r\n}\r\n\r\nfunction normalizeBoardType(partType: string): string {\r\n  if (partType.startsWith('wokwi-')) return partType\r\n  return `wokwi-${partType}`\r\n}\r\n\r\nfunction findMicrocontroller(parts: CircuitPart[]): CircuitPart | null {\r\n  const supported = new Set([\r\n    'wokwi-arduino-uno',\r\n    'wokwi-arduino-nano',\r\n    'wokwi-arduino-mega',\r\n    'wokwi-esp32-devkit-v1',\r\n    'wokwi-pi-pico',\r\n  ])\r\n\r\n  for (const p of parts) {\r\n    const normalized = normalizeBoardType(p.type)\r\n    if (supported.has(normalized)) return p\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nexport const useAppStore = create<AppState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      // Multi-project state\r\n      projects: [],\r\n      currentProjectId: null,\r\n\r\n      // Legacy compatibility\r\n      code: defaultCode,\r\n      diagramJson: '',\r\n      circuitParts: [],\r\n      circuitConnections: [],\r\n      connections: [],\r\n      isRunning: false,\r\n\r\n      // Multi-file support\r\n      files: [\r\n        {\r\n          path: 'main.cpp',\r\n          content: defaultCode,\r\n          isMain: true,\r\n          includeInSimulation: true,\r\n        },\r\n      ],\r\n      activeFilePath: 'main.cpp',\r\n      openFilePaths: ['main.cpp'],\r\n\r\n      isCompiling: false,\r\n      compilationError: null,\r\n      hex: null,\r\n      compiledBoard: null,\r\n\r\n      nextWireColorIndex: 0,\r\n\r\n      selectedPartIds: [],\r\n\r\n      // Counter to trigger auto-fit after AI generates a circuit\r\n      circuitGeneratedVersion: 0,\r\n\r\n      // Terminal/AI Chat state\r\n      terminalHistory: [],\r\n      isAiLoading: false,\r\n\r\n      // Teacher mode (Socratic Tutor feature)\r\n      teacherMode: false,\r\n\r\n      // Image staging\r\n      stagedImageData: null,\r\n\r\n      // Settings\r\n      settings: defaultSettings,\r\n\r\n      // Project management\r\n      createProject: (name) => {\r\n        const newProject = createDefaultProject(name)\r\n        set((state) => ({\r\n          projects: [...state.projects, newProject],\r\n          currentProjectId: newProject.id,\r\n          files: newProject.files,\r\n          circuitParts: newProject.circuitParts,\r\n          connections: newProject.connections,\r\n          code: newProject.files.find(f => f.isMain)?.content || defaultCode,\r\n          activeFilePath: 'main.cpp',\r\n          openFilePaths: ['main.cpp'],\r\n        }))\r\n        return newProject.id\r\n      },\r\n\r\n      deleteProject: (id) => {\r\n        set((state) => {\r\n          const filtered = state.projects.filter(p => p.id !== id)\r\n          const wasCurrentProject = state.currentProjectId === id\r\n          return {\r\n            projects: filtered,\r\n            currentProjectId: wasCurrentProject\r\n              ? (filtered[0]?.id || null)\r\n              : state.currentProjectId,\r\n          }\r\n        })\r\n        // If deleted current project, load another or reset\r\n        if (get().currentProjectId === null && get().projects.length > 0) {\r\n          get().loadProject(get().projects[0].id)\r\n        }\r\n      },\r\n\r\n      loadProject: (id) => {\r\n        const project = get().projects.find(p => p.id === id)\r\n        if (!project) return\r\n\r\n        set({\r\n          currentProjectId: id,\r\n          files: project.files,\r\n          circuitParts: project.circuitParts,\r\n          connections: project.connections,\r\n          code: project.files.find(f => f.isMain)?.content || defaultCode,\r\n          activeFilePath: project.files.find(f => f.isMain)?.path || project.files[0]?.path || null,\r\n          openFilePaths: [project.files.find(f => f.isMain)?.path || project.files[0]?.path].filter(Boolean) as string[],\r\n        })\r\n      },\r\n\r\n      saveCurrentProject: () => {\r\n        const { currentProjectId, files, circuitParts, connections, projects } = get()\r\n        if (!currentProjectId) return\r\n\r\n        set({\r\n          projects: projects.map(p =>\r\n            p.id === currentProjectId\r\n              ? { ...p, files, circuitParts, connections, lastModified: Date.now() }\r\n              : p\r\n          ),\r\n        })\r\n      },\r\n\r\n      getCurrentProject: () => {\r\n        const { currentProjectId, projects } = get()\r\n        return projects.find(p => p.id === currentProjectId) || null\r\n      },\r\n\r\n      // File management\r\n      addFile: (path, content = '', isMain = false) => {\r\n        const newFile: ProjectFile = {\r\n          path,\r\n          content,\r\n          isMain,\r\n          includeInSimulation: true,\r\n        }\r\n        set((state) => ({\r\n          files: [...state.files, newFile],\r\n          openFilePaths: [...state.openFilePaths, path],\r\n          activeFilePath: path,\r\n        }))\r\n      },\r\n\r\n      deleteFile: (path) => {\r\n        set((state) => {\r\n          const filtered = state.files.filter(f => f.path !== path)\r\n          const newActivePath = state.activeFilePath === path\r\n            ? (filtered.find(f => f.isMain)?.path || filtered[0]?.path || null)\r\n            : state.activeFilePath\r\n          return {\r\n            files: filtered,\r\n            openFilePaths: state.openFilePaths.filter(p => p !== path),\r\n            activeFilePath: newActivePath,\r\n          }\r\n        })\r\n      },\r\n\r\n      renameFile: (oldPath, newPath) => {\r\n        set((state) => ({\r\n          files: state.files.map(f =>\r\n            f.path === oldPath ? { ...f, path: newPath } : f\r\n          ),\r\n          openFilePaths: state.openFilePaths.map(p => p === oldPath ? newPath : p),\r\n          activeFilePath: state.activeFilePath === oldPath ? newPath : state.activeFilePath,\r\n        }))\r\n      },\r\n\r\n      updateFileContent: (path, content) => {\r\n        set((state) => ({\r\n          files: state.files.map(f =>\r\n            f.path === path ? { ...f, content } : f\r\n          ),\r\n          // Also update legacy code if it's the main file\r\n          code: state.files.find(f => f.path === path && f.isMain) ? content : state.code,\r\n        }))\r\n      },\r\n\r\n      setActiveFile: (path) => {\r\n        set({ activeFilePath: path })\r\n      },\r\n\r\n      openFile: (path) => {\r\n        set((state) => ({\r\n          openFilePaths: state.openFilePaths.includes(path)\r\n            ? state.openFilePaths\r\n            : [...state.openFilePaths, path],\r\n          activeFilePath: path,\r\n        }))\r\n      },\r\n\r\n      closeFile: (path) => {\r\n        set((state) => {\r\n          const filtered = state.openFilePaths.filter(p => p !== path)\r\n          return {\r\n            openFilePaths: filtered,\r\n            activeFilePath: state.activeFilePath === path\r\n              ? (filtered[filtered.length - 1] || null)\r\n              : state.activeFilePath,\r\n          }\r\n        })\r\n      },\r\n\r\n      toggleFileSimulation: (path) => {\r\n        set((state) => ({\r\n          files: state.files.map(f =>\r\n            f.path === path ? { ...f, includeInSimulation: !f.includeInSimulation } : f\r\n          ),\r\n        }))\r\n      },\r\n\r\n      updateCode: (newCode) => {\r\n        set({ code: newCode })\r\n        // Also update the active file if it's the main file\r\n        const activeFile = get().files.find(f => f.path === get().activeFilePath)\r\n        if (activeFile?.isMain) {\r\n          get().updateFileContent(activeFile.path, newCode)\r\n        }\r\n      },\r\n\r\n      setDiagramJson: (json) => {\r\n        set({ diagramJson: json })\r\n      },\r\n\r\n      updateCircuit: (nodes, edges) => {\r\n        const circuitParts = toCircuitParts(nodes)\r\n        const circuitConnections = toCircuitConnections(edges)\r\n\r\n        set({ circuitParts, circuitConnections })\r\n      },\r\n\r\n      toggleSimulation: () => {\r\n        set({ isRunning: !get().isRunning })\r\n      },\r\n\r\n      compileAndRun: async () => {\r\n        const mcu = findMicrocontroller(get().circuitParts)\r\n        if (!mcu) {\r\n          set({ compilationError: 'No supported microcontroller found in the circuit.', hex: null, compiledBoard: null })\r\n          return\r\n        }\r\n\r\n        const board = normalizeBoardType(mcu.type)\r\n\r\n        set({ isCompiling: true, compilationError: null })\r\n\r\n        try {\r\n          const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://127.0.0.1:8000'\r\n\r\n          // Build files object for multi-file compilation\r\n          const filesForCompilation = get().files\r\n            .filter(f => f.includeInSimulation)\r\n            .reduce((acc, f) => {\r\n              acc[f.path] = f.content\r\n              return acc\r\n            }, {} as Record<string, string>)\r\n\r\n          const res = await fetch(`${baseUrl}/api/v1/compile`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              code: get().code,\r\n              board,\r\n              files: filesForCompilation,\r\n            }),\r\n          })\r\n\r\n          const data = (await res.json().catch(() => null)) as\r\n            | { success?: boolean; hex?: string | null; error?: string | null }\r\n            | null\r\n\r\n          if (!res.ok) {\r\n            set({\r\n              compilationError: (data && (data.error || (!data.success ? 'Compilation failed.' : null))) || res.statusText,\r\n              hex: null,\r\n              compiledBoard: null,\r\n            })\r\n            return\r\n          }\r\n\r\n          if (!data?.success || !data.hex) {\r\n            set({ compilationError: data?.error || 'Compilation failed.', hex: null, compiledBoard: null })\r\n            return\r\n          }\r\n\r\n          set({ hex: data.hex, compiledBoard: board, compilationError: null })\r\n        } catch (err) {\r\n          const msg = err instanceof Error ? err.message : String(err)\r\n          set({ compilationError: msg || 'Compilation request failed.', hex: null, compiledBoard: null })\r\n        } finally {\r\n          set({ isCompiling: false })\r\n        }\r\n      },\r\n\r\n      addPart: (part) => {\r\n        const id = nanoid()\r\n        const next: CircuitPart = {\r\n          id,\r\n          type: part.type,\r\n          position: { x: part.position.x, y: part.position.y },\r\n          rotate: part.rotate ?? 0,\r\n          attrs: part.attrs ?? {},\r\n        }\r\n        set({ circuitParts: [...get().circuitParts, next] })\r\n        return id\r\n      },\r\n\r\n      removePart: (id) => {\r\n        set((state) => ({\r\n          circuitParts: state.circuitParts.filter(p => p.id !== id),\r\n          // Also remove any connections involving this part\r\n          connections: state.connections.filter(\r\n            c => c.from.partId !== id && c.to.partId !== id\r\n          ),\r\n          selectedPartIds: state.selectedPartIds.filter(pid => pid !== id),\r\n        }))\r\n      },\r\n\r\n      updatePartsPositions: (updates) => {\r\n        if (!updates.length) return\r\n        const byId = new Map(updates.map((u) => [u.id, u]))\r\n        set({\r\n          circuitParts: get().circuitParts.map((p) => {\r\n            const u = byId.get(p.id)\r\n            if (!u) return p\r\n            return { ...p, position: { x: u.x, y: u.y } }\r\n          }),\r\n        })\r\n      },\r\n\r\n      setSelectedPartIds: (ids) => {\r\n        set({ selectedPartIds: [...new Set(ids)] })\r\n      },\r\n\r\n      toggleSelectedPartId: (id) => {\r\n        const curr = get().selectedPartIds\r\n        if (curr.includes(id)) {\r\n          set({ selectedPartIds: curr.filter((x) => x !== id) })\r\n        } else {\r\n          set({ selectedPartIds: [...curr, id] })\r\n        }\r\n      },\r\n\r\n      clearSelectedParts: () => {\r\n        set({ selectedPartIds: [] })\r\n      },\r\n\r\n      addConnection: (conn) => {\r\n        const id = nanoid()\r\n        set({ connections: [...get().connections, { ...conn, id }] })\r\n        return id\r\n      },\r\n\r\n      allocateNextWireColor: () => {\r\n        const idx = get().nextWireColorIndex\r\n        const color = DEFAULT_WIRE_COLOR_CYCLE[idx % DEFAULT_WIRE_COLOR_CYCLE.length]\r\n        set({ nextWireColorIndex: idx + 1 })\r\n        return color\r\n      },\r\n\r\n      removeConnection: (id) => {\r\n        set({ connections: get().connections.filter((c) => c.id !== id) })\r\n      },\r\n\r\n      updateWireColor: (id, color) => {\r\n        set({\r\n          connections: get().connections.map((c) =>\r\n            c.id === id ? { ...c, color } : c\r\n          ),\r\n        })\r\n      },\r\n\r\n      updateWire: (id, points) => {\r\n        set({\r\n          connections: get().connections.map((c) =>\r\n            c.id === id ? { ...c, points } : c\r\n          ),\r\n        })\r\n      },\r\n\r\n      // Terminal/AI Chat actions\r\n      addTerminalEntry: (entry) => {\r\n        const newEntry: TerminalEntry = {\r\n          id: nanoid(),\r\n          timestamp: Date.now(),\r\n          ...entry,\r\n        }\r\n        set({ terminalHistory: [...get().terminalHistory, newEntry] })\r\n      },\r\n\r\n      clearTerminalHistory: () => {\r\n        set({ terminalHistory: [] })\r\n      },\r\n\r\n      setTeacherMode: (enabled) => {\r\n        set({ teacherMode: enabled })\r\n        get().addTerminalEntry({\r\n          type: 'log',\r\n          content: enabled\r\n            ? ' Teacher Mode enabled. AI will explain concepts before providing implementations.'\r\n            : ' Builder Mode enabled. AI will focus on generating code and circuits.',\r\n        })\r\n      },\r\n\r\n      // Image staging\r\n      stageImage: (imageData) => {\r\n        set({ stagedImageData: imageData })\r\n      },\r\n\r\n      clearStagedImage: () => {\r\n        set({ stagedImageData: null })\r\n      },\r\n\r\n      // Settings\r\n      updateSettings: (newSettings) => {\r\n        set((state) => ({\r\n          settings: { ...state.settings, ...newSettings },\r\n        }))\r\n      },\r\n\r\n      applyGeneratedCircuit: (parts, newConnections) => {\r\n        // Check if AI provided meaningful positions (non-zero coordinates)\r\n        const hasAiPositions = parts.some(p =>\r\n          p.position && (p.position.x !== 0 || p.position.y !== 0)\r\n        )\r\n\r\n        // Only apply layout algorithm if AI didn't provide positions\r\n        // This preserves AI's intended layout when coordinates exist\r\n        const finalParts = hasAiPositions\r\n          ? parts\r\n          : calculateCircuitLayout(parts, newConnections)\r\n\r\n        // Replace current circuit with AI-generated one\r\n        // Increment version to trigger auto-fit in canvas\r\n        set((state) => ({\r\n          circuitParts: finalParts,\r\n          connections: newConnections,\r\n          circuitGeneratedVersion: state.circuitGeneratedVersion + 1,\r\n        }))\r\n      },\r\n\r\n      submitCommand: async (text, imageData) => {\r\n        const trimmed = text.trim()\r\n        const finalImageData = imageData ?? get().stagedImageData\r\n\r\n        if (!trimmed && !finalImageData) return\r\n\r\n        // Clear staged image after use\r\n        if (finalImageData) {\r\n          set({ stagedImageData: null })\r\n        }\r\n\r\n        // Add user command to history\r\n        if (trimmed) {\r\n          get().addTerminalEntry({ type: 'cmd', content: trimmed })\r\n        }\r\n        if (finalImageData) {\r\n          get().addTerminalEntry({ type: 'log', content: ' Image uploaded for circuit recognition' })\r\n        }\r\n\r\n        // Handle slash commands\r\n        if (trimmed.startsWith('/')) {\r\n          const cmd = trimmed.toLowerCase()\r\n          if (cmd === '/clear') {\r\n            set({ terminalHistory: [] })\r\n            return\r\n          }\r\n          if (cmd === '/help') {\r\n            get().addTerminalEntry({\r\n              type: 'log',\r\n              content: `Available commands:\r\n/clear - Clear terminal history\r\n/help - Show this help message\r\n/teacher - Toggle Teacher Mode (explains concepts)\r\n/builder - Toggle Builder Mode (direct generation)\r\n/files - List all project files\r\n/components - List current circuit components\r\n/code - Show current code\r\n\r\nOr type any prompt to generate Arduino code and circuits.\r\nYou can also upload images of physical circuits for recognition.`,\r\n            })\r\n            return\r\n          }\r\n          if (cmd === '/teacher') {\r\n            get().setTeacherMode(true)\r\n            return\r\n          }\r\n          if (cmd === '/builder') {\r\n            get().setTeacherMode(false)\r\n            return\r\n          }\r\n          if (cmd === '/files') {\r\n            const files = get().files\r\n            const fileList = files.map(f => `  ${f.isMain ? '' : ''} ${f.path}${f.isMain ? ' (main)' : ''}`).join('\\n')\r\n            get().addTerminalEntry({\r\n              type: 'log',\r\n              content: ` Project Files:\\n${fileList || '  (no files)'}`,\r\n            })\r\n            return\r\n          }\r\n          if (cmd === '/components') {\r\n            const parts = get().circuitParts\r\n            const partList = parts.map(p => `   ${p.id}: ${p.type} at (${p.position.x}, ${p.position.y})`).join('\\n')\r\n            get().addTerminalEntry({\r\n              type: 'log',\r\n              content: ` Circuit Components (${parts.length}):\\n${partList || '  (no components)'}`,\r\n            })\r\n            return\r\n          }\r\n          if (cmd === '/code') {\r\n            const code = get().code\r\n            get().addTerminalEntry({\r\n              type: 'log',\r\n              content: ` Current Code:\\n\\`\\`\\`cpp\\n${code}\\n\\`\\`\\``,\r\n            })\r\n            return\r\n          }\r\n          get().addTerminalEntry({\r\n            type: 'error',\r\n            content: `Unknown command: ${trimmed}. Type /help for available commands.`,\r\n          })\r\n          return\r\n        }\r\n\r\n        // Call AI generate endpoint\r\n        set({ isAiLoading: true })\r\n        try {\r\n          const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://127.0.0.1:8000'\r\n\r\n          // Sync state with backend for AI context\r\n          await fetch(`${baseUrl}/api/v1/ai-tools/sync-state`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              files: get().files,\r\n              components: get().circuitParts,\r\n              connections: get().connections,\r\n              compilation: {\r\n                is_compiling: get().isCompiling,\r\n                error: get().compilationError,\r\n                hex: get().hex,\r\n                board: get().compiledBoard,\r\n              },\r\n            }),\r\n          }).catch(() => { }) // Ignore sync errors\r\n\r\n          // Get current circuit state for context (bi-directional awareness)\r\n          const currentCircuit = JSON.stringify({\r\n            parts: get().circuitParts,\r\n            connections: get().connections,\r\n          })\r\n\r\n          const res = await fetch(`${baseUrl}/api/v1/generate`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              prompt: trimmed || 'Analyze this circuit image and recreate it',\r\n              teacher_mode: get().teacherMode,\r\n              image_data: finalImageData || null,\r\n              current_circuit: get().circuitParts.length > 0 ? currentCircuit : null,\r\n            }),\r\n          })\r\n\r\n          if (!res.ok) {\r\n            const errorData = await res.json().catch(() => null)\r\n            const errorMsg = errorData?.detail || res.statusText || 'Request failed'\r\n            get().addTerminalEntry({ type: 'error', content: `Error: ${errorMsg}` })\r\n            return\r\n          }\r\n\r\n          const data = await res.json()\r\n\r\n          // Format the AI response as a log entry\r\n          let response = ''\r\n          if (data.explanation) {\r\n            response += data.explanation + '\\n\\n'\r\n          }\r\n          if (data.code) {\r\n            response += '```cpp\\n' + data.code + '\\n```'\r\n            // Also update the code editor\r\n            set({ code: data.code })\r\n            // Update the main file content\r\n            const mainFile = get().files.find(f => f.isMain)\r\n            if (mainFile) {\r\n              get().updateFileContent(mainFile.path, data.code)\r\n            }\r\n          }\r\n\r\n          get().addTerminalEntry({ type: 'ai', content: response || 'Generated successfully.' })\r\n\r\n          // Process file changes from AI (GitHub Copilot-like codebase modifications)\r\n          if (data.file_changes && Array.isArray(data.file_changes)) {\r\n            const fileActions: string[] = []\r\n            for (const change of data.file_changes) {\r\n              const { action, path, content, description } = change as {\r\n                action: string;\r\n                path: string;\r\n                content?: string;\r\n                description?: string\r\n              }\r\n\r\n              if (action === 'create' && path && content) {\r\n                // Check if file already exists\r\n                const existing = get().files.find(f => f.path === path)\r\n                if (!existing) {\r\n                  get().addFile(path, content, false)\r\n                  fileActions.push(` Created: ${path}${description ? ` (${description})` : ''}`)\r\n                } else {\r\n                  // Update existing file\r\n                  get().updateFileContent(path, content)\r\n                  fileActions.push(` Updated: ${path}${description ? ` (${description})` : ''}`)\r\n                }\r\n              } else if (action === 'update' && path && content) {\r\n                get().updateFileContent(path, content)\r\n                fileActions.push(` Updated: ${path}${description ? ` (${description})` : ''}`)\r\n              } else if (action === 'delete' && path) {\r\n                get().deleteFile(path)\r\n                fileActions.push(` Deleted: ${path}`)\r\n              }\r\n            }\r\n\r\n            if (fileActions.length > 0) {\r\n              get().addTerminalEntry({\r\n                type: 'log',\r\n                content: ` File changes applied:\\n${fileActions.join('\\n')}`,\r\n              })\r\n            }\r\n          }\r\n\r\n\r\n          // Apply generated circuit parts and connections to canvas\r\n          if (data.circuit_parts && Array.isArray(data.circuit_parts)) {\r\n            // Debug: Log raw AI response\r\n            console.log('[AI Circuit Debug] Raw parts:', data.circuit_parts)\r\n            console.log('[AI Circuit Debug] Raw connections:', data.connections)\r\n\r\n            // Create a mapping from AI-generated IDs to actual generated IDs\r\n            // This is critical for connections to work properly!\r\n            const idMap = new Map<string, string>()\r\n\r\n            const newParts: CircuitPart[] = data.circuit_parts.map((p: { id: string; type: string; x: number; y: number; attrs?: Record<string, string> }) => {\r\n              const newId = nanoid()\r\n              // Map the AI's ID (e.g., \"arduino1\") to our generated ID\r\n              if (p.id) {\r\n                idMap.set(p.id, newId)\r\n              }\r\n              return {\r\n                id: newId,\r\n                type: p.type,\r\n                position: { x: p.x || 0, y: p.y || 0 },\r\n                rotate: 0,\r\n                attrs: p.attrs || {},\r\n              }\r\n            })\r\n\r\n            // Helper function to get wire color based on signal type or pin name\r\n            const getWireColor = (conn: { color?: string; signal_type?: string; source_pin: string; target_pin: string }): string => {\r\n              // Use AI-provided color if available\r\n              if (conn.color) return conn.color\r\n\r\n              // Signal type color map\r\n              const signalColors: Record<string, string> = {\r\n                power: '#ef4444',    // Red\r\n                ground: '#000000',   // Black\r\n                digital: '#3b82f6',  // Blue\r\n                analog: '#22c55e',   // Green\r\n                pwm: '#eab308',      // Yellow\r\n                i2c: '#8b5cf6',      // Purple\r\n                spi: '#f97316',      // Orange\r\n                uart: '#06b6d4',     // Cyan\r\n              }\r\n\r\n              if (conn.signal_type && signalColors[conn.signal_type.toLowerCase()]) {\r\n                return signalColors[conn.signal_type.toLowerCase()]\r\n              }\r\n\r\n              // Infer from pin names\r\n              const pins = [conn.source_pin, conn.target_pin].map(p => p.toUpperCase())\r\n              for (const pin of pins) {\r\n                if (['VCC', '5V', '3V3', '3.3V', 'VIN'].includes(pin)) return signalColors.power\r\n                if (['GND', 'GROUND'].includes(pin)) return signalColors.ground\r\n                if (pin.startsWith('A')) return signalColors.analog\r\n                if (pin.includes('SDA') || pin.includes('SCL')) return signalColors.i2c\r\n                if (['MOSI', 'MISO', 'SCK', 'SS'].some(s => pin.includes(s))) return signalColors.spi\r\n                if (pin.includes('TX') || pin.includes('RX')) return signalColors.uart\r\n              }\r\n\r\n              // Fallback to allocated color\r\n              return get().allocateNextWireColor()\r\n            }\r\n\r\n            // Helper function to normalize pin names from AI output to exact wokwi-elements format\r\n            const normalizePinName = (pin: string, partType: string): string => {\r\n              const p = pin.toString().trim()\r\n              const pUpper = p.toUpperCase()\r\n              const partLower = partType.toLowerCase()\r\n\r\n              // ========================\r\n              // ESP32 GPIO pins\r\n              // ========================\r\n              if (partLower.includes('esp32')) {\r\n                // GPIO13  13, IO13  13, D13  13\r\n                const gpioMatch = p.match(/^(?:gpio|io|d)?(\\d+)$/i)\r\n                if (gpioMatch) return gpioMatch[1]\r\n                // I2C defaults for ESP32: SDA  21, SCL  22\r\n                if (/^sda$/i.test(p)) return '21'\r\n                if (/^scl$/i.test(p)) return '22'\r\n                // Power pins\r\n                if (/^(3v3?|3\\.3v)$/i.test(p)) return '3V3'\r\n                if (/^(5v|vin)$/i.test(p)) return 'VIN'\r\n                if (/^gnd$/i.test(p)) return 'GND.1'\r\n              }\r\n\r\n              // ========================\r\n              // LED pins: normalize anode/cathode variations\r\n              // ========================\r\n              if (partLower.includes('led') && !partLower.includes('neopixel') && !partLower.includes('bar') && !partLower.includes('ring') && !partLower.includes('matrix')) {\r\n                if (/^(a|anode|\\+|positive|vcc|an)$/i.test(p)) return 'A'\r\n                if (/^(c|k|cathode|-|negative|gnd|cat)$/i.test(p)) return 'C'\r\n              }\r\n\r\n              // ========================\r\n              // NeoPixel / WS2812 / Addressable LEDs\r\n              // ========================\r\n              if (partLower.includes('neopixel') || partLower.includes('ws2812')) {\r\n                if (/^(din|data|in|signal)$/i.test(p)) return 'DIN'\r\n                if (/^(dout|do|out)$/i.test(p)) return 'DOUT'\r\n                if (/^(vcc|5v|\\+|vdd)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|vss|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // Arduino digital/analog pins\r\n              // ========================\r\n              if (partLower.includes('arduino') || partLower.includes('uno') || partLower.includes('nano') || partLower.includes('mega')) {\r\n                // Digital: D13  13, PIN13  13, also handles mega pins 22-53\r\n                const digitalMatch = p.match(/^(?:d|pin)?(\\d{1,2})$/i)\r\n                if (digitalMatch) return digitalMatch[1]\r\n                // Analog: A0, A1, etc. - keep as-is but uppercase\r\n                const analogMatch = p.match(/^a(\\d)$/i)\r\n                if (analogMatch) return `A${analogMatch[1]}`\r\n                // Power pins\r\n                if (/^(5v|vcc)$/i.test(p)) return '5V'\r\n                if (/^(3v3?|3\\.3v)$/i.test(p)) return '3.3V'\r\n                if (/^vin$/i.test(p)) return 'VIN'\r\n                // GND pins - normalize to GND.1\r\n                if (/^gnd$/i.test(p)) return 'GND.1'\r\n                if (/^gnd\\.?[123]$/i.test(p)) return p.toUpperCase().replace('.', '.')\r\n              }\r\n\r\n              // ========================\r\n              // LCD1602 / LCD2004 displays\r\n              // ========================\r\n              if (partLower.includes('lcd1602') || partLower.includes('lcd2004') || partLower.includes('lcd')) {\r\n                // I2C mode pins\r\n                if (/^sda$/i.test(p)) return 'SDA'\r\n                if (/^scl$/i.test(p)) return 'SCL'\r\n                // Parallel mode pins\r\n                if (/^(rs|register.?select)$/i.test(p)) return 'RS'\r\n                if (/^(e|en|enable)$/i.test(p)) return 'E'\r\n                if (/^(rw|read.?write)$/i.test(p)) return 'RW'\r\n                if (/^(v0|contrast|vo)$/i.test(p)) return 'V0'\r\n                if (/^(vss|gnd)$/i.test(p)) return 'VSS'\r\n                if (/^(vdd|vcc|5v)$/i.test(p)) return 'VDD'\r\n                if (/^(led\\+|a|backlight\\+)$/i.test(p)) return 'A'\r\n                if (/^(led-|k|backlight-)$/i.test(p)) return 'K'\r\n                // Data pins D0-D7\r\n                const dataMatch = p.match(/^d?([0-7])$/i)\r\n                if (dataMatch) return `D${dataMatch[1]}`\r\n              }\r\n\r\n              // ========================\r\n              // SSD1306 / OLED displays (I2C)\r\n              // ========================\r\n              if (partLower.includes('ssd1306') || partLower.includes('oled')) {\r\n                if (/^sda$/i.test(p)) return 'SDA'\r\n                if (/^scl$/i.test(p)) return 'SCL'\r\n                if (/^(vcc|vdd|3v3?|5v|\\+)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|ground|vss|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // DHT22 / DHT11 temperature sensors\r\n              // ========================\r\n              if (partLower.includes('dht')) {\r\n                if (/^(data|sda|out|signal|dat)$/i.test(p)) return 'SDA'\r\n                if (/^(vcc|vdd|\\+|5v|3v3?)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|ground|-)$/i.test(p)) return 'GND'\r\n                if (/^nc$/i.test(p)) return 'NC'\r\n              }\r\n\r\n              // ========================\r\n              // HC-SR04 Ultrasonic sensor\r\n              // ========================\r\n              if (partLower.includes('hc-sr04') || partLower.includes('sr04') || partLower.includes('ultrasonic')) {\r\n                if (/^(trig|trigger)$/i.test(p)) return 'TRIG'\r\n                if (/^echo$/i.test(p)) return 'ECHO'\r\n                if (/^(vcc|5v|\\+)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // Potentiometer\r\n              // ========================\r\n              if (partLower.includes('potentiometer')) {\r\n                if (/^(sig|signal|wiper|out|w)$/i.test(p)) return 'SIG'\r\n                if (/^(vcc|\\+|5v|cw)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|-|ccw)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // Slide potentiometer\r\n              // ========================\r\n              if (partLower.includes('slide') && partLower.includes('potentiometer')) {\r\n                if (/^(sig|signal|wiper|out)$/i.test(p)) return 'SIG'\r\n                if (/^(vcc|\\+|5v)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // Pushbutton\r\n              // ========================\r\n              if (partLower.includes('pushbutton') || partLower.includes('button')) {\r\n                // Wokwi uses 1.l, 1.r, 2.l, 2.r for 4-pin buttons\r\n                if (/^(1|left|l|in|a)$/i.test(p)) return '1.l'\r\n                if (/^(2|right|r|out|b)$/i.test(p)) return '2.l'\r\n                // Already correct formats - normalize case\r\n                if (/^[12]\\.[lr]$/i.test(p)) return p.toLowerCase()\r\n              }\r\n\r\n              // ========================\r\n              // Resistor pins\r\n              // ========================\r\n              if (partLower.includes('resistor')) {\r\n                if (/^(1|one|left|l|a)$/i.test(p)) return '1'\r\n                if (/^(2|two|right|r|b)$/i.test(p)) return '2'\r\n              }\r\n\r\n              // ========================\r\n              // Buzzer pins\r\n              // ========================\r\n              if (partLower.includes('buzzer')) {\r\n                if (/^(1|signal|sig|s|\\+|positive|vcc)$/i.test(p)) return '1'\r\n                if (/^(2|gnd|ground|-|negative)$/i.test(p)) return '2'\r\n              }\r\n\r\n              // ========================\r\n              // Servo pins\r\n              // ========================\r\n              if (partLower.includes('servo')) {\r\n                if (/^(pwm|signal|sig|s|pulse|ctrl|control)$/i.test(p)) return 'PWM'\r\n                if (/^(v\\+|vcc|5v|power|\\+)$/i.test(p)) return 'V+'\r\n                if (/^(gnd|ground|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // PIR Motion sensor\r\n              // ========================\r\n              if (partLower.includes('pir') || partLower.includes('motion')) {\r\n                if (/^(out|signal|sig|data)$/i.test(p)) return 'OUT'\r\n                if (/^(vcc|5v|\\+)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // Photoresistor / LDR\r\n              // ========================\r\n              if (partLower.includes('photoresistor') || partLower.includes('ldr')) {\r\n                if (/^(ao|out|signal|a0)$/i.test(p)) return 'AO'\r\n                if (/^(do|digital)$/i.test(p)) return 'DO'\r\n                if (/^(vcc|5v|\\+)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // IR Receiver\r\n              // ========================\r\n              if (partLower.includes('ir') && partLower.includes('receiver')) {\r\n                if (/^(out|signal|data)$/i.test(p)) return 'OUT'\r\n                if (/^(vcc|\\+|5v)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // Membrane Keypad\r\n              // ========================\r\n              if (partLower.includes('keypad') || partLower.includes('membrane')) {\r\n                // Row pins R1-R4\r\n                const rowMatch = p.match(/^r(\\d)$/i)\r\n                if (rowMatch) return `R${rowMatch[1]}`\r\n                // Column pins C1-C4\r\n                const colMatch = p.match(/^c(\\d)$/i)\r\n                if (colMatch) return `C${colMatch[1]}`\r\n              }\r\n\r\n              // ========================\r\n              // Rotary Encoder (KY-040)\r\n              // ========================\r\n              if (partLower.includes('rotary') || partLower.includes('encoder') || partLower.includes('ky-040')) {\r\n                if (/^(clk|clock|a)$/i.test(p)) return 'CLK'\r\n                if (/^(dt|data|b)$/i.test(p)) return 'DT'\r\n                if (/^(sw|switch|button)$/i.test(p)) return 'SW'\r\n                if (/^(vcc|\\+|5v)$/i.test(p)) return 'VCC'\r\n                if (/^(gnd|-)$/i.test(p)) return 'GND'\r\n              }\r\n\r\n              // ========================\r\n              // MPU6050 accelerometer/gyroscope\r\n              // ========================\r\n              if (partLower.includes('mpu6050') || partLower.includes('accelerometer') || partLower.includes('gyro')) {\r\n                if (/^sda$/i.test(p)) return 'SDA'\r\n                if (/^scl$/i.test(p)) return 'SCL'\r\n                if (/^(vcc|3v3?)$/i.test(p)) return 'VCC'\r\n                if (/^gnd$/i.test(p)) return 'GND'\r\n                if (/^int$/i.test(p)) return 'INT'\r\n              }\r\n\r\n              // ========================\r\n              // Generic I2C devices fallback\r\n              // ========================\r\n              if (/^sda$/i.test(p)) return 'SDA'\r\n              if (/^scl$/i.test(p)) return 'SCL'\r\n\r\n              // ========================\r\n              // Generic power pins fallback\r\n              // ========================\r\n              if (/^(vcc|5v|3v3?|vin|\\+)$/i.test(p)) return pUpper.replace('3V3', '3.3V')\r\n              if (/^(gnd|ground|vss|-)$/i.test(p)) return 'GND'\r\n\r\n              return p // Return as-is if no normalization needed\r\n            }\r\n\r\n            // Get part type from AI parts for normalization\r\n            const getPartTypeFromAIParts = (aiPartId: string): string => {\r\n              const part = data.circuit_parts.find((p: { id: string; type: string }) => p.id === aiPartId)\r\n              return part?.type || ''\r\n            }\r\n\r\n            const newConnections: Connection[] = (data.connections || []).map((c: { source_part: string; source_pin: string; target_part: string; target_pin: string; color?: string; signal_type?: string; label?: string }) => {\r\n              // Translate AI-generated part IDs to our actual generated IDs\r\n              const fromPartId = idMap.get(c.source_part) || c.source_part\r\n              const toPartId = idMap.get(c.target_part) || c.target_part\r\n\r\n              // Normalize pin names based on part types\r\n              const sourcePartType = getPartTypeFromAIParts(c.source_part)\r\n              const targetPartType = getPartTypeFromAIParts(c.target_part)\r\n              const normalizedSourcePin = normalizePinName(c.source_pin, sourcePartType)\r\n              const normalizedTargetPin = normalizePinName(c.target_pin, targetPartType)\r\n\r\n              console.log('[AI Circuit] Creating connection:', {\r\n                aiSource: c.source_part,\r\n                aiSourcePin: c.source_pin,\r\n                normalizedSourcePin,\r\n                aiTarget: c.target_part,\r\n                aiTargetPin: c.target_pin,\r\n                normalizedTargetPin,\r\n              })\r\n\r\n              return {\r\n                id: nanoid(),\r\n                from: { partId: fromPartId, pinId: normalizedSourcePin },\r\n                to: { partId: toPartId, pinId: normalizedTargetPin },\r\n                color: getWireColor(c),\r\n              }\r\n            })\r\n\r\n            // Debug: Log ID mapping and final connections\r\n            console.log('[AI Circuit Debug] ID mapping:', Object.fromEntries(idMap))\r\n            console.log('[AI Circuit Debug] Final connections:', newConnections.map(c => ({\r\n              from: `${c.from.partId}:${c.from.pinId}`,\r\n              to: `${c.to.partId}:${c.to.pinId}`,\r\n            })))\r\n\r\n            get().applyGeneratedCircuit(newParts, newConnections)\r\n            get().addTerminalEntry({\r\n              type: 'log',\r\n              content: ` Applied ${newParts.length} components and ${newConnections.length} connections to canvas`,\r\n            })\r\n          }\r\n        } catch (err) {\r\n          const msg = err instanceof Error ? err.message : String(err)\r\n          get().addTerminalEntry({ type: 'error', content: `Error: ${msg}` })\r\n        } finally {\r\n          set({ isAiLoading: false })\r\n        }\r\n      },\r\n    }),\r\n    {\r\n      name: 'fundi-app-storage',\r\n      storage: createJSONStorage(() => localStorage),\r\n      partialize: (state) => ({\r\n        projects: state.projects,\r\n        settings: state.settings,\r\n      }),\r\n    }\r\n  )\r\n)\r\n\r\n// Temporal store type for undo/redo\r\ntype TemporalState = {\r\n  pastStates: Partial<AppState>[]\r\n  futureStates: Partial<AppState>[]\r\n  undo: () => void\r\n  redo: () => void\r\n  clear: () => void\r\n}\r\n\r\n// Create a separate temporal store that wraps the main store's state\r\nconst temporalHistory: { past: Partial<AppState>[]; future: Partial<AppState>[] } = {\r\n  past: [],\r\n  future: [],\r\n}\r\n\r\nconst MAX_HISTORY = 50\r\n\r\n// Helper to get trackable state\r\nconst getTrackableState = (): Partial<AppState> => {\r\n  const state = useAppStore.getState()\r\n  return {\r\n    circuitParts: [...state.circuitParts],\r\n    connections: [...state.connections],\r\n    code: state.code,\r\n  }\r\n}\r\n\r\n// Helper to check if state changed\r\nconst statesEqual = (a: Partial<AppState>, b: Partial<AppState>): boolean => {\r\n  return (\r\n    JSON.stringify(a.circuitParts) === JSON.stringify(b.circuitParts) &&\r\n    JSON.stringify(a.connections) === JSON.stringify(b.connections) &&\r\n    a.code === b.code\r\n  )\r\n}\r\n\r\n// Subscribe to store changes and track history\r\nlet lastTrackedState = getTrackableState()\r\nuseAppStore.subscribe((state) => {\r\n  const currentTrackable = {\r\n    circuitParts: state.circuitParts,\r\n    connections: state.connections,\r\n    code: state.code,\r\n  }\r\n\r\n  if (!statesEqual(lastTrackedState, currentTrackable)) {\r\n    temporalHistory.past.push(lastTrackedState)\r\n    if (temporalHistory.past.length > MAX_HISTORY) {\r\n      temporalHistory.past.shift()\r\n    }\r\n    temporalHistory.future = [] // Clear redo stack on new change\r\n    lastTrackedState = { ...currentTrackable }\r\n  }\r\n})\r\n\r\n// Undo function\r\nexport const undo = (): void => {\r\n  if (temporalHistory.past.length === 0) return\r\n\r\n  const previousState = temporalHistory.past.pop()!\r\n  temporalHistory.future.push(getTrackableState())\r\n\r\n  useAppStore.setState({\r\n    circuitParts: previousState.circuitParts || [],\r\n    connections: previousState.connections || [],\r\n    code: previousState.code || '',\r\n  })\r\n  lastTrackedState = { ...previousState }\r\n}\r\n\r\n// Redo function  \r\nexport const redo = (): void => {\r\n  if (temporalHistory.future.length === 0) return\r\n\r\n  const nextState = temporalHistory.future.pop()!\r\n  temporalHistory.past.push(getTrackableState())\r\n\r\n  useAppStore.setState({\r\n    circuitParts: nextState.circuitParts || [],\r\n    connections: nextState.connections || [],\r\n    code: nextState.code || '',\r\n  })\r\n  lastTrackedState = { ...nextState }\r\n}\r\n\r\n// Check if undo is available\r\nexport const canUndo = (): boolean => temporalHistory.past.length > 0\r\n\r\n// Check if redo is available\r\nexport const canRedo = (): boolean => temporalHistory.future.length > 0\r\n\r\n// Clear history\r\nexport const clearHistory = (): void => {\r\n  temporalHistory.past = []\r\n  temporalHistory.future = []\r\n  lastTrackedState = getTrackableState()\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3701, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/SelectionOverlay.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { memo, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { useStore } from '@xyflow/react';\r\nimport type { Node } from '@xyflow/react';\r\nimport { useAppStore } from '@/store/useAppStore';\r\nimport type { WirePoint } from '@/types/wire';\r\n\r\ntype ReactFlowStoreSlice = {\r\n  nodes: Node[];\r\n};\r\n\r\ntype NodeWithInternals = Node & {\r\n  positionAbsolute?: { x: number; y: number };\r\n  internals?: { positionAbsolute?: { x: number; y: number } };\r\n  measured?: { width?: number; height?: number };\r\n  width?: number;\r\n  height?: number;\r\n};\r\n\r\ninterface SelectionOverlayProps {\r\n  containerRef: React.RefObject<HTMLElement | null>;\r\n}\r\n\r\nfunction toFlowPoint(p: WirePoint, transform: [number, number, number]): WirePoint {\r\n  const [tx, ty, zoom] = transform;\r\n  return { x: (p.x - tx) / zoom, y: (p.y - ty) / zoom };\r\n}\r\n\r\nfunction rectFromPoints(a: WirePoint, b: WirePoint) {\r\n  const left = Math.min(a.x, b.x);\r\n  const top = Math.min(a.y, b.y);\r\n  const right = Math.max(a.x, b.x);\r\n  const bottom = Math.max(a.y, b.y);\r\n  return { left, top, right, bottom, width: right - left, height: bottom - top };\r\n}\r\n\r\nfunction intersects(r1: { left: number; top: number; right: number; bottom: number }, r2: { left: number; top: number; right: number; bottom: number }) {\r\n  return !(r2.left > r1.right || r2.right < r1.left || r2.top > r1.bottom || r2.bottom < r1.top);\r\n}\r\n\r\nfunction SelectionOverlay({ containerRef }: SelectionOverlayProps) {\r\n  const setSelectedPartIds = useAppStore((s) => s.setSelectedPartIds);\r\n\r\n  const transform = useStore((s) => s.transform as [number, number, number]);\r\n  const nodes = useStore((s) => (s as unknown as ReactFlowStoreSlice).nodes);\r\n\r\n  const dragRef = useRef<{\r\n    start: WirePoint;\r\n    current: WirePoint;\r\n    active: boolean;\r\n  } | null>(null);\r\n\r\n  const [box, setBox] = useState<{ left: number; top: number; width: number; height: number } | null>(null);\r\n\r\n  const nodesForSelection = useMemo(() => nodes ?? [], [nodes]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    const isBackgroundTarget = (target: EventTarget | null): boolean => {\r\n      if (!(target instanceof HTMLElement)) return false;\r\n      if (target.closest('[data-fundi-pin=\"true\"]')) return false;\r\n      if (target.closest('.react-flow__node')) return false;\r\n      // Pane/background within ReactFlow.\r\n      return Boolean(target.closest('.react-flow__pane'));\r\n    };\r\n\r\n    const getRel = (e: PointerEvent): WirePoint => {\r\n      const rect = container.getBoundingClientRect();\r\n      return { x: e.clientX - rect.left, y: e.clientY - rect.top };\r\n    };\r\n\r\n    const onPointerDown = (e: PointerEvent) => {\r\n      if (e.button !== 0) return;\r\n      if (!isBackgroundTarget(e.target)) return;\r\n\r\n      e.preventDefault();\r\n\r\n      const start = getRel(e);\r\n      dragRef.current = { start, current: start, active: true };\r\n      setBox({ left: start.x, top: start.y, width: 0, height: 0 });\r\n    };\r\n\r\n    const onPointerMove = (e: PointerEvent) => {\r\n      if (!dragRef.current?.active) return;\r\n      const curr = getRel(e);\r\n      dragRef.current.current = curr;\r\n\r\n      const r = rectFromPoints(dragRef.current.start, curr);\r\n      setBox({ left: r.left, top: r.top, width: r.width, height: r.height });\r\n    };\r\n\r\n    const onPointerUp = () => {\r\n      if (!dragRef.current?.active) return;\r\n\r\n      const start = dragRef.current.start;\r\n      const curr = dragRef.current.current;\r\n      dragRef.current = null;\r\n      setBox(null);\r\n\r\n      // Ignore tiny drags.\r\n      const rScreen = rectFromPoints(start, curr);\r\n      if (rScreen.width < 4 || rScreen.height < 4) return;\r\n\r\n      const aFlow = toFlowPoint({ x: rScreen.left, y: rScreen.top }, transform);\r\n      const bFlow = toFlowPoint({ x: rScreen.right, y: rScreen.bottom }, transform);\r\n      const rFlow = rectFromPoints(aFlow, bFlow);\r\n\r\n      const selected: string[] = [];\r\n      for (const n of nodesForSelection) {\r\n        const nn = n as NodeWithInternals;\r\n        const pos = nn.positionAbsolute ?? nn.internals?.positionAbsolute ?? nn.position;\r\n        const w = nn.measured?.width ?? nn.width ?? 0;\r\n        const h = nn.measured?.height ?? nn.height ?? 0;\r\n\r\n        const nr = { left: pos.x, top: pos.y, right: pos.x + w, bottom: pos.y + h };\r\n        if (intersects(rFlow, nr)) {\r\n          selected.push(n.id);\r\n        }\r\n      }\r\n\r\n      setSelectedPartIds(selected);\r\n    };\r\n\r\n    window.addEventListener('pointerdown', onPointerDown, { capture: true });\r\n    window.addEventListener('pointermove', onPointerMove, { capture: true });\r\n    window.addEventListener('pointerup', onPointerUp, { capture: true });\r\n\r\n    return () => {\r\n      window.removeEventListener('pointerdown', onPointerDown, true);\r\n      window.removeEventListener('pointermove', onPointerMove, true);\r\n      window.removeEventListener('pointerup', onPointerUp, true);\r\n    };\r\n  }, [containerRef, nodesForSelection, setSelectedPartIds, transform]);\r\n\r\n  if (!box) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"pointer-events-none absolute inset-0 z-20\"\r\n      aria-hidden={true}\r\n    >\r\n      <div\r\n        style={{\r\n          position: 'absolute',\r\n          left: box.left,\r\n          top: box.top,\r\n          width: box.width,\r\n          height: box.height,\r\n        }}\r\n        className=\"rounded border border-electric/70 bg-electric/10 ring-1 ring-electric/20\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(SelectionOverlay);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3916, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/wireRouting.ts"],"sourcesContent":["/**\r\n * Orthogonal wire routing utilities\r\n *\r\n * Wokwi-style routing: all wire segments are strictly horizontal or vertical,\r\n * alternating between the two to create clean orthogonal paths.\r\n *\r\n * Enhanced with component avoidance: wires wrap around components instead of\r\n * crossing through them, keeping pins and connections visible.\r\n */\r\n\r\nimport type { WirePoint } from '@/types/wire';\r\n\r\ntype FirstLeg = 'horizontal' | 'vertical';\r\n\r\n/**\r\n * Bounding box of a component for obstacle avoidance\r\n */\r\nexport interface ComponentBounds {\r\n    id: string;\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\n/**\r\n * Result of checking if a segment intersects an obstacle\r\n */\r\ninterface IntersectionResult {\r\n    intersects: boolean;\r\n    normalizedPath: WirePoint[];\r\n}\r\n\r\nexport function snapToGrid(value: number, gridSize: number): number {\r\n    if (!Number.isFinite(value)) return value;\r\n    if (!gridSize || gridSize <= 0) return value;\r\n    return Math.round(value / gridSize) * gridSize;\r\n}\r\n\r\n/**\r\n * Check if a line segment (horizontal or vertical) intersects a bounding box\r\n * Returns true if the segment goes through or touches the box\r\n */\r\nfunction segmentIntersectsBounds(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    bounds: ComponentBounds,\r\n    margin: number = 15\r\n): boolean {\r\n    const expanded = {\r\n        left: bounds.x - margin,\r\n        right: bounds.x + bounds.width + margin,\r\n        top: bounds.y - margin,\r\n        bottom: bounds.y + bounds.height + margin,\r\n    };\r\n\r\n    // Horizontal segment\r\n    if (start.y === end.y) {\r\n        const y = start.y;\r\n        if (y < expanded.top || y > expanded.bottom) return false;\r\n\r\n        const minX = Math.min(start.x, end.x);\r\n        const maxX = Math.max(start.x, end.x);\r\n\r\n        // Check if horizontal line crosses the expanded box\r\n        return maxX >= expanded.left && minX <= expanded.right;\r\n    }\r\n\r\n    // Vertical segment\r\n    if (start.x === end.x) {\r\n        const x = start.x;\r\n        if (x < expanded.left || x > expanded.right) return false;\r\n\r\n        const minY = Math.min(start.y, end.y);\r\n        const maxY = Math.max(start.y, end.y);\r\n\r\n        // Check if vertical line crosses the expanded box\r\n        return maxY >= expanded.top && minY <= expanded.bottom;\r\n    }\r\n\r\n    // Diagonal segment - shouldn't happen in our orthogonal routing, but handle it\r\n    return false;\r\n}\r\n\r\n/**\r\n * Find all bounding boxes that a path segment intersects\r\n */\r\nfunction findIntersectingBounds(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    obstacles: ComponentBounds[]\r\n): ComponentBounds[] {\r\n    return obstacles.filter((obs) => segmentIntersectsBounds(start, end, obs));\r\n}\r\n\r\n/**\r\n * Calculate the shortest detour around an obstacle for a given segment\r\n * Returns a new path that goes around the obstacle\r\n */\r\nfunction calculateDetour(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    obstacle: ComponentBounds,\r\n    originalPathType: 'horizontal' | 'vertical',\r\n    gridSize: number\r\n): WirePoint[] {\r\n    const margin = 25; // Extra spacing from component edge for visibility\r\n    const expLeft = obstacle.x - margin;\r\n    const expRight = obstacle.x + obstacle.width + margin;\r\n    const expTop = obstacle.y - margin;\r\n    const expBottom = obstacle.y + obstacle.height + margin;\r\n\r\n    // For horizontal segments that cross through\r\n    if (originalPathType === 'horizontal') {\r\n        const y = start.y;\r\n        const above = y < obstacle.y + obstacle.height / 2;\r\n        const detourY = above ? expTop : expBottom;\r\n\r\n        // Route: go up/down around, then across, then back down/up\r\n        return [\r\n            start,\r\n            { x: start.x, y: detourY },\r\n            { x: end.x, y: detourY },\r\n            end,\r\n        ];\r\n    }\r\n\r\n    // For vertical segments that cross through\r\n    const x = start.x;\r\n    const left = x < obstacle.x + obstacle.width / 2;\r\n    const detourX = left ? expLeft : expRight;\r\n\r\n    // Route: go left/right around, then up/down, then back\r\n    return [\r\n        start,\r\n        { x: detourX, y: start.y },\r\n        { x: detourX, y: end.y },\r\n        end,\r\n    ];\r\n}\r\n\r\n/**\r\n * Check if a point is inside any bounding box\r\n */\r\nfunction pointInBounds(point: WirePoint, obstacles: ComponentBounds[], margin: number = 5): boolean {\r\n    return obstacles.some((obs) => {\r\n        const expanded = {\r\n            left: obs.x - margin,\r\n            right: obs.x + obs.width + margin,\r\n            top: obs.y - margin,\r\n            bottom: obs.y + obs.height + margin,\r\n        };\r\n        return (\r\n            point.x >= expanded.left &&\r\n            point.x <= expanded.right &&\r\n            point.y >= expanded.top &&\r\n            point.y <= expanded.bottom\r\n        );\r\n    });\r\n}\r\n\r\n/**\r\n * Check if a whole path segment (between two points) would cross through obstacles\r\n * Returns true if the segment intersects any obstacle bounding box\r\n */\r\nfunction pathIntersectsObstacles(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    obstacles: ComponentBounds[]\r\n): boolean {\r\n    // Check if any point along the path is inside an obstacle\r\n    // For orthogonal paths, we need to check the entire segment\r\n    for (const obs of obstacles) {\r\n        if (segmentIntersectsBounds(start, end, obs)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function snapPointToGrid(point: WirePoint, gridSize: number): WirePoint {\r\n    return { x: snapToGrid(point.x, gridSize), y: snapToGrid(point.y, gridSize) };\r\n}\r\n\r\nfunction dedupeColinear(points: WirePoint[]): WirePoint[] {\r\n    if (points.length <= 2) return points;\r\n\r\n    const result: WirePoint[] = [points[0]];\r\n    for (let i = 1; i < points.length - 1; i++) {\r\n        const prev = result[result.length - 1];\r\n        const curr = points[i];\r\n        const next = points[i + 1];\r\n\r\n        const sameAsPrev = prev.x === curr.x && prev.y === curr.y;\r\n        if (sameAsPrev) continue;\r\n\r\n        const colinearHorizontal = prev.y === curr.y && curr.y === next.y;\r\n        const colinearVertical = prev.x === curr.x && curr.x === next.x;\r\n        if (colinearHorizontal || colinearVertical) {\r\n            continue;\r\n        }\r\n\r\n        result.push(curr);\r\n    }\r\n\r\n    const last = points[points.length - 1];\r\n    const tail = result[result.length - 1];\r\n    if (tail.x !== last.x || tail.y !== last.y) {\r\n        result.push(last);\r\n    }\r\n    return result;\r\n}\r\n\r\ntype Orientation = 'H' | 'V';\r\n\r\ntype Segment = {\r\n    orientation: Orientation;\r\n    coord: number; // y for H, x for V\r\n    min: number;\r\n    max: number;\r\n};\r\n\r\nfunction toSegments(points: WirePoint[]): Segment[] {\r\n    const segs: Segment[] = [];\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n        const a = points[i];\r\n        const b = points[i + 1];\r\n        if (a.x === b.x && a.y === b.y) continue;\r\n        if (a.y === b.y) {\r\n            const min = Math.min(a.x, b.x);\r\n            const max = Math.max(a.x, b.x);\r\n            if (min !== max) segs.push({ orientation: 'H', coord: a.y, min, max });\r\n        } else if (a.x === b.x) {\r\n            const min = Math.min(a.y, b.y);\r\n            const max = Math.max(a.y, b.y);\r\n            if (min !== max) segs.push({ orientation: 'V', coord: a.x, min, max });\r\n        }\r\n    }\r\n    return segs;\r\n}\r\n\r\nfunction rangesOverlapStrict(aMin: number, aMax: number, bMin: number, bMax: number): boolean {\r\n    // Strict overlap: touching at a single point is OK.\r\n    return Math.min(aMax, bMax) > Math.max(aMin, bMin);\r\n}\r\n\r\nfunction hasParallelOverlap(points: WirePoint[], occupied: Map<string, Segment[]>): boolean {\r\n    const segs = toSegments(points);\r\n    for (const s of segs) {\r\n        const key = `${s.orientation}:${s.coord}`;\r\n        const list = occupied.get(key);\r\n        if (!list?.length) continue;\r\n        for (const o of list) {\r\n            if (rangesOverlapStrict(s.min, s.max, o.min, o.max)) return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction addOccupied(points: WirePoint[], occupied: Map<string, Segment[]>): void {\r\n    for (const s of toSegments(points)) {\r\n        const key = `${s.orientation}:${s.coord}`;\r\n        const list = occupied.get(key);\r\n        if (list) list.push(s);\r\n        else occupied.set(key, [s]);\r\n    }\r\n}\r\n\r\nfunction shiftSegmentKeepingEndpoints(\r\n    points: WirePoint[],\r\n    segmentIndex: number,\r\n    orientation: Orientation,\r\n    deltaPerp: number\r\n): WirePoint[] {\r\n    if (points.length < 2) return points;\r\n    if (segmentIndex < 0 || segmentIndex >= points.length - 1) return points;\r\n    if (deltaPerp === 0) return points;\r\n\r\n    const out = points.map((p) => ({ ...p }));\r\n    const lastIdx = out.length - 1;\r\n\r\n    if (orientation === 'H') {\r\n        // Horizontal segment => shift Y.\r\n        if (segmentIndex === 0) {\r\n            const p0 = out[0];\r\n            const p1 = out[1];\r\n            // Insert a vertical jog at the start point.\r\n            const jog = { x: p0.x, y: p0.y + deltaPerp };\r\n            out.splice(1, 0, jog);\r\n            // Original p1 shifts (now at index 2).\r\n            out[2].y = jog.y;\r\n        } else if (segmentIndex === lastIdx - 1) {\r\n            const pN1 = out[lastIdx - 1];\r\n            const pN = out[lastIdx];\r\n            // Insert a vertical jog before the end point.\r\n            const jog = { x: pN.x, y: pN.y + deltaPerp };\r\n            out.splice(lastIdx, 0, jog);\r\n            // Shift previous point to align with jog.\r\n            out[lastIdx - 1].y = jog.y;\r\n            // Keep endpoint anchored.\r\n            out[lastIdx + 1].x = pN.x;\r\n            out[lastIdx + 1].y = pN.y;\r\n        } else {\r\n            out[segmentIndex].y += deltaPerp;\r\n            out[segmentIndex + 1].y += deltaPerp;\r\n        }\r\n    } else {\r\n        // Vertical segment => shift X.\r\n        if (segmentIndex === 0) {\r\n            const p0 = out[0];\r\n            const p1 = out[1];\r\n            const jog = { x: p0.x + deltaPerp, y: p0.y };\r\n            out.splice(1, 0, jog);\r\n            out[2].x = jog.x;\r\n        } else if (segmentIndex === lastIdx - 1) {\r\n            const pN1 = out[lastIdx - 1];\r\n            const pN = out[lastIdx];\r\n            const jog = { x: pN.x + deltaPerp, y: pN.y };\r\n            out.splice(lastIdx, 0, jog);\r\n            out[lastIdx - 1].x = jog.x;\r\n            out[lastIdx + 1].x = pN.x;\r\n            out[lastIdx + 1].y = pN.y;\r\n        } else {\r\n            out[segmentIndex].x += deltaPerp;\r\n            out[segmentIndex + 1].x += deltaPerp;\r\n        }\r\n    }\r\n\r\n    return dedupeColinear(out);\r\n}\r\n\r\nfunction segmentOrientation(points: WirePoint[], idx: number): Orientation | null {\r\n    if (idx < 0 || idx >= points.length - 1) return null;\r\n    const a = points[idx];\r\n    const b = points[idx + 1];\r\n    if (a.y === b.y && a.x !== b.x) return 'H';\r\n    if (a.x === b.x && a.y !== b.y) return 'V';\r\n    return null;\r\n}\r\n\r\n/**\r\n * Avoids PARALLEL overlaps between different wires.\r\n * - Horizontal-on-horizontal overlaps are removed by shifting Y.\r\n * - Vertical-on-vertical overlaps are removed by shifting X.\r\n * - Perpendicular crossings are allowed.\r\n *\r\n * This is a rendering-time deconfliction pass: endpoints stay anchored.\r\n */\r\nexport function avoidParallelOverlaps(\r\n    wires: Array<{ id: string; points: WirePoint[] }>,\r\n    options: { gridSize: number; maxLanes?: number } = { gridSize: 10 }\r\n): Map<string, WirePoint[]> {\r\n    const gridSize = options.gridSize || 10;\r\n    const maxLanes = options.maxLanes ?? 6;\r\n    const occupied = new Map<string, Segment[]>();\r\n    const result = new Map<string, WirePoint[]>();\r\n\r\n    // Stable, deterministic order: as provided.\r\n    for (const w of wires) {\r\n        let pts = dedupeColinear(w.points);\r\n\r\n        // If there is no conflict, accept quickly.\r\n        if (!hasParallelOverlap(pts, occupied)) {\r\n            addOccupied(pts, occupied);\r\n            result.set(w.id, pts);\r\n            continue;\r\n        }\r\n\r\n        // Try shifting each segment into a free lane.\r\n        let improved = true;\r\n        let safety = 0;\r\n        while (improved && safety++ < 8) {\r\n            improved = false;\r\n            for (let segIdx = 0; segIdx < pts.length - 1; segIdx++) {\r\n                const ori = segmentOrientation(pts, segIdx);\r\n                if (!ori) continue;\r\n\r\n                // Fast skip: only attempt if THIS segment overlaps.\r\n                const segs = toSegments([pts[segIdx], pts[segIdx + 1]]);\r\n                if (!segs.length) continue;\r\n                const seg = segs[0];\r\n                const key = `${seg.orientation}:${seg.coord}`;\r\n                const list = occupied.get(key);\r\n                if (!list?.length) continue;\r\n\r\n                let overlaps = false;\r\n                for (const o of list) {\r\n                    if (rangesOverlapStrict(seg.min, seg.max, o.min, o.max)) {\r\n                        overlaps = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (!overlaps) continue;\r\n\r\n                // Determine a deterministic lane preference.\r\n                const hash =\r\n                    [...w.id].reduce((acc, ch) => ((acc * 31) ^ ch.charCodeAt(0)) >>> 0, 7) +\r\n                    segIdx * 97;\r\n                const preferPositive = (hash & 1) === 0;\r\n\r\n                let best: WirePoint[] | null = null;\r\n                for (let lane = 1; lane <= maxLanes; lane++) {\r\n                    const d = lane * gridSize;\r\n                    const deltas = preferPositive ? [d, -d] : [-d, d];\r\n                    for (const deltaPerp of deltas) {\r\n                        const candidate = shiftSegmentKeepingEndpoints(pts, segIdx, ori, deltaPerp);\r\n                        if (!hasParallelOverlap(candidate, occupied)) {\r\n                            best = candidate;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (best) break;\r\n                }\r\n\r\n                if (best) {\r\n                    pts = best;\r\n                    improved = true;\r\n                    break; // re-scan from start with updated geometry\r\n                }\r\n            }\r\n        }\r\n\r\n        addOccupied(pts, occupied);\r\n        result.set(w.id, pts);\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Convert an array of points to an SVG path `d` string.\r\n * Supports smooth corners with optional quadratic Bezier curves.\r\n * @param points - Array of wire waypoints\r\n * @param cornerRadius - Radius for rounded corners (0 = sharp corners)\r\n */\r\nexport function pointsToPathD(points: WirePoint[], cornerRadius: number = 8): string {\r\n    if (points.length === 0) return '';\r\n    if (points.length === 1) return `M ${points[0].x} ${points[0].y}`;\r\n\r\n    // If no corner radius, use simple straight lines\r\n    if (cornerRadius <= 0 || points.length === 2) {\r\n        const [first, ...rest] = points;\r\n        return `M ${first.x} ${first.y}` + rest.map((p) => ` L ${p.x} ${p.y}`).join('');\r\n    }\r\n\r\n    // With corner radius: use quadratic curves at bends\r\n    let d = `M ${points[0].x} ${points[0].y}`;\r\n\r\n    for (let i = 1; i < points.length - 1; i++) {\r\n        const prev = points[i - 1];\r\n        const curr = points[i];\r\n        const next = points[i + 1];\r\n\r\n        // Calculate the maximum radius we can use at this corner\r\n        const distToPrev = Math.hypot(curr.x - prev.x, curr.y - prev.y);\r\n        const distToNext = Math.hypot(next.x - curr.x, next.y - curr.y);\r\n        const r = Math.min(cornerRadius, distToPrev / 2, distToNext / 2);\r\n\r\n        if (r <= 0) {\r\n            // No room for corner, use straight line\r\n            d += ` L ${curr.x} ${curr.y}`;\r\n            continue;\r\n        }\r\n\r\n        // Calculate direction vectors\r\n        const dx1 = curr.x - prev.x;\r\n        const dy1 = curr.y - prev.y;\r\n        const dx2 = next.x - curr.x;\r\n        const dy2 = next.y - curr.y;\r\n\r\n        // Normalize directions\r\n        const len1 = Math.hypot(dx1, dy1);\r\n        const len2 = Math.hypot(dx2, dy2);\r\n\r\n        if (len1 === 0 || len2 === 0) {\r\n            d += ` L ${curr.x} ${curr.y}`;\r\n            continue;\r\n        }\r\n\r\n        const nx1 = dx1 / len1;\r\n        const ny1 = dy1 / len1;\r\n        const nx2 = dx2 / len2;\r\n        const ny2 = dy2 / len2;\r\n\r\n        // Points where corner curve starts and ends\r\n        const startX = curr.x - nx1 * r;\r\n        const startY = curr.y - ny1 * r;\r\n        const endX = curr.x + nx2 * r;\r\n        const endY = curr.y + ny2 * r;\r\n\r\n        // Line to start of corner, then quadratic curve through corner\r\n        d += ` L ${startX} ${startY}`;\r\n        d += ` Q ${curr.x} ${curr.y} ${endX} ${endY}`;\r\n    }\r\n\r\n    // Line to final point\r\n    const last = points[points.length - 1];\r\n    d += ` L ${last.x} ${last.y}`;\r\n\r\n    return d;\r\n}\r\n\r\nexport function findSegmentIndex(\r\n    points: WirePoint[],\r\n    clickPoint: WirePoint,\r\n    threshold: number = 8\r\n): number | null {\r\n    if (points.length < 2) return null;\r\n    let bestIdx: number | null = null;\r\n    let bestDist = Infinity;\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n        const p1 = points[i];\r\n        const p2 = points[i + 1];\r\n        const dist = distanceToSegment(clickPoint, p1, p2);\r\n        if (dist <= threshold && dist < bestDist) {\r\n            bestDist = dist;\r\n            bestIdx = i;\r\n        }\r\n    }\r\n\r\n    return bestIdx;\r\n}\r\n\r\nfunction isHorizontalSegment(a: WirePoint, b: WirePoint): boolean {\r\n    return a.y === b.y && a.x !== b.x;\r\n}\r\n\r\nfunction isVerticalSegment(a: WirePoint, b: WirePoint): boolean {\r\n    return a.x === b.x && a.y !== b.y;\r\n}\r\n\r\nexport function moveSegment(\r\n    points: WirePoint[],\r\n    segmentIndex: number,\r\n    delta: WirePoint,\r\n    options: { snapTo?: number; disableSnap?: boolean } = {}\r\n): WirePoint[] {\r\n    if (points.length < 2) return points;\r\n    if (segmentIndex < 0 || segmentIndex >= points.length - 1) return points;\r\n\r\n    const out = points.map((p) => ({ ...p }));\r\n    const a = out[segmentIndex];\r\n    const b = out[segmentIndex + 1];\r\n\r\n    const isH = isHorizontalSegment(a, b);\r\n    const isV = isVerticalSegment(a, b);\r\n\r\n    if (!isH && !isV) {\r\n        // Non-orthogonal; refuse to move.\r\n        return points;\r\n    }\r\n\r\n    if (isH) {\r\n        let nextY = a.y + delta.y;\r\n        if (!options.disableSnap && options.snapTo) {\r\n            nextY = snapToGrid(nextY, options.snapTo);\r\n        }\r\n        a.y = nextY;\r\n        b.y = nextY;\r\n    } else {\r\n        let nextX = a.x + delta.x;\r\n        if (!options.disableSnap && options.snapTo) {\r\n            nextX = snapToGrid(nextX, options.snapTo);\r\n        }\r\n        a.x = nextX;\r\n        b.x = nextX;\r\n    }\r\n\r\n    return dedupeColinear(out);\r\n}\r\n\r\n/**\r\n * Wokwi-like orthogonal routing between two points.\r\n * - Produces only horizontal/vertical segments.\r\n * - Optionally threads through `waypoints` (manual bends).\r\n * - Uses a simple 2-segment strategy per hop.\r\n *\r\n * @param start - Starting point\r\n * @param end - Ending point\r\n * @param waypoints - Optional manual waypoints\r\n * @param options - Routing options including component bounds for avoidance\r\n */\r\nexport function calculateOrthogonalPoints(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    waypoints: WirePoint[] = [],\r\n    options: { firstLeg?: FirstLeg; obstacles?: ComponentBounds[]; gridSize?: number } = {}\r\n): WirePoint[] {\r\n    const firstLeg = options.firstLeg ?? 'horizontal';\r\n    const obstacles = options.obstacles ?? [];\r\n    const gridSize = options.gridSize ?? 10;\r\n    const all = [start, ...waypoints, end];\r\n    const out: WirePoint[] = [start];\r\n\r\n    // If no obstacles, use the original simple routing\r\n    if (obstacles.length === 0) {\r\n        for (let i = 1; i < all.length; i++) {\r\n            const a = all[i - 1];\r\n            const b = all[i];\r\n            if (a.x === b.x && a.y === b.y) continue;\r\n\r\n            if (firstLeg === 'horizontal') {\r\n                const mid: WirePoint = { x: b.x, y: a.y };\r\n                if (mid.x !== a.x || mid.y !== a.y) out.push(mid);\r\n            } else {\r\n                const mid: WirePoint = { x: a.x, y: b.y };\r\n                if (mid.x !== a.x || mid.y !== a.y) out.push(mid);\r\n            }\r\n            out.push(b);\r\n        }\r\n        return dedupeColinear(out);\r\n    }\r\n\r\n    // Enhanced routing with component avoidance\r\n    for (let i = 1; i < all.length; i++) {\r\n        const a = all[i - 1];\r\n        const b = all[i];\r\n\r\n        if (a.x === b.x && a.y === b.y) continue;\r\n\r\n        // Build the initial path for this segment\r\n        let segmentPath: WirePoint[];\r\n        if (firstLeg === 'horizontal') {\r\n            const mid: WirePoint = { x: b.x, y: a.y };\r\n            segmentPath = [a, mid, b];\r\n        } else {\r\n            const mid: WirePoint = { x: a.x, y: b.y };\r\n            segmentPath = [a, mid, b];\r\n        }\r\n\r\n        // Check each segment of the path for obstacle intersections\r\n        const finalPath: WirePoint[] = [a];\r\n        for (let segIdx = 0; segIdx < segmentPath.length - 1; segIdx++) {\r\n            const segStart = segmentPath[segIdx];\r\n            const segEnd = segmentPath[segIdx + 1];\r\n\r\n            // Skip if zero length\r\n            if (segStart.x === segEnd.x && segStart.y === segEnd.y) continue;\r\n\r\n            // Check if this segment intersects any obstacles\r\n            const intersectsObs = findIntersectingBounds(segStart, segEnd, obstacles);\r\n\r\n            if (intersectsObs.length === 0) {\r\n                // No intersection, add segment directly\r\n                finalPath.push(segEnd);\r\n            } else {\r\n                // Find the first obstacle that intersects\r\n                const obstacle = intersectsObs[0];\r\n\r\n                // Determine if this is horizontal or vertical segment\r\n                const isHorizontal = segStart.y === segEnd.y;\r\n                const pathType = isHorizontal ? 'horizontal' : 'vertical';\r\n\r\n                // Calculate detour around the obstacle\r\n                const detour = calculateDetour(segStart, segEnd, obstacle, pathType, gridSize);\r\n\r\n                // Add intermediate detour points (excluding start since it's already in finalPath)\r\n                for (let j = 1; j < detour.length; j++) {\r\n                    finalPath.push(detour[j]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Add all points from this segment to the main output (skip first since it's the previous end)\r\n        for (let j = 1; j < finalPath.length; j++) {\r\n            out.push(finalPath[j]);\r\n        }\r\n    }\r\n\r\n    return dedupeColinear(out);\r\n}\r\n\r\nexport function calculateOrthogonalPathD(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    waypoints: WirePoint[] = [],\r\n    options: { firstLeg?: FirstLeg } = {}\r\n): string {\r\n    return pointsToPathD(calculateOrthogonalPoints(start, end, waypoints, options));\r\n}\r\n\r\n/**\r\n * Calculate the orthogonal path between two points with optional waypoints.\r\n * Returns an array of points forming the complete path.\r\n */\r\nexport function calculateOrthogonalPath(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    waypoints: WirePoint[] = []\r\n): WirePoint[] {\r\n    const allPoints = [start, ...waypoints, end];\r\n    const path: WirePoint[] = [start];\r\n\r\n    for (let i = 1; i < allPoints.length; i++) {\r\n        const prev = allPoints[i - 1];\r\n        const curr = allPoints[i];\r\n\r\n        // Create orthogonal path between consecutive points\r\n        // Strategy: horizontal first, then vertical\r\n        const midPoint: WirePoint = { x: curr.x, y: prev.y };\r\n\r\n        // Only add midpoint if it's different from prev and curr\r\n        if (midPoint.x !== prev.x || midPoint.y !== prev.y) {\r\n            if (midPoint.x !== curr.x || midPoint.y !== curr.y) {\r\n                path.push(midPoint);\r\n            }\r\n        }\r\n\r\n        path.push(curr);\r\n    }\r\n\r\n    return path;\r\n}\r\n\r\n/**\r\n * Calculate orthogonal preview path during wire creation.\r\n * Starts with vertical movement, then horizontal to reach the cursor.\r\n */\r\nexport function calculatePreviewPath(\r\n    start: WirePoint,\r\n    cursor: WirePoint,\r\n    waypoints: WirePoint[] = []\r\n): WirePoint[] {\r\n    if (waypoints.length === 0) {\r\n        // Direct from start to cursor with orthogonal routing\r\n        const path: WirePoint[] = [start];\r\n\r\n        // Start vertical, then horizontal (Wokwi-style)\r\n        const midPoint: WirePoint = { x: start.x, y: cursor.y };\r\n\r\n        if (midPoint.y !== start.y) {\r\n            path.push(midPoint);\r\n        }\r\n\r\n        path.push(cursor);\r\n        return path;\r\n    }\r\n\r\n    // With waypoints: path through waypoints, then to cursor\r\n    const lastWaypoint = waypoints[waypoints.length - 1];\r\n    const pathToLastWaypoint = calculateOrthogonalPath(start, lastWaypoint, waypoints.slice(0, -1));\r\n\r\n    // From last waypoint to cursor\r\n    const midPoint: WirePoint = { x: lastWaypoint.x, y: cursor.y };\r\n\r\n    if (midPoint.y !== lastWaypoint.y) {\r\n        pathToLastWaypoint.push(midPoint);\r\n    }\r\n\r\n    pathToLastWaypoint.push(cursor);\r\n\r\n    return pathToLastWaypoint;\r\n}\r\n\r\n/**\r\n * Convert array of points to SVG polyline points string\r\n */\r\nexport function pointsToSvgPath(points: WirePoint[]): string {\r\n    return points.map(p => `${p.x},${p.y}`).join(' ');\r\n}\r\n\r\n/**\r\n * Check if a point is near a wire segment (for click detection)\r\n */\r\nexport function isPointNearWire(\r\n    point: WirePoint,\r\n    wirePoints: WirePoint[],\r\n    threshold: number = 8\r\n): boolean {\r\n    for (let i = 0; i < wirePoints.length - 1; i++) {\r\n        const p1 = wirePoints[i];\r\n        const p2 = wirePoints[i + 1];\r\n\r\n        const distance = distanceToSegment(point, p1, p2);\r\n        if (distance <= threshold) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Calculate distance from a point to a line segment\r\n */\r\nfunction distanceToSegment(point: WirePoint, p1: WirePoint, p2: WirePoint): number {\r\n    const dx = p2.x - p1.x;\r\n    const dy = p2.y - p1.y;\r\n    const lengthSquared = dx * dx + dy * dy;\r\n\r\n    if (lengthSquared === 0) {\r\n        // p1 and p2 are the same point\r\n        return Math.sqrt((point.x - p1.x) ** 2 + (point.y - p1.y) ** 2);\r\n    }\r\n\r\n    // Project point onto line segment\r\n    let t = ((point.x - p1.x) * dx + (point.y - p1.y) * dy) / lengthSquared;\r\n    t = Math.max(0, Math.min(1, t));\r\n\r\n    const projX = p1.x + t * dx;\r\n    const projY = p1.y + t * dy;\r\n\r\n    return Math.sqrt((point.x - projX) ** 2 + (point.y - projY) ** 2);\r\n}\r\n\r\n/**\r\n * Find which waypoint handle is being clicked\r\n */\r\nexport function findClickedHandle(\r\n    point: WirePoint,\r\n    wirePoints: WirePoint[],\r\n    threshold: number = 10\r\n): number | null {\r\n    for (let i = 0; i < wirePoints.length; i++) {\r\n        const wp = wirePoints[i];\r\n        const distance = Math.sqrt((point.x - wp.x) ** 2 + (point.y - wp.y) ** 2);\r\n        if (distance <= threshold) {\r\n            return i;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4617, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/WiringLayer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { memo, useEffect, useMemo, useRef, useState, useCallback } from 'react';\r\nimport { useStore } from '@xyflow/react';\r\nimport { useAppStore } from '@/store/useAppStore';\r\nimport type { WirePoint } from '@/types/wire';\r\nimport {\r\n  calculateOrthogonalPoints,\r\n  pointsToPathD,\r\n  findSegmentIndex,\r\n  moveSegment,\r\n  snapPointToGrid,\r\n  avoidParallelOverlaps,\r\n  type ComponentBounds,\r\n} from '@/utils/wireRouting';\r\n\r\ntype PinRef = { partId: string; pinId: string };\r\n\r\ninterface WiringLayerProps {\r\n  containerRef: React.RefObject<HTMLElement | null>;\r\n  /** Optional transient overrides for inner waypoints (used during part dragging for 60fps). */\r\n  wirePointOverrides?: Map<string, WirePoint[] | undefined>;\r\n}\r\n\r\ntype Mode = 'idle' | 'creating' | 'dragging-segment';\r\n\r\nconst HIT_STROKE = 15;\r\n\r\n// Wokwi-like keyboard palette (0-9) + Copper default.\r\nconst WOKWI_COLOR_BY_DIGIT: Record<string, string> = {\r\n  '0': '#000000', // black (GND)\r\n  '1': '#8b4513', // brown\r\n  '2': '#ef4444', // red (VCC)\r\n  '3': '#f97316', // orange\r\n  '4': '#eab308', // yellow\r\n  '5': '#22c55e', // green\r\n  '6': '#3b82f6', // blue\r\n  '7': '#8b5cf6', // violet\r\n  '8': '#9ca3af', // gray\r\n  '9': '#ffffff', // white\r\n};\r\n\r\nconst WOKWI_COLOR_PALETTE: Array<{ key: string; color: string }> = Object.entries(WOKWI_COLOR_BY_DIGIT).map(\r\n  ([key, color]) => ({ key, color })\r\n);\r\n\r\nfunction isDigitKey(key: string): key is keyof typeof WOKWI_COLOR_BY_DIGIT {\r\n  return Object.prototype.hasOwnProperty.call(WOKWI_COLOR_BY_DIGIT, key);\r\n}\r\n\r\nfunction clampToContainer(point: WirePoint, rect: DOMRect): WirePoint {\r\n  return {\r\n    x: Math.max(0, Math.min(rect.width, point.x)),\r\n    y: Math.max(0, Math.min(rect.height, point.y)),\r\n  };\r\n}\r\n\r\nfunction getRelativePoint(e: PointerEvent, container: HTMLElement): WirePoint {\r\n  const rect = container.getBoundingClientRect();\r\n  return clampToContainer({ x: e.clientX - rect.left, y: e.clientY - rect.top }, rect);\r\n}\r\n\r\nfunction isEventInsideContainer(e: PointerEvent, container: HTMLElement): boolean {\r\n  const t = e.target as Node | null;\r\n  if (!t) return false;\r\n  return container.contains(t);\r\n}\r\n\r\nfunction getPinElFromPoint(x: number, y: number): HTMLElement | null {\r\n  const el = document.elementFromPoint(x, y);\r\n  if (!el) return null;\r\n  const pin = (el as HTMLElement).closest?.('[data-fundi-pin=\"true\"]') as HTMLElement | null;\r\n  return pin;\r\n}\r\n\r\nfunction getPinRefFromEl(pinEl: HTMLElement): PinRef | null {\r\n  const partId = pinEl.getAttribute('data-node-id') || pinEl.getAttribute('data-part-id');\r\n  const pinId = pinEl.getAttribute('data-pin-id');\r\n  if (!partId || !pinId) return null;\r\n  return { partId, pinId };\r\n}\r\n\r\nfunction getPinCenterInContainer(pinEl: HTMLElement, container: HTMLElement): WirePoint {\r\n  const pinRect = pinEl.getBoundingClientRect();\r\n  const containerRect = container.getBoundingClientRect();\r\n  return {\r\n    x: pinRect.left + pinRect.width / 2 - containerRect.left,\r\n    y: pinRect.top + pinRect.height / 2 - containerRect.top,\r\n  };\r\n}\r\n\r\nfunction samePin(a: PinRef | null, b: PinRef | null): boolean {\r\n  if (!a || !b) return false;\r\n  return a.partId === b.partId && a.pinId === b.pinId;\r\n}\r\n\r\nfunction stripEndpoints(points: WirePoint[]): WirePoint[] {\r\n  if (points.length <= 2) return [];\r\n  return points.slice(1, -1);\r\n}\r\n\r\nfunction normalizePointsForStore(points: WirePoint[]): WirePoint[] | undefined {\r\n  const inner = stripEndpoints(points);\r\n  return inner.length ? inner : undefined;\r\n}\r\n\r\nfunction getGridSizeForZoom(zoom: number): number {\r\n  // Simple heuristic: coarser grid when zoomed out.\r\n  return zoom < 0.75 ? 20 : 10;\r\n}\r\n\r\nfunction WiringLayer({ containerRef, wirePointOverrides }: WiringLayerProps) {\r\n  const connections = useAppStore((s) => s.connections);\r\n  const addConnection = useAppStore((s) => s.addConnection);\r\n  const allocateNextWireColor = useAppStore((s) => s.allocateNextWireColor);\r\n  const removeConnection = useAppStore((s) => s.removeConnection);\r\n  const updateWireColor = useAppStore((s) => s.updateWireColor);\r\n  const updateWire = useAppStore((s) => s.updateWire);\r\n\r\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\r\n  const [selectedId, setSelectedId] = useState<string | null>(null);\r\n  const [hoveredId, setHoveredId] = useState<string | null>(null);\r\n\r\n  const zoom = useStore((s) => s.transform[2]);\r\n  // Subscribe to node changes so wire endpoints update in real-time while parts move.\r\n  // Using the store's nodes array reference is enough to invalidate memos during drags.\r\n  const flowNodes = useStore((s) => (s as any).nodes as unknown[]);\r\n  const gridSize = useMemo(() => getGridSizeForZoom(zoom), [zoom]);\r\n\r\n  const modeRef = useRef<Mode>('idle');\r\n\r\n  const creatingRef = useRef<{\r\n    from: PinRef;\r\n    fromPoint: WirePoint;\r\n    waypoints: WirePoint[];\r\n    cursor: WirePoint;\r\n    hoveredPin: PinRef | null;\r\n    hoveredPoint: WirePoint | null;\r\n    color: string;\r\n  } | null>(null);\r\n\r\n  const segmentDragRef = useRef<{\r\n    wireId: string;\r\n    segmentIndex: number;\r\n    startMouse: WirePoint;\r\n    startPoints: WirePoint[];\r\n    disableSnap: boolean;\r\n  } | null>(null);\r\n\r\n  const [, forceTick] = useState(0);\r\n\r\n  // Track container size.\r\n  useEffect(() => {\r\n    const el = containerRef.current;\r\n    if (!el) return;\r\n\r\n    const update = () => {\r\n      const rect = el.getBoundingClientRect();\r\n      setDimensions({ width: rect.width, height: rect.height });\r\n    };\r\n\r\n    update();\r\n    const ro = new ResizeObserver(update);\r\n    ro.observe(el);\r\n    return () => ro.disconnect();\r\n  }, [containerRef]);\r\n\r\n  // Precompute all pin centers once per render to keep 60fps during drags.\r\n  const pinCenters = useMemo(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return new Map<string, WirePoint>();\r\n\r\n    const containerRect = container.getBoundingClientRect();\r\n    const els = container.querySelectorAll<HTMLElement>('[data-fundi-pin=\"true\"][data-node-id][data-pin-id]');\r\n    const next = new Map<string, WirePoint>();\r\n    els.forEach((el) => {\r\n      const partId = el.getAttribute('data-node-id');\r\n      const pinId = el.getAttribute('data-pin-id');\r\n      if (!partId || !pinId) return;\r\n      const r = el.getBoundingClientRect();\r\n      next.set(`${partId}:${pinId}`, {\r\n        x: r.left + r.width / 2 - containerRect.left,\r\n        y: r.top + r.height / 2 - containerRect.top,\r\n      });\r\n    });\r\n    return next;\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [containerRef, dimensions.width, dimensions.height, zoom, flowNodes]);\r\n\r\n  // Precompute component bounding boxes for obstacle avoidance\r\n  const componentBounds = useMemo(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return [] as ComponentBounds[];\r\n\r\n    const containerRect = container.getBoundingClientRect();\r\n    // Get all node elements (excluding the wiring layer itself which is in an SVG)\r\n    // Looking for elements with data-node-id attribute\r\n    const nodeElements = container.querySelectorAll<HTMLElement>('[data-node-id]');\r\n    const bounds: ComponentBounds[] = [];\r\n\r\n    nodeElements.forEach((el) => {\r\n      const partId = el.getAttribute('data-node-id');\r\n      if (!partId) return;\r\n\r\n      // Get the bounding box of the node element\r\n      const rect = el.getBoundingClientRect();\r\n\r\n      // Convert to container-relative coordinates\r\n      const x = rect.left - containerRect.left;\r\n      const y = rect.top - containerRect.top;\r\n      const width = rect.width;\r\n      const height = rect.height;\r\n\r\n      // Filter out tiny elements (like the pin hitboxes which have node-id too)\r\n      if (width < 20 || height < 20) return;\r\n\r\n      // Check if we already have bounds for this part (multiple pin elements might exist)\r\n      if (!bounds.find(b => b.id === partId)) {\r\n        bounds.push({ id: partId, x, y, width, height });\r\n      }\r\n    });\r\n\r\n    return bounds;\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [containerRef, dimensions.width, dimensions.height, zoom, flowNodes]);\r\n\r\n  const getPinPoint = useCallback(\r\n    (pin: PinRef): WirePoint | null => {\r\n      return pinCenters.get(`${pin.partId}:${pin.pinId}`) ?? null;\r\n    },\r\n    [pinCenters]\r\n  );\r\n\r\n  const wireGeometry = useMemo(() => {\r\n    const base = connections\r\n      .map((c) => {\r\n        const start = getPinPoint(c.from);\r\n        const end = getPinPoint(c.to);\r\n\r\n        if (!start || !end) {\r\n          return null;\r\n        }\r\n\r\n        const waypoints = wirePointOverrides?.has(c.id)\r\n          ? wirePointOverrides.get(c.id) ?? []\r\n          : c.points ?? [];\r\n\r\n        const points = calculateOrthogonalPoints(start, end, waypoints, {\r\n          firstLeg: 'horizontal',\r\n          obstacles: componentBounds,\r\n          gridSize,\r\n        });\r\n        return { id: c.id, color: c.color, points };\r\n      })\r\n      .filter((x): x is { id: string; color: string; points: WirePoint[] } => Boolean(x));\r\n\r\n    // Prevent PARALLEL overlaps between different wires (perpendicular crossings OK).\r\n    const adjusted = avoidParallelOverlaps(\r\n      base.map((w) => ({ id: w.id, points: w.points })),\r\n      { gridSize }\r\n    );\r\n\r\n    return base.map((w) => {\r\n      const points = adjusted.get(w.id) ?? w.points;\r\n      return { ...w, points, d: pointsToPathD(points) };\r\n    });\r\n  }, [connections, getPinPoint, wirePointOverrides, gridSize, pinCenters, componentBounds]);\r\n\r\n  const selectedWire = useMemo(() => {\r\n    if (!selectedId) return null;\r\n    return wireGeometry.find((w) => w.id === selectedId) ?? null;\r\n  }, [selectedId, wireGeometry]);\r\n\r\n  const selectedMidpoint = useMemo(() => {\r\n    if (!selectedWire) return null;\r\n    const pts = selectedWire.points;\r\n    if (pts.length < 2) return null;\r\n    const i = Math.floor(pts.length / 2);\r\n    return pts[i];\r\n  }, [selectedWire]);\r\n\r\n  // Global pointer + keyboard interactions.\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    const onPointerMoveCapture = (e: PointerEvent) => {\r\n      if (!container) return;\r\n      if (!isEventInsideContainer(e, container)) return;\r\n\r\n      if (modeRef.current === 'creating' && creatingRef.current) {\r\n        const cursorRaw = getRelativePoint(e, container);\r\n        const cursor = e.shiftKey ? cursorRaw : snapPointToGrid(cursorRaw, gridSize);\r\n\r\n        const pinEl = getPinElFromPoint(e.clientX, e.clientY);\r\n        const hoveredRef = pinEl ? getPinRefFromEl(pinEl) : null;\r\n\r\n        let hoveredPin: PinRef | null = null;\r\n        let hoveredPoint: WirePoint | null = null;\r\n        if (hoveredRef && !samePin(hoveredRef, creatingRef.current.from)) {\r\n          hoveredPin = hoveredRef;\r\n          hoveredPoint = pinEl ? getPinCenterInContainer(pinEl, container) : null;\r\n        }\r\n\r\n        creatingRef.current = {\r\n          ...creatingRef.current,\r\n          cursor,\r\n          hoveredPin,\r\n          hoveredPoint,\r\n        };\r\n        forceTick((n) => (n + 1) % 1000000);\r\n      }\r\n\r\n      if (modeRef.current === 'dragging-segment' && segmentDragRef.current) {\r\n        const curr = getRelativePoint(e, container);\r\n        const drag = segmentDragRef.current;\r\n        const delta = { x: curr.x - drag.startMouse.x, y: curr.y - drag.startMouse.y };\r\n\r\n        const moved = moveSegment(drag.startPoints, drag.segmentIndex, delta, {\r\n          snapTo: gridSize,\r\n          disableSnap: drag.disableSnap,\r\n        });\r\n\r\n        updateWire(drag.wireId, normalizePointsForStore(moved));\r\n        forceTick((n) => (n + 1) % 1000000);\r\n      }\r\n    };\r\n\r\n    const onPointerDownCapture = (e: PointerEvent) => {\r\n      if (e.button !== 0) return;\r\n      if (!isEventInsideContainer(e, container)) return;\r\n\r\n      // Click-away deselect: clicking anywhere else in the canvas clears wire selection,\r\n      // except when interacting with the wire toolbar or wire hit targets.\r\n      if (selectedId) {\r\n        const target = e.target as HTMLElement | null;\r\n        const insideToolbar = Boolean(target?.closest?.('[data-wire-toolbar=\"true\"]'));\r\n        const onWire = Boolean(target?.closest?.('[data-wire-hit=\"true\"]'));\r\n        if (!insideToolbar && !onWire) {\r\n          setSelectedId(null);\r\n        }\r\n      }\r\n\r\n      const pinEl = (e.target as HTMLElement | null)?.closest?.('[data-fundi-pin=\"true\"]') as HTMLElement | null;\r\n      const pinRef = pinEl ? getPinRefFromEl(pinEl) : null;\r\n\r\n      // If we're creating and click a pin, complete the wire.\r\n      if (modeRef.current === 'creating' && creatingRef.current) {\r\n        if (pinEl && pinRef && !samePin(pinRef, creatingRef.current.from)) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          addConnection({\r\n            from: creatingRef.current.from,\r\n            to: pinRef,\r\n            color: creatingRef.current.color,\r\n            points: creatingRef.current.waypoints.length\r\n              ? creatingRef.current.waypoints\r\n              : undefined,\r\n          });\r\n\r\n          creatingRef.current = null;\r\n          modeRef.current = 'idle';\r\n          forceTick((n) => n + 1);\r\n          return;\r\n        }\r\n\r\n        // Otherwise pin a waypoint at current cursor (empty space click).\r\n        if (!pinEl) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          const pRaw = getRelativePoint(e, container);\r\n          const p = e.shiftKey ? pRaw : snapPointToGrid(pRaw, gridSize);\r\n          creatingRef.current = {\r\n            ...creatingRef.current,\r\n            waypoints: [...creatingRef.current.waypoints, p],\r\n            cursor: p,\r\n          };\r\n          forceTick((n) => n + 1);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Start creating from a pin.\r\n      if (pinEl && pinRef) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const fromPointRaw = getPinCenterInContainer(pinEl, container);\r\n        const fromPoint = snapPointToGrid(fromPointRaw, gridSize);\r\n        const cursorRaw = getRelativePoint(e, container);\r\n        const cursor = e.shiftKey ? cursorRaw : snapPointToGrid(cursorRaw, gridSize);\r\n\r\n        creatingRef.current = {\r\n          from: pinRef,\r\n          fromPoint,\r\n          waypoints: [],\r\n          cursor,\r\n          hoveredPin: null,\r\n          hoveredPoint: null,\r\n          color: allocateNextWireColor(),\r\n        };\r\n\r\n        modeRef.current = 'creating';\r\n        setSelectedId(null);\r\n        forceTick((n) => n + 1);\r\n      }\r\n    };\r\n\r\n    const onPointerUpCapture = () => {\r\n      if (modeRef.current === 'dragging-segment') {\r\n        segmentDragRef.current = null;\r\n        modeRef.current = 'idle';\r\n        forceTick((n) => n + 1);\r\n      }\r\n    };\r\n\r\n    const onKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        if (modeRef.current === 'creating') {\r\n          creatingRef.current = null;\r\n          modeRef.current = 'idle';\r\n          forceTick((n) => n + 1);\r\n        }\r\n        if (modeRef.current === 'dragging-segment') {\r\n          segmentDragRef.current = null;\r\n          modeRef.current = 'idle';\r\n          forceTick((n) => n + 1);\r\n        }\r\n        if (selectedId) setSelectedId(null);\r\n      }\r\n\r\n      if ((e.key === 'Delete' || e.key === 'Backspace') && selectedId) {\r\n        removeConnection(selectedId);\r\n        setSelectedId(null);\r\n      }\r\n\r\n      if (isDigitKey(e.key)) {\r\n        const color = WOKWI_COLOR_BY_DIGIT[e.key];\r\n        if (modeRef.current === 'creating' && creatingRef.current) {\r\n          creatingRef.current = { ...creatingRef.current, color };\r\n          forceTick((n) => n + 1);\r\n        } else if (selectedId) {\r\n          updateWireColor(selectedId, color);\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('pointerdown', onPointerDownCapture, { capture: true });\r\n    window.addEventListener('pointermove', onPointerMoveCapture, { capture: true });\r\n    window.addEventListener('pointerup', onPointerUpCapture, { capture: true });\r\n    window.addEventListener('keydown', onKeyDown);\r\n\r\n    return () => {\r\n      window.removeEventListener('pointerdown', onPointerDownCapture, true);\r\n      window.removeEventListener('pointermove', onPointerMoveCapture, true);\r\n      window.removeEventListener('pointerup', onPointerUpCapture, true);\r\n      window.removeEventListener('keydown', onKeyDown);\r\n    };\r\n  }, [addConnection, allocateNextWireColor, containerRef, gridSize, removeConnection, selectedId, updateWire, updateWireColor]);\r\n\r\n  const creating = creatingRef.current;\r\n  const preview = useMemo(() => {\r\n    if (!creating) return null;\r\n    const end = creating.hoveredPoint ?? creating.cursor;\r\n    const points = calculateOrthogonalPoints(creating.fromPoint, end, creating.waypoints, {\r\n      firstLeg: 'vertical',\r\n      obstacles: componentBounds,\r\n      gridSize,\r\n    });\r\n    return { d: pointsToPathD(points), color: creating.color };\r\n  }, [creating, forceTick, componentBounds, gridSize]);\r\n\r\n  if (dimensions.width === 0 || dimensions.height === 0) return null;\r\n\r\n  return (\r\n    <>\r\n      <style jsx global>{`\r\n        @keyframes fundi-wire-dash {\r\n          to {\r\n            stroke-dashoffset: -24;\r\n          }\r\n        }\r\n      `}</style>\r\n\r\n      <svg\r\n        style={{\r\n          position: 'absolute',\r\n          top: 0,\r\n          left: 0,\r\n          width: '100%',\r\n          height: '100%',\r\n          pointerEvents: 'none',\r\n          overflow: 'visible',\r\n          zIndex: 15,\r\n        }}\r\n        viewBox={`0 0 ${dimensions.width} ${dimensions.height}`}\r\n      >\r\n        <g style={{ pointerEvents: 'auto' }}>\r\n          {wireGeometry.map((w) => {\r\n            const isSelected = selectedId === w.id;\r\n            const isHovered = hoveredId === w.id;\r\n            const strokeWidth = isSelected ? 3.5 : 2;\r\n            const displayColor = isSelected ? '#00F0FF' : w.color; // Electric cyan when selected\r\n\r\n            return (\r\n              <g key={w.id}>\r\n                {/* Hit target (also used for segment dragging) */}\r\n                <path\r\n                  d={w.d}\r\n                  data-wire-hit=\"true\"\r\n                  data-wire-id={w.id}\r\n                  fill=\"none\"\r\n                  stroke=\"transparent\"\r\n                  strokeWidth={HIT_STROKE}\r\n                  style={{ cursor: isSelected ? 'grab' : 'pointer', pointerEvents: 'stroke' }}\r\n                  onPointerEnter={() => setHoveredId(w.id)}\r\n                  onPointerLeave={() => setHoveredId((prev) => (prev === w.id ? null : prev))}\r\n                  onPointerDown={(e) => {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n\r\n                    setSelectedId(w.id);\r\n\r\n                    // Segment dragging only when selected.\r\n                    const container = containerRef.current;\r\n                    if (!container) return;\r\n                    if (selectedId !== w.id) return;\r\n\r\n                    const rect = container.getBoundingClientRect();\r\n                    const click: WirePoint = { x: e.clientX - rect.left, y: e.clientY - rect.top };\r\n                    const segIdx = findSegmentIndex(w.points, click, HIT_STROKE / 2);\r\n                    if (segIdx === null) return;\r\n\r\n                    segmentDragRef.current = {\r\n                      wireId: w.id,\r\n                      segmentIndex: segIdx,\r\n                      startMouse: click,\r\n                      startPoints: w.points,\r\n                      disableSnap: e.shiftKey,\r\n                    };\r\n                    modeRef.current = 'dragging-segment';\r\n                  }}\r\n                  onDoubleClick={(e) => {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                    removeConnection(w.id);\r\n                    if (selectedId === w.id) setSelectedId(null);\r\n                  }}\r\n                />\r\n\r\n                {/* Glow effect for selected wire */}\r\n                {isSelected && (\r\n                  <path\r\n                    d={w.d}\r\n                    fill=\"none\"\r\n                    stroke=\"#00F0FF\"\r\n                    strokeWidth={strokeWidth + 3}\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    style={{\r\n                      pointerEvents: 'none',\r\n                      opacity: 0.3,\r\n                      filter: 'blur(4px)',\r\n                    }}\r\n                  />\r\n                )}\r\n\r\n                {/* Hover feedback (marching ants) */}\r\n                {(isHovered || isSelected) && (\r\n                  <path\r\n                    d={w.d}\r\n                    fill=\"none\"\r\n                    stroke={isSelected ? '#00F0FF' : '#D4AF37'}\r\n                    strokeWidth={strokeWidth + 1.25}\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeDasharray=\"6 6\"\r\n                    style={{\r\n                      pointerEvents: 'none',\r\n                      opacity: 0.4,\r\n                      animation: 'fundi-wire-dash 1s linear infinite',\r\n                    }}\r\n                  />\r\n                )}\r\n\r\n                {/* Visible wire */}\r\n                <path\r\n                  d={w.d}\r\n                  fill=\"none\"\r\n                  stroke={displayColor}\r\n                  strokeWidth={strokeWidth}\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  style={{\r\n                    pointerEvents: 'none',\r\n                    transition: 'all 0.2s ease',\r\n                  }}\r\n                />\r\n              </g>\r\n            );\r\n          })}\r\n\r\n          {/* Preview (ghost) wire */}\r\n          {preview && (\r\n            <path\r\n              d={preview.d}\r\n              fill=\"none\"\r\n              stroke={preview.color}\r\n              strokeWidth={2.5}\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeDasharray=\"6 6\"\r\n              opacity={0.9}\r\n              style={{ pointerEvents: 'none' }}\r\n            />\r\n          )}\r\n        </g>\r\n      </svg>\r\n\r\n      {/* Selected wire toolbar (color + delete) */}\r\n      {selectedWire && selectedMidpoint && (\r\n        <div\r\n          data-wire-toolbar=\"true\"\r\n          className=\"absolute z-30 flex items-center gap-1 glass-panel rounded-lg p-2 shadow-2xl\"\r\n          style={{\r\n            left: selectedMidpoint.x,\r\n            top: selectedMidpoint.y,\r\n            transform: 'translate(-50%, -110%)',\r\n            pointerEvents: 'auto',\r\n          }}\r\n          onPointerDown={(e) => {\r\n            // Prevent toolbar clicks from being treated as \"click away\".\r\n            e.stopPropagation();\r\n          }}\r\n        >\r\n          <div className=\"flex items-center gap-0.5\">\r\n            {WOKWI_COLOR_PALETTE.map((c) => (\r\n              <button\r\n                key={c.key}\r\n                type=\"button\"\r\n                onClick={() => updateWireColor(selectedWire.id, c.color)}\r\n                className={\r\n                  'h-5 w-5 rounded border-2 transition-all ' +\r\n                  (selectedWire.color.toLowerCase() === c.color.toLowerCase()\r\n                    ? 'border-electric scale-110 shadow-lg shadow-electric/50'\r\n                    : 'border-transparent hover:border-brass hover:scale-105')\r\n                }\r\n                style={{ backgroundColor: c.color }}\r\n                title={`Color ${c.key}`}\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"mx-1 h-5 w-px bg-brass/30\" />\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => {\r\n              removeConnection(selectedWire.id);\r\n              setSelectedId(null);\r\n            }}\r\n            className=\"rounded px-2 py-1 font-mono text-[11px] font-medium text-error hover:bg-error/15 transition-colors\"\r\n            title=\"Delete wire (also: Delete key or double-click)\"\r\n          >\r\n            Delete\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Wire connection label tooltip on hover */}\r\n      {hoveredId && !selectedId && (() => {\r\n        const hoveredWire = wireGeometry.find(w => w.id === hoveredId);\r\n        const hoveredConn = connections.find(c => c.id === hoveredId);\r\n        if (!hoveredWire || !hoveredConn) return null;\r\n\r\n        const pts = hoveredWire.points;\r\n        if (pts.length < 2) return null;\r\n\r\n        const midIdx = Math.floor(pts.length / 2);\r\n        const midpoint = pts[midIdx];\r\n\r\n        return (\r\n          <div\r\n            className=\"absolute z-20 pointer-events-none\"\r\n            style={{\r\n              left: midpoint.x,\r\n              top: midpoint.y,\r\n              transform: 'translate(-50%, -100%) translateY(-8px)',\r\n            }}\r\n          >\r\n            <div className=\"bg-ide-panel-bg/95 backdrop-blur-sm border border-ide-border rounded-md px-2.5 py-1.5 shadow-lg\">\r\n              <div className=\"flex items-center gap-2 text-[11px] font-mono\">\r\n                <span className=\"text-ide-text-muted\">{hoveredConn.from.partId}</span>\r\n                <span className=\"text-ide-accent font-medium\">{hoveredConn.from.pinId}</span>\r\n                <span className=\"text-ide-text-subtle\"></span>\r\n                <span className=\"text-ide-text-muted\">{hoveredConn.to.partId}</span>\r\n                <span className=\"text-ide-accent font-medium\">{hoveredConn.to.pinId}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        );\r\n      })()}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default memo(WiringLayer);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5506, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/terminal/CommandInterface.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react'\r\nimport { Loader2, Mic, MicOff, GraduationCap, Wrench, Send, ImagePlus, X, Sparkles } from 'lucide-react'\r\nimport { useAppStore, type TerminalEntry } from '@/store/useAppStore'\r\nimport { cn } from '@/utils/cn'\r\n\r\nfunction formatTimestamp(ts: number): string {\r\n  const d = new Date(ts)\r\n  return d.toLocaleTimeString('en-US', {\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    hour12: false,\r\n  })\r\n}\r\n\r\nfunction ChatMessage({ entry }: { entry: TerminalEntry }) {\r\n  const isUser = entry.type === 'cmd'\r\n  const isAi = entry.type === 'ai'\r\n  const isError = entry.type === 'error'\r\n\r\n  // Simple markdown-like rendering for code blocks\r\n  const renderContent = (content: string) => {\r\n    const parts = content.split(/(```[\\s\\S]*?```)/g)\r\n    return parts.map((part, i) => {\r\n      if (part.startsWith('```') && part.endsWith('```')) {\r\n        // Extract language and code\r\n        const match = part.match(/```(\\w+)?\\n?([\\s\\S]*?)```/)\r\n        const lang = match?.[1] || ''\r\n        const code = match?.[2] ?? part.slice(3, -3)\r\n        return (\r\n          <div key={i} className=\"my-2 rounded-lg overflow-hidden border border-ide-border\">\r\n            {lang && (\r\n              <div className=\"px-3 py-1 bg-ide-panel-bg text-[10px] font-medium text-ide-text-muted border-b border-ide-border\">\r\n                {lang}\r\n              </div>\r\n            )}\r\n            <pre className=\"p-3 overflow-x-auto bg-ide-panel-bg/50 text-xs text-ide-success\">\r\n              <code>{code.trim()}</code>\r\n            </pre>\r\n          </div>\r\n        )\r\n      }\r\n      // Regular text - preserve newlines\r\n      return (\r\n        <span key={i} className=\"whitespace-pre-wrap\">\r\n          {part}\r\n        </span>\r\n      )\r\n    })\r\n  }\r\n\r\n  return (\r\n    <div className={cn(\r\n      'mb-3 animate-fade-in',\r\n      isUser && 'flex justify-end'\r\n    )}>\r\n      <div className={cn(\r\n        'max-w-[85%] rounded-lg px-3 py-2',\r\n        isUser\r\n          ? 'bg-ide-accent/20 text-ide-text border border-ide-accent/30'\r\n          : isError\r\n            ? 'bg-ide-error/10 text-ide-error border border-ide-error/30'\r\n            : isAi\r\n              ? 'bg-ide-panel-surface text-ide-text border border-ide-border'\r\n              : 'bg-ide-panel-hover/50 text-ide-text-muted'\r\n      )}>\r\n        {/* Header */}\r\n        <div className=\"flex items-center gap-2 mb-1\">\r\n          <span className={cn(\r\n            'text-[10px] font-medium',\r\n            isUser ? 'text-ide-accent' : isAi ? 'text-ide-accent' : isError ? 'text-ide-error' : 'text-ide-text-subtle'\r\n          )}>\r\n            {isUser ? 'You' : isAi ? 'FUNDI AI' : isError ? 'Error' : 'System'}\r\n          </span>\r\n          <span className=\"text-[9px] text-ide-text-subtle\">{formatTimestamp(entry.timestamp)}</span>\r\n        </div>\r\n        {/* Content */}\r\n        <div className=\"text-sm leading-relaxed\">{renderContent(entry.content)}</div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport function CommandInterface() {\r\n  const terminalHistory = useAppStore((s) => s.terminalHistory)\r\n  const isAiLoading = useAppStore((s) => s.isAiLoading)\r\n  const submitCommand = useAppStore((s) => s.submitCommand)\r\n  const teacherMode = useAppStore((s) => s.teacherMode)\r\n  const setTeacherMode = useAppStore((s) => s.setTeacherMode)\r\n  const stagedImageData = useAppStore((s) => s.stagedImageData)\r\n  const stageImage = useAppStore((s) => s.stageImage)\r\n  const clearStagedImage = useAppStore((s) => s.clearStagedImage)\r\n\r\n  const [input, setInput] = useState('')\r\n  const [isListening, setIsListening] = useState(false)\r\n  // Command history navigation state\r\n  const [historyIndex, setHistoryIndex] = useState(-1)\r\n  const [tempInput, setTempInput] = useState('') // Store current input when navigating\r\n  const scrollRef = useRef<HTMLDivElement>(null)\r\n  const inputRef = useRef<HTMLTextAreaElement>(null)\r\n  const fileInputRef = useRef<HTMLInputElement>(null)\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const recognitionRef = useRef<any>(null)\r\n\r\n  // Get user command history (most recent first)\r\n  const commandHistory = useMemo(() =>\r\n    terminalHistory.filter(e => e.type === 'cmd').map(e => e.content).reverse(),\r\n    [terminalHistory]\r\n  )\r\n\r\n  // Auto-scroll to bottom when new entries arrive\r\n  useEffect(() => {\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight\r\n    }\r\n  }, [terminalHistory])\r\n\r\n  // Focus input on mount\r\n  useEffect(() => {\r\n    inputRef.current?.focus()\r\n  }, [])\r\n\r\n  // Initialize speech recognition\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      const SpeechRecognitionAPI = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition\r\n      if (SpeechRecognitionAPI) {\r\n        recognitionRef.current = new SpeechRecognitionAPI()\r\n        recognitionRef.current.continuous = false\r\n        recognitionRef.current.interimResults = false\r\n        recognitionRef.current.lang = 'en-US'\r\n\r\n        recognitionRef.current.onresult = (event: { results: { transcript: string }[][] }) => {\r\n          const transcript = event.results[0][0].transcript\r\n          setInput((prev) => prev ? prev + ' ' + transcript : transcript)\r\n          setIsListening(false)\r\n        }\r\n\r\n        recognitionRef.current.onerror = () => {\r\n          setIsListening(false)\r\n        }\r\n\r\n        recognitionRef.current.onend = () => {\r\n          setIsListening(false)\r\n        }\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  const handleSubmit = useCallback(\r\n    (e: React.FormEvent) => {\r\n      e.preventDefault()\r\n      if (!input.trim() || isAiLoading) return\r\n      void submitCommand(input)\r\n      setInput('')\r\n    },\r\n    [input, isAiLoading, submitCommand]\r\n  )\r\n\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\r\n    // Submit on Enter (without Shift)\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault()\r\n      if (!input.trim() || isAiLoading) return\r\n      void submitCommand(input)\r\n      setInput('')\r\n      setHistoryIndex(-1)\r\n      setTempInput('')\r\n    }\r\n    // Navigate up through history\r\n    else if (e.key === 'ArrowUp') {\r\n      e.preventDefault()\r\n      if (commandHistory.length === 0) return\r\n      if (historyIndex === -1) {\r\n        setTempInput(input) // Save current input\r\n      }\r\n      const newIndex = Math.min(historyIndex + 1, commandHistory.length - 1)\r\n      setHistoryIndex(newIndex)\r\n      setInput(commandHistory[newIndex])\r\n    }\r\n    // Navigate down through history\r\n    else if (e.key === 'ArrowDown') {\r\n      e.preventDefault()\r\n      if (historyIndex <= 0) {\r\n        setHistoryIndex(-1)\r\n        setInput(tempInput) // Restore original input\r\n        return\r\n      }\r\n      const newIndex = historyIndex - 1\r\n      setHistoryIndex(newIndex)\r\n      setInput(commandHistory[newIndex])\r\n    }\r\n  }, [input, isAiLoading, submitCommand, commandHistory, historyIndex, tempInput])\r\n\r\n  const toggleVoiceInput = useCallback(() => {\r\n    if (!recognitionRef.current) {\r\n      alert('Speech recognition is not supported in this browser.')\r\n      return\r\n    }\r\n\r\n    if (isListening) {\r\n      recognitionRef.current.stop()\r\n      setIsListening(false)\r\n    } else {\r\n      recognitionRef.current.start()\r\n      setIsListening(true)\r\n    }\r\n  }, [isListening])\r\n\r\n  // Stage image instead of sending immediately\r\n  const handleImageUpload = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      const file = e.target.files?.[0]\r\n      if (!file) return\r\n\r\n      try {\r\n        const reader = new FileReader()\r\n        reader.onload = (event) => {\r\n          const base64 = event.target?.result as string\r\n          stageImage(base64)\r\n        }\r\n        reader.readAsDataURL(file)\r\n      } catch (err) {\r\n        console.error('Error reading image:', err)\r\n      }\r\n\r\n      // Reset file input\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = ''\r\n      }\r\n    },\r\n    [stageImage]\r\n  )\r\n\r\n  // Quick action to generate circuit from staged image\r\n  const handleGenerateFromImage = useCallback(() => {\r\n    void submitCommand('Analyze this circuit image and recreate it as a virtual Wokwi circuit with appropriate code')\r\n  }, [submitCommand])\r\n\r\n  return (\r\n    <div\r\n      className=\"flex h-full flex-col bg-ide-panel-bg\"\r\n      onClick={() => inputRef.current?.focus()}\r\n    >\r\n      {/* Mode toggle bar - Segmented Control */}\r\n      <div className=\"flex items-center justify-between border-b border-ide-border bg-ide-panel-surface px-3 py-2\">\r\n        <div className=\"flex items-center rounded-lg bg-ide-panel-bg p-0.5\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setTeacherMode(false)}\r\n            className={cn(\r\n              'flex items-center gap-1.5 rounded-md px-3 py-1.5 text-xs font-medium transition-all',\r\n              !teacherMode\r\n                ? 'bg-ide-success/20 text-ide-success shadow-sm'\r\n                : 'text-ide-text-muted hover:text-ide-text'\r\n            )}\r\n          >\r\n            <Wrench className=\"h-3.5 w-3.5\" />\r\n            Builder\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setTeacherMode(true)}\r\n            className={cn(\r\n              'flex items-center gap-1.5 rounded-md px-3 py-1.5 text-xs font-medium transition-all',\r\n              teacherMode\r\n                ? 'bg-ide-accent/20 text-ide-accent shadow-sm'\r\n                : 'text-ide-text-muted hover:text-ide-text'\r\n            )}\r\n          >\r\n            <GraduationCap className=\"h-3.5 w-3.5\" />\r\n            Teacher\r\n          </button>\r\n        </div>\r\n        <span className=\"text-[10px] text-ide-text-subtle\">\r\n          {teacherMode ? 'Explains concepts' : 'Builds circuits'}\r\n        </span>\r\n      </div>\r\n\r\n      {/* Chat history area */}\r\n      <div\r\n        ref={scrollRef}\r\n        className=\"min-h-0 flex-1 overflow-y-auto px-3 py-3\"\r\n      >\r\n        {terminalHistory.length === 0 && (\r\n          <div className=\"flex h-full items-center justify-center\">\r\n            <div className=\"text-center max-w-xs\">\r\n              <div className=\"mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-ide-accent/10\">\r\n                <Wrench className=\"h-6 w-6 text-ide-accent\" />\r\n              </div>\r\n              <h3 className=\"text-sm font-medium text-ide-text mb-1\">FUNDI AI Assistant</h3>\r\n              <p className=\"text-xs text-ide-text-muted mb-3\">\r\n                Describe the circuit you want to build, upload an image, or use voice input.\r\n              </p>\r\n              <p className=\"text-[10px] text-ide-text-subtle\">\r\n                Type /help for commands\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n        {terminalHistory.map((entry) => (\r\n          <ChatMessage key={entry.id} entry={entry} />\r\n        ))}\r\n        {isAiLoading && (\r\n          <div className=\"flex items-center gap-2 py-2 text-sm text-ide-accent animate-pulse\">\r\n            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n            <span>Generating...</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Input area - GitHub-style Comment Box */}\r\n      <div className=\"shrink-0 border-t border-ide-border bg-ide-panel-surface p-3\">\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"rounded-lg border border-ide-border bg-ide-panel-bg overflow-hidden focus-within:border-ide-accent/50 focus-within:ring-1 focus-within:ring-ide-accent/20 transition-all\">\r\n            {/* Staged Image Preview */}\r\n            {stagedImageData && (\r\n              <div className=\"border-b border-ide-border p-2\">\r\n                <div className=\"relative inline-block\">\r\n                  <img\r\n                    src={stagedImageData}\r\n                    alt=\"Staged circuit\"\r\n                    className=\"h-20 rounded border border-ide-border object-cover\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={clearStagedImage}\r\n                    className=\"absolute -right-2 -top-2 flex h-5 w-5 items-center justify-center rounded-full bg-ide-error text-white hover:bg-ide-error/80 transition-colors\"\r\n                    title=\"Remove image\"\r\n                  >\r\n                    <X className=\"h-3 w-3\" />\r\n                  </button>\r\n                </div>\r\n                {/* Generate from Image button */}\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleGenerateFromImage}\r\n                  disabled={isAiLoading}\r\n                  className=\"mt-2 flex w-full items-center justify-center gap-2 rounded-md bg-ide-accent/20 px-3 py-1.5 text-xs font-medium text-ide-accent hover:bg-ide-accent/30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  <Sparkles className=\"h-3.5 w-3.5\" />\r\n                  Generate Circuit from this Image\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {/* Text input */}\r\n            <textarea\r\n              ref={inputRef}\r\n              value={input}\r\n              onChange={(e) => setInput(e.target.value)}\r\n              onKeyDown={handleKeyDown}\r\n              disabled={isAiLoading}\r\n              placeholder={\r\n                isListening\r\n                  ? 'Listening...'\r\n                  : isAiLoading\r\n                    ? 'Generating...'\r\n                    : stagedImageData\r\n                      ? 'Add a description or click the button above...'\r\n                      : 'Describe your circuit or ask a question...'\r\n              }\r\n              rows={2}\r\n              className={cn(\r\n                'w-full resize-none bg-transparent px-3 py-2 text-sm text-ide-text outline-none',\r\n                'placeholder:text-ide-text-subtle',\r\n                'disabled:cursor-not-allowed disabled:opacity-50'\r\n              )}\r\n              autoComplete=\"off\"\r\n              spellCheck={false}\r\n            />\r\n\r\n            {/* Bottom toolbar */}\r\n            <div className=\"flex items-center justify-between border-t border-ide-border px-2 py-1.5\">\r\n              <div className=\"flex items-center gap-1\">\r\n                {/* Image upload button */}\r\n                <input\r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={handleImageUpload}\r\n                  className=\"hidden\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => fileInputRef.current?.click()}\r\n                  disabled={isAiLoading}\r\n                  className={cn(\r\n                    'flex h-7 w-7 items-center justify-center rounded-md transition-colors',\r\n                    stagedImageData\r\n                      ? 'text-ide-accent bg-ide-accent/10'\r\n                      : 'text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text',\r\n                    'disabled:cursor-not-allowed disabled:opacity-50'\r\n                  )}\r\n                  title=\"Upload circuit image\"\r\n                >\r\n                  <ImagePlus className=\"h-4 w-4\" />\r\n                </button>\r\n\r\n                {/* Voice input button with recording state */}\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={toggleVoiceInput}\r\n                  disabled={isAiLoading}\r\n                  className={cn(\r\n                    'relative flex h-7 w-7 items-center justify-center rounded-md transition-all',\r\n                    isListening\r\n                      ? 'mic-recording text-ide-error'\r\n                      : 'text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text',\r\n                    'disabled:cursor-not-allowed disabled:opacity-50'\r\n                  )}\r\n                  title={isListening ? 'Stop listening' : 'Start voice input'}\r\n                >\r\n                  {isListening ? (\r\n                    <MicOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Mic className=\"h-4 w-4\" />\r\n                  )}\r\n                  {/* Pulse ring when recording */}\r\n                  {isListening && (\r\n                    <span className=\"absolute inset-0 rounded-md animate-pulse-ring bg-ide-error/30\" />\r\n                  )}\r\n                </button>\r\n              </div>\r\n\r\n              {/* Submit button */}\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isAiLoading || (!input.trim() && !stagedImageData)}\r\n                className={cn(\r\n                  'flex h-7 items-center gap-1.5 rounded-md px-3 text-xs font-medium transition-all btn-press',\r\n                  (input.trim() || stagedImageData) && !isAiLoading\r\n                    ? 'bg-ide-accent text-white hover:bg-ide-accent-hover'\r\n                    : 'bg-ide-panel-hover text-ide-text-subtle cursor-not-allowed'\r\n                )}\r\n              >\r\n                <Send className=\"h-3.5 w-3.5\" />\r\n                <span>Send</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6243, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/terminal/SerialMonitor.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react'\r\nimport { Trash2, ArrowDownToLine, Send, Binary } from 'lucide-react'\r\nimport { cn } from '@/utils/cn'\r\n\r\ninterface SerialMonitorProps {\r\n  serialOutput: string[]\r\n  onClear: () => void\r\n  isRunning: boolean\r\n  /** Optional callback to send input to simulation serial RX */\r\n  onSendInput?: (text: string) => void\r\n}\r\n\r\nexport function SerialMonitor({ serialOutput, onClear, isRunning, onSendInput }: SerialMonitorProps) {\r\n  const [autoScroll, setAutoScroll] = useState(true)\r\n  const [baudRate, setBaudRate] = useState(9600)\r\n  const [inputValue, setInputValue] = useState('')\r\n  const [lineEnding, setLineEnding] = useState<'none' | 'nl' | 'cr' | 'both'>('nl')\r\n  const [viewMode, setViewMode] = useState<'ascii' | 'hex'>('ascii')\r\n  const scrollRef = useRef<HTMLDivElement>(null)\r\n  const inputRef = useRef<HTMLInputElement>(null)\r\n\r\n  // Convert string to hex representation\r\n  const toHex = useCallback((str: string) => {\r\n    return str.split('').map(c => c.charCodeAt(0).toString(16).padStart(2, '0').toUpperCase()).join(' ')\r\n  }, [])\r\n\r\n  // Process output based on view mode  \r\n  const displayOutput = useMemo(() => {\r\n    if (viewMode === 'hex') {\r\n      return serialOutput.map(line => toHex(line))\r\n    }\r\n    return serialOutput\r\n  }, [serialOutput, viewMode, toHex])\r\n\r\n  // Auto-scroll to bottom when new output arrives (if enabled)\r\n  // Using useLayoutEffect to ensure scroll happens after DOM update (fixes race condition)\r\n  useLayoutEffect(() => {\r\n    if (autoScroll && scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight\r\n    }\r\n  }, [serialOutput, autoScroll])\r\n\r\n  const handleScroll = useCallback(() => {\r\n    if (!scrollRef.current) return\r\n    const { scrollTop, scrollHeight, clientHeight } = scrollRef.current\r\n    // Disable auto-scroll if user scrolls up\r\n    const isAtBottom = scrollHeight - scrollTop - clientHeight < 20\r\n    if (!isAtBottom && autoScroll) {\r\n      setAutoScroll(false)\r\n    }\r\n  }, [autoScroll])\r\n\r\n  const scrollToBottom = useCallback(() => {\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight\r\n      setAutoScroll(true)\r\n    }\r\n  }, [])\r\n\r\n  const handleSendInput = useCallback(() => {\r\n    if (!onSendInput || !inputValue) return\r\n\r\n    // Add line ending based on setting\r\n    let textToSend = inputValue\r\n    switch (lineEnding) {\r\n      case 'nl':\r\n        textToSend += '\\n'\r\n        break\r\n      case 'cr':\r\n        textToSend += '\\r'\r\n        break\r\n      case 'both':\r\n        textToSend += '\\r\\n'\r\n        break\r\n    }\r\n\r\n    // Send each character\r\n    for (const char of textToSend) {\r\n      onSendInput(char)\r\n    }\r\n\r\n    setInputValue('')\r\n    inputRef.current?.focus()\r\n  }, [inputValue, lineEnding, onSendInput])\r\n\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault()\r\n      handleSendInput()\r\n    }\r\n  }, [handleSendInput])\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col bg-ide-panel-bg\">\r\n      {/* Header toolbar */}\r\n      <div className=\"flex shrink-0 items-center justify-between border-b border-ide-border px-3 py-1.5\">\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Status indicator */}\r\n          <div className=\"flex items-center gap-1.5\">\r\n            <div\r\n              className={cn(\r\n                'h-2 w-2 rounded-full',\r\n                isRunning ? 'bg-ide-success animate-pulse' : 'bg-ide-text-subtle'\r\n              )}\r\n            />\r\n            <span className=\"text-[10px] font-medium text-ide-text-muted\">\r\n              {isRunning ? 'Connected' : 'Disconnected'}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Baud rate selector */}\r\n          <select\r\n            value={baudRate}\r\n            onChange={(e) => setBaudRate(Number(e.target.value))}\r\n            className=\"h-6 rounded border border-ide-border bg-ide-panel-surface px-1.5 text-[10px] text-ide-text-muted outline-none hover:border-ide-border-focus focus:border-ide-accent\"\r\n          >\r\n            <option value={9600}>9600 baud</option>\r\n            <option value={19200}>19200 baud</option>\r\n            <option value={38400}>38400 baud</option>\r\n            <option value={57600}>57600 baud</option>\r\n            <option value={115200}>115200 baud</option>\r\n          </select>\r\n\r\n          {/* Line ending selector */}\r\n          <select\r\n            value={lineEnding}\r\n            onChange={(e) => setLineEnding(e.target.value as typeof lineEnding)}\r\n            className=\"h-6 rounded border border-ide-border bg-ide-panel-surface px-1.5 text-[10px] text-ide-text-muted outline-none hover:border-ide-border-focus focus:border-ide-accent\"\r\n            title=\"Line ending\"\r\n          >\r\n            <option value=\"none\">No line ending</option>\r\n            <option value=\"nl\">Newline</option>\r\n            <option value=\"cr\">Carriage return</option>\r\n            <option value=\"both\">Both NL & CR</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-1\">\r\n          {/* Hex view toggle */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setViewMode(v => v === 'ascii' ? 'hex' : 'ascii')}\r\n            title={viewMode === 'ascii' ? 'Switch to HEX view' : 'Switch to ASCII view'}\r\n            className={cn(\r\n              'flex h-6 items-center gap-1 px-1.5 rounded text-[10px] font-medium transition-colors',\r\n              viewMode === 'hex'\r\n                ? 'bg-ide-accent/20 text-ide-accent'\r\n                : 'text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text'\r\n            )}\r\n          >\r\n            <Binary className=\"h-3.5 w-3.5\" />\r\n            <span>{viewMode === 'hex' ? 'HEX' : 'ASCII'}</span>\r\n          </button>\r\n\r\n          {/* Scroll to bottom / Auto-scroll toggle */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={scrollToBottom}\r\n            title={autoScroll ? 'Auto-scroll ON' : 'Scroll to bottom'}\r\n            className={cn(\r\n              'flex h-6 w-6 items-center justify-center rounded transition-colors',\r\n              autoScroll\r\n                ? 'bg-ide-success/20 text-ide-success'\r\n                : 'text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text'\r\n            )}\r\n          >\r\n            <ArrowDownToLine className=\"h-3.5 w-3.5\" />\r\n          </button>\r\n\r\n          {/* Clear output */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClear}\r\n            title=\"Clear output\"\r\n            className=\"flex h-6 w-6 items-center justify-center rounded text-ide-text-muted transition-colors hover:bg-ide-panel-hover hover:text-ide-text\"\r\n          >\r\n            <Trash2 className=\"h-3.5 w-3.5\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Output area */}\r\n      <div\r\n        ref={scrollRef}\r\n        onScroll={handleScroll}\r\n        className=\"min-h-0 flex-1 overflow-y-auto px-3 py-2 font-mono text-xs\"\r\n      >\r\n        {serialOutput.length === 0 ? (\r\n          <div className=\"flex h-full items-center justify-center text-ide-text-subtle\">\r\n            <div className=\"text-center\">\r\n              <p className=\"mb-1\">Serial Monitor</p>\r\n              <p className=\"text-ide-text-subtle/70\">\r\n                {isRunning\r\n                  ? 'Waiting for serial output...'\r\n                  : 'Run simulation to see output'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          displayOutput.map((line, index) => (\r\n            <div key={index} className={cn(\r\n              'leading-relaxed font-mono',\r\n              viewMode === 'hex' ? 'text-ide-warning tracking-wide' : 'text-ide-success'\r\n            )}>\r\n              {line || '\\u00A0'}\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n\r\n      {/* Input area */}\r\n      {onSendInput && (\r\n        <div className=\"shrink-0 border-t border-ide-border px-3 py-2\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <input\r\n              ref={inputRef}\r\n              type=\"text\"\r\n              value={inputValue}\r\n              onChange={(e) => setInputValue(e.target.value)}\r\n              onKeyDown={handleKeyDown}\r\n              disabled={!isRunning}\r\n              placeholder={isRunning ? \"Type here to send...\" : \"Start simulation to send\"}\r\n              className={cn(\r\n                'h-7 flex-1 rounded border bg-ide-panel-surface px-2 font-mono text-xs',\r\n                'text-ide-text placeholder:text-ide-text-subtle',\r\n                'outline-none transition-colors',\r\n                isRunning\r\n                  ? 'border-ide-border hover:border-ide-border-focus focus:border-ide-accent'\r\n                  : 'border-ide-border/50 cursor-not-allowed opacity-50'\r\n              )}\r\n            />\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleSendInput}\r\n              disabled={!isRunning || !inputValue}\r\n              title=\"Send\"\r\n              className={cn(\r\n                'flex h-7 w-7 items-center justify-center rounded transition-colors',\r\n                isRunning && inputValue\r\n                  ? 'bg-ide-accent text-white hover:bg-ide-accent/80'\r\n                  : 'bg-ide-panel-hover text-ide-text-subtle cursor-not-allowed'\r\n              )}\r\n            >\r\n              <Send className=\"h-3.5 w-3.5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6686, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/simulation/logicAnalyzer.ts"],"sourcesContent":["'use client';\r\n\r\n/**\r\n * Logic Analyzer for FUNDI Workbench\r\n * \r\n * Captures and displays digital signal transitions for debugging.\r\n * Can monitor up to 8 channels simultaneously.\r\n */\r\n\r\nexport interface LogicSample {\r\n    /** Timestamp in microseconds since capture start */\r\n    timestamp: number;\r\n    /** Channel states (bitmask - bit 0 = channel 0, etc.) */\r\n    channels: number;\r\n}\r\n\r\nexport interface ChannelConfig {\r\n    /** Channel index (0-7) */\r\n    index: number;\r\n    /** Channel name/label */\r\n    name: string;\r\n    /** Arduino pin number this channel monitors */\r\n    pin: number;\r\n    /** Display color */\r\n    color: string;\r\n    /** Whether channel is enabled */\r\n    enabled: boolean;\r\n}\r\n\r\nexport interface LogicAnalyzerState {\r\n    /** Is capture running? */\r\n    capturing: boolean;\r\n    /** Captured samples */\r\n    samples: LogicSample[];\r\n    /** Channel configurations */\r\n    channels: ChannelConfig[];\r\n    /** Capture start time */\r\n    startTime: number;\r\n    /** Maximum samples to keep */\r\n    maxSamples: number;\r\n    /** Sample rate (samples per second) */\r\n    sampleRate: number;\r\n}\r\n\r\nexport type LogicAnalyzerListener = (state: LogicAnalyzerState) => void;\r\n\r\n// Default channel colors\r\nconst CHANNEL_COLORS = [\r\n    '#22c55e', // Green\r\n    '#3b82f6', // Blue\r\n    '#f59e0b', // Amber\r\n    '#ef4444', // Red\r\n    '#8b5cf6', // Purple\r\n    '#06b6d4', // Cyan\r\n    '#f97316', // Orange\r\n    '#ec4899', // Pink\r\n];\r\n\r\n/**\r\n * Logic Analyzer class\r\n */\r\nclass LogicAnalyzer {\r\n    private samples: LogicSample[] = [];\r\n    private channels: ChannelConfig[] = [];\r\n    private capturing: boolean = false;\r\n    private startTime: number = 0;\r\n    private lastChannelState: number = 0;\r\n    private maxSamples: number = 10000;\r\n    private sampleRate: number = 100000; // 100kHz default\r\n    private listeners: Set<LogicAnalyzerListener> = new Set();\r\n    private updateTimer: ReturnType<typeof setTimeout> | null = null;\r\n\r\n    constructor(numChannels: number = 8) {\r\n        // Initialize default channels\r\n        for (let i = 0; i < numChannels; i++) {\r\n            this.channels.push({\r\n                index: i,\r\n                name: `CH${i}`,\r\n                pin: i + 2, // Default to pins 2-9\r\n                color: CHANNEL_COLORS[i % CHANNEL_COLORS.length],\r\n                enabled: i < 4, // Enable first 4 channels by default\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Configure a channel\r\n     */\r\n    configureChannel(index: number, config: Partial<ChannelConfig>): void {\r\n        if (index >= 0 && index < this.channels.length) {\r\n            this.channels[index] = { ...this.channels[index], ...config };\r\n            this.notifyListeners();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set channel pin mapping\r\n     */\r\n    setChannelPin(index: number, pin: number): void {\r\n        this.configureChannel(index, { pin });\r\n    }\r\n\r\n    /**\r\n     * Set channel name\r\n     */\r\n    setChannelName(index: number, name: string): void {\r\n        this.configureChannel(index, { name });\r\n    }\r\n\r\n    /**\r\n     * Enable/disable a channel\r\n     */\r\n    setChannelEnabled(index: number, enabled: boolean): void {\r\n        this.configureChannel(index, { enabled });\r\n    }\r\n\r\n    /**\r\n     * Start capturing\r\n     */\r\n    startCapture(): void {\r\n        if (this.capturing) return;\r\n\r\n        this.samples = [];\r\n        this.startTime = performance.now();\r\n        this.capturing = true;\r\n        this.lastChannelState = 0;\r\n\r\n        console.log('[LogicAnalyzer] Capture started');\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Stop capturing\r\n     */\r\n    stopCapture(): void {\r\n        if (!this.capturing) return;\r\n\r\n        this.capturing = false;\r\n        console.log(`[LogicAnalyzer] Capture stopped. ${this.samples.length} samples recorded.`);\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Clear captured data\r\n     */\r\n    clearCapture(): void {\r\n        this.samples = [];\r\n        this.lastChannelState = 0;\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Record a pin state change\r\n     * Call this from the simulation when a monitored pin changes\r\n     */\r\n    recordPinChange(pin: number, high: boolean): void {\r\n        if (!this.capturing) return;\r\n\r\n        // Find which channel this pin is mapped to\r\n        const channel = this.channels.find(ch => ch.enabled && ch.pin === pin);\r\n        if (!channel) return;\r\n\r\n        // Update channel state bitmask\r\n        if (high) {\r\n            this.lastChannelState |= (1 << channel.index);\r\n        } else {\r\n            this.lastChannelState &= ~(1 << channel.index);\r\n        }\r\n\r\n        // Record sample\r\n        const timestamp = (performance.now() - this.startTime) * 1000; // Convert to microseconds\r\n        this.samples.push({\r\n            timestamp,\r\n            channels: this.lastChannelState,\r\n        });\r\n\r\n        // Limit sample count\r\n        if (this.samples.length > this.maxSamples) {\r\n            this.samples.shift();\r\n        }\r\n\r\n        this.scheduleUpdate();\r\n    }\r\n\r\n    /**\r\n     * Record all channel states at once\r\n     * Call this for periodic sampling\r\n     */\r\n    recordSample(channelStates: boolean[]): void {\r\n        if (!this.capturing) return;\r\n\r\n        let state = 0;\r\n        for (let i = 0; i < Math.min(channelStates.length, this.channels.length); i++) {\r\n            if (this.channels[i].enabled && channelStates[i]) {\r\n                state |= (1 << i);\r\n            }\r\n        }\r\n\r\n        // Only record if state changed\r\n        if (state !== this.lastChannelState) {\r\n            this.lastChannelState = state;\r\n            const timestamp = (performance.now() - this.startTime) * 1000;\r\n            this.samples.push({ timestamp, channels: state });\r\n\r\n            if (this.samples.length > this.maxSamples) {\r\n                this.samples.shift();\r\n            }\r\n\r\n            this.scheduleUpdate();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current state\r\n     */\r\n    getState(): LogicAnalyzerState {\r\n        return {\r\n            capturing: this.capturing,\r\n            samples: [...this.samples],\r\n            channels: this.channels.map(ch => ({ ...ch })),\r\n            startTime: this.startTime,\r\n            maxSamples: this.maxSamples,\r\n            sampleRate: this.sampleRate,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get samples in a time range\r\n     */\r\n    getSamplesInRange(startUs: number, endUs: number): LogicSample[] {\r\n        return this.samples.filter(s => s.timestamp >= startUs && s.timestamp <= endUs);\r\n    }\r\n\r\n    /**\r\n     * Calculate frequency of a channel (Hz)\r\n     */\r\n    measureFrequency(channelIndex: number): number | null {\r\n        if (this.samples.length < 2) return null;\r\n\r\n        const mask = 1 << channelIndex;\r\n        const edges: number[] = [];\r\n        let lastState = false;\r\n\r\n        for (const sample of this.samples) {\r\n            const high = (sample.channels & mask) !== 0;\r\n            if (high && !lastState) {\r\n                edges.push(sample.timestamp);\r\n            }\r\n            lastState = high;\r\n        }\r\n\r\n        if (edges.length < 2) return null;\r\n\r\n        // Calculate average period\r\n        let totalPeriod = 0;\r\n        for (let i = 1; i < edges.length; i++) {\r\n            totalPeriod += edges[i] - edges[i - 1];\r\n        }\r\n        const avgPeriodUs = totalPeriod / (edges.length - 1);\r\n\r\n        return avgPeriodUs > 0 ? 1000000 / avgPeriodUs : null;\r\n    }\r\n\r\n    /**\r\n     * Calculate duty cycle of a channel (0-100%)\r\n     */\r\n    measureDutyCycle(channelIndex: number): number | null {\r\n        if (this.samples.length < 2) return null;\r\n\r\n        const mask = 1 << channelIndex;\r\n        let highTime = 0;\r\n        let totalTime = 0;\r\n\r\n        for (let i = 1; i < this.samples.length; i++) {\r\n            const duration = this.samples[i].timestamp - this.samples[i - 1].timestamp;\r\n            const wasHigh = (this.samples[i - 1].channels & mask) !== 0;\r\n\r\n            if (wasHigh) {\r\n                highTime += duration;\r\n            }\r\n            totalTime += duration;\r\n        }\r\n\r\n        return totalTime > 0 ? (highTime / totalTime) * 100 : null;\r\n    }\r\n\r\n    /**\r\n     * Export samples as CSV\r\n     */\r\n    exportCSV(): string {\r\n        const enabledChannels = this.channels.filter(ch => ch.enabled);\r\n        const header = ['Timestamp (s)', ...enabledChannels.map(ch => ch.name)].join(',');\r\n\r\n        const rows = this.samples.map(sample => {\r\n            const values = [sample.timestamp.toFixed(2)];\r\n            for (const ch of enabledChannels) {\r\n                values.push((sample.channels & (1 << ch.index)) !== 0 ? '1' : '0');\r\n            }\r\n            return values.join(',');\r\n        });\r\n\r\n        return [header, ...rows].join('\\n');\r\n    }\r\n\r\n    /**\r\n     * Subscribe to state changes\r\n     */\r\n    subscribe(listener: LogicAnalyzerListener): () => void {\r\n        this.listeners.add(listener);\r\n        listener(this.getState());\r\n        return () => this.listeners.delete(listener);\r\n    }\r\n\r\n    /**\r\n     * Set max samples\r\n     */\r\n    setMaxSamples(max: number): void {\r\n        this.maxSamples = Math.max(100, Math.min(100000, max));\r\n    }\r\n\r\n    private scheduleUpdate(): void {\r\n        // Debounce to ~30fps for UI updates\r\n        if (this.updateTimer) return;\r\n        this.updateTimer = setTimeout(() => {\r\n            this.notifyListeners();\r\n            this.updateTimer = null;\r\n        }, 33);\r\n    }\r\n\r\n    private notifyListeners(): void {\r\n        const state = this.getState();\r\n        for (const listener of this.listeners) {\r\n            listener(state);\r\n        }\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nlet logicAnalyzerInstance: LogicAnalyzer | null = null;\r\n\r\n/**\r\n * Get the logic analyzer singleton\r\n */\r\nexport function getLogicAnalyzer(): LogicAnalyzer {\r\n    if (!logicAnalyzerInstance) {\r\n        logicAnalyzerInstance = new LogicAnalyzer();\r\n    }\r\n    return logicAnalyzerInstance;\r\n}\r\n\r\nexport type { LogicAnalyzer };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6960, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/LogicAnalyzerPanel.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport {\r\n    Play,\r\n    Square,\r\n    Trash2,\r\n    Download,\r\n    Settings,\r\n    Activity,\r\n    Zap\r\n} from 'lucide-react';\r\nimport { cn } from '@/utils/cn';\r\nimport {\r\n    getLogicAnalyzer,\r\n    LogicAnalyzerState,\r\n    LogicSample,\r\n    ChannelConfig\r\n} from '@/utils/simulation/logicAnalyzer';\r\n\r\ninterface LogicAnalyzerPanelProps {\r\n    className?: string;\r\n}\r\n\r\n/**\r\n * Logic Analyzer Panel - displays digital waveforms and measurements\r\n */\r\nexport function LogicAnalyzerPanel({ className }: LogicAnalyzerPanelProps) {\r\n    const [state, setState] = useState<LogicAnalyzerState | null>(null);\r\n    const [showSettings, setShowSettings] = useState(false);\r\n    const [timeScale, setTimeScale] = useState(1000); // s per division\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Subscribe to logic analyzer state\r\n    useEffect(() => {\r\n        const analyzer = getLogicAnalyzer();\r\n        const unsubscribe = analyzer.subscribe(setState);\r\n        return unsubscribe;\r\n    }, []);\r\n\r\n    // Render waveforms\r\n    useEffect(() => {\r\n        if (!state || !canvasRef.current) return;\r\n\r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        const { width, height } = canvas.getBoundingClientRect();\r\n        canvas.width = width * window.devicePixelRatio;\r\n        canvas.height = height * window.devicePixelRatio;\r\n        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\r\n\r\n        // Clear canvas\r\n        ctx.fillStyle = '#0f0f0f';\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        // Draw grid\r\n        ctx.strokeStyle = '#222';\r\n        ctx.lineWidth = 1;\r\n        const divisions = 10;\r\n        for (let i = 0; i <= divisions; i++) {\r\n            const x = (width / divisions) * i;\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, 0);\r\n            ctx.lineTo(x, height);\r\n            ctx.stroke();\r\n        }\r\n\r\n        // Get enabled channels\r\n        const enabledChannels = state.channels.filter(ch => ch.enabled);\r\n        if (enabledChannels.length === 0) return;\r\n\r\n        const channelHeight = height / enabledChannels.length;\r\n        const samples = state.samples;\r\n\r\n        if (samples.length === 0) return;\r\n\r\n        // Calculate time range\r\n        const endTime = samples[samples.length - 1]?.timestamp || 0;\r\n        const startTime = Math.max(0, endTime - timeScale * divisions);\r\n\r\n        // Draw each channel\r\n        enabledChannels.forEach((channel, idx) => {\r\n            const y0 = idx * channelHeight;\r\n            const highY = y0 + 10;\r\n            const lowY = y0 + channelHeight - 10;\r\n\r\n            // Draw channel label\r\n            ctx.fillStyle = channel.color;\r\n            ctx.font = '12px monospace';\r\n            ctx.fillText(channel.name, 5, y0 + 20);\r\n\r\n            // Draw waveform\r\n            ctx.strokeStyle = channel.color;\r\n            ctx.lineWidth = 2;\r\n            ctx.beginPath();\r\n\r\n            let lastX = 0;\r\n            let lastY = lowY;\r\n            const mask = 1 << channel.index;\r\n\r\n            for (const sample of samples) {\r\n                if (sample.timestamp < startTime) continue;\r\n\r\n                const x = ((sample.timestamp - startTime) / (timeScale * divisions)) * width;\r\n                const high = (sample.channels & mask) !== 0;\r\n                const y = high ? highY : lowY;\r\n\r\n                if (lastX === 0) {\r\n                    ctx.moveTo(0, y);\r\n                } else {\r\n                    // Draw vertical transition\r\n                    if (y !== lastY) {\r\n                        ctx.lineTo(x, lastY);\r\n                        ctx.lineTo(x, y);\r\n                    }\r\n                }\r\n                ctx.lineTo(x, y);\r\n\r\n                lastX = x;\r\n                lastY = y;\r\n            }\r\n\r\n            // Extend to edge\r\n            ctx.lineTo(width, lastY);\r\n            ctx.stroke();\r\n\r\n            // Draw separator line\r\n            if (idx < enabledChannels.length - 1) {\r\n                ctx.strokeStyle = '#333';\r\n                ctx.lineWidth = 1;\r\n                ctx.beginPath();\r\n                ctx.moveTo(0, y0 + channelHeight);\r\n                ctx.lineTo(width, y0 + channelHeight);\r\n                ctx.stroke();\r\n            }\r\n        });\r\n\r\n    }, [state, timeScale]);\r\n\r\n    const handleStartCapture = useCallback(() => {\r\n        getLogicAnalyzer().startCapture();\r\n    }, []);\r\n\r\n    const handleStopCapture = useCallback(() => {\r\n        getLogicAnalyzer().stopCapture();\r\n    }, []);\r\n\r\n    const handleClear = useCallback(() => {\r\n        getLogicAnalyzer().clearCapture();\r\n    }, []);\r\n\r\n    const handleExport = useCallback(() => {\r\n        const csv = getLogicAnalyzer().exportCSV();\r\n        const blob = new Blob([csv], { type: 'text/csv' });\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement('a');\r\n        link.href = url;\r\n        link.download = 'logic_capture.csv';\r\n        link.click();\r\n        URL.revokeObjectURL(url);\r\n    }, []);\r\n\r\n    const toggleChannel = useCallback((index: number) => {\r\n        const analyzer = getLogicAnalyzer();\r\n        const channel = state?.channels[index];\r\n        if (channel) {\r\n            analyzer.setChannelEnabled(index, !channel.enabled);\r\n        }\r\n    }, [state]);\r\n\r\n    if (!state) return null;\r\n\r\n    // Calculate measurements for enabled channels\r\n    const measurements = state.channels\r\n        .filter(ch => ch.enabled)\r\n        .map(ch => ({\r\n            ...ch,\r\n            frequency: getLogicAnalyzer().measureFrequency(ch.index),\r\n            dutyCycle: getLogicAnalyzer().measureDutyCycle(ch.index),\r\n        }));\r\n\r\n    return (\r\n        <div className={cn('flex flex-col h-full bg-ide-panel', className)}>\r\n            {/* Toolbar */}\r\n            <div className=\"flex items-center gap-2 border-b border-ide-border px-3 py-2\">\r\n                <Activity className=\"h-4 w-4 text-ide-accent\" />\r\n                <span className=\"text-xs font-semibold text-ide-text\">Logic Analyzer</span>\r\n\r\n                <div className=\"flex-1\" />\r\n\r\n                {!state.capturing ? (\r\n                    <button\r\n                        onClick={handleStartCapture}\r\n                        className=\"flex items-center gap-1 px-2 py-1 text-xs bg-ide-success/20 text-ide-success rounded hover:bg-ide-success/30 transition-colors\"\r\n                    >\r\n                        <Play className=\"h-3 w-3\" />\r\n                        Capture\r\n                    </button>\r\n                ) : (\r\n                    <button\r\n                        onClick={handleStopCapture}\r\n                        className=\"flex items-center gap-1 px-2 py-1 text-xs bg-ide-error/20 text-ide-error rounded hover:bg-ide-error/30 transition-colors\"\r\n                    >\r\n                        <Square className=\"h-3 w-3\" />\r\n                        Stop\r\n                    </button>\r\n                )}\r\n\r\n                <button\r\n                    onClick={handleClear}\r\n                    className=\"p-1.5 text-ide-text-muted hover:text-ide-text hover:bg-ide-panel-hover rounded transition-colors\"\r\n                    title=\"Clear\"\r\n                >\r\n                    <Trash2 className=\"h-3.5 w-3.5\" />\r\n                </button>\r\n\r\n                <button\r\n                    onClick={handleExport}\r\n                    className=\"p-1.5 text-ide-text-muted hover:text-ide-text hover:bg-ide-panel-hover rounded transition-colors\"\r\n                    title=\"Export CSV\"\r\n                >\r\n                    <Download className=\"h-3.5 w-3.5\" />\r\n                </button>\r\n\r\n                <button\r\n                    onClick={() => setShowSettings(!showSettings)}\r\n                    className={cn(\r\n                        'p-1.5 rounded transition-colors',\r\n                        showSettings\r\n                            ? 'text-ide-accent bg-ide-accent/20'\r\n                            : 'text-ide-text-muted hover:text-ide-text hover:bg-ide-panel-hover'\r\n                    )}\r\n                    title=\"Settings\"\r\n                >\r\n                    <Settings className=\"h-3.5 w-3.5\" />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Settings panel */}\r\n            {showSettings && (\r\n                <div className=\"border-b border-ide-border p-3 bg-ide-panel-hover\">\r\n                    <div className=\"flex flex-wrap gap-4\">\r\n                        {/* Time scale */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-xs text-ide-text-muted\">Time/div:</span>\r\n                            <select\r\n                                value={timeScale}\r\n                                onChange={(e) => setTimeScale(Number(e.target.value))}\r\n                                className=\"text-xs bg-ide-bg border border-ide-border rounded px-2 py-1 text-ide-text\"\r\n                            >\r\n                                <option value={100}>100s</option>\r\n                                <option value={500}>500s</option>\r\n                                <option value={1000}>1ms</option>\r\n                                <option value={5000}>5ms</option>\r\n                                <option value={10000}>10ms</option>\r\n                                <option value={50000}>50ms</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        {/* Channel toggles */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-xs text-ide-text-muted\">Channels:</span>\r\n                            {state.channels.map((ch) => (\r\n                                <button\r\n                                    key={ch.index}\r\n                                    onClick={() => toggleChannel(ch.index)}\r\n                                    className={cn(\r\n                                        'px-2 py-0.5 text-xs rounded border transition-colors',\r\n                                        ch.enabled\r\n                                            ? 'border-current bg-current/20'\r\n                                            : 'border-ide-border text-ide-text-muted'\r\n                                    )}\r\n                                    style={{ color: ch.enabled ? ch.color : undefined }}\r\n                                >\r\n                                    {ch.name}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Waveform display */}\r\n            <div ref={containerRef} className=\"flex-1 min-h-0\">\r\n                <canvas\r\n                    ref={canvasRef}\r\n                    className=\"w-full h-full\"\r\n                />\r\n            </div>\r\n\r\n            {/* Measurements bar */}\r\n            {measurements.length > 0 && (\r\n                <div className=\"border-t border-ide-border p-2 bg-ide-panel-hover\">\r\n                    <div className=\"flex flex-wrap gap-4\">\r\n                        {measurements.map((m) => (\r\n                            <div key={m.index} className=\"flex items-center gap-2 text-xs\">\r\n                                <Zap className=\"h-3 w-3\" style={{ color: m.color }} />\r\n                                <span className=\"text-ide-text-muted\">{m.name}:</span>\r\n                                {m.frequency !== null && (\r\n                                    <span className=\"text-ide-text\">\r\n                                        {m.frequency > 1000\r\n                                            ? `${(m.frequency / 1000).toFixed(2)} kHz`\r\n                                            : `${m.frequency.toFixed(2)} Hz`}\r\n                                    </span>\r\n                                )}\r\n                                {m.dutyCycle !== null && (\r\n                                    <span className=\"text-ide-text-muted\">\r\n                                        ({m.dutyCycle.toFixed(1)}%)\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Sample count */}\r\n            <div className=\"border-t border-ide-border px-3 py-1 text-xs text-ide-text-muted\">\r\n                {state.samples.length} samples {state.capturing && ' Recording...'}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default LogicAnalyzerPanel;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7487, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/simulation/wifiMock.ts"],"sourcesContent":["'use client';\r\n\r\n/**\r\n * WiFi Mock for ESP32 Simulation\r\n * \r\n * Simulates basic WiFi functionality for ESP32 projects.\r\n * Handles connection states, HTTP requests, and basic networking.\r\n */\r\n\r\nexport type WiFiMode = 'OFF' | 'STA' | 'AP' | 'AP_STA';\r\nexport type WiFiStatus =\r\n    | 'WL_IDLE_STATUS'\r\n    | 'WL_NO_SSID_AVAIL'\r\n    | 'WL_SCAN_COMPLETED'\r\n    | 'WL_CONNECTED'\r\n    | 'WL_CONNECT_FAILED'\r\n    | 'WL_CONNECTION_LOST'\r\n    | 'WL_DISCONNECTED';\r\n\r\nexport interface WiFiNetwork {\r\n    ssid: string;\r\n    rssi: number;  // Signal strength (-100 to 0)\r\n    encryption: 'OPEN' | 'WEP' | 'WPA_PSK' | 'WPA2_PSK' | 'WPA3_PSK';\r\n    channel: number;\r\n    bssid?: string;\r\n}\r\n\r\nexport interface HTTPRequest {\r\n    id: string;\r\n    method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\r\n    url: string;\r\n    headers?: Record<string, string>;\r\n    body?: string;\r\n    timestamp: number;\r\n}\r\n\r\nexport interface HTTPResponse {\r\n    requestId: string;\r\n    statusCode: number;\r\n    headers: Record<string, string>;\r\n    body: string;\r\n    timestamp: number;\r\n}\r\n\r\nexport interface WiFiMockState {\r\n    mode: WiFiMode;\r\n    status: WiFiStatus;\r\n    ssid: string | null;\r\n    localIP: string;\r\n    gatewayIP: string;\r\n    subnetMask: string;\r\n    dns: string;\r\n    macAddress: string;\r\n    rssi: number;\r\n    hostname: string;\r\n    availableNetworks: WiFiNetwork[];\r\n    isScanning: boolean;\r\n    pendingRequests: HTTPRequest[];\r\n    completedRequests: Array<{ request: HTTPRequest; response: HTTPResponse }>;\r\n}\r\n\r\nexport type WiFiMockListener = (state: WiFiMockState) => void;\r\n\r\n/**\r\n * Default available networks for simulation\r\n */\r\nconst DEFAULT_NETWORKS: WiFiNetwork[] = [\r\n    { ssid: 'SimulatedWiFi', rssi: -45, encryption: 'WPA2_PSK', channel: 6 },\r\n    { ssid: 'TestNetwork', rssi: -65, encryption: 'WPA2_PSK', channel: 1 },\r\n    { ssid: 'OpenNetwork', rssi: -72, encryption: 'OPEN', channel: 11 },\r\n    { ssid: 'FUNDI_Lab', rssi: -55, encryption: 'WPA3_PSK', channel: 6 },\r\n];\r\n\r\n/**\r\n * Mock HTTP responses for common endpoints\r\n */\r\nconst MOCK_RESPONSES: Record<string, { status: number; body: string; headers?: Record<string, string> }> = {\r\n    'https://httpbin.org/get': {\r\n        status: 200,\r\n        body: JSON.stringify({\r\n            args: {},\r\n            headers: { 'User-Agent': 'ESP32/1.0' },\r\n            origin: '192.168.1.100',\r\n            url: 'https://httpbin.org/get'\r\n        }),\r\n    },\r\n    'https://api.github.com': {\r\n        status: 200,\r\n        body: JSON.stringify({ message: 'GitHub API Mock' }),\r\n    },\r\n    'https://jsonplaceholder.typicode.com/todos/1': {\r\n        status: 200,\r\n        body: JSON.stringify({ userId: 1, id: 1, title: 'Mock todo item', completed: false }),\r\n    },\r\n};\r\n\r\n/**\r\n * WiFi Mock Implementation\r\n */\r\nclass WiFiMock {\r\n    private mode: WiFiMode = 'OFF';\r\n    private status: WiFiStatus = 'WL_IDLE_STATUS';\r\n    private ssid: string | null = null;\r\n    private localIP: string = '0.0.0.0';\r\n    private gatewayIP: string = '0.0.0.0';\r\n    private subnetMask: string = '255.255.255.0';\r\n    private dns: string = '8.8.8.8';\r\n    private macAddress: string = 'AA:BB:CC:DD:EE:FF';\r\n    private hostname: string = 'esp32-device';\r\n    private rssi: number = 0;\r\n    private availableNetworks: WiFiNetwork[] = [...DEFAULT_NETWORKS];\r\n    private isScanning: boolean = false;\r\n    private pendingRequests: HTTPRequest[] = [];\r\n    private completedRequests: Array<{ request: HTTPRequest; response: HTTPResponse }> = [];\r\n    private listeners: Set<WiFiMockListener> = new Set();\r\n    private requestIdCounter: number = 0;\r\n\r\n    /**\r\n     * Set WiFi mode\r\n     */\r\n    setMode(mode: WiFiMode): void {\r\n        this.mode = mode;\r\n        console.log(`[WiFiMock] Mode set to: ${mode}`);\r\n\r\n        if (mode === 'OFF') {\r\n            this.disconnect();\r\n        } else if (mode === 'AP') {\r\n            this.localIP = '192.168.4.1';\r\n            this.gatewayIP = '192.168.4.1';\r\n        }\r\n\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Connect to a WiFi network\r\n     */\r\n    connect(ssid: string, password?: string): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            if (this.mode === 'OFF') {\r\n                this.mode = 'STA';\r\n            }\r\n\r\n            this.status = 'WL_IDLE_STATUS';\r\n            this.notifyListeners();\r\n\r\n            // Find the network\r\n            const network = this.availableNetworks.find(n => n.ssid === ssid);\r\n\r\n            // Simulate connection delay\r\n            setTimeout(() => {\r\n                if (network) {\r\n                    // Check password requirement\r\n                    if (network.encryption !== 'OPEN' && !password) {\r\n                        this.status = 'WL_CONNECT_FAILED';\r\n                        console.log(`[WiFiMock] Connection to '${ssid}' failed: password required`);\r\n                        resolve(false);\r\n                    } else {\r\n                        // Successful connection\r\n                        this.ssid = ssid;\r\n                        this.rssi = network.rssi;\r\n                        this.localIP = '192.168.1.' + Math.floor(Math.random() * 200 + 10);\r\n                        this.gatewayIP = '192.168.1.1';\r\n                        this.status = 'WL_CONNECTED';\r\n                        console.log(`[WiFiMock] Connected to '${ssid}' with IP ${this.localIP}`);\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    this.status = 'WL_NO_SSID_AVAIL';\r\n                    console.log(`[WiFiMock] Network '${ssid}' not found`);\r\n                    resolve(false);\r\n                }\r\n                this.notifyListeners();\r\n            }, 1500); // 1.5s connection delay\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Disconnect from WiFi\r\n     */\r\n    disconnect(): void {\r\n        this.ssid = null;\r\n        this.localIP = '0.0.0.0';\r\n        this.rssi = 0;\r\n        this.status = 'WL_DISCONNECTED';\r\n        console.log('[WiFiMock] Disconnected');\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Scan for networks\r\n     */\r\n    scanNetworks(): Promise<WiFiNetwork[]> {\r\n        return new Promise((resolve) => {\r\n            this.isScanning = true;\r\n            this.notifyListeners();\r\n\r\n            // Simulate scan time\r\n            setTimeout(() => {\r\n                // Add some randomness to RSSI values\r\n                this.availableNetworks = this.availableNetworks.map(n => ({\r\n                    ...n,\r\n                    rssi: n.rssi + Math.floor(Math.random() * 10 - 5),\r\n                }));\r\n\r\n                this.isScanning = false;\r\n                this.status = 'WL_SCAN_COMPLETED';\r\n                console.log(`[WiFiMock] Scan complete, found ${this.availableNetworks.length} networks`);\r\n                this.notifyListeners();\r\n                resolve([...this.availableNetworks]);\r\n            }, 2000); // 2s scan time\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set hostname\r\n     */\r\n    setHostname(name: string): void {\r\n        this.hostname = name;\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Add a mock network\r\n     */\r\n    addMockNetwork(network: WiFiNetwork): void {\r\n        this.availableNetworks.push(network);\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Make an HTTP request\r\n     */\r\n    httpRequest(method: HTTPRequest['method'], url: string, options?: {\r\n        headers?: Record<string, string>;\r\n        body?: string;\r\n    }): Promise<HTTPResponse> {\r\n        return new Promise((resolve, reject) => {\r\n            if (this.status !== 'WL_CONNECTED') {\r\n                reject(new Error('Not connected to WiFi'));\r\n                return;\r\n            }\r\n\r\n            const request: HTTPRequest = {\r\n                id: `req_${++this.requestIdCounter}`,\r\n                method,\r\n                url,\r\n                headers: options?.headers,\r\n                body: options?.body,\r\n                timestamp: Date.now(),\r\n            };\r\n\r\n            this.pendingRequests.push(request);\r\n            console.log(`[WiFiMock] HTTP ${method} ${url}`);\r\n            this.notifyListeners();\r\n\r\n            // Simulate network delay\r\n            setTimeout(() => {\r\n                // Remove from pending\r\n                this.pendingRequests = this.pendingRequests.filter(r => r.id !== request.id);\r\n\r\n                // Find mock response or generate default\r\n                const mockResponse = MOCK_RESPONSES[url];\r\n                const response: HTTPResponse = {\r\n                    requestId: request.id,\r\n                    statusCode: mockResponse?.status || 200,\r\n                    headers: mockResponse?.headers || { 'Content-Type': 'application/json' },\r\n                    body: mockResponse?.body || JSON.stringify({ mock: true, url }),\r\n                    timestamp: Date.now(),\r\n                };\r\n\r\n                this.completedRequests.push({ request, response });\r\n\r\n                // Keep only last 50 requests\r\n                if (this.completedRequests.length > 50) {\r\n                    this.completedRequests.shift();\r\n                }\r\n\r\n                console.log(`[WiFiMock] HTTP response: ${response.statusCode}`);\r\n                this.notifyListeners();\r\n                resolve(response);\r\n            }, 200 + Math.random() * 300); // 200-500ms latency\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Shorthand for GET request\r\n     */\r\n    get(url: string): Promise<HTTPResponse> {\r\n        return this.httpRequest('GET', url);\r\n    }\r\n\r\n    /**\r\n     * Shorthand for POST request\r\n     */\r\n    post(url: string, body: string, contentType: string = 'application/json'): Promise<HTTPResponse> {\r\n        return this.httpRequest('POST', url, {\r\n            headers: { 'Content-Type': contentType },\r\n            body,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get current state\r\n     */\r\n    getState(): WiFiMockState {\r\n        return {\r\n            mode: this.mode,\r\n            status: this.status,\r\n            ssid: this.ssid,\r\n            localIP: this.localIP,\r\n            gatewayIP: this.gatewayIP,\r\n            subnetMask: this.subnetMask,\r\n            dns: this.dns,\r\n            macAddress: this.macAddress,\r\n            rssi: this.rssi,\r\n            hostname: this.hostname,\r\n            availableNetworks: [...this.availableNetworks],\r\n            isScanning: this.isScanning,\r\n            pendingRequests: [...this.pendingRequests],\r\n            completedRequests: [...this.completedRequests],\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Check if connected\r\n     */\r\n    isConnected(): boolean {\r\n        return this.status === 'WL_CONNECTED';\r\n    }\r\n\r\n    /**\r\n     * Get local IP\r\n     */\r\n    getLocalIP(): string {\r\n        return this.localIP;\r\n    }\r\n\r\n    /**\r\n     * Subscribe to state changes\r\n     */\r\n    subscribe(listener: WiFiMockListener): () => void {\r\n        this.listeners.add(listener);\r\n        listener(this.getState());\r\n        return () => this.listeners.delete(listener);\r\n    }\r\n\r\n    /**\r\n     * Reset to initial state\r\n     */\r\n    reset(): void {\r\n        this.mode = 'OFF';\r\n        this.status = 'WL_IDLE_STATUS';\r\n        this.ssid = null;\r\n        this.localIP = '0.0.0.0';\r\n        this.gatewayIP = '0.0.0.0';\r\n        this.rssi = 0;\r\n        this.isScanning = false;\r\n        this.pendingRequests = [];\r\n        this.completedRequests = [];\r\n        this.availableNetworks = [...DEFAULT_NETWORKS];\r\n        this.notifyListeners();\r\n    }\r\n\r\n    private notifyListeners(): void {\r\n        const state = this.getState();\r\n        for (const listener of this.listeners) {\r\n            listener(state);\r\n        }\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nlet wifiMockInstance: WiFiMock | null = null;\r\n\r\n/**\r\n * Get the WiFi mock singleton\r\n */\r\nexport function getWiFiMock(): WiFiMock {\r\n    if (!wifiMockInstance) {\r\n        wifiMockInstance = new WiFiMock();\r\n    }\r\n    return wifiMockInstance;\r\n}\r\n\r\nexport type { WiFiMock };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7815, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/simulation/mqttMock.ts"],"sourcesContent":["'use client';\r\n\r\n/**\r\n * MQTT Mock for IoT Simulation\r\n * \r\n * Simulates basic MQTT publish/subscribe for ESP32 IoT projects.\r\n * Supports topics, QoS levels, and retained messages.\r\n */\r\n\r\nexport type MQTTQoS = 0 | 1 | 2;\r\n\r\nexport interface MQTTMessage {\r\n    topic: string;\r\n    payload: string | Uint8Array;\r\n    qos: MQTTQoS;\r\n    retain: boolean;\r\n    timestamp: number;\r\n}\r\n\r\nexport interface MQTTSubscription {\r\n    topic: string;\r\n    qos: MQTTQoS;\r\n    callback: (message: MQTTMessage) => void;\r\n}\r\n\r\nexport interface MQTTMockState {\r\n    connected: boolean;\r\n    clientId: string;\r\n    broker: string;\r\n    port: number;\r\n    subscriptions: string[];\r\n    publishedMessages: MQTTMessage[];\r\n    receivedMessages: MQTTMessage[];\r\n    lastWill?: {\r\n        topic: string;\r\n        payload: string;\r\n        qos: MQTTQoS;\r\n        retain: boolean;\r\n    };\r\n}\r\n\r\nexport type MQTTMockListener = (state: MQTTMockState) => void;\r\n\r\n/**\r\n * MQTT Mock Implementation\r\n */\r\nclass MQTTMock {\r\n    private connected: boolean = false;\r\n    private clientId: string = '';\r\n    private broker: string = 'mqtt://mock-broker';\r\n    private port: number = 1883;\r\n    private subscriptions: Map<string, MQTTSubscription[]> = new Map();\r\n    private retainedMessages: Map<string, MQTTMessage> = new Map();\r\n    private publishedMessages: MQTTMessage[] = [];\r\n    private receivedMessages: MQTTMessage[] = [];\r\n    private lastWill?: MQTTMockState['lastWill'];\r\n    private listeners: Set<MQTTMockListener> = new Set();\r\n\r\n    /**\r\n     * Connect to MQTT broker\r\n     */\r\n    connect(options: {\r\n        broker?: string;\r\n        port?: number;\r\n        clientId?: string;\r\n        username?: string;\r\n        password?: string;\r\n        lastWill?: MQTTMockState['lastWill'];\r\n    } = {}): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.broker = options.broker || 'mqtt://mock-broker';\r\n            this.port = options.port || 1883;\r\n            this.clientId = options.clientId || `fundi_${Date.now()}`;\r\n            this.lastWill = options.lastWill;\r\n\r\n            console.log(`[MQTTMock] Connecting to ${this.broker}:${this.port} as ${this.clientId}`);\r\n\r\n            // Simulate connection delay\r\n            setTimeout(() => {\r\n                this.connected = true;\r\n                console.log('[MQTTMock] Connected');\r\n                this.notifyListeners();\r\n                resolve(true);\r\n            }, 500);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Disconnect from broker\r\n     */\r\n    disconnect(): void {\r\n        if (!this.connected) return;\r\n\r\n        // Trigger last will if configured\r\n        if (this.lastWill) {\r\n            this.publish(this.lastWill.topic, this.lastWill.payload, {\r\n                qos: this.lastWill.qos,\r\n                retain: this.lastWill.retain,\r\n            });\r\n        }\r\n\r\n        this.connected = false;\r\n        this.subscriptions.clear();\r\n        console.log('[MQTTMock] Disconnected');\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Subscribe to a topic\r\n     */\r\n    subscribe(\r\n        topic: string,\r\n        callback: (message: MQTTMessage) => void,\r\n        qos: MQTTQoS = 0\r\n    ): void {\r\n        if (!this.connected) {\r\n            console.warn('[MQTTMock] Cannot subscribe: not connected');\r\n            return;\r\n        }\r\n\r\n        const subscription: MQTTSubscription = { topic, qos, callback };\r\n\r\n        if (!this.subscriptions.has(topic)) {\r\n            this.subscriptions.set(topic, []);\r\n        }\r\n        this.subscriptions.get(topic)!.push(subscription);\r\n\r\n        console.log(`[MQTTMock] Subscribed to: ${topic}`);\r\n\r\n        // Deliver retained message if exists\r\n        const retained = this.retainedMessages.get(topic);\r\n        if (retained) {\r\n            callback(retained);\r\n        }\r\n\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Unsubscribe from a topic\r\n     */\r\n    unsubscribe(topic: string): void {\r\n        if (this.subscriptions.delete(topic)) {\r\n            console.log(`[MQTTMock] Unsubscribed from: ${topic}`);\r\n            this.notifyListeners();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Publish a message to a topic\r\n     */\r\n    publish(\r\n        topic: string,\r\n        payload: string | Uint8Array,\r\n        options: { qos?: MQTTQoS; retain?: boolean } = {}\r\n    ): void {\r\n        if (!this.connected) {\r\n            console.warn('[MQTTMock] Cannot publish: not connected');\r\n            return;\r\n        }\r\n\r\n        const message: MQTTMessage = {\r\n            topic,\r\n            payload,\r\n            qos: options.qos || 0,\r\n            retain: options.retain || false,\r\n            timestamp: Date.now(),\r\n        };\r\n\r\n        this.publishedMessages.push(message);\r\n        console.log(`[MQTTMock] Published to ${topic}: ${typeof payload === 'string' ? payload : `(${payload.length} bytes)`\r\n            }`);\r\n\r\n        // Store retained message\r\n        if (message.retain) {\r\n            this.retainedMessages.set(topic, message);\r\n        }\r\n\r\n        // Deliver to matching subscribers\r\n        this.deliverMessage(message);\r\n\r\n        // Limit stored messages\r\n        if (this.publishedMessages.length > 100) {\r\n            this.publishedMessages.shift();\r\n        }\r\n\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Simulate receiving a message from the broker\r\n     * (useful for testing subscription handlers)\r\n     */\r\n    simulateIncoming(topic: string, payload: string | Uint8Array, options: { qos?: MQTTQoS; retain?: boolean } = {}): void {\r\n        const message: MQTTMessage = {\r\n            topic,\r\n            payload,\r\n            qos: options.qos || 0,\r\n            retain: options.retain || false,\r\n            timestamp: Date.now(),\r\n        };\r\n\r\n        this.receivedMessages.push(message);\r\n        this.deliverMessage(message);\r\n\r\n        if (this.receivedMessages.length > 100) {\r\n            this.receivedMessages.shift();\r\n        }\r\n\r\n        this.notifyListeners();\r\n    }\r\n\r\n    /**\r\n     * Deliver message to matching subscribers\r\n     */\r\n    private deliverMessage(message: MQTTMessage): void {\r\n        // Check each subscription for topic match\r\n        for (const [pattern, subscribers] of this.subscriptions) {\r\n            if (this.topicMatches(pattern, message.topic)) {\r\n                for (const sub of subscribers) {\r\n                    try {\r\n                        sub.callback(message);\r\n                    } catch (e) {\r\n                        console.error(`[MQTTMock] Error in subscription callback for ${pattern}:`, e);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if topic matches pattern (supports + and # wildcards)\r\n     */\r\n    private topicMatches(pattern: string, topic: string): boolean {\r\n        const patternParts = pattern.split('/');\r\n        const topicParts = topic.split('/');\r\n\r\n        for (let i = 0; i < patternParts.length; i++) {\r\n            const p = patternParts[i];\r\n\r\n            // Multi-level wildcard matches everything\r\n            if (p === '#') {\r\n                return true;\r\n            }\r\n\r\n            // Single-level wildcard\r\n            if (p === '+') {\r\n                if (i >= topicParts.length) return false;\r\n                continue;\r\n            }\r\n\r\n            // Exact match required\r\n            if (i >= topicParts.length || p !== topicParts[i]) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // Must have same number of parts (unless # was used)\r\n        return patternParts.length === topicParts.length;\r\n    }\r\n\r\n    /**\r\n     * Get current state\r\n     */\r\n    getState(): MQTTMockState {\r\n        return {\r\n            connected: this.connected,\r\n            clientId: this.clientId,\r\n            broker: this.broker,\r\n            port: this.port,\r\n            subscriptions: Array.from(this.subscriptions.keys()),\r\n            publishedMessages: [...this.publishedMessages],\r\n            receivedMessages: [...this.receivedMessages],\r\n            lastWill: this.lastWill,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Check if connected\r\n     */\r\n    isConnected(): boolean {\r\n        return this.connected;\r\n    }\r\n\r\n    /**\r\n     * Subscribe to state changes\r\n     */\r\n    subscribeToState(listener: MQTTMockListener): () => void {\r\n        this.listeners.add(listener);\r\n        listener(this.getState());\r\n        return () => this.listeners.delete(listener);\r\n    }\r\n\r\n    /**\r\n     * Reset to initial state\r\n     */\r\n    reset(): void {\r\n        this.disconnect();\r\n        this.publishedMessages = [];\r\n        this.receivedMessages = [];\r\n        this.retainedMessages.clear();\r\n        this.lastWill = undefined;\r\n        this.notifyListeners();\r\n    }\r\n\r\n    private notifyListeners(): void {\r\n        const state = this.getState();\r\n        for (const listener of this.listeners) {\r\n            listener(state);\r\n        }\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nlet mqttMockInstance: MQTTMock | null = null;\r\n\r\n/**\r\n * Get the MQTT mock singleton\r\n */\r\nexport function getMQTTMock(): MQTTMock {\r\n    if (!mqttMockInstance) {\r\n        mqttMockInstance = new MQTTMock();\r\n    }\r\n    return mqttMockInstance;\r\n}\r\n\r\nexport type { MQTTMock };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8047, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/NetworkPanel.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    Wifi,\r\n    WifiOff,\r\n    RefreshCw,\r\n    Signal,\r\n    Lock,\r\n    Unlock,\r\n    Send,\r\n    MessageSquare\r\n} from 'lucide-react';\r\nimport { cn } from '@/utils/cn';\r\nimport { getWiFiMock, WiFiMockState, WiFiNetwork } from '@/utils/simulation/wifiMock';\r\nimport { getMQTTMock, MQTTMockState, MQTTMessage } from '@/utils/simulation/mqttMock';\r\n\r\ninterface NetworkPanelProps {\r\n    className?: string;\r\n    boardType?: string;\r\n}\r\n\r\n/**\r\n * Network Panel - WiFi and MQTT controls for ESP32 simulation\r\n */\r\nexport function NetworkPanel({ className, boardType }: NetworkPanelProps) {\r\n    const [wifiState, setWifiState] = useState<WiFiMockState | null>(null);\r\n    const [mqttState, setMqttState] = useState<MQTTMockState | null>(null);\r\n    const [activeTab, setActiveTab] = useState<'wifi' | 'mqtt'>('wifi');\r\n    const [password, setPassword] = useState('');\r\n    const [selectedSSID, setSelectedSSID] = useState<string | null>(null);\r\n    const [mqttTopic, setMqttTopic] = useState('');\r\n    const [mqttMessage, setMqttMessage] = useState('');\r\n\r\n    // Only show for ESP32 boards\r\n    const isESP32 = boardType?.toLowerCase().includes('esp32');\r\n\r\n    // Subscribe to WiFi state\r\n    useEffect(() => {\r\n        const wifi = getWiFiMock();\r\n        const unsubscribe = wifi.subscribe(setWifiState);\r\n        return unsubscribe;\r\n    }, []);\r\n\r\n    // Subscribe to MQTT state\r\n    useEffect(() => {\r\n        const mqtt = getMQTTMock();\r\n        const unsubscribe = mqtt.subscribeToState(setMqttState);\r\n        return unsubscribe;\r\n    }, []);\r\n\r\n    const handleScan = useCallback(async () => {\r\n        await getWiFiMock().scanNetworks();\r\n    }, []);\r\n\r\n    const handleConnect = useCallback(async () => {\r\n        if (!selectedSSID) return;\r\n        const success = await getWiFiMock().connect(selectedSSID, password);\r\n        if (success) {\r\n            setPassword('');\r\n            setSelectedSSID(null);\r\n        }\r\n    }, [selectedSSID, password]);\r\n\r\n    const handleDisconnect = useCallback(() => {\r\n        getWiFiMock().disconnect();\r\n    }, []);\r\n\r\n    const handleMqttConnect = useCallback(async () => {\r\n        await getMQTTMock().connect({\r\n            broker: 'mqtt://mock-broker',\r\n            clientId: `fundi_${Date.now()}`,\r\n        });\r\n    }, []);\r\n\r\n    const handleMqttDisconnect = useCallback(() => {\r\n        getMQTTMock().disconnect();\r\n    }, []);\r\n\r\n    const handlePublish = useCallback(() => {\r\n        if (!mqttTopic || !mqttMessage) return;\r\n        getMQTTMock().publish(mqttTopic, mqttMessage);\r\n        setMqttMessage('');\r\n    }, [mqttTopic, mqttMessage]);\r\n\r\n    const handleSubscribe = useCallback(() => {\r\n        if (!mqttTopic) return;\r\n        getMQTTMock().subscribe(mqttTopic, (msg) => {\r\n            console.log('[MQTT] Received:', msg);\r\n        });\r\n        setMqttTopic('');\r\n    }, [mqttTopic]);\r\n\r\n    if (!isESP32) {\r\n        return (\r\n            <div className={cn('flex items-center justify-center h-full text-ide-text-muted text-sm', className)}>\r\n                Network features available for ESP32 boards only\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={cn('flex flex-col h-full bg-ide-panel', className)}>\r\n            {/* Tabs */}\r\n            <div className=\"flex border-b border-ide-border\">\r\n                <button\r\n                    onClick={() => setActiveTab('wifi')}\r\n                    className={cn(\r\n                        'flex items-center gap-1.5 px-4 py-2 text-xs font-medium transition-colors',\r\n                        activeTab === 'wifi'\r\n                            ? 'text-ide-accent border-b-2 border-ide-accent'\r\n                            : 'text-ide-text-muted hover:text-ide-text'\r\n                    )}\r\n                >\r\n                    <Wifi className=\"h-3.5 w-3.5\" />\r\n                    WiFi\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('mqtt')}\r\n                    className={cn(\r\n                        'flex items-center gap-1.5 px-4 py-2 text-xs font-medium transition-colors',\r\n                        activeTab === 'mqtt'\r\n                            ? 'text-ide-accent border-b-2 border-ide-accent'\r\n                            : 'text-ide-text-muted hover:text-ide-text'\r\n                    )}\r\n                >\r\n                    <MessageSquare className=\"h-3.5 w-3.5\" />\r\n                    MQTT\r\n                </button>\r\n            </div>\r\n\r\n            {/* WiFi Tab */}\r\n            {activeTab === 'wifi' && wifiState && (\r\n                <div className=\"flex-1 overflow-auto p-3 space-y-3\">\r\n                    {/* Status */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {wifiState.status === 'WL_CONNECTED' ? (\r\n                                <Wifi className=\"h-4 w-4 text-ide-success\" />\r\n                            ) : (\r\n                                <WifiOff className=\"h-4 w-4 text-ide-text-muted\" />\r\n                            )}\r\n                            <span className=\"text-sm text-ide-text\">\r\n                                {wifiState.status === 'WL_CONNECTED'\r\n                                    ? `Connected to ${wifiState.ssid}`\r\n                                    : 'Disconnected'}\r\n                            </span>\r\n                        </div>\r\n                        {wifiState.status === 'WL_CONNECTED' && (\r\n                            <button\r\n                                onClick={handleDisconnect}\r\n                                className=\"text-xs text-ide-error hover:underline\"\r\n                            >\r\n                                Disconnect\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* IP Info */}\r\n                    {wifiState.status === 'WL_CONNECTED' && (\r\n                        <div className=\"text-xs text-ide-text-muted space-y-1 bg-ide-bg rounded p-2\">\r\n                            <div>IP: {wifiState.localIP}</div>\r\n                            <div>Gateway: {wifiState.gatewayIP}</div>\r\n                            <div>RSSI: {wifiState.rssi} dBm</div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Network List */}\r\n                    <div>\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                            <span className=\"text-xs font-medium text-ide-text\">Available Networks</span>\r\n                            <button\r\n                                onClick={handleScan}\r\n                                disabled={wifiState.isScanning}\r\n                                className=\"p-1 text-ide-text-muted hover:text-ide-text disabled:opacity-50\"\r\n                            >\r\n                                <RefreshCw className={cn('h-3.5 w-3.5', wifiState.isScanning && 'animate-spin')} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-1\">\r\n                            {wifiState.availableNetworks.map((network) => (\r\n                                <button\r\n                                    key={network.ssid}\r\n                                    onClick={() => setSelectedSSID(network.ssid)}\r\n                                    className={cn(\r\n                                        'w-full flex items-center justify-between p-2 rounded text-left transition-colors',\r\n                                        selectedSSID === network.ssid\r\n                                            ? 'bg-ide-accent/20 border border-ide-accent'\r\n                                            : 'bg-ide-bg hover:bg-ide-panel-hover'\r\n                                    )}\r\n                                >\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        {network.encryption === 'OPEN' ? (\r\n                                            <Unlock className=\"h-3 w-3 text-ide-text-muted\" />\r\n                                        ) : (\r\n                                            <Lock className=\"h-3 w-3 text-ide-text-muted\" />\r\n                                        )}\r\n                                        <span className=\"text-xs text-ide-text\">{network.ssid}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        <Signal className=\"h-3 w-3 text-ide-text-muted\" />\r\n                                        <span className=\"text-xs text-ide-text-muted\">{network.rssi} dBm</span>\r\n                                    </div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Connect Form */}\r\n                    {selectedSSID && (\r\n                        <div className=\"space-y-2 pt-2 border-t border-ide-border\">\r\n                            <div className=\"text-xs text-ide-text\">Connect to: {selectedSSID}</div>\r\n                            <input\r\n                                type=\"password\"\r\n                                placeholder=\"Password (or leave empty for open)\"\r\n                                value={password}\r\n                                onChange={(e) => setPassword(e.target.value)}\r\n                                className=\"w-full px-2 py-1.5 text-xs bg-ide-bg border border-ide-border rounded text-ide-text focus:outline-none focus:border-ide-accent\"\r\n                            />\r\n                            <button\r\n                                onClick={handleConnect}\r\n                                className=\"w-full py-1.5 text-xs bg-ide-accent text-white rounded hover:bg-ide-accent/80 transition-colors\"\r\n                            >\r\n                                Connect\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* MQTT Tab */}\r\n            {activeTab === 'mqtt' && mqttState && (\r\n                <div className=\"flex-1 overflow-auto p-3 space-y-3\">\r\n                    {/* Connection Status */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className={cn(\r\n                                'h-2 w-2 rounded-full',\r\n                                mqttState.connected ? 'bg-ide-success' : 'bg-ide-text-muted'\r\n                            )} />\r\n                            <span className=\"text-sm text-ide-text\">\r\n                                {mqttState.connected ? 'Connected' : 'Disconnected'}\r\n                            </span>\r\n                        </div>\r\n                        {mqttState.connected ? (\r\n                            <button\r\n                                onClick={handleMqttDisconnect}\r\n                                className=\"text-xs text-ide-error hover:underline\"\r\n                            >\r\n                                Disconnect\r\n                            </button>\r\n                        ) : (\r\n                            <button\r\n                                onClick={handleMqttConnect}\r\n                                className=\"text-xs text-ide-accent hover:underline\"\r\n                            >\r\n                                Connect\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {mqttState.connected && (\r\n                        <>\r\n                            {/* Broker Info */}\r\n                            <div className=\"text-xs text-ide-text-muted bg-ide-bg rounded p-2\">\r\n                                <div>Broker: {mqttState.broker}</div>\r\n                                <div>Client: {mqttState.clientId}</div>\r\n                            </div>\r\n\r\n                            {/* Topic Input */}\r\n                            <div className=\"space-y-2\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Topic (e.g., sensors/temp)\"\r\n                                    value={mqttTopic}\r\n                                    onChange={(e) => setMqttTopic(e.target.value)}\r\n                                    className=\"w-full px-2 py-1.5 text-xs bg-ide-bg border border-ide-border rounded text-ide-text focus:outline-none focus:border-ide-accent\"\r\n                                />\r\n                                <button\r\n                                    onClick={handleSubscribe}\r\n                                    disabled={!mqttTopic}\r\n                                    className=\"w-full py-1 text-xs bg-ide-panel-hover text-ide-text rounded hover:bg-ide-border disabled:opacity-50 transition-colors\"\r\n                                >\r\n                                    Subscribe\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Publish */}\r\n                            <div className=\"space-y-2 pt-2 border-t border-ide-border\">\r\n                                <span className=\"text-xs font-medium text-ide-text\">Publish</span>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Message\"\r\n                                    value={mqttMessage}\r\n                                    onChange={(e) => setMqttMessage(e.target.value)}\r\n                                    className=\"w-full px-2 py-1.5 text-xs bg-ide-bg border border-ide-border rounded text-ide-text focus:outline-none focus:border-ide-accent\"\r\n                                />\r\n                                <button\r\n                                    onClick={handlePublish}\r\n                                    disabled={!mqttTopic || !mqttMessage}\r\n                                    className=\"w-full flex items-center justify-center gap-1 py-1.5 text-xs bg-ide-accent text-white rounded hover:bg-ide-accent/80 disabled:opacity-50 transition-colors\"\r\n                                >\r\n                                    <Send className=\"h-3 w-3\" />\r\n                                    Publish\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Subscriptions */}\r\n                            {mqttState.subscriptions.length > 0 && (\r\n                                <div className=\"space-y-1 pt-2 border-t border-ide-border\">\r\n                                    <span className=\"text-xs font-medium text-ide-text\">Subscriptions</span>\r\n                                    {mqttState.subscriptions.map((topic) => (\r\n                                        <div key={topic} className=\"text-xs text-ide-text-muted bg-ide-bg rounded px-2 py-1\">\r\n                                            {topic}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Recent Messages */}\r\n                            {mqttState.publishedMessages.length > 0 && (\r\n                                <div className=\"space-y-1 pt-2 border-t border-ide-border\">\r\n                                    <span className=\"text-xs font-medium text-ide-text\">Recent Messages</span>\r\n                                    <div className=\"max-h-32 overflow-auto space-y-1\">\r\n                                        {mqttState.publishedMessages.slice(-5).reverse().map((msg, idx) => (\r\n                                            <div key={idx} className=\"text-xs bg-ide-bg rounded px-2 py-1\">\r\n                                                <span className=\"text-ide-accent\">{msg.topic}</span>\r\n                                                <span className=\"text-ide-text-muted\">  </span>\r\n                                                <span className=\"text-ide-text\">\r\n                                                    {typeof msg.payload === 'string' ? msg.payload : '[binary]'}\r\n                                                </span>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default NetworkPanel;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8740, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/terminal/TerminalPanel.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Terminal, Bot, Activity, Wifi } from 'lucide-react'\r\nimport { CommandInterface } from './CommandInterface'\r\nimport { SerialMonitor } from './SerialMonitor'\r\nimport { LogicAnalyzerPanel } from '@/components/LogicAnalyzerPanel'\r\nimport { NetworkPanel } from '@/components/NetworkPanel'\r\nimport { cn } from '@/utils/cn'\r\n\r\ntype TerminalTab = 'serial' | 'assistant' | 'logic' | 'network'\r\n\r\ninterface TerminalPanelProps {\r\n  serialOutput: string[]\r\n  onClearSerial: () => void\r\n  isSimulationRunning: boolean\r\n  /** Optional callback to send input to simulation serial RX */\r\n  onSendSerialInput?: (text: string) => void\r\n  /** Current board type (for network panel) */\r\n  boardType?: string\r\n}\r\n\r\nexport function TerminalPanel({\r\n  serialOutput,\r\n  onClearSerial,\r\n  isSimulationRunning,\r\n  onSendSerialInput,\r\n  boardType,\r\n}: TerminalPanelProps) {\r\n  const [activeTab, setActiveTab] = useState<TerminalTab>('assistant')\r\n\r\n  const isESP32 = boardType?.toLowerCase().includes('esp32')\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden bg-ide-panel-bg\">\r\n      {/* Tab header */}\r\n      <div className=\"flex h-9 shrink-0 items-center border-b border-ide-border bg-ide-panel-surface overflow-x-auto\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setActiveTab('serial')}\r\n          className={cn(\r\n            'flex h-full items-center gap-1.5 px-3 text-xs font-medium transition-colors whitespace-nowrap',\r\n            activeTab === 'serial'\r\n              ? 'border-b-2 border-ide-success text-ide-success'\r\n              : 'text-ide-text-muted hover:text-ide-text'\r\n          )}\r\n        >\r\n          <Terminal className=\"h-3.5 w-3.5\" />\r\n          <span>Serial</span>\r\n          {isSimulationRunning && (\r\n            <span className=\"ml-1 h-1.5 w-1.5 animate-pulse rounded-full bg-ide-success\" />\r\n          )}\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setActiveTab('assistant')}\r\n          className={cn(\r\n            'flex h-full items-center gap-1.5 px-3 text-xs font-medium transition-colors whitespace-nowrap',\r\n            activeTab === 'assistant'\r\n              ? 'border-b-2 border-ide-accent text-ide-accent'\r\n              : 'text-ide-text-muted hover:text-ide-text'\r\n          )}\r\n        >\r\n          <Bot className=\"h-3.5 w-3.5\" />\r\n          <span>AI Assistant </span>\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setActiveTab('logic')}\r\n          className={cn(\r\n            'flex h-full items-center gap-1.5 px-3 text-xs font-medium transition-colors whitespace-nowrap',\r\n            activeTab === 'logic'\r\n              ? 'border-b-2 border-yellow-500 text-yellow-500'\r\n              : 'text-ide-text-muted hover:text-ide-text'\r\n          )}\r\n        >\r\n          <Activity className=\"h-3.5 w-3.5\" />\r\n          <span>Logic Analyzer</span>\r\n        </button>\r\n        {isESP32 && (\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setActiveTab('network')}\r\n            className={cn(\r\n              'flex h-full items-center gap-1.5 px-3 text-xs font-medium transition-colors whitespace-nowrap',\r\n              activeTab === 'network'\r\n                ? 'border-b-2 border-cyan-500 text-cyan-500'\r\n                : 'text-ide-text-muted hover:text-ide-text'\r\n            )}\r\n          >\r\n            <Wifi className=\"h-3.5 w-3.5\" />\r\n            <span>Network</span>\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Tab content */}\r\n      <div className=\"min-h-0 flex-1\">\r\n        {activeTab === 'serial' && (\r\n          <SerialMonitor\r\n            serialOutput={serialOutput}\r\n            onClear={onClearSerial}\r\n            isRunning={isSimulationRunning}\r\n            onSendInput={onSendSerialInput}\r\n          />\r\n        )}\r\n        {activeTab === 'assistant' && (\r\n          <CommandInterface />\r\n        )}\r\n        {activeTab === 'logic' && (\r\n          <LogicAnalyzerPanel />\r\n        )}\r\n        {activeTab === 'network' && (\r\n          <NetworkPanel boardType={boardType} />\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;;AAsBO,SAAS,cAAc,EAC5B,YAAY,EACZ,aAAa,EACb,mBAAmB,EACnB,iBAAiB,EACjB,SAAS,EACU;;IACnB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAc;IAExD,MAAM,UAAU,WAAW,cAAc,SAAS;IAElD,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,aAAa;wBAC5B,WAAW,IAAA,oHAAE,EACX,iGACA,cAAc,WACV,mDACA;;0CAGN,6LAAC,yNAAQ;gCAAC,WAAU;;;;;;0CACpB,6LAAC;0CAAK;;;;;;4BACL,qCACC,6LAAC;gCAAK,WAAU;;;;;;;;;;;;kCAGpB,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,aAAa;wBAC5B,WAAW,IAAA,oHAAE,EACX,iGACA,cAAc,cACV,iDACA;;0CAGN,6LAAC,0MAAG;gCAAC,WAAU;;;;;;0CACf,6LAAC;0CAAK;;;;;;;;;;;;kCAER,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,aAAa;wBAC5B,WAAW,IAAA,oHAAE,EACX,iGACA,cAAc,UACV,iDACA;;0CAGN,6LAAC,yNAAQ;gCAAC,WAAU;;;;;;0CACpB,6LAAC;0CAAK;;;;;;;;;;;;oBAEP,yBACC,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,aAAa;wBAC5B,WAAW,IAAA,oHAAE,EACX,iGACA,cAAc,YACV,6CACA;;0CAGN,6LAAC,6MAAI;gCAAC,WAAU;;;;;;0CAChB,6LAAC;0CAAK;;;;;;;;;;;;;;;;;;0BAMZ,6LAAC;gBAAI,WAAU;;oBACZ,cAAc,0BACb,6LAAC,4JAAa;wBACZ,cAAc;wBACd,SAAS;wBACT,WAAW;wBACX,aAAa;;;;;;oBAGhB,cAAc,6BACb,6LAAC,kKAAgB;;;;;oBAElB,cAAc,yBACb,6LAAC,0JAAkB;;;;;oBAEpB,cAAc,2BACb,6LAAC,8IAAY;wBAAC,WAAW;;;;;;;;;;;;;;;;;;AAKnC;GAhGgB;KAAA"}},
    {"offset": {"line": 8942, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/terminal/index.ts"],"sourcesContent":["export { CommandInterface } from './CommandInterface'\r\nexport { SerialMonitor } from './SerialMonitor'\r\nexport { TerminalPanel } from './TerminalPanel'\r\n"],"names":[],"mappings":";AAAA;AACA;AACA"}},
    {"offset": {"line": 8956, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/hooks/useDiagramSync.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useMemo, useRef } from 'react';\r\nimport { useAppStore } from '@/store/useAppStore';\r\nimport { WOKWI_PARTS } from '@/lib/wokwiParts';\r\n\r\nfunction resolveWokwiType(type: string): string {\r\n  const cfg = (WOKWI_PARTS as Record<string, { element: string } | undefined>)[type];\r\n  if (cfg?.element) return cfg.element;\r\n  if (type.startsWith('wokwi-')) return type;\r\n  return type;\r\n}\r\n\r\nexport function useDiagramSync() {\r\n  const circuitParts = useAppStore((s) => s.circuitParts);\r\n  const connections = useAppStore((s) => s.connections);\r\n  const setDiagramJson = useAppStore((s) => s.setDiagramJson);\r\n\r\n  // Memoize the JSON string directly to prevent unnecessary re-serialization\r\n  const diagramJson = useMemo(() => {\r\n    const diagram = {\r\n      version: 1,\r\n      parts: circuitParts.map((p) => ({\r\n        id: p.id,\r\n        type: resolveWokwiType(p.type),\r\n        top: Math.round(p.position.y),\r\n        left: Math.round(p.position.x),\r\n        rotate: p.rotate ?? 0,\r\n        attrs: p.attrs ?? {},\r\n      })),\r\n      connections: connections.map((c) => [\r\n        `${c.from.partId}:${c.from.pinId}`,\r\n        `${c.to.partId}:${c.to.pinId}`,\r\n        c.color,\r\n        [],\r\n      ]),\r\n    };\r\n    return JSON.stringify(diagram, null, 2);\r\n  }, [circuitParts, connections]);\r\n\r\n  // Track previous value to prevent unnecessary updates\r\n  const prevJsonRef = useRef<string>('');\r\n\r\n  useEffect(() => {\r\n    if (diagramJson !== prevJsonRef.current) {\r\n      prevJsonRef.current = diagramJson;\r\n      setDiagramJson(diagramJson);\r\n    }\r\n  }, [diagramJson, setDiagramJson]);\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAMA,SAAS,iBAAiB,IAAY;IACpC,MAAM,MAAM,AAAC,mIAAW,AAAoD,CAAC,KAAK;IAClF,IAAI,KAAK,SAAS,OAAO,IAAI,OAAO;IACpC,IAAI,KAAK,UAAU,CAAC,WAAW,OAAO;IACtC,OAAO;AACT;AAEO,SAAS;;IACd,MAAM,eAAe,IAAA,sIAAW;oDAAC,CAAC,IAAM,EAAE,YAAY;;IACtD,MAAM,cAAc,IAAA,sIAAW;mDAAC,CAAC,IAAM,EAAE,WAAW;;IACpD,MAAM,iBAAiB,IAAA,sIAAW;sDAAC,CAAC,IAAM,EAAE,cAAc;;IAE1D,2EAA2E;IAC3E,MAAM,cAAc,IAAA,wKAAO;+CAAC;YAC1B,MAAM,UAAU;gBACd,SAAS;gBACT,OAAO,aAAa,GAAG;2DAAC,CAAC,IAAM,CAAC;4BAC9B,IAAI,EAAE,EAAE;4BACR,MAAM,iBAAiB,EAAE,IAAI;4BAC7B,KAAK,KAAK,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;4BAC5B,MAAM,KAAK,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;4BAC7B,QAAQ,EAAE,MAAM,IAAI;4BACpB,OAAO,EAAE,KAAK,IAAI,CAAC;wBACrB,CAAC;;gBACD,aAAa,YAAY,GAAG;2DAAC,CAAC,IAAM;4BAClC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,EAAE;4BAClC,GAAG,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,KAAK,EAAE;4BAC9B,EAAE,KAAK;4BACP,EAAE;yBACH;;YACH;YACA,OAAO,KAAK,SAAS,CAAC,SAAS,MAAM;QACvC;8CAAG;QAAC;QAAc;KAAY;IAE9B,sDAAsD;IACtD,MAAM,cAAc,IAAA,uKAAM,EAAS;IAEnC,IAAA,0KAAS;oCAAC;YACR,IAAI,gBAAgB,YAAY,OAAO,EAAE;gBACvC,YAAY,OAAO,GAAG;gBACtB,eAAe;YACjB;QACF;mCAAG;QAAC;QAAa;KAAe;AAClC;GApCgB;;QACO,sIAAW;QACZ,sIAAW;QACR,sIAAW"}},
    {"offset": {"line": 9043, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/hooks/useSimulation.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport {\r\n  AVRIOPort,\r\n  AVRClock,\r\n  AVRTimer,\r\n  AVRUSART,\r\n  CPU,\r\n  avrInstruction,\r\n  portBConfig,\r\n  portDConfig,\r\n  timer0Config,\r\n  usart0Config,\r\n  type GPIOListener,\r\n} from 'avr8js';\r\n\r\ntype PinStates = Record<number, boolean>;\r\n\r\nfunction decodeBase64ToBytes(base64: string): Uint8Array {\r\n  const normalized = base64.trim();\r\n  const binary = atob(normalized);\r\n  const bytes = new Uint8Array(binary.length);\r\n  for (let i = 0; i < binary.length; i++) {\r\n    bytes[i] = binary.charCodeAt(i);\r\n  }\r\n  return bytes;\r\n}\r\n\r\nfunction decodeBase64ToString(base64: string): string {\r\n  return new TextDecoder('utf-8').decode(decodeBase64ToBytes(base64));\r\n}\r\n\r\nfunction looksLikeIntelHex(text: string): boolean {\r\n  // Intel HEX files are text lines starting with ':'\r\n  const t = text.trimStart();\r\n  return t.startsWith(':');\r\n}\r\n\r\nfunction parseIntelHex(hex: string): Uint16Array {\r\n  // Minimal Intel HEX parser with support for:\r\n  // - 00: Data records\r\n  // - 01: End of file\r\n  // - 04: Extended linear address\r\n  let upper = 0;\r\n  const mem = new Map<number, number>();\r\n  let maxAddr = 0;\r\n\r\n  const lines = hex.split(/\\r?\\n/);\r\n  for (const rawLine of lines) {\r\n    const line = rawLine.trim();\r\n    if (!line || !line.startsWith(':')) continue;\r\n\r\n    const byteCount = Number.parseInt(line.slice(1, 3), 16);\r\n    const addr16 = Number.parseInt(line.slice(3, 7), 16);\r\n    const recordType = Number.parseInt(line.slice(7, 9), 16);\r\n    const data = line.slice(9, 9 + byteCount * 2);\r\n\r\n    if (recordType === 0x00) {\r\n      const base = (upper << 16) + addr16;\r\n      for (let i = 0; i < byteCount; i++) {\r\n        const b = Number.parseInt(data.slice(i * 2, i * 2 + 2), 16);\r\n        const addr = base + i;\r\n        mem.set(addr, b);\r\n        if (addr + 1 > maxAddr) maxAddr = addr + 1;\r\n      }\r\n    } else if (recordType === 0x01) {\r\n      break;\r\n    } else if (recordType === 0x04) {\r\n      upper = Number.parseInt(data, 16);\r\n    }\r\n  }\r\n\r\n  const byteLength = maxAddr % 2 === 0 ? maxAddr : maxAddr + 1;\r\n  const progBytes = new Uint8Array(byteLength);\r\n  for (const [addr, value] of mem.entries()) {\r\n    if (addr >= 0 && addr < progBytes.length) progBytes[addr] = value;\r\n  }\r\n\r\n  const words = new Uint16Array(progBytes.length / 2);\r\n  for (let i = 0; i < words.length; i++) {\r\n    const lo = progBytes[i * 2];\r\n    const hi = progBytes[i * 2 + 1];\r\n    words[i] = lo | (hi << 8);\r\n  }\r\n  return words;\r\n}\r\n\r\nclass AVRRunner {\r\n  readonly cpu: CPU;\r\n  readonly portB: AVRIOPort;\r\n  readonly portD: AVRIOPort;\r\n  readonly clock: AVRClock;\r\n  readonly timer0: AVRTimer;\r\n  readonly usart: AVRUSART;\r\n\r\n  constructor(hexText: string) {\r\n    const program = parseIntelHex(hexText);\r\n    this.cpu = new CPU(program);\r\n    this.portB = new AVRIOPort(this.cpu, portBConfig);\r\n    this.portD = new AVRIOPort(this.cpu, portDConfig);\r\n\r\n    // Provide basic Arduino timing (millis/delay rely on timer0 on Uno).\r\n    this.clock = new AVRClock(this.cpu, 16_000_000);\r\n    this.timer0 = new AVRTimer(this.cpu, timer0Config);\r\n\r\n    // USART for Serial communication\r\n    this.usart = new AVRUSART(this.cpu, usart0Config, 16_000_000);\r\n  }\r\n}\r\n\r\n// PWM state for analog output (0-255 duty cycle)\r\ntype PwmStates = Record<number, number>;\r\n\r\nexport type UseSimulationControls = {\r\n  run: () => void;\r\n  stop: () => void;\r\n  pause: () => void;\r\n  isRunning: boolean;\r\n  pinStates: PinStates;\r\n  pwmStates: PwmStates;\r\n  serialOutput: string[];\r\n  clearSerialOutput: () => void;\r\n};\r\n\r\nfunction isAvrPart(partType: string): boolean {\r\n  return (\r\n    partType === 'wokwi-arduino-uno' ||\r\n    partType === 'wokwi-arduino-nano' ||\r\n    partType === 'wokwi-arduino-mega'\r\n  );\r\n}\r\n\r\n// Arduino Uno PWM pins and their timer/OCR register mappings\r\nconst PWM_PIN_CONFIGS: Record<number, { timer: string; ocrOffset: number }> = {\r\n  3: { timer: 'timer2', ocrOffset: 0xB4 },  // OC2B - OCR2B\r\n  5: { timer: 'timer0', ocrOffset: 0x47 },  // OC0B - OCR0B\r\n  6: { timer: 'timer0', ocrOffset: 0x47 },  // OC0A - OCR0A (note: shares with 5)\r\n  9: { timer: 'timer1', ocrOffset: 0x88 },  // OC1A - OCR1AL\r\n  10: { timer: 'timer1', ocrOffset: 0x8A }, // OC1B - OCR1BL\r\n  11: { timer: 'timer2', ocrOffset: 0xB3 }, // OC2A - OCR2A\r\n};\r\n\r\nexport function useSimulation(hexData: string | null | undefined, partType: string): UseSimulationControls {\r\n  const [isRunning, setIsRunning] = useState(false);\r\n  const [pinStates, setPinStates] = useState<PinStates>({});\r\n  const [pwmStates, setPwmStates] = useState<PwmStates>({});\r\n  const [serialOutput, setSerialOutput] = useState<string[]>([]);\r\n\r\n  const runnerRef = useRef<AVRRunner | null>(null);\r\n  const rafRef = useRef<number | null>(null);\r\n  const runningRef = useRef(false);\r\n  const serialBufferRef = useRef<string>('');\r\n  const stepFrameRef = useRef<() => void>(() => { });\r\n\r\n  const cyclesPerFrame = useMemo(() => Math.floor(16_000_000 / 60), []);\r\n\r\n  const clearSerialOutput = useCallback(() => {\r\n    setSerialOutput([]);\r\n    serialBufferRef.current = '';\r\n  }, []);\r\n\r\n  const appendSerialLine = useCallback((line: string) => {\r\n    if (!line) return;\r\n    setSerialOutput((prev) => [...prev, line]);\r\n  }, []);\r\n\r\n  const updatePortPins = useCallback((port: 'B' | 'D', value: number) => {\r\n    setPinStates((prev) => {\r\n      const next: PinStates = { ...prev };\r\n      if (port === 'D') {\r\n        // PORTD bits 0-7 -> Digital 0-7\r\n        for (let bit = 0; bit < 8; bit++) {\r\n          const pin = bit;\r\n          next[pin] = (value & (1 << bit)) !== 0;\r\n        }\r\n      } else {\r\n        // PORTB bits 0-5 -> Digital 8-13\r\n        for (let bit = 0; bit < 6; bit++) {\r\n          const pin = 8 + bit;\r\n          next[pin] = (value & (1 << bit)) !== 0;\r\n        }\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  // Read PWM duty cycle values from timer OCR registers\r\n  const updatePwmStates = useCallback((runner: AVRRunner) => {\r\n    setPwmStates((prev) => {\r\n      const next: PwmStates = { ...prev };\r\n      // Read OCR values for PWM pins\r\n      // Pin 3: OC2B - OCR2B at 0xB4\r\n      // Pin 5: OC0B - OCR0B at 0x48\r\n      // Pin 6: OC0A - OCR0A at 0x47\r\n      // Pin 9: OC1A - OCR1AL at 0x88\r\n      // Pin 10: OC1B - OCR1BL at 0x8A\r\n      // Pin 11: OC2A - OCR2A at 0xB3\r\n      try {\r\n        const data = runner.cpu.data;\r\n        next[3] = data[0xB4] ?? 0;   // OCR2B\r\n        next[5] = data[0x48] ?? 0;   // OCR0B\r\n        next[6] = data[0x47] ?? 0;   // OCR0A\r\n        next[9] = data[0x88] ?? 0;   // OCR1AL (low byte)\r\n        next[10] = data[0x8A] ?? 0;  // OCR1BL (low byte)\r\n        next[11] = data[0xB3] ?? 0;  // OCR2A\r\n      } catch {\r\n        // Ignore errors reading CPU data\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  // Debug: Log pin state changes\r\n  useEffect(() => {\r\n    const activeStates = Object.entries(pinStates).filter(([, v]) => v);\r\n    if (activeStates.length > 0) {\r\n      console.log('[Simulation] Active pins (HIGH):', Object.fromEntries(activeStates));\r\n    }\r\n  }, [pinStates]);\r\n\r\n  // Update the step function ref in an effect to avoid stale closure issues\r\n  useEffect(() => {\r\n    stepFrameRef.current = () => {\r\n      if (!runningRef.current) return;\r\n      const runner = runnerRef.current;\r\n      if (!runner) return;\r\n\r\n      // Run ~16MHz/60fps CPU cycles each frame.\r\n      let remaining = cyclesPerFrame;\r\n      while (remaining > 0) {\r\n        const before = runner.cpu.cycles;\r\n        avrInstruction(runner.cpu);\r\n\r\n        // Process timers/USART clock events and interrupts.\r\n        // Without ticking, Arduino time functions (millis/delay) and Serial output won't work.\r\n        const cpuAny = runner.cpu as unknown as {\r\n          cycles: number;\r\n          tick: () => void;\r\n          nextClockEvent: { cycles: number } | null;\r\n          nextInterrupt: number;\r\n          interruptsEnabled: boolean;\r\n        };\r\n\r\n        // Drain due clock events/interrupts for the current cycle.\r\n        // Safety cap avoids infinite loops if a peripheral misbehaves.\r\n        for (let i = 0; i < 32; i++) {\r\n          const dueEvent = cpuAny.nextClockEvent && cpuAny.nextClockEvent.cycles <= cpuAny.cycles;\r\n          const dueInterrupt = cpuAny.interruptsEnabled && cpuAny.nextInterrupt >= 0;\r\n          if (!dueEvent && !dueInterrupt) break;\r\n          cpuAny.tick();\r\n        }\r\n\r\n        const delta = runner.cpu.cycles - before;\r\n        remaining -= delta > 0 ? delta : 1;\r\n      }\r\n\r\n      // Update PWM states once per frame (not every instruction)\r\n      updatePwmStates(runner);\r\n\r\n      rafRef.current = requestAnimationFrame(stepFrameRef.current);\r\n    };\r\n  }, [cyclesPerFrame, updatePwmStates]);\r\n\r\n  const stepFrame = useCallback(() => {\r\n    stepFrameRef.current();\r\n  }, []);\r\n\r\n  const stop = useCallback(() => {\r\n    runningRef.current = false;\r\n    setIsRunning(false);\r\n\r\n    if (rafRef.current != null) {\r\n      cancelAnimationFrame(rafRef.current);\r\n      rafRef.current = null;\r\n    }\r\n\r\n    runnerRef.current = null;\r\n    setPinStates({});\r\n    setPwmStates({});\r\n    setSerialOutput([]);\r\n    serialBufferRef.current = '';\r\n  }, []);\r\n\r\n  const pause = useCallback(() => {\r\n    runningRef.current = false;\r\n    setIsRunning(false);\r\n\r\n    if (rafRef.current != null) {\r\n      cancelAnimationFrame(rafRef.current);\r\n      rafRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const run = useCallback(() => {\r\n    console.log('[Simulation] Run requested', { hasHex: !!hexData, partType });\r\n    if (!hexData) {\r\n      console.warn('[Simulation] No HEX data available');\r\n      appendSerialLine('[Simulation] No compiled program available. Click Run to compile first.');\r\n      return;\r\n    }\r\n    if (!isAvrPart(partType)) {\r\n      console.warn('[Simulation] Unsupported part type for AVR simulation:', partType);\r\n      // avr8js only simulates AVR8 cores; ESP32 is not supported here.\r\n      appendSerialLine(\r\n        `[Simulation] Board '${partType}' is not supported by the in-browser simulator (AVR only: Uno/Nano/Mega).`\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (!runnerRef.current) {\r\n      try {\r\n        let decodedText: string;\r\n        try {\r\n          decodedText = decodeBase64ToString(hexData);\r\n        } catch (e) {\r\n          const msg = e instanceof Error ? e.message : String(e);\r\n          console.error('[Simulation] Base64 decode failed:', msg);\r\n          appendSerialLine(`[Simulation] Failed to decode compiled artifact: ${msg}`);\r\n          return;\r\n        }\r\n\r\n        if (!looksLikeIntelHex(decodedText)) {\r\n          // When compiling for non-AVR targets, the backend returns a binary (.bin) artifact.\r\n          // Even if the board string is AVR, this provides a clear signal to the user.\r\n          console.warn('[Simulation] Decoded artifact is not Intel HEX.');\r\n          appendSerialLine(\r\n            '[Simulation] Compiled output is not an Intel HEX file. Browser simulation currently supports AVR boards only.'\r\n          );\r\n          return;\r\n        }\r\n\r\n        const hexText = decodedText;\r\n        const runner = new AVRRunner(hexText);\r\n\r\n        const onPortB: GPIOListener = (value) => updatePortPins('B', value);\r\n        const onPortD: GPIOListener = (value) => updatePortPins('D', value);\r\n        runner.portB.addListener(onPortB);\r\n        runner.portD.addListener(onPortD);\r\n\r\n        // Listen for USART byte transmissions (Serial.print output)\r\n        runner.usart.onByteTransmit = (byte: number) => {\r\n          const char = String.fromCharCode(byte);\r\n          serialBufferRef.current += char;\r\n\r\n          // When we see a newline, flush the buffer as a new line\r\n          if (char === '\\n') {\r\n            const line = serialBufferRef.current.trimEnd();\r\n            if (line) {\r\n              setSerialOutput((prev) => [...prev, line]);\r\n            }\r\n            serialBufferRef.current = '';\r\n          }\r\n        };\r\n\r\n        // Initialize state from current registers\r\n        updatePortPins('B', runner.cpu.data[portBConfig.PORT]);\r\n        updatePortPins('D', runner.cpu.data[portDConfig.PORT]);\r\n\r\n        runnerRef.current = runner;\r\n        console.log('[Simulation] AVR Runner initialized successfully');\r\n        appendSerialLine('[Simulation] Started (AVR8js)');\r\n      } catch (err) {\r\n        console.error('[Simulation] Failed to initialize AVR runner:', err);\r\n        const msg = err instanceof Error ? err.message : String(err);\r\n        appendSerialLine(`[Simulation] Failed to start: ${msg}`);\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (runningRef.current) return;\r\n    runningRef.current = true;\r\n    setIsRunning(true);\r\n    rafRef.current = requestAnimationFrame(stepFrame);\r\n  }, [appendSerialLine, hexData, partType, stepFrame, updatePortPins]);\r\n\r\n  useEffect(() => {\r\n    // Reset simulation when program/target changes.\r\n    stop();\r\n  }, [hexData, partType, stop]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      stop();\r\n    };\r\n  }, [stop]);\r\n\r\n  return { run, stop, pause, isRunning, pinStates, pwmStates, serialOutput, clearSerialOutput };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9467, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/app/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react'\r\nimport Link from 'next/link'\r\nimport {\r\n  ChevronDown,\r\n  ChevronUp,\r\n  FileCode,\r\n  FolderOpen,\r\n  FolderTree,\r\n  Layers,\r\n  Maximize2,\r\n  PanelLeftClose,\r\n  PanelLeftOpen,\r\n  Play,\r\n  Plus,\r\n  RotateCcw,\r\n  Settings,\r\n  Share2,\r\n  Square,\r\n  Trash2,\r\n  X,\r\n  ZoomIn,\r\n  ZoomOut,\r\n  Eye,\r\n  EyeOff,\r\n  Github,\r\n} from 'lucide-react'\r\nimport {\r\n  Panel,\r\n  PanelGroup,\r\n  PanelResizeHandle,\r\n} from 'react-resizable-panels'\r\nimport {\r\n  addEdge,\r\n  Background,\r\n  BackgroundVariant,\r\n  Controls,\r\n  ReactFlow,\r\n  ReactFlowProvider,\r\n  useStore,\r\n  useEdgesState,\r\n  useNodesState,\r\n  useReactFlow,\r\n  type Connection,\r\n  type Edge,\r\n  type Node,\r\n  type NodeTypes,\r\n} from '@xyflow/react'\r\n\r\nimport ArduinoNode from '@/components/nodes/ArduinoNode'\r\nimport WokwiPartNode from '@/components/nodes/WokwiPartNode'\r\nimport ComponentLibrary, { FUNDI_PART_MIME } from '@/components/ComponentLibrary'\r\nimport StatusBadge from '@/components/StatusBadge'\r\nimport SelectionOverlay from '@/components/SelectionOverlay'\r\nimport WiringLayer from '@/components/WiringLayer'\r\nimport { TerminalPanel } from '@/components/terminal'\r\nimport { useDiagramSync } from '@/hooks/useDiagramSync'\r\nimport { useSimulation } from '@/hooks/useSimulation'\r\nimport { useAppStore, type ProjectFile } from '@/store/useAppStore'\r\nimport type { WirePoint } from '@/types/wire'\r\nimport { cn } from '@/utils/cn'\r\n\r\nconst nodeTypes = {\r\n  arduino: ArduinoNode,\r\n  wokwi: WokwiPartNode,\r\n} satisfies NodeTypes\r\n\r\nfunction translatePoints(points: WirePoint[] | undefined, delta: WirePoint): WirePoint[] | undefined {\r\n  if (!points?.length) return points\r\n  return points.map((p) => ({ x: p.x + delta.x, y: p.y + delta.y }))\r\n}\r\n\r\n/* ============================================\r\n   Canvas Toolbar Overlay\r\n   ============================================ */\r\nfunction CanvasToolbar({\r\n  onZoomIn,\r\n  onZoomOut,\r\n  onFitView,\r\n  onResetView,\r\n}: {\r\n  onZoomIn: () => void\r\n  onZoomOut: () => void\r\n  onFitView: () => void\r\n  onResetView: () => void\r\n}) {\r\n  return (\r\n    <div className=\"absolute top-4 right-4 z-40 flex items-center gap-1 glass-panel rounded-lg p-1\">\r\n      <button\r\n        type=\"button\"\r\n        onClick={onZoomIn}\r\n        className=\"flex h-8 w-8 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n        title=\"Zoom In\"\r\n      >\r\n        <ZoomIn className=\"h-4 w-4\" />\r\n      </button>\r\n      <button\r\n        type=\"button\"\r\n        onClick={onZoomOut}\r\n        className=\"flex h-8 w-8 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n        title=\"Zoom Out\"\r\n      >\r\n        <ZoomOut className=\"h-4 w-4\" />\r\n      </button>\r\n      <div className=\"mx-1 h-5 w-px bg-ide-border\" />\r\n      <button\r\n        type=\"button\"\r\n        onClick={onFitView}\r\n        className=\"flex h-8 w-8 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n        title=\"Fit View\"\r\n      >\r\n        <Maximize2 className=\"h-4 w-4\" />\r\n      </button>\r\n      <button\r\n        type=\"button\"\r\n        onClick={onResetView}\r\n        className=\"flex h-8 w-8 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n        title=\"Reset View\"\r\n      >\r\n        <RotateCcw className=\"h-4 w-4\" />\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Unified Action Bar (Command Center)\r\n   ============================================ */\r\nfunction UnifiedActionBar({\r\n  isCompiling,\r\n  compilationError,\r\n  onRun,\r\n  hasProgram,\r\n  isRunning,\r\n  onStop,\r\n}: {\r\n  isCompiling: boolean\r\n  compilationError: string | null\r\n  onRun: () => void\r\n  hasProgram: boolean\r\n  isRunning: boolean\r\n  onStop: () => void\r\n}) {\r\n  return (\r\n    <div className=\"absolute bottom-6 left-1/2 z-50 -translate-x-1/2 animate-slide-up\">\r\n      <div className=\"floating-bar flex items-center gap-2 px-3 py-2\">\r\n        {/* Primary Run Button */}\r\n        <button\r\n          type=\"button\"\r\n          onClick={onRun}\r\n          disabled={isCompiling}\r\n          className={cn(\r\n            'group relative flex items-center gap-2 rounded-lg px-4 py-2',\r\n            'text-sm font-semibold transition-all duration-200',\r\n            'btn-press',\r\n            isCompiling\r\n              ? 'bg-ide-panel-hover text-ide-text-subtle cursor-not-allowed'\r\n              : isRunning\r\n                ? 'bg-ide-success/20 text-ide-success cursor-not-allowed'\r\n                : 'bg-ide-success text-white hover:bg-ide-success/90 shadow-lg shadow-ide-success/20',\r\n          )}\r\n          title={isRunning ? 'Simulation running' : 'Compile and run'}\r\n        >\r\n          {isCompiling ? (\r\n            <>\r\n              <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-white/30 border-t-white\" />\r\n              <span>Compiling...</span>\r\n            </>\r\n          ) : isRunning ? (\r\n            <>\r\n              <div className=\"h-2 w-2 rounded-full bg-ide-success animate-pulse\" />\r\n              <span>Running...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Play className=\"h-4 w-4 fill-current\" />\r\n              <span>Run Simulation</span>\r\n            </>\r\n          )}\r\n        </button>\r\n\r\n        {/* Stop Button */}\r\n        <button\r\n          type=\"button\"\r\n          onClick={onStop}\r\n          disabled={!hasProgram}\r\n          className={cn(\r\n            'flex h-9 w-9 items-center justify-center rounded-lg',\r\n            'transition-all duration-200 btn-press',\r\n            !hasProgram\r\n              ? 'text-ide-text-subtle cursor-not-allowed'\r\n              : 'text-ide-text-muted hover:bg-ide-error/20 hover:text-ide-error',\r\n          )}\r\n          title=\"Stop simulation\"\r\n        >\r\n          <Square className=\"h-4 w-4\" />\r\n        </button>\r\n\r\n        <div className=\"mx-1 h-6 w-px bg-ide-border\" />\r\n\r\n        {/* Status Indicator */}\r\n        <div className=\"flex items-center gap-2 rounded-lg bg-ide-panel-bg/80 px-3 py-1.5\">\r\n          <div\r\n            className={cn(\r\n              'h-2 w-2 rounded-full transition-colors duration-300',\r\n              isCompiling\r\n                ? 'bg-ide-warning animate-pulse'\r\n                : compilationError\r\n                  ? 'bg-ide-error'\r\n                  : hasProgram\r\n                    ? isRunning\r\n                      ? 'bg-ide-success animate-pulse'\r\n                      : 'bg-ide-success'\r\n                    : 'bg-ide-text-subtle',\r\n            )}\r\n          />\r\n          <span className=\"text-xs font-medium text-ide-text-muted\">\r\n            {isCompiling\r\n              ? 'Compiling'\r\n              : compilationError\r\n                ? 'Error'\r\n                : hasProgram\r\n                  ? isRunning\r\n                    ? 'Running'\r\n                    : 'Ready'\r\n                  : 'Idle'}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Simulation Canvas Inner (ReactFlow)\r\n   ============================================ */\r\nfunction SimulationCanvasInner({\r\n  canvasRef,\r\n  isRunning,\r\n  componentPinStates,\r\n  componentPwmStates,\r\n}: {\r\n  canvasRef: React.RefObject<HTMLDivElement | null>\r\n  isRunning: boolean\r\n  componentPinStates?: Record<string, Record<string, boolean>>\r\n  componentPwmStates?: Record<string, number>\r\n}) {\r\n  const addPart = useAppStore((s) => s.addPart)\r\n  const removePart = useAppStore((s) => s.removePart)\r\n  const updatePartsPositions = useAppStore((s) => s.updatePartsPositions)\r\n  const selectedPartIds = useAppStore((s) => s.selectedPartIds)\r\n  const setSelectedPartIds = useAppStore((s) => s.setSelectedPartIds)\r\n  const toggleSelectedPartId = useAppStore((s) => s.toggleSelectedPartId)\r\n  const connections = useAppStore((s) => s.connections)\r\n  const updateWire = useAppStore((s) => s.updateWire)\r\n  const circuitParts = useAppStore((s) => s.circuitParts)\r\n  const circuitGeneratedVersion = useAppStore((s) => s.circuitGeneratedVersion)\r\n\r\n  useDiagramSync()\r\n\r\n  const { zoomIn, zoomOut, fitView, setViewport } = useReactFlow()\r\n\r\n  // Auto-fit view after AI generates a circuit\r\n  useEffect(() => {\r\n    if (circuitGeneratedVersion > 0 && circuitParts.length > 0) {\r\n      // Delay to allow nodes to render in ReactFlow\r\n      const timer = setTimeout(() => {\r\n        fitView({ padding: 0.2, duration: 500 })\r\n      }, 150)\r\n      return () => clearTimeout(timer)\r\n    }\r\n  }, [circuitGeneratedVersion, fitView, circuitParts.length])\r\n\r\n  const getCanvasRect = useCallback(() => {\r\n    return canvasRef.current?.getBoundingClientRect() ?? null\r\n  }, [canvasRef])\r\n\r\n  const [selectedEdge, setSelectedEdge] = useState<string | null>(null)\r\n  const [nodes, setNodes, onNodesChange] = useNodesState<Node>([])\r\n\r\n  const initializedRef = useRef(false)\r\n\r\n  // Seed a default part once.\r\n  useEffect(() => {\r\n    if (initializedRef.current) return\r\n    if (nodes.length) return\r\n    initializedRef.current = true\r\n    const id = addPart({ type: 'arduino-uno', position: { x: 0, y: 0 } })\r\n    setNodes([\r\n      {\r\n        id,\r\n        type: 'wokwi',\r\n        position: { x: 0, y: 0 },\r\n        data: {\r\n          getCanvasRect,\r\n          partType: 'arduino-uno',\r\n        },\r\n        selected: true,\r\n      },\r\n    ])\r\n    setSelectedPartIds([id])\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [])\r\n\r\n  // Sync ReactFlow nodes with circuitParts from store\r\n  useEffect(() => {\r\n    if (!initializedRef.current) return\r\n\r\n    const newNodes: Node[] = circuitParts.map((part) => ({\r\n      id: part.id,\r\n      type: 'wokwi',\r\n      position: { x: part.position.x, y: part.position.y },\r\n      data: {\r\n        getCanvasRect,\r\n        partType: part.type.replace('wokwi-', ''),\r\n        onDeletePart: removePart,\r\n        attrs: part.attrs ?? {},\r\n      },\r\n      selected: selectedPartIds.includes(part.id),\r\n    }))\r\n\r\n    const currentIds = new Set(nodes.map(n => n.id))\r\n    const newIds = new Set(newNodes.map(n => n.id))\r\n    const idsChanged = newIds.size !== currentIds.size ||\r\n      [...newIds].some(id => !currentIds.has(id))\r\n\r\n    if (newNodes.length > 0 && idsChanged) {\r\n      setNodes(newNodes)\r\n    }\r\n  }, [circuitParts, getCanvasRect, nodes, removePart, selectedPartIds, setNodes])\r\n\r\n  // Update node data when handlers change\r\n  useEffect(() => {\r\n    setNodes((nds) =>\r\n      nds.map((node) => {\r\n        if (node.type === 'arduino' || node.type === 'wokwi') {\r\n          return {\r\n            ...node,\r\n            data: {\r\n              ...node.data,\r\n              getCanvasRect,\r\n              onDeletePart: removePart,\r\n            },\r\n          }\r\n        }\r\n        return node\r\n      })\r\n    )\r\n  }, [getCanvasRect, removePart, setNodes])\r\n\r\n  // Keep ReactFlow selection in sync with Zustand selection.\r\n  useEffect(() => {\r\n    const selectedSet = new Set(selectedPartIds)\r\n    setNodes((nds) => nds.map((n) => ({ ...n, selected: selectedSet.has(n.id) })))\r\n  }, [selectedPartIds, setNodes])\r\n\r\n  // Update node data with simulation pin states for visual component updates\r\n  useEffect(() => {\r\n    setNodes((nds) =>\r\n      nds.map((node) => {\r\n        if (node.type === 'wokwi') {\r\n          const simStates = componentPinStates?.[node.id]\r\n          const pwmValue = componentPwmStates?.[node.id]\r\n          return {\r\n            ...node,\r\n            data: {\r\n              ...node.data,\r\n              simulationPinStates: simStates,\r\n              pwmValue: pwmValue,\r\n            },\r\n          }\r\n        }\r\n        return node\r\n      })\r\n    )\r\n  }, [componentPinStates, componentPwmStates, setNodes])\r\n\r\n  const [edges, setEdges, onEdgesChange] = useEdgesState<Edge>([])\r\n\r\n  const onConnect = useCallback(\r\n    (params: Connection) =>\r\n      setEdges((eds) =>\r\n        addEdge(\r\n          {\r\n            ...params,\r\n            type: 'default',\r\n            animated: false,\r\n            style: { stroke: 'var(--ide-accent)', strokeWidth: 2.5 },\r\n          },\r\n          eds\r\n        )\r\n      ),\r\n    [setEdges]\r\n  )\r\n\r\n  const onEdgeClick = useCallback((_: React.MouseEvent, edge: Edge) => {\r\n    setSelectedEdge(edge.id)\r\n  }, [])\r\n\r\n  const onPaneClick = useCallback(() => {\r\n    setSelectedEdge(null)\r\n  }, [])\r\n\r\n  const onNodeClick = useCallback(\r\n    (e: React.MouseEvent, node: Node) => {\r\n      if ((e.target as HTMLElement | null)?.closest?.('[data-fundi-pin=\"true\"]')) return\r\n\r\n      if (e.shiftKey) {\r\n        toggleSelectedPartId(node.id)\r\n      } else {\r\n        setSelectedPartIds([node.id])\r\n      }\r\n    },\r\n    [setSelectedPartIds, toggleSelectedPartId]\r\n  )\r\n\r\n  // Double-click to delete component\r\n  const onNodeDoubleClick = useCallback(\r\n    (_: React.MouseEvent, node: Node) => {\r\n      // Get the part type for a better confirmation message\r\n      const part = circuitParts.find(p => p.id === node.id)\r\n      const partName = part?.type.replace('wokwi-', '').replace(/-/g, ' ') || 'component'\r\n\r\n      if (confirm(`Delete this ${partName}?`)) {\r\n        removePart(node.id)\r\n      }\r\n    },\r\n    [circuitParts, removePart]\r\n  )\r\n\r\n  // Group-drag engine\r\n  const dragStartNodesRef = useRef<Map<string, { x: number; y: number }>>(new Map())\r\n  const dragStartWirePointsRef = useRef<Map<string, WirePoint[] | undefined>>(new Map())\r\n  const dragWireModeRef = useRef<Map<string, 'both' | 'one'>>(new Map())\r\n  const [wirePointOverrides, setWirePointOverrides] = useState<Map<string, WirePoint[] | undefined> | null>(null)\r\n\r\n  const onNodeDragStart = useCallback(\r\n    (_: React.MouseEvent, node: Node) => {\r\n      if (!selectedPartIds.includes(node.id)) {\r\n        setSelectedPartIds([node.id])\r\n      }\r\n\r\n      const selectedSet = new Set(selectedPartIds.includes(node.id) ? selectedPartIds : [node.id])\r\n\r\n      dragStartNodesRef.current = new Map(\r\n        nodes\r\n          .filter((n) => selectedSet.has(n.id))\r\n          .map((n) => [n.id, { x: n.position.x, y: n.position.y }])\r\n      )\r\n\r\n      dragStartWirePointsRef.current = new Map()\r\n      dragWireModeRef.current = new Map()\r\n      for (const c of connections) {\r\n        if (!c.points?.length) continue\r\n        const fromMoving = selectedSet.has(c.from.partId)\r\n        const toMoving = selectedSet.has(c.to.partId)\r\n        if (!fromMoving && !toMoving) continue\r\n        dragStartWirePointsRef.current.set(c.id, c.points)\r\n        dragWireModeRef.current.set(c.id, fromMoving && toMoving ? 'both' : 'one')\r\n      }\r\n    },\r\n    [connections, nodes, selectedPartIds, setSelectedPartIds]\r\n  )\r\n\r\n  const onNodeDrag = useCallback(\r\n    (_: React.MouseEvent, node: Node) => {\r\n      const start = dragStartNodesRef.current.get(node.id)\r\n      if (!start) return\r\n      const delta = { x: node.position.x - start.x, y: node.position.y - start.y }\r\n\r\n      setNodes((nds) =>\r\n        nds.map((n) => {\r\n          const s = dragStartNodesRef.current.get(n.id)\r\n          if (!s) return n\r\n          return { ...n, position: { x: s.x + delta.x, y: s.y + delta.y } }\r\n        })\r\n      )\r\n\r\n      const overrides = new Map<string, WirePoint[] | undefined>()\r\n      for (const [wireId, basePoints] of dragStartWirePointsRef.current.entries()) {\r\n        const mode = dragWireModeRef.current.get(wireId)\r\n        if (!mode) continue\r\n        if (mode === 'both') {\r\n          overrides.set(wireId, translatePoints(basePoints, delta))\r\n        } else {\r\n          overrides.set(wireId, undefined)\r\n        }\r\n      }\r\n      setWirePointOverrides(overrides.size ? overrides : null)\r\n    },\r\n    [setNodes]\r\n  )\r\n\r\n  const onNodeDragStop = useCallback(() => {\r\n    const updates: Array<{ id: string; x: number; y: number }> = []\r\n    for (const [id] of dragStartNodesRef.current.entries()) {\r\n      const n = nodes.find((nn) => nn.id === id)\r\n      if (!n) continue\r\n      updates.push({ id, x: n.position.x, y: n.position.y })\r\n    }\r\n    updatePartsPositions(updates)\r\n\r\n    if (wirePointOverrides) {\r\n      for (const [wireId, pts] of wirePointOverrides.entries()) {\r\n        updateWire(wireId, pts)\r\n      }\r\n    }\r\n\r\n    dragStartNodesRef.current = new Map()\r\n    dragStartWirePointsRef.current = new Map()\r\n    dragWireModeRef.current = new Map()\r\n    setWirePointOverrides(null)\r\n  }, [nodes, updatePartsPositions, updateWire, wirePointOverrides])\r\n\r\n  // Drag-to-add handler\r\n  const transform = useStore((s) => s.transform as [number, number, number])\r\n  const handleDrop = useCallback(\r\n    (e: React.DragEvent) => {\r\n      const container = canvasRef.current\r\n      if (!container) return\r\n\r\n      const partType = e.dataTransfer.getData(FUNDI_PART_MIME)\r\n      if (!partType) return\r\n\r\n      e.preventDefault()\r\n\r\n      const rect = container.getBoundingClientRect()\r\n      const p = { x: e.clientX - rect.left, y: e.clientY - rect.top }\r\n      const [tx, ty, zoom] = transform\r\n      const flow = { x: (p.x - tx) / zoom, y: (p.y - ty) / zoom }\r\n\r\n      const id = addPart({ type: partType, position: { x: flow.x, y: flow.y } })\r\n      setNodes((nds) => [\r\n        ...nds,\r\n        {\r\n          id,\r\n          type: 'wokwi',\r\n          position: flow,\r\n          data: { getCanvasRect, partType },\r\n          selected: true,\r\n        },\r\n      ])\r\n\r\n      setSelectedPartIds([id])\r\n    },\r\n    [addPart, canvasRef, getCanvasRect, setNodes, setSelectedPartIds, transform]\r\n  )\r\n\r\n  const handleDragOver = useCallback((e: React.DragEvent) => {\r\n    if (e.dataTransfer.types.includes(FUNDI_PART_MIME)) {\r\n      e.preventDefault()\r\n      e.dataTransfer.dropEffect = 'copy'\r\n    }\r\n  }, [])\r\n\r\n  const handleResetView = useCallback(() => {\r\n    setViewport({ x: 0, y: 0, zoom: 1 }, { duration: 300 })\r\n  }, [setViewport])\r\n\r\n  return (\r\n    <div\r\n      ref={canvasRef}\r\n      className={cn(\r\n        'relative h-full w-full ide-canvas',\r\n        isRunning && 'simulation-active rounded-lg'\r\n      )}\r\n      onDrop={handleDrop}\r\n      onDragOver={handleDragOver}\r\n    >\r\n      <CanvasToolbar\r\n        onZoomIn={() => zoomIn({ duration: 200 })}\r\n        onZoomOut={() => zoomOut({ duration: 200 })}\r\n        onFitView={() => fitView({ duration: 300, padding: 0.2 })}\r\n        onResetView={handleResetView}\r\n      />\r\n\r\n      <SelectionOverlay containerRef={canvasRef} />\r\n\r\n      <ReactFlow\r\n        nodes={nodes}\r\n        edges={edges.map((edge) => ({\r\n          ...edge,\r\n          style: {\r\n            ...edge.style,\r\n            stroke: 'var(--ide-text-muted)',\r\n            strokeWidth: edge.id === selectedEdge ? 3 : 2,\r\n          },\r\n        }))}\r\n        nodeTypes={nodeTypes}\r\n        onNodesChange={onNodesChange}\r\n        onEdgesChange={onEdgesChange}\r\n        onConnect={onConnect}\r\n        onEdgeClick={onEdgeClick}\r\n        onPaneClick={onPaneClick}\r\n        onNodeClick={onNodeClick}\r\n        onNodeDoubleClick={onNodeDoubleClick}\r\n        onNodeDragStart={onNodeDragStart}\r\n        onNodeDrag={onNodeDrag}\r\n        onNodeDragStop={onNodeDragStop}\r\n        snapToGrid={true}\r\n        snapGrid={[20, 20]}\r\n        fitView\r\n        className=\"h-full w-full\"\r\n        style={{ cursor: 'inherit', background: 'transparent' }}\r\n        defaultEdgeOptions={{\r\n          type: 'default',\r\n          animated: false,\r\n          style: { stroke: 'var(--ide-text-muted)', strokeWidth: 2 },\r\n        }}\r\n        connectionLineStyle={{ stroke: 'var(--ide-accent)', strokeWidth: 2 }}\r\n      >\r\n        <Background color=\"#333333\" variant={BackgroundVariant.Dots} gap={20} size={1} />\r\n        <Controls className=\"!left-4 !bottom-20\" />\r\n\r\n        <WiringLayer\r\n          containerRef={canvasRef}\r\n          wirePointOverrides={wirePointOverrides ?? undefined}\r\n        />\r\n      </ReactFlow>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction SimulationCanvas({\r\n  isRunning,\r\n  componentPinStates,\r\n  componentPwmStates,\r\n}: {\r\n  isRunning: boolean\r\n  componentPinStates?: Record<string, Record<string, boolean>>\r\n  componentPwmStates?: Record<string, number>\r\n}) {\r\n  const canvasRef = useRef<HTMLDivElement | null>(null)\r\n  return (\r\n    <ReactFlowProvider>\r\n      <SimulationCanvasInner\r\n        canvasRef={canvasRef}\r\n        isRunning={isRunning}\r\n        componentPinStates={componentPinStates}\r\n        componentPwmStates={componentPwmStates}\r\n      />\r\n    </ReactFlowProvider>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Code Editor Panel\r\n   ============================================ */\r\nfunction CodeEditorPanel({\r\n  compilationError,\r\n}: {\r\n  compilationError: string | null\r\n}) {\r\n  const files = useAppStore((s) => s.files)\r\n  const openFilePaths = useAppStore((s) => s.openFilePaths)\r\n  const activeFilePath = useAppStore((s) => s.activeFilePath)\r\n  const setActiveFile = useAppStore((s) => s.setActiveFile)\r\n  const closeFile = useAppStore((s) => s.closeFile)\r\n  const updateFileContent = useAppStore((s) => s.updateFileContent)\r\n  const settings = useAppStore((s) => s.settings)\r\n\r\n  const activeFile = files.find(f => f.path === activeFilePath)\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden bg-ide-panel-surface\">\r\n      {/* Tab bar */}\r\n      <div className=\"flex h-9 shrink-0 items-center border-b border-ide-border bg-ide-panel-bg overflow-x-auto\">\r\n        {openFilePaths.map((path) => {\r\n          const file = files.find(f => f.path === path)\r\n          if (!file) return null\r\n          const isActive = path === activeFilePath\r\n          return (\r\n            <div\r\n              key={path}\r\n              className={cn(\r\n                'group flex h-full items-center gap-1.5 border-r border-ide-border px-2 text-xs font-medium transition-colors cursor-pointer',\r\n                isActive\r\n                  ? 'bg-ide-panel-surface text-ide-text border-b-2 border-b-ide-accent'\r\n                  : 'text-ide-text-muted hover:text-ide-text hover:bg-ide-panel-hover'\r\n              )}\r\n              onClick={() => setActiveFile(path)}\r\n            >\r\n              <FileCode className=\"h-3.5 w-3.5 shrink-0\" />\r\n              <span className=\"truncate max-w-[120px]\">{file.path}</span>\r\n              {file.includeInSimulation && (\r\n                <span className=\"h-1.5 w-1.5 rounded-full bg-ide-success shrink-0\" title=\"Included in simulation\" />\r\n              )}\r\n              {openFilePaths.length > 1 && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={(e) => {\r\n                    e.stopPropagation()\r\n                    closeFile(path)\r\n                  }}\r\n                  className=\"ml-1 flex h-4 w-4 items-center justify-center rounded opacity-0 group-hover:opacity-100 hover:bg-ide-panel-hover transition-all\"\r\n                >\r\n                  <X className=\"h-3 w-3\" />\r\n                </button>\r\n              )}\r\n            </div>\r\n          )\r\n        })}\r\n      </div>\r\n\r\n      {/* Error banner */}\r\n      {compilationError && (\r\n        <div className=\"shrink-0 border-b border-ide-error/30 bg-ide-error/10 px-4 py-2\">\r\n          <pre className=\"whitespace-pre-wrap break-words font-mono text-xs text-ide-error\">\r\n            {compilationError}\r\n          </pre>\r\n        </div>\r\n      )}\r\n\r\n      {/* Editor content */}\r\n      <div className=\"min-h-0 flex-1 p-2\">\r\n        {activeFile ? (\r\n          <textarea\r\n            value={activeFile.content}\r\n            onChange={(e) => updateFileContent(activeFile.path, e.target.value)}\r\n            spellCheck={false}\r\n            readOnly={activeFile.isReadOnly}\r\n            style={{ fontSize: `${settings.editorFontSize}px`, tabSize: settings.editorTabSize }}\r\n            className={cn(\r\n              'h-full w-full resize-none rounded-md bg-ide-panel-bg p-4',\r\n              'font-mono leading-6 text-ide-text',\r\n              'border border-ide-border',\r\n              'focus:outline-none focus:ring-1 focus:ring-ide-accent/50 focus:border-ide-accent/50',\r\n              'placeholder:text-ide-text-subtle',\r\n              activeFile.isReadOnly && 'opacity-75 cursor-not-allowed'\r\n            )}\r\n            placeholder=\"// Write your Arduino code here...\"\r\n          />\r\n        ) : (\r\n          <div className=\"flex h-full items-center justify-center text-ide-text-subtle\">\r\n            <p className=\"text-sm\">No file selected</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Files Panel Component\r\n   ============================================ */\r\nfunction FilesPanel() {\r\n  const files = useAppStore((s) => s.files)\r\n  const activeFilePath = useAppStore((s) => s.activeFilePath)\r\n  const openFile = useAppStore((s) => s.openFile)\r\n  const addFile = useAppStore((s) => s.addFile)\r\n  const deleteFile = useAppStore((s) => s.deleteFile)\r\n  const renameFile = useAppStore((s) => s.renameFile)\r\n  const toggleFileSimulation = useAppStore((s) => s.toggleFileSimulation)\r\n\r\n  const [showNewFileInput, setShowNewFileInput] = useState(false)\r\n  const [newFileName, setNewFileName] = useState('')\r\n  const [contextMenu, setContextMenu] = useState<{ x: number; y: number; file: ProjectFile } | null>(null)\r\n  const [renamingFile, setRenamingFile] = useState<string | null>(null)\r\n  const [renameValue, setRenameValue] = useState('')\r\n\r\n  const handleAddFile = () => {\r\n    if (newFileName.trim()) {\r\n      addFile(newFileName.trim())\r\n      setNewFileName('')\r\n      setShowNewFileInput(false)\r\n    }\r\n  }\r\n\r\n  const handleContextMenu = (e: React.MouseEvent, file: ProjectFile) => {\r\n    e.preventDefault()\r\n    setContextMenu({ x: e.clientX, y: e.clientY, file })\r\n  }\r\n\r\n  const handleRename = (oldPath: string) => {\r\n    if (renameValue.trim() && renameValue !== oldPath) {\r\n      renameFile(oldPath, renameValue.trim())\r\n    }\r\n    setRenamingFile(null)\r\n    setRenameValue('')\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col\">\r\n      {/* Header with actions */}\r\n      <div className=\"flex items-center justify-between border-b border-ide-border px-3 py-2\">\r\n        <span className=\"text-xs font-medium text-ide-text-muted\">PROJECT FILES</span>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setShowNewFileInput(true)}\r\n          className=\"flex h-6 w-6 items-center justify-center rounded text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n          title=\"New File\"\r\n        >\r\n          <Plus className=\"h-3.5 w-3.5\" />\r\n        </button>\r\n      </div>\r\n\r\n      {/* New file input */}\r\n      {showNewFileInput && (\r\n        <div className=\"border-b border-ide-border px-3 py-2\">\r\n          <input\r\n            type=\"text\"\r\n            value={newFileName}\r\n            onChange={(e) => setNewFileName(e.target.value)}\r\n            onKeyDown={(e) => {\r\n              if (e.key === 'Enter') handleAddFile()\r\n              if (e.key === 'Escape') {\r\n                setShowNewFileInput(false)\r\n                setNewFileName('')\r\n              }\r\n            }}\r\n            placeholder=\"filename.cpp\"\r\n            className=\"w-full rounded border border-ide-border bg-ide-panel-bg px-2 py-1 text-xs text-ide-text placeholder:text-ide-text-subtle focus:border-ide-accent focus:outline-none\"\r\n            autoFocus\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* File list */}\r\n      <div className=\"flex-1 overflow-auto p-2\">\r\n        {files.map((file) => (\r\n          <div\r\n            key={file.path}\r\n            onContextMenu={(e) => handleContextMenu(e, file)}\r\n            onClick={() => openFile(file.path)}\r\n            className={cn(\r\n              'group flex items-center justify-between rounded px-2 py-1.5 text-xs cursor-pointer transition-colors',\r\n              activeFilePath === file.path\r\n                ? 'bg-ide-accent/20 text-ide-text'\r\n                : 'text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text'\r\n            )}\r\n          >\r\n            {renamingFile === file.path ? (\r\n              <input\r\n                type=\"text\"\r\n                value={renameValue}\r\n                onChange={(e) => setRenameValue(e.target.value)}\r\n                onBlur={() => handleRename(file.path)}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') handleRename(file.path)\r\n                  if (e.key === 'Escape') {\r\n                    setRenamingFile(null)\r\n                    setRenameValue('')\r\n                  }\r\n                }}\r\n                className=\"flex-1 rounded border border-ide-accent bg-ide-panel-bg px-1 text-xs text-ide-text focus:outline-none\"\r\n                autoFocus\r\n                onClick={(e) => e.stopPropagation()}\r\n              />\r\n            ) : (\r\n              <div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n                <FileCode className=\"h-3.5 w-3.5 shrink-0\" />\r\n                <span className=\"truncate\">{file.path}</span>\r\n                {file.isMain && (\r\n                  <span className=\"shrink-0 rounded bg-ide-accent/20 px-1 py-0.5 text-[9px] font-medium text-ide-accent\">\r\n                    main\r\n                  </span>\r\n                )}\r\n              </div>\r\n            )}\r\n            <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation()\r\n                  toggleFileSimulation(file.path)\r\n                }}\r\n                className={cn(\r\n                  'flex h-5 w-5 items-center justify-center rounded transition-colors',\r\n                  file.includeInSimulation\r\n                    ? 'text-ide-success hover:bg-ide-success/20'\r\n                    : 'text-ide-text-subtle hover:bg-ide-panel-hover'\r\n                )}\r\n                title={file.includeInSimulation ? 'Included in simulation' : 'Excluded from simulation'}\r\n              >\r\n                {file.includeInSimulation ? <Eye className=\"h-3 w-3\" /> : <EyeOff className=\"h-3 w-3\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Context menu */}\r\n      {contextMenu && (\r\n        <>\r\n          <div\r\n            className=\"fixed inset-0 z-50\"\r\n            onClick={() => setContextMenu(null)}\r\n          />\r\n          <div\r\n            className=\"fixed z-50 w-40 rounded-lg border border-ide-border bg-ide-panel-surface py-1 shadow-lg\"\r\n            style={{ left: contextMenu.x, top: contextMenu.y }}\r\n          >\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                setRenamingFile(contextMenu.file.path)\r\n                setRenameValue(contextMenu.file.path)\r\n                setContextMenu(null)\r\n              }}\r\n              className=\"flex w-full items-center gap-2 px-3 py-1.5 text-xs text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text\"\r\n            >\r\n              Rename\r\n            </button>\r\n            {!contextMenu.file.isMain && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  deleteFile(contextMenu.file.path)\r\n                  setContextMenu(null)\r\n                }}\r\n                className=\"flex w-full items-center gap-2 px-3 py-1.5 text-xs text-ide-error hover:bg-ide-error/10\"\r\n              >\r\n                <Trash2 className=\"h-3 w-3\" />\r\n                Delete\r\n              </button>\r\n            )}\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Left Panel - The Assistant\r\n   ============================================ */\r\ntype LeftPanelTab = 'components' | 'files'\r\n\r\nfunction LeftPanel() {\r\n  const [activeTab, setActiveTab] = useState<LeftPanelTab>('components')\r\n\r\n  const tabs: { key: LeftPanelTab; label: string; icon: React.ElementType }[] = [\r\n    { key: 'components', label: 'Components', icon: Layers },\r\n    { key: 'files', label: 'Files', icon: FolderTree },\r\n  ]\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden bg-ide-panel-bg\">\r\n      {/* Tab header */}\r\n      <div className=\"flex h-10 shrink-0 items-center border-b border-ide-border bg-ide-panel-surface\">\r\n        {tabs.map((tab) => {\r\n          const Icon = tab.icon\r\n          const isActive = tab.key === activeTab\r\n          return (\r\n            <button\r\n              key={tab.key}\r\n              type=\"button\"\r\n              onClick={() => setActiveTab(tab.key)}\r\n              className={cn(\r\n                'flex h-full items-center gap-1.5 px-3 text-xs font-medium transition-colors',\r\n                isActive\r\n                  ? 'text-ide-accent border-b-2 border-ide-accent'\r\n                  : 'text-ide-text-muted hover:text-ide-text'\r\n              )}\r\n            >\r\n              <Icon className=\"h-3.5 w-3.5\" />\r\n              <span>{tab.label}</span>\r\n            </button>\r\n          )\r\n        })}\r\n      </div>\r\n\r\n      {/* Tab content */}\r\n      <div className=\"min-h-0 flex-1 overflow-hidden\">\r\n        {activeTab === 'components' && (\r\n          <div className=\"h-full overflow-auto p-4\">\r\n            <ComponentLibrary />\r\n          </div>\r\n        )}\r\n        {activeTab === 'files' && (\r\n          <FilesPanel />\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Resize Handle Component\r\n   ============================================ */\r\nfunction ResizeHandle({\r\n  direction = 'horizontal',\r\n  className,\r\n}: {\r\n  direction?: 'horizontal' | 'vertical'\r\n  className?: string\r\n}) {\r\n  return (\r\n    <PanelResizeHandle\r\n      className={cn(\r\n        'resize-handle group relative flex items-center justify-center',\r\n        direction === 'horizontal'\r\n          ? 'w-1.5 cursor-col-resize'\r\n          : 'h-1.5 cursor-row-resize',\r\n        className\r\n      )}\r\n    >\r\n      <div className={cn(\r\n        'absolute rounded-full bg-ide-border opacity-0 group-hover:opacity-100 transition-opacity',\r\n        direction === 'horizontal'\r\n          ? 'w-0.5 h-8'\r\n          : 'h-0.5 w-8'\r\n      )} />\r\n    </PanelResizeHandle>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Main IDE Shell Layout\r\n   ============================================ */\r\nexport default function Home() {\r\n  const [leftPanelCollapsed, setLeftPanelCollapsed] = useState(false)\r\n  const [bottomPanelCollapsed, setBottomPanelCollapsed] = useState(false)\r\n  const [showPublishModal, setShowPublishModal] = useState(false)\r\n\r\n  const files = useAppStore((s) => s.files)\r\n  const circuitParts = useAppStore((s) => s.circuitParts)\r\n  const connections = useAppStore((s) => s.connections)\r\n  const compileAndRun = useAppStore((s) => s.compileAndRun)\r\n  const isCompiling = useAppStore((s) => s.isCompiling)\r\n  const compilationError = useAppStore((s) => s.compilationError)\r\n  const hex = useAppStore((s) => s.hex)\r\n  const compiledBoard = useAppStore((s) => s.compiledBoard)\r\n\r\n  const {\r\n    run: simRun,\r\n    stop: simStop,\r\n    isRunning: simIsRunning,\r\n    pinStates,\r\n    pwmStates,\r\n    serialOutput,\r\n    clearSerialOutput,\r\n  } = useSimulation(hex, compiledBoard ?? '')\r\n\r\n  useEffect(() => {\r\n    if (!hex || !compiledBoard) return\r\n    if (isCompiling) return\r\n    if (compilationError) return\r\n    if (simIsRunning) return\r\n    console.log('[Page] Auto-starting simulation')\r\n    simRun()\r\n  }, [compiledBoard, compilationError, hex, isCompiling, simIsRunning, simRun])\r\n\r\n  // Compute component pin states based on connections and Arduino pinStates\r\n  // This maps component IDs to their simulated pin values for visual updates\r\n  const componentPinStates = useMemo(() => {\r\n    const states: Record<string, Record<string, boolean>> = {}\r\n\r\n    const mcuPart = circuitParts.find((p) => p.type.includes('arduino') || p.type.includes('esp32') || p.type.includes('pi-pico'))\r\n    if (!mcuPart) return states\r\n\r\n    const keyOf = (partId: string, pinId: string) => `${partId}:${pinId}`\r\n\r\n    // Build an undirected connectivity graph of all wired pin endpoints.\r\n    const adjacency = new Map<string, Set<string>>()\r\n    for (const conn of connections) {\r\n      const a = keyOf(conn.from.partId, conn.from.pinId)\r\n      const b = keyOf(conn.to.partId, conn.to.pinId)\r\n      if (!adjacency.has(a)) adjacency.set(a, new Set())\r\n      if (!adjacency.has(b)) adjacency.set(b, new Set())\r\n      adjacency.get(a)!.add(b)\r\n      adjacency.get(b)!.add(a)\r\n    }\r\n\r\n    // Seed known net values from MCU pins + basic power/ground inference.\r\n    const netValue = new Map<string, boolean>()\r\n\r\n    const normalizePinName = (pinId: string) => pinId.trim().toUpperCase()\r\n    const inferFixedPinValue = (pinId: string): boolean | null => {\r\n      const p = normalizePinName(pinId)\r\n      if (p === 'GND' || p === 'GROUND') return false\r\n      if (p === 'VCC' || p === '5V' || p === '3V3' || p === '3.3V' || p === 'VIN') return true\r\n      return null\r\n    }\r\n\r\n    const inferMcuPinValue = (pinId: string): boolean | null => {\r\n      const fixed = inferFixedPinValue(pinId)\r\n      if (fixed !== null) return fixed\r\n      // Digital pins exposed as numeric strings on Wokwi Arduino elements (\"13\", \"0\", ...)\r\n      if (/^\\d+$/.test(pinId)) {\r\n        const pinNum = parseInt(pinId, 10)\r\n        const v = pinStates[pinNum]\r\n        return typeof v === 'boolean' ? v : null\r\n      }\r\n      return null\r\n    }\r\n\r\n    for (const conn of connections) {\r\n      for (const endpoint of [conn.from, conn.to]) {\r\n        if (endpoint.partId !== mcuPart.id) continue\r\n        const v = inferMcuPinValue(endpoint.pinId)\r\n        if (v === null) continue\r\n        netValue.set(keyOf(endpoint.partId, endpoint.pinId), v)\r\n      }\r\n    }\r\n\r\n    // Also seed any explicit power/ground pins on any part (helps when the MCU isn't directly connected).\r\n    for (const conn of connections) {\r\n      for (const endpoint of [conn.from, conn.to]) {\r\n        const fixed = inferFixedPinValue(endpoint.pinId)\r\n        if (fixed === null) continue\r\n        netValue.set(keyOf(endpoint.partId, endpoint.pinId), fixed)\r\n      }\r\n    }\r\n\r\n    // Propagate values across connected nets (simple BFS).\r\n    // If multiple seeds exist on the same net, the first discovered value wins (simplest behavior).\r\n    const queue: string[] = [...netValue.keys()]\r\n    const seen = new Set(queue)\r\n    while (queue.length) {\r\n      const cur = queue.shift()!\r\n      const curVal = netValue.get(cur)\r\n      if (curVal === undefined) continue\r\n      const neighbors = adjacency.get(cur)\r\n      if (!neighbors) continue\r\n      for (const n of neighbors) {\r\n        if (!netValue.has(n)) {\r\n          netValue.set(n, curVal)\r\n        }\r\n        if (!seen.has(n)) {\r\n          seen.add(n)\r\n          queue.push(n)\r\n        }\r\n      }\r\n    }\r\n\r\n    // Materialize per-component pin states for visual updates.\r\n    for (const [k, v] of netValue.entries()) {\r\n      const idx = k.indexOf(':')\r\n      if (idx < 0) continue\r\n      const partId = k.slice(0, idx)\r\n      const pinId = k.slice(idx + 1)\r\n      if (!states[partId]) states[partId] = {}\r\n      states[partId][pinId] = v\r\n    }\r\n\r\n    return states\r\n  }, [circuitParts, connections, pinStates])\r\n\r\n  // Compute PWM values for components based on connections to PWM pins\r\n  const componentPwmStates = useMemo(() => {\r\n    const states: Record<string, number> = {}\r\n    \r\n    const mcuPart = circuitParts.find((p) => p.type.includes('arduino') || p.type.includes('esp32') || p.type.includes('pi-pico'))\r\n    if (!mcuPart) return states\r\n\r\n    // Find components connected to PWM pins and map their PWM values\r\n    for (const conn of connections) {\r\n      let mcuEndpoint = null\r\n      let componentEndpoint = null\r\n      \r\n      if (conn.from.partId === mcuPart.id) {\r\n        mcuEndpoint = conn.from\r\n        componentEndpoint = conn.to\r\n      } else if (conn.to.partId === mcuPart.id) {\r\n        mcuEndpoint = conn.to\r\n        componentEndpoint = conn.from\r\n      }\r\n      \r\n      if (!mcuEndpoint || !componentEndpoint) continue\r\n      \r\n      // Check if MCU pin is a PWM pin (3, 5, 6, 9, 10, 11 for Arduino Uno)\r\n      const pinNum = parseInt(mcuEndpoint.pinId, 10)\r\n      if (isNaN(pinNum)) continue\r\n      \r\n      const pwmPins = [3, 5, 6, 9, 10, 11]\r\n      if (pwmPins.includes(pinNum)) {\r\n        const pwmValue = pwmStates[pinNum]\r\n        if (typeof pwmValue === 'number' && pwmValue > 0) {\r\n          states[componentEndpoint.partId] = pwmValue\r\n        }\r\n      }\r\n    }\r\n    \r\n    return states\r\n  }, [circuitParts, connections, pwmStates])\r\n\r\n  // Debug: Log componentPinStates changes\r\n  useEffect(() => {\r\n    if (Object.keys(componentPinStates).length > 0) {\r\n      console.log('[Page] componentPinStates updated:', componentPinStates)\r\n    }\r\n  }, [componentPinStates])\r\n\r\n  // Prepare project data for publishing\r\n  const prepareProjectForPublish = useCallback(() => {\r\n    return {\r\n      files: files.map(f => ({ path: f.path, content: f.content })),\r\n      circuit: {\r\n        parts: circuitParts,\r\n        connections: connections,\r\n      },\r\n    }\r\n  }, [files, circuitParts, connections])\r\n\r\n  return (\r\n    <div className=\"relative h-screen overflow-hidden bg-ide-panel-bg text-ide-text\">\r\n      {/* Global Header - Compact Command Center (40px) */}\r\n      <header className=\"relative z-50 flex h-10 items-center justify-between border-b border-ide-border bg-ide-panel-surface px-3\">\r\n        {/* Left - Logo & Project */}\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Collapse toggle */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setLeftPanelCollapsed(!leftPanelCollapsed)}\r\n            className=\"flex h-7 w-7 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n            title={leftPanelCollapsed ? 'Expand sidebar' : 'Collapse sidebar'}\r\n          >\r\n            {leftPanelCollapsed ? (\r\n              <PanelLeftOpen className=\"h-4 w-4\" />\r\n            ) : (\r\n              <PanelLeftClose className=\"h-4 w-4\" />\r\n            )}\r\n          </button>\r\n\r\n          <Link href=\"/workspace\" className=\"flex items-center gap-2 hover:opacity-80 transition-opacity\">\r\n            <div className=\"flex h-6 w-6 items-center justify-center rounded-md bg-ide-accent\">\r\n              <span className=\"text-xs font-bold text-white\">F</span>\r\n            </div>\r\n            <div>\r\n              <h1 className=\"text-xs font-semibold text-ide-text leading-none\">\r\n                FUNDI\r\n              </h1>\r\n              <p className=\"text-[9px] text-ide-text-muted leading-none mt-0.5\">\r\n                IoT Workbench\r\n              </p>\r\n            </div>\r\n          </Link>\r\n\r\n          <div className=\"h-5 w-px bg-ide-border\" />\r\n\r\n          <Link\r\n            href=\"/workspace\"\r\n            className=\"flex h-7 items-center gap-1.5 rounded-md px-2 text-xs text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n            title=\"Workspace\"\r\n          >\r\n            <FolderOpen className=\"h-3.5 w-3.5\" />\r\n            <span className=\"hidden md:inline\">Workspace</span>\r\n          </Link>\r\n        </div>\r\n\r\n        {/* Center - Device Status */}\r\n        <StatusBadge deviceName=\"Arduino Uno\" isConnected={true} />\r\n\r\n        {/* Right - Actions */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setShowPublishModal(true)}\r\n            className=\"flex h-7 items-center gap-1.5 rounded-md bg-ide-accent/10 px-3 text-xs font-medium text-ide-accent hover:bg-ide-accent/20 transition-colors\"\r\n            title=\"Publish to Gallery\"\r\n          >\r\n            <Share2 className=\"h-3.5 w-3.5\" />\r\n            <span className=\"hidden sm:inline\">Publish</span>\r\n          </button>\r\n          <Link\r\n            href=\"/settings\"\r\n            className=\"flex h-7 w-7 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n            title=\"Settings\"\r\n          >\r\n            <Settings className=\"h-4 w-4\" />\r\n          </Link>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Publish Modal */}\r\n      {showPublishModal && (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className=\"w-full max-w-md rounded-xl border border-ide-border bg-ide-panel-surface p-6 shadow-2xl\">\r\n            <div className=\"mb-4 flex items-center justify-between\">\r\n              <h3 className=\"text-lg font-semibold\">Publish Project</h3>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowPublishModal(false)}\r\n                className=\"flex h-7 w-7 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"space-y-3\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  const data = prepareProjectForPublish()\r\n                  console.log('Ready to publish to GitHub:', data)\r\n                  // TODO: Implement GitHub OAuth and API integration\r\n                }}\r\n                className=\"flex w-full items-center gap-3 rounded-lg border border-ide-border bg-ide-panel-bg p-4 text-left transition-colors hover:border-ide-accent/50 hover:bg-ide-panel-hover\"\r\n              >\r\n                <Github className=\"h-5 w-5 text-ide-accent\" />\r\n                <div>\r\n                  <div className=\"text-sm font-medium\">Publish to GitHub</div>\r\n                  <div className=\"text-xs text-ide-text-muted\">\r\n                    Create a new repository or gist\r\n                  </div>\r\n                </div>\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  const data = prepareProjectForPublish()\r\n                  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })\r\n                  const url = URL.createObjectURL(blob)\r\n                  const a = document.createElement('a')\r\n                  a.href = url\r\n                  a.download = 'fundi-project.json'\r\n                  a.click()\r\n                  URL.revokeObjectURL(url)\r\n                }}\r\n                className=\"flex w-full items-center gap-3 rounded-lg border border-ide-border bg-ide-panel-bg p-4 text-left transition-colors hover:border-ide-accent/50 hover:bg-ide-panel-hover\"\r\n              >\r\n                <Share2 className=\"h-5 w-5 text-ide-accent\" />\r\n                <div>\r\n                  <div className=\"text-sm font-medium\">Download Project</div>\r\n                  <div className=\"text-xs text-ide-text-muted\">\r\n                    Export as JSON file\r\n                  </div>\r\n                </div>\r\n              </button>\r\n            </div>\r\n            <div className=\"mt-4 rounded-lg bg-ide-info/10 border border-ide-info/30 p-3\">\r\n              <p className=\"text-xs text-ide-info\">\r\n                 GitHub integration requires authentication. Coming soon!\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Main IDE Layout - Resizable Panels */}\r\n      <div className=\"h-[calc(100vh-40px)]\">\r\n        <PanelGroup direction=\"horizontal\" className=\"h-full\">\r\n          {/* Left Panel - Component Library (collapsible) */}\r\n          {!leftPanelCollapsed && (\r\n            <>\r\n              <Panel\r\n                defaultSize={20}\r\n                minSize={15}\r\n                maxSize={35}\r\n                className=\"bg-ide-panel-bg\"\r\n              >\r\n                <LeftPanel />\r\n              </Panel>\r\n              <ResizeHandle direction=\"horizontal\" />\r\n            </>\r\n          )}\r\n\r\n          {/* Middle Panel - The Workshop (Canvas + Code Editor) */}\r\n          <Panel defaultSize={leftPanelCollapsed ? 60 : 55} minSize={30}>\r\n            <PanelGroup direction=\"vertical\" className=\"h-full\">\r\n              {/* Top - Simulation Canvas (The Stage) */}\r\n              <Panel defaultSize={bottomPanelCollapsed ? 100 : 60} minSize={30}>\r\n                <div className=\"relative h-full overflow-hidden\">\r\n                  <SimulationCanvas\r\n                    isRunning={simIsRunning}\r\n                    componentPinStates={componentPinStates}\r\n                    componentPwmStates={componentPwmStates}\r\n                  />\r\n\r\n                  {/* Unified Action Bar */}\r\n                  <UnifiedActionBar\r\n                    isCompiling={isCompiling}\r\n                    compilationError={compilationError}\r\n                    onRun={() => void compileAndRun()}\r\n                    hasProgram={Boolean(hex && compiledBoard)}\r\n                    isRunning={simIsRunning}\r\n                    onStop={simStop}\r\n                  />\r\n\r\n                  {/* Bottom Panel Toggle Button (when collapsed) */}\r\n                  {bottomPanelCollapsed && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setBottomPanelCollapsed(false)}\r\n                      className=\"absolute bottom-2 left-1/2 -translate-x-1/2 flex items-center gap-1.5 rounded-lg bg-ide-panel-surface/90 border border-ide-border px-3 py-1.5 text-xs text-ide-text-muted hover:text-ide-text hover:bg-ide-panel-hover transition-colors backdrop-blur-sm\"\r\n                      title=\"Show Code Editor\"\r\n                    >\r\n                      <ChevronUp className=\"h-3.5 w-3.5\" />\r\n                      <span>Show Editor</span>\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </Panel>\r\n\r\n              {!bottomPanelCollapsed && (\r\n                <>\r\n                  <ResizeHandle direction=\"vertical\" />\r\n\r\n                  {/* Bottom - Code Editor */}\r\n                  <Panel defaultSize={40} minSize={15}>\r\n                    <div className=\"relative h-full flex flex-col\">\r\n                      {/* Collapse toggle header */}\r\n                      <div className=\"flex items-center justify-between border-b border-ide-border bg-ide-panel-surface px-2 py-1\">\r\n                        <span className=\"text-[10px] font-medium text-ide-text-muted uppercase tracking-wider\">Code Editor</span>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => setBottomPanelCollapsed(true)}\r\n                          className=\"flex h-5 w-5 items-center justify-center rounded text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n                          title=\"Collapse Code Editor\"\r\n                        >\r\n                          <ChevronDown className=\"h-3.5 w-3.5\" />\r\n                        </button>\r\n                      </div>\r\n                      <div className=\"flex-1 min-h-0\">\r\n                        <CodeEditorPanel\r\n                          compilationError={compilationError}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </Panel>\r\n                </>\r\n              )}\r\n            </PanelGroup>\r\n          </Panel>\r\n\r\n          <ResizeHandle direction=\"horizontal\" />\r\n\r\n          {/* Right Panel - Terminal/Serial (always visible) */}\r\n          <Panel defaultSize={leftPanelCollapsed ? 40 : 25} minSize={15} maxSize={40}>\r\n            <TerminalPanel\r\n              serialOutput={serialOutput}\r\n              onClearSerial={clearSerialOutput}\r\n              isSimulationRunning={simIsRunning}\r\n            />\r\n          </Panel>\r\n        </PanelGroup>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}