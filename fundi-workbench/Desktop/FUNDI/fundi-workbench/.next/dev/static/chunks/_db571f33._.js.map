{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/nodes/ArduinoNode.tsx"],"sourcesContent":["'use client';\r\n\r\nimport '@wokwi/elements';\r\nimport { memo, useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Handle, Position } from '@xyflow/react';\r\nimport type { WirePoint } from '@/types/wire';\r\n\r\ninterface PinData {\r\n    id: string;\r\n    x: number;\r\n    y: number;\r\n    row: 'top' | 'bottom';\r\n}\r\n\r\ninterface ArduinoNodeData {\r\n    onPinClick?: (nodeId: string, pinId: string, position: WirePoint) => void;\r\n    getCanvasRect?: () => DOMRect | null;\r\n}\r\n\r\ninterface ArduinoNodeProps {\r\n    id: string; // React Flow node ID\r\n    data: ArduinoNodeData;\r\n}\r\n\r\n// Wokwi approach: pinInfo coords are at 96 DPI\r\n// Reference dimensions: 72.58mm x 53.34mm = 274.32px x 201.56px at 96 DPI\r\nconst REFERENCE_WIDTH = 72.58 * (96 / 25.4);  // ~274.32 px\r\nconst REFERENCE_HEIGHT = 53.34 * (96 / 25.4); // ~201.56 px\r\n\r\nfunction ArduinoNode({ id: nodeId, data }: ArduinoNodeProps) {\r\n    const onPinClick = data?.onPinClick;\r\n    const getCanvasRect = data?.getCanvasRect;\r\n    const [hoveredPin, setHoveredPin] = useState<string | null>(null);\r\n    const [pins, setPins] = useState<PinData[]>([]);\r\n    const [svgDimensions, setSvgDimensions] = useState({ width: 274, height: 201 });\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const elementRef = useRef<HTMLElement | null>(null);\r\n\r\n\r\n\r\n    const calculatePins = useCallback(() => {\r\n        const element = elementRef.current as HTMLElement & {\r\n            pinInfo?: { name: string; x: number; y: number }[]\r\n        };\r\n\r\n        if (!element || !element.shadowRoot || !element.pinInfo) return;\r\n\r\n        const svg = element.shadowRoot.querySelector('svg');\r\n        if (!svg) return;\r\n\r\n        const viewBoxAttr = svg.getAttribute('viewBox');\r\n        if (!viewBoxAttr) return;\r\n\r\n        // ViewBox: \"-4 0 72.58 53.34\" (mm)\r\n        const [, , vbW_mm, vbH_mm] = viewBoxAttr.split(/[\\s,]+/).map(parseFloat);\r\n        if (vbW_mm === 0 || vbH_mm === 0) return;\r\n\r\n        // Convert mm to px (96 DPI)\r\n        const MM_TO_PX = 96 / 25.4;\r\n        const vbW_px = vbW_mm * MM_TO_PX;\r\n        const vbH_px = vbH_mm * MM_TO_PX;\r\n\r\n        setSvgDimensions({ width: vbW_px, height: vbH_px });\r\n\r\n        // Use pinInfo coordinates DIRECTLY - they're likely already in the right space\r\n        const mappedPins: PinData[] = element.pinInfo.map((pin) => {\r\n            const isTop = pin.y < vbH_px / 2;\r\n            return {\r\n                id: pin.name,\r\n                x: pin.x,  // Use directly\r\n                y: pin.y,  // Use directly\r\n                row: isTop ? 'top' : 'bottom',\r\n            };\r\n        });\r\n\r\n        setPins(mappedPins);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const initElement = async () => {\r\n            await customElements.whenDefined('wokwi-arduino-uno');\r\n\r\n            const element = containerRef.current?.querySelector('wokwi-arduino-uno');\r\n            if (!element) return;\r\n\r\n            elementRef.current = element as HTMLElement;\r\n\r\n            requestAnimationFrame(() => {\r\n                calculatePins();\r\n                setTimeout(calculatePins, 100);\r\n                setTimeout(calculatePins, 300);\r\n            });\r\n        };\r\n\r\n        initElement();\r\n\r\n        const observer = new ResizeObserver(calculatePins);\r\n        if (containerRef.current) observer.observe(containerRef.current);\r\n\r\n        window.addEventListener('resize', calculatePins);\r\n\r\n        return () => {\r\n            observer.disconnect();\r\n            window.removeEventListener('resize', calculatePins);\r\n        };\r\n    }, [calculatePins]);\r\n\r\n    const handlePinClick = useCallback(\r\n        (e: React.MouseEvent, pin: PinData) => {\r\n            e.stopPropagation();\r\n            if (!onPinClick || !elementRef.current) return;\r\n\r\n            const element = elementRef.current;\r\n            const elementRect = element.getBoundingClientRect();\r\n\r\n            // Calculate scale: how much the element is scaled from reference\r\n            // Reference: 72.58mm x 53.34mm = 274.32px x 201.56px at 96 DPI\r\n            const REFERENCE_WIDTH = 72.58 * (96 / 25.4);\r\n            const REFERENCE_HEIGHT = 53.34 * (96 / 25.4);\r\n            const scaleX = elementRect.width / REFERENCE_WIDTH;\r\n            const scaleY = elementRect.height / REFERENCE_HEIGHT;\r\n\r\n            // Transform pin coordinates (96 DPI) to screen coordinates\r\n            const screenX = elementRect.left + pin.x * scaleX;\r\n            const screenY = elementRect.top + pin.y * scaleY;\r\n\r\n            const canvasRect = getCanvasRect?.();\r\n            const canvasRelative = canvasRect\r\n                ? { x: screenX - canvasRect.left, y: screenY - canvasRect.top }\r\n                : { x: screenX, y: screenY };\r\n\r\n            onPinClick(nodeId, pin.id, canvasRelative);\r\n        },\r\n        [onPinClick, nodeId, getCanvasRect]\r\n    );\r\n\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            className=\"relative\"\r\n            style={{\r\n                display: 'inline-block',\r\n                lineHeight: 0,\r\n            }}\r\n        >\r\n            {/* The Arduino Board */}\r\n            <wokwi-arduino-uno style={{ display: 'block' }} />\r\n\r\n            {/* Pin hitboxes (Wokwi-style): big invisible clickable targets */}\r\n            <div\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 20,\r\n                }}\r\n            >\r\n                {pins.map((pin) => {\r\n                    const leftPct = svgDimensions.width\r\n                        ? (pin.x / svgDimensions.width) * 100\r\n                        : 0;\r\n                    const topPct = svgDimensions.height\r\n                        ? (pin.y / svgDimensions.height) * 100\r\n                        : 0;\r\n\r\n                    return (\r\n                        <div\r\n                            key={pin.id}\r\n                            className=\"nodrag\"\r\n                            data-fundi-pin=\"true\"\r\n                            data-node-id={nodeId}\r\n                            data-pin-id={pin.id}\r\n                            style={{\r\n                                position: 'absolute',\r\n                                left: `${leftPct}%`,\r\n                                top: `${topPct}%`,\r\n                                width: 14,\r\n                                height: 14,\r\n                                transform: 'translate(-50%, -50%)',\r\n                                borderRadius: 9999,\r\n                                pointerEvents: 'auto',\r\n                                cursor: 'pointer',\r\n                                background: 'transparent',\r\n                                touchAction: 'none',\r\n                                zIndex: 30,\r\n                            }}\r\n                            onPointerDown={(e) => {\r\n                                // Prevent ReactFlow node dragging from stealing the interaction\r\n                                e.stopPropagation();\r\n                            }}\r\n                            onMouseEnter={() => setHoveredPin(pin.id)}\r\n                            onMouseLeave={() => setHoveredPin(null)}\r\n                            onClick={(e) => handlePinClick(e, pin)}\r\n                            aria-label={`Pin ${pin.id}`}\r\n                        />\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* SVG Overlay (visual only) */}\r\n            <svg\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    overflow: 'visible',\r\n                    zIndex: 10,\r\n                }}\r\n                viewBox={`0 0 ${svgDimensions.width} ${svgDimensions.height}`}\r\n            >\r\n                {pins.map((pin) => {\r\n                    const isHovered = hoveredPin === pin.id;\r\n\r\n                    return (\r\n                        <g key={pin.id}>\r\n                            <circle\r\n                                cx={pin.x}\r\n                                cy={pin.y}\r\n                                r={isHovered ? 3 : 2}\r\n                                fill={isHovered ? '#22c55e' : 'rgba(34, 197, 94, 0.5)'}\r\n                                stroke={isHovered ? '#16a34a' : 'rgba(22, 163, 74, 0.7)'}\r\n                                strokeWidth={0.5}\r\n                                style={{ transition: 'all 0.1s ease' }}\r\n                            />\r\n                            {isHovered && (\r\n                                <g>\r\n                                    <rect\r\n                                        x={pin.x - 15}\r\n                                        y={pin.row === 'top' ? pin.y + 5 : pin.y - 15}\r\n                                        width={30}\r\n                                        height={10}\r\n                                        rx={2}\r\n                                        fill=\"rgba(15, 23, 42, 0.95)\"\r\n                                        stroke=\"rgba(34, 197, 94, 0.5)\"\r\n                                        strokeWidth={0.5}\r\n                                    />\r\n                                    <text\r\n                                        x={pin.x}\r\n                                        y={pin.row === 'top' ? pin.y + 12.5 : pin.y - 7.5}\r\n                                        textAnchor=\"middle\"\r\n                                        fill=\"#4ade80\"\r\n                                        fontSize={5}\r\n                                        fontFamily=\"monospace\"\r\n                                    >\r\n                                        {pin.id}\r\n                                    </text>\r\n                                </g>\r\n                            )}\r\n                        </g>\r\n                    );\r\n                })}\r\n            </svg>\r\n\r\n            {pins.map((pin) => (\r\n                <Handle\r\n                    key={pin.id}\r\n                    id={pin.id}\r\n                    type=\"source\"\r\n                    position={pin.row === 'top' ? Position.Top : Position.Bottom}\r\n                    style={{ opacity: 0, pointerEvents: 'none' }}\r\n                />\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default memo(ArduinoNode);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 309, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/lib/wokwiParts.ts"],"sourcesContent":["/**\r\n * Registry of available Wokwi parts\r\n */\r\nexport interface WokwiPartConfig {\r\n    name: string;\r\n    element: string;\r\n    description?: string;\r\n    category?: 'mcu' | 'displays' | 'leds' | 'sensors';\r\n}\r\n\r\nexport const WOKWI_PARTS: Record<string, WokwiPartConfig> = {\r\n    'arduino-uno': {\r\n        name: 'Arduino Uno',\r\n        element: 'wokwi-arduino-uno',\r\n        description: 'ATmega328P-based microcontroller board',\r\n        category: 'mcu',\r\n    },\r\n    'esp32-devkit-v1': {\r\n        name: 'ESP32 DevKit V1',\r\n        element: 'wokwi-esp32-devkit-v1',\r\n        description: 'ESP32 development board with WiFi & Bluetooth',\r\n        category: 'mcu',\r\n    },\r\n    'arduino-mega': {\r\n        name: 'Arduino Mega',\r\n        element: 'wokwi-arduino-mega',\r\n        description: 'ATmega2560-based board with more pins',\r\n        category: 'mcu',\r\n    },\r\n    'arduino-nano': {\r\n        name: 'Arduino Nano',\r\n        element: 'wokwi-arduino-nano',\r\n        description: 'Compact ATmega328P board',\r\n        category: 'mcu',\r\n    },\r\n\r\n    'nano-rp2040-connect': {\r\n        name: 'Nano RP2040 Connect',\r\n        element: 'wokwi-nano-rp2040-connect',\r\n        description: 'RP2040-based Arduino Nano form factor',\r\n        category: 'mcu',\r\n    },\r\n\r\n    'franzininho': {\r\n        name: 'Franzininho',\r\n        element: 'wokwi-franzininho',\r\n        description: 'ATtiny85-based development board',\r\n        category: 'mcu',\r\n    },\r\n\r\n    // Displays\r\n    'oled-128x64-i2c': {\r\n        name: 'OLED 128x64 (I2C)',\r\n        element: 'wokwi-ssd1306',\r\n        description: 'SSD1306 monochrome OLED display',\r\n        category: 'displays',\r\n    },\r\n    'lcd1602': {\r\n        name: 'LCD 1602',\r\n        element: 'wokwi-lcd1602',\r\n        description: '16x2 character LCD',\r\n        category: 'displays',\r\n    },\r\n    'seven-segment': {\r\n        name: '7-Segment Display',\r\n        element: 'wokwi-7segment',\r\n        description: 'Single-digit 7-segment display',\r\n        category: 'displays',\r\n    },\r\n\r\n    'lcd2004': {\r\n        name: 'LCD 2004',\r\n        element: 'wokwi-lcd2004',\r\n        description: '20x4 character LCD',\r\n        category: 'displays',\r\n    },\r\n\r\n    'ili9341': {\r\n        name: 'ILI9341 TFT',\r\n        element: 'wokwi-ili9341',\r\n        description: 'SPI TFT display (ILI9341)',\r\n        category: 'displays',\r\n    },\r\n\r\n    // LEDs\r\n    'led': {\r\n        name: 'LED',\r\n        element: 'wokwi-led',\r\n        description: 'Basic single-color LED',\r\n        category: 'leds',\r\n    },\r\n    'rgb-led': {\r\n        name: 'RGB LED',\r\n        element: 'wokwi-rgb-led',\r\n        description: 'Common-cathode RGB LED',\r\n        category: 'leds',\r\n    },\r\n    'neopixel': {\r\n        name: 'NeoPixel (WS2812)',\r\n        element: 'wokwi-neopixel',\r\n        description: 'Addressable RGB LED (single)',\r\n        category: 'leds',\r\n    },\r\n\r\n    'neopixel-matrix': {\r\n        name: 'NeoPixel Matrix',\r\n        element: 'wokwi-neopixel-matrix',\r\n        description: 'Addressable RGB LED matrix',\r\n        category: 'leds',\r\n    },\r\n\r\n    'led-bar-graph': {\r\n        name: 'LED Bar Graph',\r\n        element: 'wokwi-led-bar-graph',\r\n        description: '10-segment LED bar graph',\r\n        category: 'leds',\r\n    },\r\n\r\n    'led-ring': {\r\n        name: 'LED Ring',\r\n        element: 'wokwi-led-ring',\r\n        description: 'Addressable LED ring',\r\n        category: 'leds',\r\n    },\r\n\r\n    // Sensors\r\n    'dht22': {\r\n        name: 'DHT22',\r\n        element: 'wokwi-dht22',\r\n        description: 'Temperature & humidity sensor',\r\n        category: 'sensors',\r\n    },\r\n    'hc-sr04': {\r\n        name: 'HC-SR04',\r\n        element: 'wokwi-hc-sr04',\r\n        description: 'Ultrasonic distance sensor',\r\n        category: 'sensors',\r\n    },\r\n    'pir-motion': {\r\n        name: 'PIR Motion Sensor',\r\n        element: 'wokwi-pir-motion-sensor',\r\n        description: 'Passive infrared motion sensor',\r\n        category: 'sensors',\r\n    },\r\n    'photoresistor': {\r\n        name: 'Photoresistor (LDR)',\r\n        element: 'wokwi-photoresistor-sensor',\r\n        description: 'Light-dependent resistor sensor',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'mpu6050': {\r\n        name: 'MPU6050',\r\n        element: 'wokwi-mpu6050',\r\n        description: 'Accelerometer + gyroscope (I2C)',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'ds1307': {\r\n        name: 'DS1307 RTC',\r\n        element: 'wokwi-ds1307',\r\n        description: 'Real-time clock module (I2C)',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'ir-receiver': {\r\n        name: 'IR Receiver',\r\n        element: 'wokwi-ir-receiver',\r\n        description: 'Infrared receiver',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'ir-remote': {\r\n        name: 'IR Remote',\r\n        element: 'wokwi-ir-remote',\r\n        description: 'Infrared remote control',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'analog-joystick': {\r\n        name: 'Analog Joystick',\r\n        element: 'wokwi-analog-joystick',\r\n        description: '2-axis analog joystick',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'rotary-encoder': {\r\n        name: 'Rotary Encoder (KY-040)',\r\n        element: 'wokwi-ky-040',\r\n        description: 'Incremental rotary encoder',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'pushbutton': {\r\n        name: 'Pushbutton',\r\n        element: 'wokwi-pushbutton',\r\n        description: 'Momentary pushbutton',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'pushbutton-6mm': {\r\n        name: 'Pushbutton (6mm)',\r\n        element: 'wokwi-pushbutton-6mm',\r\n        description: 'Tactile 6mm pushbutton',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'resistor': {\r\n        name: 'Resistor',\r\n        element: 'wokwi-resistor',\r\n        description: 'Generic resistor',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'potentiometer': {\r\n        name: 'Potentiometer',\r\n        element: 'wokwi-potentiometer',\r\n        description: 'Rotary potentiometer',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'slide-potentiometer': {\r\n        name: 'Slide Potentiometer',\r\n        element: 'wokwi-slide-potentiometer',\r\n        description: 'Linear slide potentiometer',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'slide-switch': {\r\n        name: 'Slide Switch',\r\n        element: 'wokwi-slide-switch',\r\n        description: '2-position slide switch',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'dip-switch-8': {\r\n        name: 'DIP Switch (8)',\r\n        element: 'wokwi-dip-switch-8',\r\n        description: '8-position DIP switch',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'buzzer': {\r\n        name: 'Buzzer',\r\n        element: 'wokwi-buzzer',\r\n        description: 'Piezo buzzer',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'servo': {\r\n        name: 'Servo',\r\n        element: 'wokwi-servo',\r\n        description: 'RC servo motor',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'membrane-keypad': {\r\n        name: 'Membrane Keypad',\r\n        element: 'wokwi-membrane-keypad',\r\n        description: 'Matrix keypad',\r\n        category: 'sensors',\r\n    },\r\n\r\n    'microsd-card': {\r\n        name: 'MicroSD Card',\r\n        element: 'wokwi-microsd-card',\r\n        description: 'MicroSD card module',\r\n        category: 'sensors',\r\n    },\r\n};\r\n\r\nexport type WokwiPartType = keyof typeof WOKWI_PARTS;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AAQM,MAAM,cAA+C;IACxD,eAAe;QACX,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,mBAAmB;QACf,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,gBAAgB;QACZ,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,gBAAgB;QACZ,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,uBAAuB;QACnB,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,eAAe;QACX,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,WAAW;IACX,mBAAmB;QACf,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,iBAAiB;QACb,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,OAAO;IACP,OAAO;QACH,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,YAAY;QACR,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,mBAAmB;QACf,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,iBAAiB;QACb,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,YAAY;QACR,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,UAAU;IACV,SAAS;QACL,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,cAAc;QACV,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IACA,iBAAiB;QACb,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,WAAW;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,UAAU;QACN,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,eAAe;QACX,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,aAAa;QACT,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,mBAAmB;QACf,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,kBAAkB;QACd,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,cAAc;QACV,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,kBAAkB;QACd,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,YAAY;QACR,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,iBAAiB;QACb,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,uBAAuB;QACnB,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,gBAAgB;QACZ,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,gBAAgB;QACZ,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,UAAU;QACN,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,SAAS;QACL,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,mBAAmB;QACf,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;IAEA,gBAAgB;QACZ,MAAM;QACN,SAAS;QACT,aAAa;QACb,UAAU;IACd;AACJ"}},
    {"offset": {"line": 555, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/nodes/WokwiPartNode.tsx"],"sourcesContent":["'use client';\r\n\r\nimport '@wokwi/elements';\r\nimport { memo, useEffect, useRef, useState, useCallback } from 'react';\r\nimport type { ElementType } from 'react';\r\nimport { WOKWI_PARTS, WokwiPartType } from '@/lib/wokwiParts';\r\nimport type { WirePoint } from '@/types/wire';\r\n\r\ninterface PinData {\r\n    id: string;\r\n    x: number;\r\n    y: number;\r\n    row: 'top' | 'bottom' | 'left' | 'right';\r\n}\r\n\r\ninterface WokwiPartNodeData {\r\n    onPinClick?: (nodeId: string, pinId: string, position: WirePoint) => void;\r\n    getCanvasRect?: () => DOMRect | null;\r\n}\r\n\r\ninterface WokwiPartNodeProps {\r\n    id?: string;\r\n    data?: WokwiPartNodeData;\r\n    partType?: WokwiPartType; // Can be passed directly or via data\r\n}\r\n\r\nfunction getPartTypeFromData(data: WokwiPartNodeData | undefined): WokwiPartType | null {\r\n    const maybe = (data as unknown as { partType?: unknown } | undefined)?.partType;\r\n    return typeof maybe === 'string' ? (maybe as WokwiPartType) : null;\r\n}\r\n\r\n/**\r\n * Generic Wokwi Part Node - renders any Wokwi element with pin overlays\r\n */\r\nfunction WokwiPartNode({ id: nodeId = 'preview', data, partType: propPartType }: WokwiPartNodeProps) {\r\n    const onPinClick = data?.onPinClick;\r\n    const getCanvasRect = data?.getCanvasRect;\r\n    const partType = propPartType ?? getPartTypeFromData(data) ?? 'arduino-uno';\r\n\r\n    const [hoveredPin, setHoveredPin] = useState<string | null>(null);\r\n    const [pins, setPins] = useState<PinData[]>([]);\r\n    const [svgDimensions, setSvgDimensions] = useState({ width: 100, height: 100 });\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const elementRef = useRef<HTMLElement | null>(null);\r\n\r\n    const partConfig = WOKWI_PARTS[partType];\r\n    const PartElement = (partConfig?.element ?? null) as ElementType | null;\r\n\r\n    const handlePinClick = useCallback(\r\n        (e: React.MouseEvent, pin: PinData) => {\r\n            e.stopPropagation();\r\n            if (!onPinClick || !elementRef.current) return;\r\n\r\n            const element = elementRef.current;\r\n            const elementRect = element.getBoundingClientRect();\r\n\r\n            // Calculate scale: how much the element is scaled from its internal coordinate space\r\n            const scaleX = elementRect.width / svgDimensions.width;\r\n            const scaleY = elementRect.height / svgDimensions.height;\r\n\r\n            // Transform pin coordinates to screen coordinates\r\n            const screenX = elementRect.left + pin.x * scaleX;\r\n            const screenY = elementRect.top + pin.y * scaleY;\r\n\r\n            const canvasRect = getCanvasRect?.();\r\n            const canvasRelative = canvasRect\r\n                ? { x: screenX - canvasRect.left, y: screenY - canvasRect.top }\r\n                : { x: screenX, y: screenY };\r\n\r\n            onPinClick(nodeId, pin.id, canvasRelative);\r\n        },\r\n        [onPinClick, nodeId, getCanvasRect, svgDimensions]\r\n    );\r\n\r\n    const calculatePins = useCallback(() => {\r\n        const element = elementRef.current as HTMLElement & {\r\n            pinInfo?: { name: string; x: number; y: number }[]\r\n        };\r\n\r\n        if (!element || !element.shadowRoot || !element.pinInfo) return;\r\n\r\n        const svg = element.shadowRoot.querySelector('svg');\r\n        if (!svg) return;\r\n\r\n        const viewBoxAttr = svg.getAttribute('viewBox');\r\n        const widthAttr = svg.getAttribute('width') || '';\r\n        const heightAttr = svg.getAttribute('height') || '';\r\n\r\n        if (!viewBoxAttr) return;\r\n\r\n        // Parse viewBox: \"minX minY width height\"\r\n        const [, , vbW, vbH] = viewBoxAttr.split(/[\\s,]+/).map(parseFloat);\r\n        if (!vbW || !vbH) return;\r\n\r\n        // Parse mm dimensions if present\r\n        const widthMM = widthAttr.includes('mm') ? parseFloat(widthAttr) : null;\r\n        const heightMM = heightAttr.includes('mm') ? parseFloat(heightAttr) : null;\r\n\r\n        // Detect if viewBox is in mm by checking if it matches the mm dimensions\r\n        // Arduino: viewBox=\"-4 0 72.58 53.34\" with width=\"72.58mm\" height=\"53.34mm\" -> viewBox IS in mm\r\n        // ESP32: viewBox=\"0 0 107 201\" with width=\"28.2mm\" height=\"54.053mm\" -> viewBox is NOT in mm\r\n        const viewBoxMatchesMM =\r\n            widthMM !== null &&\r\n            heightMM !== null &&\r\n            Math.abs(vbW - widthMM) < 1 &&\r\n            Math.abs(vbH - heightMM) < 1;\r\n\r\n        const MM_TO_PX = 96 / 25.4;\r\n\r\n        let overlayWidth: number;\r\n        let overlayHeight: number;\r\n\r\n        if (viewBoxMatchesMM) {\r\n            // ViewBox is in mm, convert to pixels to match pinInfo coordinates\r\n            overlayWidth = vbW * MM_TO_PX;\r\n            overlayHeight = vbH * MM_TO_PX;\r\n        } else {\r\n            // ViewBox is already in the correct coordinate space (like ESP32)\r\n            overlayWidth = vbW;\r\n            overlayHeight = vbH;\r\n        }\r\n\r\n        setSvgDimensions({ width: overlayWidth, height: overlayHeight });\r\n\r\n        // Map pins - pinInfo coordinates work directly in the overlay's space\r\n        const mappedPins: PinData[] = element.pinInfo.map((pin) => {\r\n            // Determine which edge the pin is closest to\r\n            const relX = pin.x / overlayWidth;\r\n            const relY = pin.y / overlayHeight;\r\n\r\n            let row: 'top' | 'bottom' | 'left' | 'right';\r\n            if (relX < 0.15) row = 'left';\r\n            else if (relX > 0.85) row = 'right';\r\n            else if (relY < 0.5) row = 'top';\r\n            else row = 'bottom';\r\n\r\n            return {\r\n                id: pin.name,\r\n                x: pin.x,\r\n                y: pin.y,\r\n                row,\r\n            };\r\n        });\r\n\r\n        setPins(mappedPins);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const initElement = async () => {\r\n            await customElements.whenDefined(partConfig.element);\r\n\r\n            const element = containerRef.current?.querySelector(partConfig.element);\r\n            if (!element) return;\r\n\r\n            elementRef.current = element as HTMLElement;\r\n\r\n            requestAnimationFrame(() => {\r\n                calculatePins();\r\n                setTimeout(calculatePins, 100);\r\n                setTimeout(calculatePins, 300);\r\n            });\r\n        };\r\n\r\n        initElement();\r\n\r\n        const observer = new ResizeObserver(calculatePins);\r\n        if (containerRef.current) observer.observe(containerRef.current);\r\n\r\n        window.addEventListener('resize', calculatePins);\r\n\r\n        return () => {\r\n            observer.disconnect();\r\n            window.removeEventListener('resize', calculatePins);\r\n        };\r\n    }, [calculatePins, partConfig.element]);\r\n\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            className=\"relative glass-panel border-alchemist rounded-md\"\r\n            style={{\r\n                display: 'inline-block',\r\n                lineHeight: 0,\r\n            }}\r\n        >\r\n            {/* Render the Wokwi custom element */}\r\n            {PartElement ? <PartElement style={{ display: 'block' }} /> : null}\r\n\r\n            {/* Pin hitboxes (Wokwi-style): big invisible clickable targets */}\r\n            <div\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 20,\r\n                }}\r\n            >\r\n                {pins.map((pin) => {\r\n                    const leftPct = svgDimensions.width\r\n                        ? (pin.x / svgDimensions.width) * 100\r\n                        : 0;\r\n                    const topPct = svgDimensions.height\r\n                        ? (pin.y / svgDimensions.height) * 100\r\n                        : 0;\r\n\r\n                    return (\r\n                        <div\r\n                            key={pin.id}\r\n                            className=\"nodrag\"\r\n                            data-fundi-pin=\"true\"\r\n                            data-node-id={nodeId}\r\n                            data-pin-id={pin.id}\r\n                            style={{\r\n                                position: 'absolute',\r\n                                left: `${leftPct}%`,\r\n                                top: `${topPct}%`,\r\n                                width: 14,\r\n                                height: 14,\r\n                                transform: 'translate(-50%, -50%)',\r\n                                borderRadius: 9999,\r\n                                pointerEvents: 'auto',\r\n                                cursor: 'pointer',\r\n                                background: 'transparent',\r\n                                touchAction: 'none',\r\n                                zIndex: 30,\r\n                            }}\r\n                            onPointerDown={(e) => {\r\n                                // Prevent ReactFlow node dragging from stealing the interaction\r\n                                e.stopPropagation();\r\n                            }}\r\n                            onMouseEnter={() => setHoveredPin(pin.id)}\r\n                            onMouseLeave={() => setHoveredPin(null)}\r\n                            onClick={(e) => handlePinClick(e, pin)}\r\n                            aria-label={`Pin ${pin.id}`}\r\n                        />\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* SVG Overlay - viewBox matches the pinInfo coordinate space */}\r\n            <svg\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    overflow: 'visible',\r\n                    zIndex: 10,\r\n                }}\r\n                viewBox={`0 0 ${svgDimensions.width} ${svgDimensions.height}`}\r\n            >\r\n                {pins.map((pin) => {\r\n                    const isHovered = hoveredPin === pin.id;\r\n\r\n                    return (\r\n                        <g key={pin.id}>\r\n                            {/* Visual pin indicator - Copper Pad style */}\r\n                            <circle\r\n                                cx={pin.x}\r\n                                cy={pin.y}\r\n                                r={isHovered ? 3.5 : 2.5}\r\n                                fill={isHovered ? '#D4AF37' : '#B87333'}\r\n                                stroke={isHovered ? '#00F0FF' : '#8B4513'}\r\n                                strokeWidth={isHovered ? 1 : 0.75}\r\n                                style={{ \r\n                                    transition: 'all 0.1s ease', \r\n                                    pointerEvents: 'none',\r\n                                    filter: isHovered ? 'drop-shadow(0 0 3px #00F0FF)' : 'none'\r\n                                }}\r\n                            />\r\n                            {isHovered && (\r\n                                <g>\r\n                                    <rect\r\n                                        x={pin.x - 15}\r\n                                        y={pin.row === 'top' || pin.row === 'left' ? pin.y + 6 : pin.y - 18}\r\n                                        width={30}\r\n                                        height={12}\r\n                                        rx={2}\r\n                                        fill=\"rgba(21, 27, 43, 0.95)\"\r\n                                        stroke=\"rgba(212, 175, 55, 0.5)\"\r\n                                        strokeWidth={0.5}\r\n                                    />\r\n                                    <text\r\n                                        x={pin.x}\r\n                                        y={pin.row === 'top' || pin.row === 'left' ? pin.y + 15 : pin.y - 9}\r\n                                        textAnchor=\"middle\"\r\n                                        fill=\"#D4AF37\"\r\n                                        fontSize={6}\r\n                                        fontFamily=\"monospace\"\r\n                                        fontWeight=\"bold\"\r\n                                    >\r\n                                        {pin.id}\r\n                                    </text>\r\n                                </g>\r\n                            )}\r\n                        </g>\r\n                    );\r\n                })}\r\n            </svg>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default memo(WokwiPartNode);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 877, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/cn.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx'\r\nimport { twMerge } from 'tailwind-merge'\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs))\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB"}},
    {"offset": {"line": 895, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/ComponentLibrary.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { memo, useMemo, useState } from 'react';\r\nimport { Cpu, Lightbulb, Gauge, Monitor } from 'lucide-react';\r\nimport type { WokwiPartType } from '@/lib/wokwiParts';\r\nimport { WOKWI_PARTS } from '@/lib/wokwiParts';\r\nimport { cn } from '@/utils/cn';\r\n\r\nexport const FUNDI_PART_MIME = 'application/x-fundi-part';\r\n\r\ntype PartCatalogItem = {\r\n  id: WokwiPartType;\r\n  name: string;\r\n  description?: string;\r\n};\r\n\r\ntype CatalogCategory = {\r\n  key: 'mcu' | 'displays' | 'leds' | 'sensors';\r\n  title: string;\r\n  items: PartCatalogItem[];\r\n  icon: React.ComponentType<{ className?: string }>;\r\n};\r\n\r\nexport function buildPartCatalog(): CatalogCategory[] {\r\n  const base: Record<CatalogCategory['key'], PartCatalogItem[]> = {\r\n    mcu: [],\r\n    displays: [],\r\n    leds: [],\r\n    sensors: [],\r\n  };\r\n\r\n  for (const id of Object.keys(WOKWI_PARTS) as WokwiPartType[]) {\r\n    const cfg = WOKWI_PARTS[id];\r\n    const cat = cfg.category ?? 'mcu';\r\n    base[cat].push({ id, name: cfg.name, description: cfg.description });\r\n  }\r\n\r\n  return (\r\n    [\r\n      { key: 'mcu', title: 'MCU', items: base.mcu, icon: Cpu },\r\n      { key: 'displays', title: 'Display', items: base.displays, icon: Monitor },\r\n      { key: 'leds', title: 'LEDs', items: base.leds, icon: Lightbulb },\r\n      { key: 'sensors', title: 'Input', items: base.sensors, icon: Gauge },\r\n    ] satisfies CatalogCategory[]\r\n  );\r\n}\r\n\r\nfunction ComponentLibrary() {\r\n  const categories = useMemo(() => buildPartCatalog(), []);\r\n  const [active, setActive] = useState<CatalogCategory['key']>('mcu');\r\n\r\n  const activeCategory = categories.find((c) => c.key === active) ?? categories[0];\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden\">\r\n      {/* Category Tabs - Horizontal Pills */}\r\n      <div className=\"shrink-0 border-b border-ide-border pb-3 mb-3\">\r\n        <div className=\"flex gap-1\">\r\n          {categories.map((cat) => {\r\n            const isActive = cat.key === active;\r\n            const Icon = cat.icon;\r\n\r\n            return (\r\n              <button\r\n                key={cat.key}\r\n                type=\"button\"\r\n                onClick={() => setActive(cat.key)}\r\n                className={cn(\r\n                  'flex items-center gap-1.5 rounded-md px-2 py-1.5 text-xs font-medium transition-all',\r\n                  isActive\r\n                    ? 'bg-ide-accent/20 text-ide-accent'\r\n                    : 'text-ide-text-muted hover:text-ide-text hover:bg-ide-panel-hover'\r\n                )}\r\n                title={cat.title}\r\n              >\r\n                <Icon className=\"h-3.5 w-3.5\" />\r\n                <span>{cat.title}</span>\r\n              </button>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Component Grid */}\r\n      <div className=\"min-h-0 flex-1 overflow-auto\">\r\n        {activeCategory.items.length === 0 ? (\r\n          <div className=\"flex h-full items-center justify-center text-xs text-ide-text-subtle\">\r\n            No components in this category yet.\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {activeCategory.items.map((item) => {\r\n              const Icon = activeCategory.icon;\r\n              \r\n              return (\r\n                <div\r\n                  key={item.id}\r\n                  draggable\r\n                  onDragStart={(e) => {\r\n                    e.dataTransfer.effectAllowed = 'copy';\r\n                    e.dataTransfer.setData(FUNDI_PART_MIME, item.id);\r\n                  }}\r\n                  className={cn(\r\n                    'group relative flex cursor-grab flex-col items-center justify-center',\r\n                    'rounded-lg border p-3 transition-all duration-200',\r\n                    'bg-ide-panel-surface border-ide-border',\r\n                    'hover:border-ide-accent/50 hover:bg-ide-panel-hover',\r\n                    'active:cursor-grabbing active:scale-95'\r\n                  )}\r\n                  title={item.description ?? item.name}\r\n                >\r\n                  {/* Icon */}\r\n                  <Icon className=\"h-6 w-6 text-ide-text-muted transition-colors group-hover:text-ide-accent\" />\r\n                  \r\n                  {/* Label */}\r\n                  <div className=\"mt-2 text-center\">\r\n                    <div className=\"font-mono text-[10px] text-ide-text-muted group-hover:text-ide-text transition-colors leading-tight\">\r\n                      {item.name}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(ComponentLibrary);\r\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;;;AANA;;;;;AAQO,MAAM,kBAAkB;AAexB,SAAS;IACd,MAAM,OAA0D;QAC9D,KAAK,EAAE;QACP,UAAU,EAAE;QACZ,MAAM,EAAE;QACR,SAAS,EAAE;IACb;IAEA,KAAK,MAAM,MAAM,OAAO,IAAI,CAAC,mIAAW,EAAsB;QAC5D,MAAM,MAAM,mIAAW,CAAC,GAAG;QAC3B,MAAM,MAAM,IAAI,QAAQ,IAAI;QAC5B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;YAAE;YAAI,MAAM,IAAI,IAAI;YAAE,aAAa,IAAI,WAAW;QAAC;IACpE;IAEA,OACE;QACE;YAAE,KAAK;YAAO,OAAO;YAAO,OAAO,KAAK,GAAG;YAAE,MAAM,0MAAG;QAAC;QACvD;YAAE,KAAK;YAAY,OAAO;YAAW,OAAO,KAAK,QAAQ;YAAE,MAAM,sNAAO;QAAC;QACzE;YAAE,KAAK;YAAQ,OAAO;YAAQ,OAAO,KAAK,IAAI;YAAE,MAAM,4NAAS;QAAC;QAChE;YAAE,KAAK;YAAW,OAAO;YAAS,OAAO,KAAK,OAAO;YAAE,MAAM,gNAAK;QAAC;KACpE;AAEL;AAEA,SAAS;;IACP,MAAM,aAAa,IAAA,wKAAO;gDAAC,IAAM;+CAAoB,EAAE;IACvD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAyB;IAE7D,MAAM,iBAAiB,WAAW,IAAI,CAAC,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW,UAAU,CAAC,EAAE;IAEhF,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;8BACZ,WAAW,GAAG,CAAC,CAAC;wBACf,MAAM,WAAW,IAAI,GAAG,KAAK;wBAC7B,MAAM,OAAO,IAAI,IAAI;wBAErB,qBACE,6LAAC;4BAEC,MAAK;4BACL,SAAS,IAAM,UAAU,IAAI,GAAG;4BAChC,WAAW,IAAA,oHAAE,EACX,uFACA,WACI,qCACA;4BAEN,OAAO,IAAI,KAAK;;8CAEhB,6LAAC;oCAAK,WAAU;;;;;;8CAChB,6LAAC;8CAAM,IAAI,KAAK;;;;;;;2BAZX,IAAI,GAAG;;;;;oBAelB;;;;;;;;;;;0BAKJ,6LAAC;gBAAI,WAAU;0BACZ,eAAe,KAAK,CAAC,MAAM,KAAK,kBAC/B,6LAAC;oBAAI,WAAU;8BAAuE;;;;;yCAItF,6LAAC;oBAAI,WAAU;8BACZ,eAAe,KAAK,CAAC,GAAG,CAAC,CAAC;wBACzB,MAAM,OAAO,eAAe,IAAI;wBAEhC,qBACE,6LAAC;4BAEC,SAAS;4BACT,aAAa,CAAC;gCACZ,EAAE,YAAY,CAAC,aAAa,GAAG;gCAC/B,EAAE,YAAY,CAAC,OAAO,CAAC,iBAAiB,KAAK,EAAE;4BACjD;4BACA,WAAW,IAAA,oHAAE,EACX,wEACA,qDACA,0CACA,uDACA;4BAEF,OAAO,KAAK,WAAW,IAAI,KAAK,IAAI;;8CAGpC,6LAAC;oCAAK,WAAU;;;;;;8CAGhB,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC;wCAAI,WAAU;kDACZ,KAAK,IAAI;;;;;;;;;;;;2BArBT,KAAK,EAAE;;;;;oBA0BlB;;;;;;;;;;;;;;;;;AAMZ;GAjFS;KAAA;2DAmFM,IAAA,qKAAI,EAAC"}},
    {"offset": {"line": 1097, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/StatusBadge.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { Cpu, Wifi, WifiOff } from 'lucide-react';\r\nimport { cn } from '@/utils/cn';\r\n\r\ninterface StatusBadgeProps {\r\n  deviceName?: string;\r\n  isConnected?: boolean;\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * StatusBadge - Pill component showing device connection status\r\n * Dark IDE theme compatible\r\n */\r\nexport default function StatusBadge({\r\n  deviceName = 'Arduino Uno',\r\n  isConnected = true,\r\n  className,\r\n}: StatusBadgeProps) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'inline-flex items-center gap-2 rounded-md',\r\n        'bg-ide-panel-bg border border-ide-border',\r\n        'px-2.5 py-1',\r\n        'transition-all duration-200',\r\n        className,\r\n      )}\r\n    >\r\n      {/* Device Icon */}\r\n      <Cpu className=\"h-3.5 w-3.5 text-ide-text-muted\" aria-hidden={true} />\r\n\r\n      {/* Device Name */}\r\n      <span className=\"text-xs font-medium text-ide-text\">{deviceName}</span>\r\n\r\n      {/* Divider */}\r\n      <div className=\"h-3 w-px bg-ide-border\" />\r\n\r\n      {/* Connection Status */}\r\n      <div className=\"flex items-center gap-1.5\">\r\n        {isConnected ? (\r\n          <>\r\n            <Wifi className=\"h-3 w-3 text-ide-success\" aria-hidden={true} />\r\n            <span className=\"text-xs font-medium text-ide-success\">Connected</span>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <WifiOff className=\"h-3 w-3 text-ide-text-subtle\" aria-hidden={true} />\r\n            <span className=\"text-xs font-medium text-ide-text-subtle\">Disconnected</span>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Active indicator dot when connected */}\r\n      {isConnected && (\r\n        <div className=\"relative ml-0.5\">\r\n          <div className=\"h-1.5 w-1.5 rounded-full bg-ide-success\" />\r\n          <div className=\"absolute inset-0 h-1.5 w-1.5 rounded-full bg-ide-success animate-ping opacity-75\" />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AACA;AAHA;;;;AAee,SAAS,YAAY,EAClC,aAAa,aAAa,EAC1B,cAAc,IAAI,EAClB,SAAS,EACQ;IACjB,qBACE,6LAAC;QACC,WAAW,IAAA,oHAAE,EACX,6CACA,4CACA,eACA,+BACA;;0BAIF,6LAAC,0MAAG;gBAAC,WAAU;gBAAkC,eAAa;;;;;;0BAG9D,6LAAC;gBAAK,WAAU;0BAAqC;;;;;;0BAGrD,6LAAC;gBAAI,WAAU;;;;;;0BAGf,6LAAC;gBAAI,WAAU;0BACZ,4BACC;;sCACE,6LAAC,6MAAI;4BAAC,WAAU;4BAA2B,eAAa;;;;;;sCACxD,6LAAC;4BAAK,WAAU;sCAAuC;;;;;;;iDAGzD;;sCACE,6LAAC,0NAAO;4BAAC,WAAU;4BAA+B,eAAa;;;;;;sCAC/D,6LAAC;4BAAK,WAAU;sCAA2C;;;;;;;;;;;;;YAMhE,6BACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;;;;;kCACf,6LAAC;wBAAI,WAAU;;;;;;;;;;;;;;;;;;AAKzB;KAhDwB"}},
    {"offset": {"line": 1223, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/store/useAppStore.ts"],"sourcesContent":["import { create } from 'zustand'\r\nimport { nanoid } from 'nanoid'\r\n\r\nexport type CircuitPart = {\r\n  id: string\r\n  /** Wokwi part key (e.g. 'arduino-uno') or element type (e.g. 'wokwi-arduino-uno') */\r\n  type: string\r\n  position: {\r\n    x: number\r\n    y: number\r\n  }\r\n  rotate?: number\r\n  attrs?: Record<string, string>\r\n}\r\n\r\nexport type CircuitConnection = {\r\n  source: string\r\n  target: string\r\n  color: string\r\n}\r\n\r\nexport interface Connection {\r\n  id: string\r\n  from: { partId: string; pinId: string }\r\n  to: { partId: string; pinId: string }\r\n  color: string\r\n  points?: { x: number; y: number }[]\r\n}\r\n\r\n/** Terminal history entry for CLI-style AI chat */\r\nexport type TerminalEntry = {\r\n  id: string\r\n  type: 'cmd' | 'log' | 'ai' | 'error'\r\n  content: string\r\n  timestamp: number\r\n}\r\n\r\nexport type AppState = {\r\n  code: string\r\n  diagramJson: string\r\n  circuitParts: CircuitPart[]\r\n  circuitConnections: CircuitConnection[]\r\n  connections: Connection[]\r\n  isRunning: boolean\r\n\r\n  isCompiling: boolean\r\n  compilationError: string | null\r\n  hex: string | null\r\n  compiledBoard: string | null\r\n\r\n  nextWireColorIndex: number\r\n\r\n  selectedPartIds: string[]\r\n\r\n  // Terminal/AI Chat state\r\n  terminalHistory: TerminalEntry[]\r\n  isAiLoading: boolean\r\n\r\n  // Teacher mode toggle (Socratic Tutor feature)\r\n  teacherMode: boolean\r\n\r\n  updateCode: (newCode: string) => void\r\n  setDiagramJson: (json: string) => void\r\n  updateCircuit: (nodes: unknown, edges: unknown) => void\r\n  toggleSimulation: () => void\r\n\r\n  compileAndRun: () => Promise<void>\r\n\r\n  addPart: (part: {\r\n    type: string\r\n    position: { x: number; y: number }\r\n    rotate?: number\r\n    attrs?: Record<string, string>\r\n  }) => string\r\n  updatePartsPositions: (updates: Array<{ id: string; x: number; y: number }>) => void\r\n\r\n  setSelectedPartIds: (ids: string[]) => void\r\n  toggleSelectedPartId: (id: string) => void\r\n  clearSelectedParts: () => void\r\n\r\n  addConnection: (conn: Omit<Connection, 'id'>) => string\r\n  allocateNextWireColor: () => string\r\n  removeConnection: (id: string) => void\r\n  updateWireColor: (id: string, color: string) => void\r\n  updateWire: (id: string, points: { x: number; y: number }[] | undefined) => void\r\n\r\n  // Terminal/AI Chat actions\r\n  submitCommand: (text: string, imageData?: string) => Promise<void>\r\n  addTerminalEntry: (entry: Omit<TerminalEntry, 'id' | 'timestamp'>) => void\r\n  clearTerminalHistory: () => void\r\n  setTeacherMode: (enabled: boolean) => void\r\n  \r\n  // Apply AI-generated circuit to canvas\r\n  applyGeneratedCircuit: (parts: CircuitPart[], connections: Connection[]) => void\r\n}\r\n\r\nconst DEFAULT_WIRE_COLOR_CYCLE = [\r\n  '#B87333', // copper (default)\r\n  '#22c55e', // green\r\n  '#3b82f6', // blue\r\n  '#ef4444', // red\r\n  '#eab308', // yellow\r\n  '#8b5cf6', // violet\r\n  '#f97316', // orange\r\n  '#06b6d4', // cyan\r\n  '#ec4899', // pink\r\n  '#000000', // black\r\n  '#ffffff', // white\r\n] as const\r\n\r\nconst defaultCode =\r\n  'void setup() { pinMode(13, OUTPUT); } void loop() { digitalWrite(13, HIGH); delay(1000); digitalWrite(13, LOW); delay(1000); }'\r\n\r\nfunction isRecord(value: unknown): value is Record<string, unknown> {\r\n  return typeof value === 'object' && value !== null\r\n}\r\n\r\nfunction isNotNull<T>(value: T | null): value is T {\r\n  return value !== null\r\n}\r\n\r\nfunction toCircuitParts(nodes: unknown): CircuitPart[] {\r\n  if (!Array.isArray(nodes)) return []\r\n\r\n  return nodes\r\n    .map((node) => {\r\n      if (!isRecord(node)) return null\r\n\r\n      const id = typeof node.id === 'string' ? node.id : ''\r\n      const nodeType = typeof node.type === 'string' ? node.type : 'unknown'\r\n\r\n      // Try to carry Wokwi partType from node data (for node.type === 'wokwi').\r\n      const data = isRecord(node.data) ? node.data : null\r\n      const dataPartType = data && typeof data.partType === 'string' ? data.partType : null\r\n\r\n      const type =\r\n        (nodeType === 'wokwi' && dataPartType) ? dataPartType :\r\n        (nodeType === 'arduino' ? 'arduino-uno' : nodeType)\r\n      const position = isRecord(node.position) ? node.position : {}\r\n      const x = typeof position.x === 'number' ? position.x : 0\r\n      const y = typeof position.y === 'number' ? position.y : 0\r\n\r\n      if (!id) return null\r\n\r\n      return {\r\n        id,\r\n        type,\r\n        position: { x, y },\r\n        rotate: 0,\r\n        attrs: {},\r\n      } satisfies CircuitPart\r\n    })\r\n    .filter(isNotNull)\r\n}\r\n\r\nfunction toCircuitConnections(edges: unknown): CircuitConnection[] {\r\n  if (!Array.isArray(edges)) return []\r\n\r\n  return edges\r\n    .map((edge) => {\r\n      if (!isRecord(edge)) return null\r\n\r\n      const source = typeof edge.source === 'string' ? edge.source : ''\r\n      const target = typeof edge.target === 'string' ? edge.target : ''\r\n\r\n      // Try common React Flow / XYFlow shapes for a stroke color.\r\n      const style = isRecord(edge.style) ? edge.style : null\r\n      const data = isRecord(edge.data) ? edge.data : null\r\n\r\n      const colorCandidate =\r\n        (typeof edge.color === 'string' && edge.color) ||\r\n        (style && typeof style.stroke === 'string' && style.stroke) ||\r\n        (data && typeof data.color === 'string' && data.color)\r\n\r\n      if (!source || !target) return null\r\n\r\n      return {\r\n        source,\r\n        target,\r\n        color: colorCandidate || 'currentColor',\r\n      } satisfies CircuitConnection\r\n    })\r\n    .filter(isNotNull)\r\n}\r\n\r\nfunction normalizeBoardType(partType: string): string {\r\n  if (partType.startsWith('wokwi-')) return partType\r\n  return `wokwi-${partType}`\r\n}\r\n\r\nfunction findMicrocontroller(parts: CircuitPart[]): CircuitPart | null {\r\n  const supported = new Set([\r\n    'wokwi-arduino-uno',\r\n    'wokwi-arduino-nano',\r\n    'wokwi-arduino-mega',\r\n    'wokwi-esp32-devkit-v1',\r\n    'wokwi-pi-pico',\r\n  ])\r\n\r\n  for (const p of parts) {\r\n    const normalized = normalizeBoardType(p.type)\r\n    if (supported.has(normalized)) return p\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nexport const useAppStore = create<AppState>((set, get) => ({\r\n  code: defaultCode,\r\n  diagramJson: '',\r\n  circuitParts: [],\r\n  circuitConnections: [],\r\n  connections: [],\r\n  isRunning: false,\r\n\r\n  isCompiling: false,\r\n  compilationError: null,\r\n  hex: null,\r\n  compiledBoard: null,\r\n\r\n  nextWireColorIndex: 0,\r\n\r\n  selectedPartIds: [],\r\n\r\n  // Terminal/AI Chat state\r\n  terminalHistory: [],\r\n  isAiLoading: false,\r\n\r\n  // Teacher mode (Socratic Tutor feature)\r\n  teacherMode: false,\r\n\r\n  updateCode: (newCode) => {\r\n    set({ code: newCode })\r\n  },\r\n\r\n  setDiagramJson: (json) => {\r\n    set({ diagramJson: json })\r\n  },\r\n\r\n  updateCircuit: (nodes, edges) => {\r\n    const circuitParts = toCircuitParts(nodes)\r\n    const circuitConnections = toCircuitConnections(edges)\r\n\r\n    set({ circuitParts, circuitConnections })\r\n  },\r\n\r\n  toggleSimulation: () => {\r\n    set({ isRunning: !get().isRunning })\r\n  },\r\n\r\n  compileAndRun: async () => {\r\n    const mcu = findMicrocontroller(get().circuitParts)\r\n    if (!mcu) {\r\n      set({ compilationError: 'No supported microcontroller found in the circuit.', hex: null, compiledBoard: null })\r\n      return\r\n    }\r\n\r\n    const board = normalizeBoardType(mcu.type)\r\n\r\n    set({ isCompiling: true, compilationError: null })\r\n\r\n    try {\r\n      const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://127.0.0.1:8000'\r\n      const res = await fetch(`${baseUrl}/api/v1/compile`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ code: get().code, board }),\r\n      })\r\n\r\n      const data = (await res.json().catch(() => null)) as\r\n        | { success?: boolean; hex?: string | null; error?: string | null }\r\n        | null\r\n\r\n      if (!res.ok) {\r\n        set({\r\n          compilationError: (data && (data.error || (!data.success ? 'Compilation failed.' : null))) || res.statusText,\r\n          hex: null,\r\n          compiledBoard: null,\r\n        })\r\n        return\r\n      }\r\n\r\n      if (!data?.success || !data.hex) {\r\n        set({ compilationError: data?.error || 'Compilation failed.', hex: null, compiledBoard: null })\r\n        return\r\n      }\r\n\r\n      set({ hex: data.hex, compiledBoard: board, compilationError: null })\r\n    } catch (err) {\r\n      const msg = err instanceof Error ? err.message : String(err)\r\n      set({ compilationError: msg || 'Compilation request failed.', hex: null, compiledBoard: null })\r\n    } finally {\r\n      set({ isCompiling: false })\r\n    }\r\n  },\r\n\r\n  addPart: (part) => {\r\n    const id = nanoid()\r\n    const next: CircuitPart = {\r\n      id,\r\n      type: part.type,\r\n      position: { x: part.position.x, y: part.position.y },\r\n      rotate: part.rotate ?? 0,\r\n      attrs: part.attrs ?? {},\r\n    }\r\n    set({ circuitParts: [...get().circuitParts, next] })\r\n    return id\r\n  },\r\n\r\n  updatePartsPositions: (updates) => {\r\n    if (!updates.length) return\r\n    const byId = new Map(updates.map((u) => [u.id, u]))\r\n    set({\r\n      circuitParts: get().circuitParts.map((p) => {\r\n        const u = byId.get(p.id)\r\n        if (!u) return p\r\n        return { ...p, position: { x: u.x, y: u.y } }\r\n      }),\r\n    })\r\n  },\r\n\r\n  setSelectedPartIds: (ids) => {\r\n    set({ selectedPartIds: [...new Set(ids)] })\r\n  },\r\n\r\n  toggleSelectedPartId: (id) => {\r\n    const curr = get().selectedPartIds\r\n    if (curr.includes(id)) {\r\n      set({ selectedPartIds: curr.filter((x) => x !== id) })\r\n    } else {\r\n      set({ selectedPartIds: [...curr, id] })\r\n    }\r\n  },\r\n\r\n  clearSelectedParts: () => {\r\n    set({ selectedPartIds: [] })\r\n  },\r\n\r\n  addConnection: (conn) => {\r\n    const id = nanoid()\r\n    set({ connections: [...get().connections, { ...conn, id }] })\r\n    return id\r\n  },\r\n\r\n  allocateNextWireColor: () => {\r\n    const idx = get().nextWireColorIndex\r\n    const color = DEFAULT_WIRE_COLOR_CYCLE[idx % DEFAULT_WIRE_COLOR_CYCLE.length]\r\n    set({ nextWireColorIndex: idx + 1 })\r\n    return color\r\n  },\r\n\r\n  removeConnection: (id) => {\r\n    set({ connections: get().connections.filter((c) => c.id !== id) })\r\n  },\r\n\r\n  updateWireColor: (id, color) => {\r\n    set({\r\n      connections: get().connections.map((c) =>\r\n        c.id === id ? { ...c, color } : c\r\n      ),\r\n    })\r\n  },\r\n\r\n  updateWire: (id, points) => {\r\n    set({\r\n      connections: get().connections.map((c) =>\r\n        c.id === id ? { ...c, points } : c\r\n      ),\r\n    })\r\n  },\r\n\r\n  // Terminal/AI Chat actions\r\n  addTerminalEntry: (entry) => {\r\n    const newEntry: TerminalEntry = {\r\n      id: nanoid(),\r\n      timestamp: Date.now(),\r\n      ...entry,\r\n    }\r\n    set({ terminalHistory: [...get().terminalHistory, newEntry] })\r\n  },\r\n\r\n  clearTerminalHistory: () => {\r\n    set({ terminalHistory: [] })\r\n  },\r\n\r\n  setTeacherMode: (enabled) => {\r\n    set({ teacherMode: enabled })\r\n    get().addTerminalEntry({\r\n      type: 'log',\r\n      content: enabled\r\n        ? ' Teacher Mode enabled. AI will explain concepts before providing implementations.'\r\n        : ' Builder Mode enabled. AI will focus on generating code and circuits.',\r\n    })\r\n  },\r\n\r\n  applyGeneratedCircuit: (parts, newConnections) => {\r\n    // Replace current circuit with AI-generated one\r\n    set({\r\n      circuitParts: parts,\r\n      connections: newConnections,\r\n    })\r\n  },\r\n\r\n  submitCommand: async (text, imageData) => {\r\n    const trimmed = text.trim()\r\n    if (!trimmed && !imageData) return\r\n\r\n    // Add user command to history\r\n    if (trimmed) {\r\n      get().addTerminalEntry({ type: 'cmd', content: trimmed })\r\n    }\r\n    if (imageData) {\r\n      get().addTerminalEntry({ type: 'log', content: ' Image uploaded for circuit recognition' })\r\n    }\r\n\r\n    // Handle slash commands\r\n    if (trimmed.startsWith('/')) {\r\n      const cmd = trimmed.toLowerCase()\r\n      if (cmd === '/clear') {\r\n        set({ terminalHistory: [] })\r\n        return\r\n      }\r\n      if (cmd === '/help') {\r\n        get().addTerminalEntry({\r\n          type: 'log',\r\n          content: `Available commands:\r\n/clear - Clear terminal history\r\n/help - Show this help message\r\n/teacher - Toggle Teacher Mode (explains concepts)\r\n/builder - Toggle Builder Mode (direct generation)\r\n\r\nOr type any prompt to generate Arduino code and circuits.\r\nYou can also upload images of physical circuits for recognition.`,\r\n        })\r\n        return\r\n      }\r\n      if (cmd === '/teacher') {\r\n        get().setTeacherMode(true)\r\n        return\r\n      }\r\n      if (cmd === '/builder') {\r\n        get().setTeacherMode(false)\r\n        return\r\n      }\r\n      get().addTerminalEntry({\r\n        type: 'error',\r\n        content: `Unknown command: ${trimmed}. Type /help for available commands.`,\r\n      })\r\n      return\r\n    }\r\n\r\n    // Call AI generate endpoint\r\n    set({ isAiLoading: true })\r\n    try {\r\n      const baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://127.0.0.1:8000'\r\n      \r\n      // Get current circuit state for context (bi-directional awareness)\r\n      const currentCircuit = JSON.stringify({\r\n        parts: get().circuitParts,\r\n        connections: get().connections,\r\n      })\r\n      \r\n      const res = await fetch(`${baseUrl}/api/v1/generate`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          prompt: trimmed || 'Analyze this circuit image and recreate it',\r\n          teacher_mode: get().teacherMode,\r\n          image_data: imageData || null,\r\n          current_circuit: get().circuitParts.length > 0 ? currentCircuit : null,\r\n        }),\r\n      })\r\n\r\n      if (!res.ok) {\r\n        const errorData = await res.json().catch(() => null)\r\n        const errorMsg = errorData?.detail || res.statusText || 'Request failed'\r\n        get().addTerminalEntry({ type: 'error', content: `Error: ${errorMsg}` })\r\n        return\r\n      }\r\n\r\n      const data = await res.json()\r\n      \r\n      // Format the AI response as a log entry\r\n      let response = ''\r\n      if (data.explanation) {\r\n        response += data.explanation + '\\n\\n'\r\n      }\r\n      if (data.code) {\r\n        response += '```cpp\\n' + data.code + '\\n```'\r\n        // Also update the code editor\r\n        set({ code: data.code })\r\n      }\r\n      \r\n      get().addTerminalEntry({ type: 'ai', content: response || 'Generated successfully.' })\r\n\r\n      // Apply generated circuit parts and connections to canvas\r\n      if (data.circuit_parts && Array.isArray(data.circuit_parts)) {\r\n        const newParts: CircuitPart[] = data.circuit_parts.map((p: { id: string; type: string; x: number; y: number; attrs?: Record<string, string> }) => ({\r\n          id: p.id || nanoid(),\r\n          type: p.type,\r\n          position: { x: p.x || 0, y: p.y || 0 },\r\n          rotate: 0,\r\n          attrs: p.attrs || {},\r\n        }))\r\n        \r\n        const newConnections: Connection[] = (data.connections || []).map((c: { source_part: string; source_pin: string; target_part: string; target_pin: string }) => ({\r\n          id: nanoid(),\r\n          from: { partId: c.source_part, pinId: c.source_pin },\r\n          to: { partId: c.target_part, pinId: c.target_pin },\r\n          color: get().allocateNextWireColor(),\r\n        }))\r\n        \r\n        get().applyGeneratedCircuit(newParts, newConnections)\r\n        get().addTerminalEntry({\r\n          type: 'log',\r\n          content: ` Applied ${newParts.length} components and ${newConnections.length} connections to canvas`,\r\n        })\r\n      }\r\n    } catch (err) {\r\n      const msg = err instanceof Error ? err.message : String(err)\r\n      get().addTerminalEntry({ type: 'error', content: `Error: ${msg}` })\r\n    } finally {\r\n      set({ isAiLoading: false })\r\n    }\r\n  },\r\n}))\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1713, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/SelectionOverlay.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { memo, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { useStore } from '@xyflow/react';\r\nimport type { Node } from '@xyflow/react';\r\nimport { useAppStore } from '@/store/useAppStore';\r\nimport type { WirePoint } from '@/types/wire';\r\n\r\ntype ReactFlowStoreSlice = {\r\n  nodes: Node[];\r\n};\r\n\r\ntype NodeWithInternals = Node & {\r\n  positionAbsolute?: { x: number; y: number };\r\n  internals?: { positionAbsolute?: { x: number; y: number } };\r\n  measured?: { width?: number; height?: number };\r\n  width?: number;\r\n  height?: number;\r\n};\r\n\r\ninterface SelectionOverlayProps {\r\n  containerRef: React.RefObject<HTMLElement | null>;\r\n}\r\n\r\nfunction toFlowPoint(p: WirePoint, transform: [number, number, number]): WirePoint {\r\n  const [tx, ty, zoom] = transform;\r\n  return { x: (p.x - tx) / zoom, y: (p.y - ty) / zoom };\r\n}\r\n\r\nfunction rectFromPoints(a: WirePoint, b: WirePoint) {\r\n  const left = Math.min(a.x, b.x);\r\n  const top = Math.min(a.y, b.y);\r\n  const right = Math.max(a.x, b.x);\r\n  const bottom = Math.max(a.y, b.y);\r\n  return { left, top, right, bottom, width: right - left, height: bottom - top };\r\n}\r\n\r\nfunction intersects(r1: { left: number; top: number; right: number; bottom: number }, r2: { left: number; top: number; right: number; bottom: number }) {\r\n  return !(r2.left > r1.right || r2.right < r1.left || r2.top > r1.bottom || r2.bottom < r1.top);\r\n}\r\n\r\nfunction SelectionOverlay({ containerRef }: SelectionOverlayProps) {\r\n  const setSelectedPartIds = useAppStore((s) => s.setSelectedPartIds);\r\n\r\n  const transform = useStore((s) => s.transform as [number, number, number]);\r\n  const nodes = useStore((s) => (s as unknown as ReactFlowStoreSlice).nodes);\r\n\r\n  const dragRef = useRef<{\r\n    start: WirePoint;\r\n    current: WirePoint;\r\n    active: boolean;\r\n  } | null>(null);\r\n\r\n  const [box, setBox] = useState<{ left: number; top: number; width: number; height: number } | null>(null);\r\n\r\n  const nodesForSelection = useMemo(() => nodes ?? [], [nodes]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    const isBackgroundTarget = (target: EventTarget | null): boolean => {\r\n      if (!(target instanceof HTMLElement)) return false;\r\n      if (target.closest('[data-fundi-pin=\"true\"]')) return false;\r\n      if (target.closest('.react-flow__node')) return false;\r\n      // Pane/background within ReactFlow.\r\n      return Boolean(target.closest('.react-flow__pane'));\r\n    };\r\n\r\n    const getRel = (e: PointerEvent): WirePoint => {\r\n      const rect = container.getBoundingClientRect();\r\n      return { x: e.clientX - rect.left, y: e.clientY - rect.top };\r\n    };\r\n\r\n    const onPointerDown = (e: PointerEvent) => {\r\n      if (e.button !== 0) return;\r\n      if (!isBackgroundTarget(e.target)) return;\r\n\r\n      e.preventDefault();\r\n\r\n      const start = getRel(e);\r\n      dragRef.current = { start, current: start, active: true };\r\n      setBox({ left: start.x, top: start.y, width: 0, height: 0 });\r\n    };\r\n\r\n    const onPointerMove = (e: PointerEvent) => {\r\n      if (!dragRef.current?.active) return;\r\n      const curr = getRel(e);\r\n      dragRef.current.current = curr;\r\n\r\n      const r = rectFromPoints(dragRef.current.start, curr);\r\n      setBox({ left: r.left, top: r.top, width: r.width, height: r.height });\r\n    };\r\n\r\n    const onPointerUp = () => {\r\n      if (!dragRef.current?.active) return;\r\n\r\n      const start = dragRef.current.start;\r\n      const curr = dragRef.current.current;\r\n      dragRef.current = null;\r\n      setBox(null);\r\n\r\n      // Ignore tiny drags.\r\n      const rScreen = rectFromPoints(start, curr);\r\n      if (rScreen.width < 4 || rScreen.height < 4) return;\r\n\r\n      const aFlow = toFlowPoint({ x: rScreen.left, y: rScreen.top }, transform);\r\n      const bFlow = toFlowPoint({ x: rScreen.right, y: rScreen.bottom }, transform);\r\n      const rFlow = rectFromPoints(aFlow, bFlow);\r\n\r\n      const selected: string[] = [];\r\n      for (const n of nodesForSelection) {\r\n        const nn = n as NodeWithInternals;\r\n        const pos = nn.positionAbsolute ?? nn.internals?.positionAbsolute ?? nn.position;\r\n        const w = nn.measured?.width ?? nn.width ?? 0;\r\n        const h = nn.measured?.height ?? nn.height ?? 0;\r\n\r\n        const nr = { left: pos.x, top: pos.y, right: pos.x + w, bottom: pos.y + h };\r\n        if (intersects(rFlow, nr)) {\r\n          selected.push(n.id);\r\n        }\r\n      }\r\n\r\n      setSelectedPartIds(selected);\r\n    };\r\n\r\n    window.addEventListener('pointerdown', onPointerDown, { capture: true });\r\n    window.addEventListener('pointermove', onPointerMove, { capture: true });\r\n    window.addEventListener('pointerup', onPointerUp, { capture: true });\r\n\r\n    return () => {\r\n      window.removeEventListener('pointerdown', onPointerDown, true);\r\n      window.removeEventListener('pointermove', onPointerMove, true);\r\n      window.removeEventListener('pointerup', onPointerUp, true);\r\n    };\r\n  }, [containerRef, nodesForSelection, setSelectedPartIds, transform]);\r\n\r\n  if (!box) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"pointer-events-none absolute inset-0 z-20\"\r\n      aria-hidden={true}\r\n    >\r\n      <div\r\n        style={{\r\n          position: 'absolute',\r\n          left: box.left,\r\n          top: box.top,\r\n          width: box.width,\r\n          height: box.height,\r\n        }}\r\n        className=\"rounded border border-electric/70 bg-electric/10 ring-1 ring-electric/20\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(SelectionOverlay);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1928, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/utils/wireRouting.ts"],"sourcesContent":["/**\r\n * Orthogonal wire routing utilities\r\n * \r\n * Wokwi-style routing: all wire segments are strictly horizontal or vertical,\r\n * alternating between the two to create clean orthogonal paths.\r\n */\r\n\r\nimport type { WirePoint } from '@/types/wire';\r\n\r\ntype FirstLeg = 'horizontal' | 'vertical';\r\n\r\nexport function snapToGrid(value: number, gridSize: number): number {\r\n    if (!Number.isFinite(value)) return value;\r\n    if (!gridSize || gridSize <= 0) return value;\r\n    return Math.round(value / gridSize) * gridSize;\r\n}\r\n\r\nexport function snapPointToGrid(point: WirePoint, gridSize: number): WirePoint {\r\n    return { x: snapToGrid(point.x, gridSize), y: snapToGrid(point.y, gridSize) };\r\n}\r\n\r\nfunction dedupeColinear(points: WirePoint[]): WirePoint[] {\r\n    if (points.length <= 2) return points;\r\n\r\n    const result: WirePoint[] = [points[0]];\r\n    for (let i = 1; i < points.length - 1; i++) {\r\n        const prev = result[result.length - 1];\r\n        const curr = points[i];\r\n        const next = points[i + 1];\r\n\r\n        const sameAsPrev = prev.x === curr.x && prev.y === curr.y;\r\n        if (sameAsPrev) continue;\r\n\r\n        const colinearHorizontal = prev.y === curr.y && curr.y === next.y;\r\n        const colinearVertical = prev.x === curr.x && curr.x === next.x;\r\n        if (colinearHorizontal || colinearVertical) {\r\n            continue;\r\n        }\r\n\r\n        result.push(curr);\r\n    }\r\n\r\n    const last = points[points.length - 1];\r\n    const tail = result[result.length - 1];\r\n    if (tail.x !== last.x || tail.y !== last.y) {\r\n        result.push(last);\r\n    }\r\n    return result;\r\n}\r\n\r\ntype Orientation = 'H' | 'V';\r\n\r\ntype Segment = {\r\n    orientation: Orientation;\r\n    coord: number; // y for H, x for V\r\n    min: number;\r\n    max: number;\r\n};\r\n\r\nfunction toSegments(points: WirePoint[]): Segment[] {\r\n    const segs: Segment[] = [];\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n        const a = points[i];\r\n        const b = points[i + 1];\r\n        if (a.x === b.x && a.y === b.y) continue;\r\n        if (a.y === b.y) {\r\n            const min = Math.min(a.x, b.x);\r\n            const max = Math.max(a.x, b.x);\r\n            if (min !== max) segs.push({ orientation: 'H', coord: a.y, min, max });\r\n        } else if (a.x === b.x) {\r\n            const min = Math.min(a.y, b.y);\r\n            const max = Math.max(a.y, b.y);\r\n            if (min !== max) segs.push({ orientation: 'V', coord: a.x, min, max });\r\n        }\r\n    }\r\n    return segs;\r\n}\r\n\r\nfunction rangesOverlapStrict(aMin: number, aMax: number, bMin: number, bMax: number): boolean {\r\n    // Strict overlap: touching at a single point is OK.\r\n    return Math.min(aMax, bMax) > Math.max(aMin, bMin);\r\n}\r\n\r\nfunction hasParallelOverlap(points: WirePoint[], occupied: Map<string, Segment[]>): boolean {\r\n    const segs = toSegments(points);\r\n    for (const s of segs) {\r\n        const key = `${s.orientation}:${s.coord}`;\r\n        const list = occupied.get(key);\r\n        if (!list?.length) continue;\r\n        for (const o of list) {\r\n            if (rangesOverlapStrict(s.min, s.max, o.min, o.max)) return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction addOccupied(points: WirePoint[], occupied: Map<string, Segment[]>): void {\r\n    for (const s of toSegments(points)) {\r\n        const key = `${s.orientation}:${s.coord}`;\r\n        const list = occupied.get(key);\r\n        if (list) list.push(s);\r\n        else occupied.set(key, [s]);\r\n    }\r\n}\r\n\r\nfunction shiftSegmentKeepingEndpoints(\r\n    points: WirePoint[],\r\n    segmentIndex: number,\r\n    orientation: Orientation,\r\n    deltaPerp: number\r\n): WirePoint[] {\r\n    if (points.length < 2) return points;\r\n    if (segmentIndex < 0 || segmentIndex >= points.length - 1) return points;\r\n    if (deltaPerp === 0) return points;\r\n\r\n    const out = points.map((p) => ({ ...p }));\r\n    const lastIdx = out.length - 1;\r\n\r\n    if (orientation === 'H') {\r\n        // Horizontal segment => shift Y.\r\n        if (segmentIndex === 0) {\r\n            const p0 = out[0];\r\n            const p1 = out[1];\r\n            // Insert a vertical jog at the start point.\r\n            const jog = { x: p0.x, y: p0.y + deltaPerp };\r\n            out.splice(1, 0, jog);\r\n            // Original p1 shifts (now at index 2).\r\n            out[2].y = jog.y;\r\n        } else if (segmentIndex === lastIdx - 1) {\r\n            const pN1 = out[lastIdx - 1];\r\n            const pN = out[lastIdx];\r\n            // Insert a vertical jog before the end point.\r\n            const jog = { x: pN.x, y: pN.y + deltaPerp };\r\n            out.splice(lastIdx, 0, jog);\r\n            // Shift previous point to align with jog.\r\n            out[lastIdx - 1].y = jog.y;\r\n            // Keep endpoint anchored.\r\n            out[lastIdx + 1].x = pN.x;\r\n            out[lastIdx + 1].y = pN.y;\r\n        } else {\r\n            out[segmentIndex].y += deltaPerp;\r\n            out[segmentIndex + 1].y += deltaPerp;\r\n        }\r\n    } else {\r\n        // Vertical segment => shift X.\r\n        if (segmentIndex === 0) {\r\n            const p0 = out[0];\r\n            const p1 = out[1];\r\n            const jog = { x: p0.x + deltaPerp, y: p0.y };\r\n            out.splice(1, 0, jog);\r\n            out[2].x = jog.x;\r\n        } else if (segmentIndex === lastIdx - 1) {\r\n            const pN1 = out[lastIdx - 1];\r\n            const pN = out[lastIdx];\r\n            const jog = { x: pN.x + deltaPerp, y: pN.y };\r\n            out.splice(lastIdx, 0, jog);\r\n            out[lastIdx - 1].x = jog.x;\r\n            out[lastIdx + 1].x = pN.x;\r\n            out[lastIdx + 1].y = pN.y;\r\n        } else {\r\n            out[segmentIndex].x += deltaPerp;\r\n            out[segmentIndex + 1].x += deltaPerp;\r\n        }\r\n    }\r\n\r\n    return dedupeColinear(out);\r\n}\r\n\r\nfunction segmentOrientation(points: WirePoint[], idx: number): Orientation | null {\r\n    if (idx < 0 || idx >= points.length - 1) return null;\r\n    const a = points[idx];\r\n    const b = points[idx + 1];\r\n    if (a.y === b.y && a.x !== b.x) return 'H';\r\n    if (a.x === b.x && a.y !== b.y) return 'V';\r\n    return null;\r\n}\r\n\r\n/**\r\n * Avoids PARALLEL overlaps between different wires.\r\n * - Horizontal-on-horizontal overlaps are removed by shifting Y.\r\n * - Vertical-on-vertical overlaps are removed by shifting X.\r\n * - Perpendicular crossings are allowed.\r\n *\r\n * This is a rendering-time deconfliction pass: endpoints stay anchored.\r\n */\r\nexport function avoidParallelOverlaps(\r\n    wires: Array<{ id: string; points: WirePoint[] }>,\r\n    options: { gridSize: number; maxLanes?: number } = { gridSize: 10 }\r\n): Map<string, WirePoint[]> {\r\n    const gridSize = options.gridSize || 10;\r\n    const maxLanes = options.maxLanes ?? 6;\r\n    const occupied = new Map<string, Segment[]>();\r\n    const result = new Map<string, WirePoint[]>();\r\n\r\n    // Stable, deterministic order: as provided.\r\n    for (const w of wires) {\r\n        let pts = dedupeColinear(w.points);\r\n\r\n        // If there is no conflict, accept quickly.\r\n        if (!hasParallelOverlap(pts, occupied)) {\r\n            addOccupied(pts, occupied);\r\n            result.set(w.id, pts);\r\n            continue;\r\n        }\r\n\r\n        // Try shifting each segment into a free lane.\r\n        let improved = true;\r\n        let safety = 0;\r\n        while (improved && safety++ < 8) {\r\n            improved = false;\r\n            for (let segIdx = 0; segIdx < pts.length - 1; segIdx++) {\r\n                const ori = segmentOrientation(pts, segIdx);\r\n                if (!ori) continue;\r\n\r\n                // Fast skip: only attempt if THIS segment overlaps.\r\n                const segs = toSegments([pts[segIdx], pts[segIdx + 1]]);\r\n                if (!segs.length) continue;\r\n                const seg = segs[0];\r\n                const key = `${seg.orientation}:${seg.coord}`;\r\n                const list = occupied.get(key);\r\n                if (!list?.length) continue;\r\n\r\n                let overlaps = false;\r\n                for (const o of list) {\r\n                    if (rangesOverlapStrict(seg.min, seg.max, o.min, o.max)) {\r\n                        overlaps = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (!overlaps) continue;\r\n\r\n                // Determine a deterministic lane preference.\r\n                const hash =\r\n                    [...w.id].reduce((acc, ch) => ((acc * 31) ^ ch.charCodeAt(0)) >>> 0, 7) +\r\n                    segIdx * 97;\r\n                const preferPositive = (hash & 1) === 0;\r\n\r\n                let best: WirePoint[] | null = null;\r\n                for (let lane = 1; lane <= maxLanes; lane++) {\r\n                    const d = lane * gridSize;\r\n                    const deltas = preferPositive ? [d, -d] : [-d, d];\r\n                    for (const deltaPerp of deltas) {\r\n                        const candidate = shiftSegmentKeepingEndpoints(pts, segIdx, ori, deltaPerp);\r\n                        if (!hasParallelOverlap(candidate, occupied)) {\r\n                            best = candidate;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (best) break;\r\n                }\r\n\r\n                if (best) {\r\n                    pts = best;\r\n                    improved = true;\r\n                    break; // re-scan from start with updated geometry\r\n                }\r\n            }\r\n        }\r\n\r\n        addOccupied(pts, occupied);\r\n        result.set(w.id, pts);\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Convert an array of points to an SVG path `d` string.\r\n * Uses straight line segments between points.\r\n */\r\nexport function pointsToPathD(points: WirePoint[]): string {\r\n    if (points.length === 0) return '';\r\n    const [first, ...rest] = points;\r\n    return `M ${first.x} ${first.y}` + rest.map((p) => ` L ${p.x} ${p.y}`).join('');\r\n}\r\n\r\nexport function findSegmentIndex(\r\n    points: WirePoint[],\r\n    clickPoint: WirePoint,\r\n    threshold: number = 8\r\n): number | null {\r\n    if (points.length < 2) return null;\r\n    let bestIdx: number | null = null;\r\n    let bestDist = Infinity;\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n        const p1 = points[i];\r\n        const p2 = points[i + 1];\r\n        const dist = distanceToSegment(clickPoint, p1, p2);\r\n        if (dist <= threshold && dist < bestDist) {\r\n            bestDist = dist;\r\n            bestIdx = i;\r\n        }\r\n    }\r\n\r\n    return bestIdx;\r\n}\r\n\r\nfunction isHorizontalSegment(a: WirePoint, b: WirePoint): boolean {\r\n    return a.y === b.y && a.x !== b.x;\r\n}\r\n\r\nfunction isVerticalSegment(a: WirePoint, b: WirePoint): boolean {\r\n    return a.x === b.x && a.y !== b.y;\r\n}\r\n\r\nexport function moveSegment(\r\n    points: WirePoint[],\r\n    segmentIndex: number,\r\n    delta: WirePoint,\r\n    options: { snapTo?: number; disableSnap?: boolean } = {}\r\n): WirePoint[] {\r\n    if (points.length < 2) return points;\r\n    if (segmentIndex < 0 || segmentIndex >= points.length - 1) return points;\r\n\r\n    const out = points.map((p) => ({ ...p }));\r\n    const a = out[segmentIndex];\r\n    const b = out[segmentIndex + 1];\r\n\r\n    const isH = isHorizontalSegment(a, b);\r\n    const isV = isVerticalSegment(a, b);\r\n\r\n    if (!isH && !isV) {\r\n        // Non-orthogonal; refuse to move.\r\n        return points;\r\n    }\r\n\r\n    if (isH) {\r\n        let nextY = a.y + delta.y;\r\n        if (!options.disableSnap && options.snapTo) {\r\n            nextY = snapToGrid(nextY, options.snapTo);\r\n        }\r\n        a.y = nextY;\r\n        b.y = nextY;\r\n    } else {\r\n        let nextX = a.x + delta.x;\r\n        if (!options.disableSnap && options.snapTo) {\r\n            nextX = snapToGrid(nextX, options.snapTo);\r\n        }\r\n        a.x = nextX;\r\n        b.x = nextX;\r\n    }\r\n\r\n    return dedupeColinear(out);\r\n}\r\n\r\n/**\r\n * Wokwi-like orthogonal routing between two points.\r\n * - Produces only horizontal/vertical segments.\r\n * - Optionally threads through `waypoints` (manual bends).\r\n * - Uses a simple 2-segment strategy per hop.\r\n */\r\nexport function calculateOrthogonalPoints(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    waypoints: WirePoint[] = [],\r\n    options: { firstLeg?: FirstLeg } = {}\r\n): WirePoint[] {\r\n    const firstLeg = options.firstLeg ?? 'horizontal';\r\n    const all = [start, ...waypoints, end];\r\n    const out: WirePoint[] = [start];\r\n\r\n    for (let i = 1; i < all.length; i++) {\r\n        const a = all[i - 1];\r\n        const b = all[i];\r\n\r\n        // Same point.\r\n        if (a.x === b.x && a.y === b.y) continue;\r\n\r\n        if (firstLeg === 'horizontal') {\r\n            const mid: WirePoint = { x: b.x, y: a.y };\r\n            if (mid.x !== a.x || mid.y !== a.y) out.push(mid);\r\n        } else {\r\n            const mid: WirePoint = { x: a.x, y: b.y };\r\n            if (mid.x !== a.x || mid.y !== a.y) out.push(mid);\r\n        }\r\n        out.push(b);\r\n    }\r\n\r\n    return dedupeColinear(out);\r\n}\r\n\r\nexport function calculateOrthogonalPathD(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    waypoints: WirePoint[] = [],\r\n    options: { firstLeg?: FirstLeg } = {}\r\n): string {\r\n    return pointsToPathD(calculateOrthogonalPoints(start, end, waypoints, options));\r\n}\r\n\r\n/**\r\n * Calculate the orthogonal path between two points with optional waypoints.\r\n * Returns an array of points forming the complete path.\r\n */\r\nexport function calculateOrthogonalPath(\r\n    start: WirePoint,\r\n    end: WirePoint,\r\n    waypoints: WirePoint[] = []\r\n): WirePoint[] {\r\n    const allPoints = [start, ...waypoints, end];\r\n    const path: WirePoint[] = [start];\r\n\r\n    for (let i = 1; i < allPoints.length; i++) {\r\n        const prev = allPoints[i - 1];\r\n        const curr = allPoints[i];\r\n\r\n        // Create orthogonal path between consecutive points\r\n        // Strategy: horizontal first, then vertical\r\n        const midPoint: WirePoint = { x: curr.x, y: prev.y };\r\n\r\n        // Only add midpoint if it's different from prev and curr\r\n        if (midPoint.x !== prev.x || midPoint.y !== prev.y) {\r\n            if (midPoint.x !== curr.x || midPoint.y !== curr.y) {\r\n                path.push(midPoint);\r\n            }\r\n        }\r\n\r\n        path.push(curr);\r\n    }\r\n\r\n    return path;\r\n}\r\n\r\n/**\r\n * Calculate orthogonal preview path during wire creation.\r\n * Starts with vertical movement, then horizontal to reach the cursor.\r\n */\r\nexport function calculatePreviewPath(\r\n    start: WirePoint,\r\n    cursor: WirePoint,\r\n    waypoints: WirePoint[] = []\r\n): WirePoint[] {\r\n    if (waypoints.length === 0) {\r\n        // Direct from start to cursor with orthogonal routing\r\n        const path: WirePoint[] = [start];\r\n\r\n        // Start vertical, then horizontal (Wokwi-style)\r\n        const midPoint: WirePoint = { x: start.x, y: cursor.y };\r\n\r\n        if (midPoint.y !== start.y) {\r\n            path.push(midPoint);\r\n        }\r\n\r\n        path.push(cursor);\r\n        return path;\r\n    }\r\n\r\n    // With waypoints: path through waypoints, then to cursor\r\n    const lastWaypoint = waypoints[waypoints.length - 1];\r\n    const pathToLastWaypoint = calculateOrthogonalPath(start, lastWaypoint, waypoints.slice(0, -1));\r\n\r\n    // From last waypoint to cursor\r\n    const midPoint: WirePoint = { x: lastWaypoint.x, y: cursor.y };\r\n\r\n    if (midPoint.y !== lastWaypoint.y) {\r\n        pathToLastWaypoint.push(midPoint);\r\n    }\r\n\r\n    pathToLastWaypoint.push(cursor);\r\n\r\n    return pathToLastWaypoint;\r\n}\r\n\r\n/**\r\n * Convert array of points to SVG polyline points string\r\n */\r\nexport function pointsToSvgPath(points: WirePoint[]): string {\r\n    return points.map(p => `${p.x},${p.y}`).join(' ');\r\n}\r\n\r\n/**\r\n * Check if a point is near a wire segment (for click detection)\r\n */\r\nexport function isPointNearWire(\r\n    point: WirePoint,\r\n    wirePoints: WirePoint[],\r\n    threshold: number = 8\r\n): boolean {\r\n    for (let i = 0; i < wirePoints.length - 1; i++) {\r\n        const p1 = wirePoints[i];\r\n        const p2 = wirePoints[i + 1];\r\n\r\n        const distance = distanceToSegment(point, p1, p2);\r\n        if (distance <= threshold) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Calculate distance from a point to a line segment\r\n */\r\nfunction distanceToSegment(point: WirePoint, p1: WirePoint, p2: WirePoint): number {\r\n    const dx = p2.x - p1.x;\r\n    const dy = p2.y - p1.y;\r\n    const lengthSquared = dx * dx + dy * dy;\r\n\r\n    if (lengthSquared === 0) {\r\n        // p1 and p2 are the same point\r\n        return Math.sqrt((point.x - p1.x) ** 2 + (point.y - p1.y) ** 2);\r\n    }\r\n\r\n    // Project point onto line segment\r\n    let t = ((point.x - p1.x) * dx + (point.y - p1.y) * dy) / lengthSquared;\r\n    t = Math.max(0, Math.min(1, t));\r\n\r\n    const projX = p1.x + t * dx;\r\n    const projY = p1.y + t * dy;\r\n\r\n    return Math.sqrt((point.x - projX) ** 2 + (point.y - projY) ** 2);\r\n}\r\n\r\n/**\r\n * Find which waypoint handle is being clicked\r\n */\r\nexport function findClickedHandle(\r\n    point: WirePoint,\r\n    wirePoints: WirePoint[],\r\n    threshold: number = 10\r\n): number | null {\r\n    for (let i = 0; i < wirePoints.length; i++) {\r\n        const wp = wirePoints[i];\r\n        const distance = Math.sqrt((point.x - wp.x) ** 2 + (point.y - wp.y) ** 2);\r\n        if (distance <= threshold) {\r\n            return i;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2404, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/WiringLayer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { memo, useEffect, useMemo, useRef, useState, useCallback } from 'react';\r\nimport { useStore } from '@xyflow/react';\r\nimport { useAppStore } from '@/store/useAppStore';\r\nimport type { WirePoint } from '@/types/wire';\r\nimport {\r\n  calculateOrthogonalPoints,\r\n  pointsToPathD,\r\n  findSegmentIndex,\r\n  moveSegment,\r\n  snapPointToGrid,\r\n  avoidParallelOverlaps,\r\n} from '@/utils/wireRouting';\r\n\r\ntype PinRef = { partId: string; pinId: string };\r\n\r\ninterface WiringLayerProps {\r\n  containerRef: React.RefObject<HTMLElement | null>;\r\n  /** Optional transient overrides for inner waypoints (used during part dragging for 60fps). */\r\n  wirePointOverrides?: Map<string, WirePoint[] | undefined>;\r\n}\r\n\r\ntype Mode = 'idle' | 'creating' | 'dragging-segment';\r\n\r\nconst HIT_STROKE = 15;\r\n\r\n// Wokwi-like keyboard palette (0-9) + Copper default.\r\nconst WOKWI_COLOR_BY_DIGIT: Record<string, string> = {\r\n  '0': '#000000', // black (GND)\r\n  '1': '#8b4513', // brown\r\n  '2': '#ef4444', // red (VCC)\r\n  '3': '#f97316', // orange\r\n  '4': '#eab308', // yellow\r\n  '5': '#22c55e', // green\r\n  '6': '#3b82f6', // blue\r\n  '7': '#8b5cf6', // violet\r\n  '8': '#9ca3af', // gray\r\n  '9': '#ffffff', // white\r\n};\r\n\r\nconst WOKWI_COLOR_PALETTE: Array<{ key: string; color: string }> = Object.entries(WOKWI_COLOR_BY_DIGIT).map(\r\n  ([key, color]) => ({ key, color })\r\n);\r\n\r\nfunction isDigitKey(key: string): key is keyof typeof WOKWI_COLOR_BY_DIGIT {\r\n  return Object.prototype.hasOwnProperty.call(WOKWI_COLOR_BY_DIGIT, key);\r\n}\r\n\r\nfunction clampToContainer(point: WirePoint, rect: DOMRect): WirePoint {\r\n  return {\r\n    x: Math.max(0, Math.min(rect.width, point.x)),\r\n    y: Math.max(0, Math.min(rect.height, point.y)),\r\n  };\r\n}\r\n\r\nfunction getRelativePoint(e: PointerEvent, container: HTMLElement): WirePoint {\r\n  const rect = container.getBoundingClientRect();\r\n  return clampToContainer({ x: e.clientX - rect.left, y: e.clientY - rect.top }, rect);\r\n}\r\n\r\nfunction isEventInsideContainer(e: PointerEvent, container: HTMLElement): boolean {\r\n  const t = e.target as Node | null;\r\n  if (!t) return false;\r\n  return container.contains(t);\r\n}\r\n\r\nfunction getPinElFromPoint(x: number, y: number): HTMLElement | null {\r\n  const el = document.elementFromPoint(x, y);\r\n  if (!el) return null;\r\n  const pin = (el as HTMLElement).closest?.('[data-fundi-pin=\"true\"]') as HTMLElement | null;\r\n  return pin;\r\n}\r\n\r\nfunction getPinRefFromEl(pinEl: HTMLElement): PinRef | null {\r\n  const partId = pinEl.getAttribute('data-node-id') || pinEl.getAttribute('data-part-id');\r\n  const pinId = pinEl.getAttribute('data-pin-id');\r\n  if (!partId || !pinId) return null;\r\n  return { partId, pinId };\r\n}\r\n\r\nfunction getPinCenterInContainer(pinEl: HTMLElement, container: HTMLElement): WirePoint {\r\n  const pinRect = pinEl.getBoundingClientRect();\r\n  const containerRect = container.getBoundingClientRect();\r\n  return {\r\n    x: pinRect.left + pinRect.width / 2 - containerRect.left,\r\n    y: pinRect.top + pinRect.height / 2 - containerRect.top,\r\n  };\r\n}\r\n\r\nfunction samePin(a: PinRef | null, b: PinRef | null): boolean {\r\n  if (!a || !b) return false;\r\n  return a.partId === b.partId && a.pinId === b.pinId;\r\n}\r\n\r\nfunction stripEndpoints(points: WirePoint[]): WirePoint[] {\r\n  if (points.length <= 2) return [];\r\n  return points.slice(1, -1);\r\n}\r\n\r\nfunction normalizePointsForStore(points: WirePoint[]): WirePoint[] | undefined {\r\n  const inner = stripEndpoints(points);\r\n  return inner.length ? inner : undefined;\r\n}\r\n\r\nfunction getGridSizeForZoom(zoom: number): number {\r\n  // Simple heuristic: coarser grid when zoomed out.\r\n  return zoom < 0.75 ? 20 : 10;\r\n}\r\n\r\nfunction WiringLayer({ containerRef, wirePointOverrides }: WiringLayerProps) {\r\n  const connections = useAppStore((s) => s.connections);\r\n  const addConnection = useAppStore((s) => s.addConnection);\r\n  const allocateNextWireColor = useAppStore((s) => s.allocateNextWireColor);\r\n  const removeConnection = useAppStore((s) => s.removeConnection);\r\n  const updateWireColor = useAppStore((s) => s.updateWireColor);\r\n  const updateWire = useAppStore((s) => s.updateWire);\r\n\r\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\r\n  const [selectedId, setSelectedId] = useState<string | null>(null);\r\n  const [hoveredId, setHoveredId] = useState<string | null>(null);\r\n\r\n  const zoom = useStore((s) => s.transform[2]);\r\n  // Subscribe to node changes so wire endpoints update in real-time while parts move.\r\n  // Using the store's nodes array reference is enough to invalidate memos during drags.\r\n  const flowNodes = useStore((s) => (s as any).nodes as unknown[]);\r\n  const gridSize = useMemo(() => getGridSizeForZoom(zoom), [zoom]);\r\n\r\n  const modeRef = useRef<Mode>('idle');\r\n\r\n  const creatingRef = useRef<{\r\n    from: PinRef;\r\n    fromPoint: WirePoint;\r\n    waypoints: WirePoint[];\r\n    cursor: WirePoint;\r\n    hoveredPin: PinRef | null;\r\n    hoveredPoint: WirePoint | null;\r\n    color: string;\r\n  } | null>(null);\r\n\r\n  const segmentDragRef = useRef<{\r\n    wireId: string;\r\n    segmentIndex: number;\r\n    startMouse: WirePoint;\r\n    startPoints: WirePoint[];\r\n    disableSnap: boolean;\r\n  } | null>(null);\r\n\r\n  const [, forceTick] = useState(0);\r\n\r\n  // Track container size.\r\n  useEffect(() => {\r\n    const el = containerRef.current;\r\n    if (!el) return;\r\n\r\n    const update = () => {\r\n      const rect = el.getBoundingClientRect();\r\n      setDimensions({ width: rect.width, height: rect.height });\r\n    };\r\n\r\n    update();\r\n    const ro = new ResizeObserver(update);\r\n    ro.observe(el);\r\n    return () => ro.disconnect();\r\n  }, [containerRef]);\r\n\r\n  // Precompute all pin centers once per render to keep 60fps during drags.\r\n  const pinCenters = useMemo(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return new Map<string, WirePoint>();\r\n\r\n    const containerRect = container.getBoundingClientRect();\r\n    const els = container.querySelectorAll<HTMLElement>('[data-fundi-pin=\"true\"][data-node-id][data-pin-id]');\r\n    const next = new Map<string, WirePoint>();\r\n    els.forEach((el) => {\r\n      const partId = el.getAttribute('data-node-id');\r\n      const pinId = el.getAttribute('data-pin-id');\r\n      if (!partId || !pinId) return;\r\n      const r = el.getBoundingClientRect();\r\n      next.set(`${partId}:${pinId}`, {\r\n        x: r.left + r.width / 2 - containerRect.left,\r\n        y: r.top + r.height / 2 - containerRect.top,\r\n      });\r\n    });\r\n    return next;\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [containerRef, dimensions.width, dimensions.height, zoom, flowNodes]);\r\n\r\n  const getPinPoint = useCallback(\r\n    (pin: PinRef): WirePoint | null => {\r\n      return pinCenters.get(`${pin.partId}:${pin.pinId}`) ?? null;\r\n    },\r\n    [pinCenters]\r\n  );\r\n\r\n  const wireGeometry = useMemo(() => {\r\n    const base = connections\r\n      .map((c) => {\r\n        const start = getPinPoint(c.from);\r\n        const end = getPinPoint(c.to);\r\n        if (!start || !end) return null;\r\n\r\n        const waypoints = wirePointOverrides?.has(c.id)\r\n          ? wirePointOverrides.get(c.id) ?? []\r\n          : c.points ?? [];\r\n\r\n        const points = calculateOrthogonalPoints(start, end, waypoints, { firstLeg: 'horizontal' });\r\n        return { id: c.id, color: c.color, points };\r\n      })\r\n      .filter((x): x is { id: string; color: string; points: WirePoint[] } => Boolean(x));\r\n\r\n    // Prevent PARALLEL overlaps between different wires (perpendicular crossings OK).\r\n    const adjusted = avoidParallelOverlaps(\r\n      base.map((w) => ({ id: w.id, points: w.points })),\r\n      { gridSize }\r\n    );\r\n\r\n    return base.map((w) => {\r\n      const points = adjusted.get(w.id) ?? w.points;\r\n      return { ...w, points, d: pointsToPathD(points) };\r\n    });\r\n  }, [connections, getPinPoint, wirePointOverrides, gridSize]);\r\n\r\n  const selectedWire = useMemo(() => {\r\n    if (!selectedId) return null;\r\n    return wireGeometry.find((w) => w.id === selectedId) ?? null;\r\n  }, [selectedId, wireGeometry]);\r\n\r\n  const selectedMidpoint = useMemo(() => {\r\n    if (!selectedWire) return null;\r\n    const pts = selectedWire.points;\r\n    if (pts.length < 2) return null;\r\n    const i = Math.floor(pts.length / 2);\r\n    return pts[i];\r\n  }, [selectedWire]);\r\n\r\n  // Global pointer + keyboard interactions.\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    const onPointerMoveCapture = (e: PointerEvent) => {\r\n      if (!container) return;\r\n      if (!isEventInsideContainer(e, container)) return;\r\n\r\n      if (modeRef.current === 'creating' && creatingRef.current) {\r\n        const cursorRaw = getRelativePoint(e, container);\r\n        const cursor = e.shiftKey ? cursorRaw : snapPointToGrid(cursorRaw, gridSize);\r\n\r\n        const pinEl = getPinElFromPoint(e.clientX, e.clientY);\r\n        const hoveredRef = pinEl ? getPinRefFromEl(pinEl) : null;\r\n\r\n        let hoveredPin: PinRef | null = null;\r\n        let hoveredPoint: WirePoint | null = null;\r\n        if (hoveredRef && !samePin(hoveredRef, creatingRef.current.from)) {\r\n          hoveredPin = hoveredRef;\r\n          hoveredPoint = pinEl ? getPinCenterInContainer(pinEl, container) : null;\r\n        }\r\n\r\n        creatingRef.current = {\r\n          ...creatingRef.current,\r\n          cursor,\r\n          hoveredPin,\r\n          hoveredPoint,\r\n        };\r\n        forceTick((n) => (n + 1) % 1000000);\r\n      }\r\n\r\n      if (modeRef.current === 'dragging-segment' && segmentDragRef.current) {\r\n        const curr = getRelativePoint(e, container);\r\n        const drag = segmentDragRef.current;\r\n        const delta = { x: curr.x - drag.startMouse.x, y: curr.y - drag.startMouse.y };\r\n\r\n        const moved = moveSegment(drag.startPoints, drag.segmentIndex, delta, {\r\n          snapTo: gridSize,\r\n          disableSnap: drag.disableSnap,\r\n        });\r\n\r\n        updateWire(drag.wireId, normalizePointsForStore(moved));\r\n        forceTick((n) => (n + 1) % 1000000);\r\n      }\r\n    };\r\n\r\n    const onPointerDownCapture = (e: PointerEvent) => {\r\n      if (e.button !== 0) return;\r\n      if (!isEventInsideContainer(e, container)) return;\r\n\r\n      // Click-away deselect: clicking anywhere else in the canvas clears wire selection,\r\n      // except when interacting with the wire toolbar or wire hit targets.\r\n      if (selectedId) {\r\n        const target = e.target as HTMLElement | null;\r\n        const insideToolbar = Boolean(target?.closest?.('[data-wire-toolbar=\"true\"]'));\r\n        const onWire = Boolean(target?.closest?.('[data-wire-hit=\"true\"]'));\r\n        if (!insideToolbar && !onWire) {\r\n          setSelectedId(null);\r\n        }\r\n      }\r\n\r\n      const pinEl = (e.target as HTMLElement | null)?.closest?.('[data-fundi-pin=\"true\"]') as HTMLElement | null;\r\n      const pinRef = pinEl ? getPinRefFromEl(pinEl) : null;\r\n\r\n      // If we're creating and click a pin, complete the wire.\r\n      if (modeRef.current === 'creating' && creatingRef.current) {\r\n        if (pinEl && pinRef && !samePin(pinRef, creatingRef.current.from)) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          addConnection({\r\n            from: creatingRef.current.from,\r\n            to: pinRef,\r\n            color: creatingRef.current.color,\r\n            points: creatingRef.current.waypoints.length\r\n              ? creatingRef.current.waypoints\r\n              : undefined,\r\n          });\r\n\r\n          creatingRef.current = null;\r\n          modeRef.current = 'idle';\r\n          forceTick((n) => n + 1);\r\n          return;\r\n        }\r\n\r\n        // Otherwise pin a waypoint at current cursor (empty space click).\r\n        if (!pinEl) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          const pRaw = getRelativePoint(e, container);\r\n          const p = e.shiftKey ? pRaw : snapPointToGrid(pRaw, gridSize);\r\n          creatingRef.current = {\r\n            ...creatingRef.current,\r\n            waypoints: [...creatingRef.current.waypoints, p],\r\n            cursor: p,\r\n          };\r\n          forceTick((n) => n + 1);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Start creating from a pin.\r\n      if (pinEl && pinRef) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const fromPointRaw = getPinCenterInContainer(pinEl, container);\r\n        const fromPoint = snapPointToGrid(fromPointRaw, gridSize);\r\n        const cursorRaw = getRelativePoint(e, container);\r\n        const cursor = e.shiftKey ? cursorRaw : snapPointToGrid(cursorRaw, gridSize);\r\n\r\n        creatingRef.current = {\r\n          from: pinRef,\r\n          fromPoint,\r\n          waypoints: [],\r\n          cursor,\r\n          hoveredPin: null,\r\n          hoveredPoint: null,\r\n          color: allocateNextWireColor(),\r\n        };\r\n\r\n        modeRef.current = 'creating';\r\n        setSelectedId(null);\r\n        forceTick((n) => n + 1);\r\n      }\r\n    };\r\n\r\n    const onPointerUpCapture = () => {\r\n      if (modeRef.current === 'dragging-segment') {\r\n        segmentDragRef.current = null;\r\n        modeRef.current = 'idle';\r\n        forceTick((n) => n + 1);\r\n      }\r\n    };\r\n\r\n    const onKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        if (modeRef.current === 'creating') {\r\n          creatingRef.current = null;\r\n          modeRef.current = 'idle';\r\n          forceTick((n) => n + 1);\r\n        }\r\n        if (modeRef.current === 'dragging-segment') {\r\n          segmentDragRef.current = null;\r\n          modeRef.current = 'idle';\r\n          forceTick((n) => n + 1);\r\n        }\r\n        if (selectedId) setSelectedId(null);\r\n      }\r\n\r\n      if ((e.key === 'Delete' || e.key === 'Backspace') && selectedId) {\r\n        removeConnection(selectedId);\r\n        setSelectedId(null);\r\n      }\r\n\r\n      if (isDigitKey(e.key)) {\r\n        const color = WOKWI_COLOR_BY_DIGIT[e.key];\r\n        if (modeRef.current === 'creating' && creatingRef.current) {\r\n          creatingRef.current = { ...creatingRef.current, color };\r\n          forceTick((n) => n + 1);\r\n        } else if (selectedId) {\r\n          updateWireColor(selectedId, color);\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('pointerdown', onPointerDownCapture, { capture: true });\r\n    window.addEventListener('pointermove', onPointerMoveCapture, { capture: true });\r\n    window.addEventListener('pointerup', onPointerUpCapture, { capture: true });\r\n    window.addEventListener('keydown', onKeyDown);\r\n\r\n    return () => {\r\n      window.removeEventListener('pointerdown', onPointerDownCapture, true);\r\n      window.removeEventListener('pointermove', onPointerMoveCapture, true);\r\n      window.removeEventListener('pointerup', onPointerUpCapture, true);\r\n      window.removeEventListener('keydown', onKeyDown);\r\n    };\r\n  }, [addConnection, allocateNextWireColor, containerRef, gridSize, removeConnection, selectedId, updateWire, updateWireColor]);\r\n\r\n  const creating = creatingRef.current;\r\n  const preview = useMemo(() => {\r\n    if (!creating) return null;\r\n    const end = creating.hoveredPoint ?? creating.cursor;\r\n    const points = calculateOrthogonalPoints(creating.fromPoint, end, creating.waypoints, {\r\n      firstLeg: 'vertical',\r\n    });\r\n    return { d: pointsToPathD(points), color: creating.color };\r\n  }, [creating, forceTick]);\r\n\r\n  if (dimensions.width === 0 || dimensions.height === 0) return null;\r\n\r\n  return (\r\n    <>\r\n      <style jsx global>{`\r\n        @keyframes fundi-wire-dash {\r\n          to {\r\n            stroke-dashoffset: -24;\r\n          }\r\n        }\r\n      `}</style>\r\n\r\n      <svg\r\n        style={{\r\n          position: 'absolute',\r\n          top: 0,\r\n          left: 0,\r\n          width: '100%',\r\n          height: '100%',\r\n          pointerEvents: 'none',\r\n          overflow: 'visible',\r\n          zIndex: 10,\r\n        }}\r\n        viewBox={`0 0 ${dimensions.width} ${dimensions.height}`}\r\n      >\r\n        <g style={{ pointerEvents: 'auto' }}>\r\n          {wireGeometry.map((w) => {\r\n            const isSelected = selectedId === w.id;\r\n            const isHovered = hoveredId === w.id;\r\n            const strokeWidth = isSelected ? 3.5 : 2;\r\n            const displayColor = isSelected ? '#00F0FF' : w.color; // Electric cyan when selected\r\n\r\n            return (\r\n              <g key={w.id}>\r\n                {/* Hit target (also used for segment dragging) */}\r\n                <path\r\n                  d={w.d}\r\n                  data-wire-hit=\"true\"\r\n                  data-wire-id={w.id}\r\n                  fill=\"none\"\r\n                  stroke=\"transparent\"\r\n                  strokeWidth={HIT_STROKE}\r\n                  style={{ cursor: isSelected ? 'grab' : 'pointer', pointerEvents: 'stroke' }}\r\n                  onPointerEnter={() => setHoveredId(w.id)}\r\n                  onPointerLeave={() => setHoveredId((prev) => (prev === w.id ? null : prev))}\r\n                  onPointerDown={(e) => {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n\r\n                    setSelectedId(w.id);\r\n\r\n                    // Segment dragging only when selected.\r\n                    const container = containerRef.current;\r\n                    if (!container) return;\r\n                    if (selectedId !== w.id) return;\r\n\r\n                    const rect = container.getBoundingClientRect();\r\n                    const click: WirePoint = { x: e.clientX - rect.left, y: e.clientY - rect.top };\r\n                    const segIdx = findSegmentIndex(w.points, click, HIT_STROKE / 2);\r\n                    if (segIdx === null) return;\r\n\r\n                    segmentDragRef.current = {\r\n                      wireId: w.id,\r\n                      segmentIndex: segIdx,\r\n                      startMouse: click,\r\n                      startPoints: w.points,\r\n                      disableSnap: e.shiftKey,\r\n                    };\r\n                    modeRef.current = 'dragging-segment';\r\n                  }}\r\n                  onDoubleClick={(e) => {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                    removeConnection(w.id);\r\n                    if (selectedId === w.id) setSelectedId(null);\r\n                  }}\r\n                />\r\n\r\n                {/* Glow effect for selected wire */}\r\n                {isSelected && (\r\n                  <path\r\n                    d={w.d}\r\n                    fill=\"none\"\r\n                    stroke=\"#00F0FF\"\r\n                    strokeWidth={strokeWidth + 3}\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    style={{\r\n                      pointerEvents: 'none',\r\n                      opacity: 0.3,\r\n                      filter: 'blur(4px)',\r\n                    }}\r\n                  />\r\n                )}\r\n\r\n                {/* Hover feedback (marching ants) */}\r\n                {(isHovered || isSelected) && (\r\n                  <path\r\n                    d={w.d}\r\n                    fill=\"none\"\r\n                    stroke={isSelected ? '#00F0FF' : '#D4AF37'}\r\n                    strokeWidth={strokeWidth + 1.25}\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeDasharray=\"6 6\"\r\n                    style={{\r\n                      pointerEvents: 'none',\r\n                      opacity: 0.4,\r\n                      animation: 'fundi-wire-dash 1s linear infinite',\r\n                    }}\r\n                  />\r\n                )}\r\n\r\n                {/* Visible wire */}\r\n                <path\r\n                  d={w.d}\r\n                  fill=\"none\"\r\n                  stroke={displayColor}\r\n                  strokeWidth={strokeWidth}\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  style={{\r\n                    pointerEvents: 'none',\r\n                    transition: 'all 0.2s ease',\r\n                  }}\r\n                />\r\n              </g>\r\n            );\r\n          })}\r\n\r\n          {/* Preview (ghost) wire */}\r\n          {preview && (\r\n            <path\r\n              d={preview.d}\r\n              fill=\"none\"\r\n              stroke={preview.color}\r\n              strokeWidth={2.5}\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeDasharray=\"6 6\"\r\n              opacity={0.9}\r\n              style={{ pointerEvents: 'none' }}\r\n            />\r\n          )}\r\n        </g>\r\n      </svg>\r\n\r\n      {/* Selected wire toolbar (color + delete) */}\r\n      {selectedWire && selectedMidpoint && (\r\n        <div\r\n          data-wire-toolbar=\"true\"\r\n          className=\"absolute z-30 flex items-center gap-1 glass-panel rounded-lg p-2 shadow-2xl\"\r\n          style={{\r\n            left: selectedMidpoint.x,\r\n            top: selectedMidpoint.y,\r\n            transform: 'translate(-50%, -110%)',\r\n            pointerEvents: 'auto',\r\n          }}\r\n          onPointerDown={(e) => {\r\n            // Prevent toolbar clicks from being treated as \"click away\".\r\n            e.stopPropagation();\r\n          }}\r\n        >\r\n          <div className=\"flex items-center gap-0.5\">\r\n            {WOKWI_COLOR_PALETTE.map((c) => (\r\n              <button\r\n                key={c.key}\r\n                type=\"button\"\r\n                onClick={() => updateWireColor(selectedWire.id, c.color)}\r\n                className={\r\n                  'h-5 w-5 rounded border-2 transition-all ' +\r\n                  (selectedWire.color.toLowerCase() === c.color.toLowerCase()\r\n                    ? 'border-electric scale-110 shadow-lg shadow-electric/50'\r\n                    : 'border-transparent hover:border-brass hover:scale-105')\r\n                }\r\n                style={{ backgroundColor: c.color }}\r\n                title={`Color ${c.key}`}\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"mx-1 h-5 w-px bg-brass/30\" />\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => {\r\n              removeConnection(selectedWire.id);\r\n              setSelectedId(null);\r\n            }}\r\n            className=\"rounded px-2 py-1 font-mono text-[11px] font-medium text-error hover:bg-error/15 transition-colors\"\r\n            title=\"Delete wire (also: Delete key or double-click)\"\r\n          >\r\n            Delete\r\n          </button>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default memo(WiringLayer);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3159, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/terminal/CommandInterface.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useCallback, useEffect, useRef, useState } from 'react'\r\nimport { Loader2, Mic, MicOff, GraduationCap, Wrench, Send, ImagePlus } from 'lucide-react'\r\nimport { useAppStore, type TerminalEntry } from '@/store/useAppStore'\r\nimport { cn } from '@/utils/cn'\r\n\r\nfunction formatTimestamp(ts: number): string {\r\n  const d = new Date(ts)\r\n  return d.toLocaleTimeString('en-US', {\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    hour12: false,\r\n  })\r\n}\r\n\r\nfunction ChatMessage({ entry }: { entry: TerminalEntry }) {\r\n  const isUser = entry.type === 'cmd'\r\n  const isAi = entry.type === 'ai'\r\n  const isError = entry.type === 'error'\r\n\r\n  // Simple markdown-like rendering for code blocks\r\n  const renderContent = (content: string) => {\r\n    const parts = content.split(/(```[\\s\\S]*?```)/g)\r\n    return parts.map((part, i) => {\r\n      if (part.startsWith('```') && part.endsWith('```')) {\r\n        // Extract language and code\r\n        const match = part.match(/```(\\w+)?\\n?([\\s\\S]*?)```/)\r\n        const lang = match?.[1] || ''\r\n        const code = match?.[2] ?? part.slice(3, -3)\r\n        return (\r\n          <div key={i} className=\"my-2 rounded-lg overflow-hidden border border-ide-border\">\r\n            {lang && (\r\n              <div className=\"px-3 py-1 bg-ide-panel-bg text-[10px] font-medium text-ide-text-muted border-b border-ide-border\">\r\n                {lang}\r\n              </div>\r\n            )}\r\n            <pre className=\"p-3 overflow-x-auto bg-ide-panel-bg/50 text-xs text-ide-success\">\r\n              <code>{code.trim()}</code>\r\n            </pre>\r\n          </div>\r\n        )\r\n      }\r\n      // Regular text - preserve newlines\r\n      return (\r\n        <span key={i} className=\"whitespace-pre-wrap\">\r\n          {part}\r\n        </span>\r\n      )\r\n    })\r\n  }\r\n\r\n  return (\r\n    <div className={cn(\r\n      'mb-3 animate-fade-in',\r\n      isUser && 'flex justify-end'\r\n    )}>\r\n      <div className={cn(\r\n        'max-w-[85%] rounded-lg px-3 py-2',\r\n        isUser \r\n          ? 'bg-ide-accent/20 text-ide-text border border-ide-accent/30' \r\n          : isError\r\n            ? 'bg-ide-error/10 text-ide-error border border-ide-error/30'\r\n            : isAi\r\n              ? 'bg-ide-panel-surface text-ide-text border border-ide-border'\r\n              : 'bg-ide-panel-hover/50 text-ide-text-muted'\r\n      )}>\r\n        {/* Header */}\r\n        <div className=\"flex items-center gap-2 mb-1\">\r\n          <span className={cn(\r\n            'text-[10px] font-medium',\r\n            isUser ? 'text-ide-accent' : isAi ? 'text-ide-accent' : isError ? 'text-ide-error' : 'text-ide-text-subtle'\r\n          )}>\r\n            {isUser ? 'You' : isAi ? 'FUNDI AI' : isError ? 'Error' : 'System'}\r\n          </span>\r\n          <span className=\"text-[9px] text-ide-text-subtle\">{formatTimestamp(entry.timestamp)}</span>\r\n        </div>\r\n        {/* Content */}\r\n        <div className=\"text-sm leading-relaxed\">{renderContent(entry.content)}</div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport function CommandInterface() {\r\n  const terminalHistory = useAppStore((s) => s.terminalHistory)\r\n  const isAiLoading = useAppStore((s) => s.isAiLoading)\r\n  const submitCommand = useAppStore((s) => s.submitCommand)\r\n  const teacherMode = useAppStore((s) => s.teacherMode)\r\n  const setTeacherMode = useAppStore((s) => s.setTeacherMode)\r\n\r\n  const [input, setInput] = useState('')\r\n  const [isListening, setIsListening] = useState(false)\r\n  const scrollRef = useRef<HTMLDivElement>(null)\r\n  const inputRef = useRef<HTMLTextAreaElement>(null)\r\n  const fileInputRef = useRef<HTMLInputElement>(null)\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const recognitionRef = useRef<any>(null)\r\n\r\n  // Auto-scroll to bottom when new entries arrive\r\n  useEffect(() => {\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight\r\n    }\r\n  }, [terminalHistory])\r\n\r\n  // Focus input on mount\r\n  useEffect(() => {\r\n    inputRef.current?.focus()\r\n  }, [])\r\n\r\n  // Initialize speech recognition\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      const SpeechRecognitionAPI = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition\r\n      if (SpeechRecognitionAPI) {\r\n        recognitionRef.current = new SpeechRecognitionAPI()\r\n        recognitionRef.current.continuous = false\r\n        recognitionRef.current.interimResults = false\r\n        recognitionRef.current.lang = 'en-US'\r\n\r\n        recognitionRef.current.onresult = (event: { results: { transcript: string }[][] }) => {\r\n          const transcript = event.results[0][0].transcript\r\n          setInput((prev) => prev ? prev + ' ' + transcript : transcript)\r\n          setIsListening(false)\r\n        }\r\n\r\n        recognitionRef.current.onerror = () => {\r\n          setIsListening(false)\r\n        }\r\n\r\n        recognitionRef.current.onend = () => {\r\n          setIsListening(false)\r\n        }\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  const handleSubmit = useCallback(\r\n    (e: React.FormEvent) => {\r\n      e.preventDefault()\r\n      if (!input.trim() || isAiLoading) return\r\n      void submitCommand(input)\r\n      setInput('')\r\n    },\r\n    [input, isAiLoading, submitCommand]\r\n  )\r\n\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault()\r\n      if (!input.trim() || isAiLoading) return\r\n      void submitCommand(input)\r\n      setInput('')\r\n    }\r\n  }, [input, isAiLoading, submitCommand])\r\n\r\n  const toggleVoiceInput = useCallback(() => {\r\n    if (!recognitionRef.current) {\r\n      alert('Speech recognition is not supported in this browser.')\r\n      return\r\n    }\r\n\r\n    if (isListening) {\r\n      recognitionRef.current.stop()\r\n      setIsListening(false)\r\n    } else {\r\n      recognitionRef.current.start()\r\n      setIsListening(true)\r\n    }\r\n  }, [isListening])\r\n\r\n  const handleImageUpload = useCallback(\r\n    async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      const file = e.target.files?.[0]\r\n      if (!file) return\r\n\r\n      try {\r\n        const reader = new FileReader()\r\n        reader.onload = async (event) => {\r\n          const base64 = event.target?.result as string\r\n          await submitCommand(input || 'Analyze this circuit image and recreate it virtually', base64)\r\n          setInput('')\r\n        }\r\n        reader.readAsDataURL(file)\r\n      } catch (err) {\r\n        console.error('Error reading image:', err)\r\n      }\r\n\r\n      // Reset file input\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = ''\r\n      }\r\n    },\r\n    [input, submitCommand]\r\n  )\r\n\r\n  return (\r\n    <div\r\n      className=\"flex h-full flex-col bg-ide-panel-bg\"\r\n      onClick={() => inputRef.current?.focus()}\r\n    >\r\n      {/* Mode toggle bar - Segmented Control */}\r\n      <div className=\"flex items-center justify-between border-b border-ide-border bg-ide-panel-surface px-3 py-2\">\r\n        <div className=\"flex items-center rounded-lg bg-ide-panel-bg p-0.5\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setTeacherMode(false)}\r\n            className={cn(\r\n              'flex items-center gap-1.5 rounded-md px-3 py-1.5 text-xs font-medium transition-all',\r\n              !teacherMode\r\n                ? 'bg-ide-success/20 text-ide-success shadow-sm'\r\n                : 'text-ide-text-muted hover:text-ide-text'\r\n            )}\r\n          >\r\n            <Wrench className=\"h-3.5 w-3.5\" />\r\n            Builder\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setTeacherMode(true)}\r\n            className={cn(\r\n              'flex items-center gap-1.5 rounded-md px-3 py-1.5 text-xs font-medium transition-all',\r\n              teacherMode\r\n                ? 'bg-ide-accent/20 text-ide-accent shadow-sm'\r\n                : 'text-ide-text-muted hover:text-ide-text'\r\n            )}\r\n          >\r\n            <GraduationCap className=\"h-3.5 w-3.5\" />\r\n            Teacher\r\n          </button>\r\n        </div>\r\n        <span className=\"text-[10px] text-ide-text-subtle\">\r\n          {teacherMode ? 'Explains concepts' : 'Builds circuits'}\r\n        </span>\r\n      </div>\r\n\r\n      {/* Chat history area */}\r\n      <div\r\n        ref={scrollRef}\r\n        className=\"min-h-0 flex-1 overflow-y-auto px-3 py-3\"\r\n      >\r\n        {terminalHistory.length === 0 && (\r\n          <div className=\"flex h-full items-center justify-center\">\r\n            <div className=\"text-center max-w-xs\">\r\n              <div className=\"mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-ide-accent/10\">\r\n                <Wrench className=\"h-6 w-6 text-ide-accent\" />\r\n              </div>\r\n              <h3 className=\"text-sm font-medium text-ide-text mb-1\">FUNDI AI Assistant</h3>\r\n              <p className=\"text-xs text-ide-text-muted mb-3\">\r\n                Describe the circuit you want to build, upload an image, or use voice input.\r\n              </p>\r\n              <p className=\"text-[10px] text-ide-text-subtle\">\r\n                Type /help for commands\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n        {terminalHistory.map((entry) => (\r\n          <ChatMessage key={entry.id} entry={entry} />\r\n        ))}\r\n        {isAiLoading && (\r\n          <div className=\"flex items-center gap-2 py-2 text-sm text-ide-accent animate-pulse\">\r\n            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n            <span>Generating...</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Input area - GitHub-style Comment Box */}\r\n      <div className=\"shrink-0 border-t border-ide-border bg-ide-panel-surface p-3\">\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"rounded-lg border border-ide-border bg-ide-panel-bg overflow-hidden focus-within:border-ide-accent/50 focus-within:ring-1 focus-within:ring-ide-accent/20 transition-all\">\r\n            {/* Text input */}\r\n            <textarea\r\n              ref={inputRef}\r\n              value={input}\r\n              onChange={(e) => setInput(e.target.value)}\r\n              onKeyDown={handleKeyDown}\r\n              disabled={isAiLoading}\r\n              placeholder={\r\n                isListening\r\n                  ? 'Listening...'\r\n                  : isAiLoading\r\n                    ? 'Generating...'\r\n                    : 'Describe your circuit or ask a question...'\r\n              }\r\n              rows={2}\r\n              className={cn(\r\n                'w-full resize-none bg-transparent px-3 py-2 text-sm text-ide-text outline-none',\r\n                'placeholder:text-ide-text-subtle',\r\n                'disabled:cursor-not-allowed disabled:opacity-50'\r\n              )}\r\n              autoComplete=\"off\"\r\n              spellCheck={false}\r\n            />\r\n\r\n            {/* Bottom toolbar */}\r\n            <div className=\"flex items-center justify-between border-t border-ide-border px-2 py-1.5\">\r\n              <div className=\"flex items-center gap-1\">\r\n                {/* Image upload button */}\r\n                <input\r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={handleImageUpload}\r\n                  className=\"hidden\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => fileInputRef.current?.click()}\r\n                  disabled={isAiLoading}\r\n                  className={cn(\r\n                    'flex h-7 w-7 items-center justify-center rounded-md transition-colors',\r\n                    'text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text',\r\n                    'disabled:cursor-not-allowed disabled:opacity-50'\r\n                  )}\r\n                  title=\"Upload circuit image\"\r\n                >\r\n                  <ImagePlus className=\"h-4 w-4\" />\r\n                </button>\r\n\r\n                {/* Voice input button with recording state */}\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={toggleVoiceInput}\r\n                  disabled={isAiLoading}\r\n                  className={cn(\r\n                    'relative flex h-7 w-7 items-center justify-center rounded-md transition-all',\r\n                    isListening\r\n                      ? 'mic-recording text-ide-error'\r\n                      : 'text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text',\r\n                    'disabled:cursor-not-allowed disabled:opacity-50'\r\n                  )}\r\n                  title={isListening ? 'Stop listening' : 'Start voice input'}\r\n                >\r\n                  {isListening ? (\r\n                    <MicOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Mic className=\"h-4 w-4\" />\r\n                  )}\r\n                  {/* Pulse ring when recording */}\r\n                  {isListening && (\r\n                    <span className=\"absolute inset-0 rounded-md animate-pulse-ring bg-ide-error/30\" />\r\n                  )}\r\n                </button>\r\n              </div>\r\n\r\n              {/* Submit button */}\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isAiLoading || !input.trim()}\r\n                className={cn(\r\n                  'flex h-7 items-center gap-1.5 rounded-md px-3 text-xs font-medium transition-all btn-press',\r\n                  input.trim() && !isAiLoading\r\n                    ? 'bg-ide-accent text-white hover:bg-ide-accent-hover'\r\n                    : 'bg-ide-panel-hover text-ide-text-subtle cursor-not-allowed'\r\n                )}\r\n              >\r\n                <Send className=\"h-3.5 w-3.5\" />\r\n                <span>Send</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3772, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/terminal/SerialMonitor.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useCallback, useEffect, useRef, useState } from 'react'\r\nimport { Trash2, ArrowDownToLine } from 'lucide-react'\r\nimport { cn } from '@/utils/cn'\r\n\r\ninterface SerialMonitorProps {\r\n  serialOutput: string[]\r\n  onClear: () => void\r\n  isRunning: boolean\r\n}\r\n\r\nexport function SerialMonitor({ serialOutput, onClear, isRunning }: SerialMonitorProps) {\r\n  const [autoScroll, setAutoScroll] = useState(true)\r\n  const [baudRate, setBaudRate] = useState(9600)\r\n  const scrollRef = useRef<HTMLDivElement>(null)\r\n\r\n  // Auto-scroll to bottom when new output arrives (if enabled)\r\n  useEffect(() => {\r\n    if (autoScroll && scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight\r\n    }\r\n  }, [serialOutput, autoScroll])\r\n\r\n  const handleScroll = useCallback(() => {\r\n    if (!scrollRef.current) return\r\n    const { scrollTop, scrollHeight, clientHeight } = scrollRef.current\r\n    // Disable auto-scroll if user scrolls up\r\n    const isAtBottom = scrollHeight - scrollTop - clientHeight < 20\r\n    if (!isAtBottom && autoScroll) {\r\n      setAutoScroll(false)\r\n    }\r\n  }, [autoScroll])\r\n\r\n  const scrollToBottom = useCallback(() => {\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight\r\n      setAutoScroll(true)\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col bg-ide-panel-bg\">\r\n      {/* Header toolbar */}\r\n      <div className=\"flex shrink-0 items-center justify-between border-b border-ide-border px-3 py-1.5\">\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Status indicator */}\r\n          <div className=\"flex items-center gap-1.5\">\r\n            <div\r\n              className={cn(\r\n                'h-2 w-2 rounded-full',\r\n                isRunning ? 'bg-ide-success animate-pulse' : 'bg-ide-text-subtle'\r\n              )}\r\n            />\r\n            <span className=\"text-[10px] font-medium text-ide-text-muted\">\r\n              {isRunning ? 'Connected' : 'Disconnected'}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Baud rate selector */}\r\n          <select\r\n            value={baudRate}\r\n            onChange={(e) => setBaudRate(Number(e.target.value))}\r\n            className=\"h-6 rounded border border-ide-border bg-ide-panel-surface px-1.5 text-[10px] text-ide-text-muted outline-none hover:border-ide-border-focus focus:border-ide-accent\"\r\n          >\r\n            <option value={9600}>9600 baud</option>\r\n            <option value={19200}>19200 baud</option>\r\n            <option value={38400}>38400 baud</option>\r\n            <option value={57600}>57600 baud</option>\r\n            <option value={115200}>115200 baud</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-1\">\r\n          {/* Scroll to bottom / Auto-scroll toggle */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={scrollToBottom}\r\n            title={autoScroll ? 'Auto-scroll ON' : 'Scroll to bottom'}\r\n            className={cn(\r\n              'flex h-6 w-6 items-center justify-center rounded transition-colors',\r\n              autoScroll\r\n                ? 'bg-ide-success/20 text-ide-success'\r\n                : 'text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text'\r\n            )}\r\n          >\r\n            <ArrowDownToLine className=\"h-3.5 w-3.5\" />\r\n          </button>\r\n\r\n          {/* Clear output */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClear}\r\n            title=\"Clear output\"\r\n            className=\"flex h-6 w-6 items-center justify-center rounded text-ide-text-muted transition-colors hover:bg-ide-panel-hover hover:text-ide-text\"\r\n          >\r\n            <Trash2 className=\"h-3.5 w-3.5\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Output area */}\r\n      <div\r\n        ref={scrollRef}\r\n        onScroll={handleScroll}\r\n        className=\"min-h-0 flex-1 overflow-y-auto px-3 py-2 font-mono text-xs\"\r\n      >\r\n        {serialOutput.length === 0 ? (\r\n          <div className=\"flex h-full items-center justify-center text-ide-text-subtle\">\r\n            <div className=\"text-center\">\r\n              <p className=\"mb-1\">Serial Monitor</p>\r\n              <p className=\"text-ide-text-subtle/70\">\r\n                {isRunning\r\n                  ? 'Waiting for serial output...'\r\n                  : 'Run simulation to see output'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          serialOutput.map((line, index) => (\r\n            <div key={index} className=\"leading-relaxed text-ide-success\">\r\n              {line || '\\u00A0'}\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;;;AAJA;;;;AAYO,SAAS,cAAc,EAAE,YAAY,EAAE,OAAO,EAAE,SAAS,EAAsB;;IACpF,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,YAAY,IAAA,uKAAM,EAAiB;IAEzC,6DAA6D;IAC7D,IAAA,0KAAS;mCAAC;YACR,IAAI,cAAc,UAAU,OAAO,EAAE;gBACnC,UAAU,OAAO,CAAC,SAAS,GAAG,UAAU,OAAO,CAAC,YAAY;YAC9D;QACF;kCAAG;QAAC;QAAc;KAAW;IAE7B,MAAM,eAAe,IAAA,4KAAW;mDAAC;YAC/B,IAAI,CAAC,UAAU,OAAO,EAAE;YACxB,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,YAAY,EAAE,GAAG,UAAU,OAAO;YACnE,yCAAyC;YACzC,MAAM,aAAa,eAAe,YAAY,eAAe;YAC7D,IAAI,CAAC,cAAc,YAAY;gBAC7B,cAAc;YAChB;QACF;kDAAG;QAAC;KAAW;IAEf,MAAM,iBAAiB,IAAA,4KAAW;qDAAC;YACjC,IAAI,UAAU,OAAO,EAAE;gBACrB,UAAU,OAAO,CAAC,SAAS,GAAG,UAAU,OAAO,CAAC,YAAY;gBAC5D,cAAc;YAChB;QACF;oDAAG,EAAE;IAEL,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CAEb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCACC,WAAW,IAAA,oHAAE,EACX,wBACA,YAAY,iCAAiC;;;;;;kDAGjD,6LAAC;wCAAK,WAAU;kDACb,YAAY,cAAc;;;;;;;;;;;;0CAK/B,6LAAC;gCACC,OAAO;gCACP,UAAU,CAAC,IAAM,YAAY,OAAO,EAAE,MAAM,CAAC,KAAK;gCAClD,WAAU;;kDAEV,6LAAC;wCAAO,OAAO;kDAAM;;;;;;kDACrB,6LAAC;wCAAO,OAAO;kDAAO;;;;;;kDACtB,6LAAC;wCAAO,OAAO;kDAAO;;;;;;kDACtB,6LAAC;wCAAO,OAAO;kDAAO;;;;;;kDACtB,6LAAC;wCAAO,OAAO;kDAAQ;;;;;;;;;;;;;;;;;;kCAI3B,6LAAC;wBAAI,WAAU;;0CAEb,6LAAC;gCACC,MAAK;gCACL,SAAS;gCACT,OAAO,aAAa,mBAAmB;gCACvC,WAAW,IAAA,oHAAE,EACX,sEACA,aACI,uCACA;0CAGN,cAAA,6LAAC,0PAAe;oCAAC,WAAU;;;;;;;;;;;0CAI7B,6LAAC;gCACC,MAAK;gCACL,SAAS;gCACT,OAAM;gCACN,WAAU;0CAEV,cAAA,6LAAC,uNAAM;oCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;0BAMxB,6LAAC;gBACC,KAAK;gBACL,UAAU;gBACV,WAAU;0BAET,aAAa,MAAM,KAAK,kBACvB,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAE,WAAU;0CAAO;;;;;;0CACpB,6LAAC;gCAAE,WAAU;0CACV,YACG,iCACA;;;;;;;;;;;;;;;;2BAKV,aAAa,GAAG,CAAC,CAAC,MAAM,sBACtB,6LAAC;wBAAgB,WAAU;kCACxB,QAAQ;uBADD;;;;;;;;;;;;;;;;AAQtB;GApHgB;KAAA"}},
    {"offset": {"line": 4029, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/terminal/TerminalPanel.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Terminal, Bot } from 'lucide-react'\r\nimport { CommandInterface } from './CommandInterface'\r\nimport { SerialMonitor } from './SerialMonitor'\r\nimport { cn } from '@/utils/cn'\r\n\r\ntype TerminalTab = 'serial' | 'assistant'\r\n\r\ninterface TerminalPanelProps {\r\n  serialOutput: string[]\r\n  onClearSerial: () => void\r\n  isSimulationRunning: boolean\r\n}\r\n\r\nexport function TerminalPanel({\r\n  serialOutput,\r\n  onClearSerial,\r\n  isSimulationRunning,\r\n}: TerminalPanelProps) {\r\n  const [activeTab, setActiveTab] = useState<TerminalTab>('assistant')\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden bg-ide-panel-bg\">\r\n      {/* Tab header */}\r\n      <div className=\"flex h-9 shrink-0 items-center border-b border-ide-border bg-ide-panel-surface\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setActiveTab('serial')}\r\n          className={cn(\r\n            'flex h-full items-center gap-1.5 px-3 text-xs font-medium transition-colors',\r\n            activeTab === 'serial'\r\n              ? 'border-b-2 border-ide-success text-ide-success'\r\n              : 'text-ide-text-muted hover:text-ide-text'\r\n          )}\r\n        >\r\n          <Terminal className=\"h-3.5 w-3.5\" />\r\n          <span>Serial</span>\r\n          {isSimulationRunning && (\r\n            <span className=\"ml-1 h-1.5 w-1.5 animate-pulse rounded-full bg-ide-success\" />\r\n          )}\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setActiveTab('assistant')}\r\n          className={cn(\r\n            'flex h-full items-center gap-1.5 px-3 text-xs font-medium transition-colors',\r\n            activeTab === 'assistant'\r\n              ? 'border-b-2 border-ide-accent text-ide-accent'\r\n              : 'text-ide-text-muted hover:text-ide-text'\r\n          )}\r\n        >\r\n          <Bot className=\"h-3.5 w-3.5\" />\r\n          <span>Assistant</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Tab content */}\r\n      <div className=\"min-h-0 flex-1\">\r\n        {activeTab === 'serial' ? (\r\n          <SerialMonitor\r\n            serialOutput={serialOutput}\r\n            onClear={onClearSerial}\r\n            isRunning={isSimulationRunning}\r\n          />\r\n        ) : (\r\n          <CommandInterface />\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AACA;AACA;;;AANA;;;;;;AAgBO,SAAS,cAAc,EAC5B,YAAY,EACZ,aAAa,EACb,mBAAmB,EACA;;IACnB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAc;IAExD,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,aAAa;wBAC5B,WAAW,IAAA,oHAAE,EACX,+EACA,cAAc,WACV,mDACA;;0CAGN,6LAAC,yNAAQ;gCAAC,WAAU;;;;;;0CACpB,6LAAC;0CAAK;;;;;;4BACL,qCACC,6LAAC;gCAAK,WAAU;;;;;;;;;;;;kCAGpB,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,aAAa;wBAC5B,WAAW,IAAA,oHAAE,EACX,+EACA,cAAc,cACV,iDACA;;0CAGN,6LAAC,0MAAG;gCAAC,WAAU;;;;;;0CACf,6LAAC;0CAAK;;;;;;;;;;;;;;;;;;0BAKV,6LAAC;gBAAI,WAAU;0BACZ,cAAc,yBACb,6LAAC,4JAAa;oBACZ,cAAc;oBACd,SAAS;oBACT,WAAW;;;;;yCAGb,6LAAC,kKAAgB;;;;;;;;;;;;;;;;AAK3B;GAxDgB;KAAA"}},
    {"offset": {"line": 4158, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/components/terminal/index.ts"],"sourcesContent":["export { CommandInterface } from './CommandInterface'\r\nexport { SerialMonitor } from './SerialMonitor'\r\nexport { TerminalPanel } from './TerminalPanel'\r\n"],"names":[],"mappings":";AAAA;AACA;AACA"}},
    {"offset": {"line": 4172, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/hooks/useDiagramSync.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useMemo } from 'react';\r\nimport { useAppStore } from '@/store/useAppStore';\r\nimport { WOKWI_PARTS } from '@/lib/wokwiParts';\r\n\r\nfunction resolveWokwiType(type: string): string {\r\n  const cfg = (WOKWI_PARTS as Record<string, { element: string } | undefined>)[type];\r\n  if (cfg?.element) return cfg.element;\r\n  if (type.startsWith('wokwi-')) return type;\r\n  return type;\r\n}\r\n\r\nexport function useDiagramSync() {\r\n  const circuitParts = useAppStore((s) => s.circuitParts);\r\n  const connections = useAppStore((s) => s.connections);\r\n  const setDiagramJson = useAppStore((s) => s.setDiagramJson);\r\n\r\n  const diagram = useMemo(() => {\r\n    return {\r\n      version: 1,\r\n      parts: circuitParts.map((p) => ({\r\n        id: p.id,\r\n        type: resolveWokwiType(p.type),\r\n        top: Math.round(p.position.y),\r\n        left: Math.round(p.position.x),\r\n        rotate: p.rotate ?? 0,\r\n        attrs: p.attrs ?? {},\r\n      })),\r\n      connections: connections.map((c) => [\r\n        `${c.from.partId}:${c.from.pinId}`,\r\n        `${c.to.partId}:${c.to.pinId}`,\r\n        c.color,\r\n        [],\r\n      ]),\r\n    };\r\n  }, [circuitParts, connections]);\r\n\r\n  useEffect(() => {\r\n    setDiagramJson(JSON.stringify(diagram, null, 2));\r\n  }, [diagram, setDiagramJson]);\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAMA,SAAS,iBAAiB,IAAY;IACpC,MAAM,MAAM,AAAC,mIAAW,AAAoD,CAAC,KAAK;IAClF,IAAI,KAAK,SAAS,OAAO,IAAI,OAAO;IACpC,IAAI,KAAK,UAAU,CAAC,WAAW,OAAO;IACtC,OAAO;AACT;AAEO,SAAS;;IACd,MAAM,eAAe,IAAA,sIAAW;oDAAC,CAAC,IAAM,EAAE,YAAY;;IACtD,MAAM,cAAc,IAAA,sIAAW;mDAAC,CAAC,IAAM,EAAE,WAAW;;IACpD,MAAM,iBAAiB,IAAA,sIAAW;sDAAC,CAAC,IAAM,EAAE,cAAc;;IAE1D,MAAM,UAAU,IAAA,wKAAO;2CAAC;YACtB,OAAO;gBACL,SAAS;gBACT,OAAO,aAAa,GAAG;uDAAC,CAAC,IAAM,CAAC;4BAC9B,IAAI,EAAE,EAAE;4BACR,MAAM,iBAAiB,EAAE,IAAI;4BAC7B,KAAK,KAAK,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;4BAC5B,MAAM,KAAK,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;4BAC7B,QAAQ,EAAE,MAAM,IAAI;4BACpB,OAAO,EAAE,KAAK,IAAI,CAAC;wBACrB,CAAC;;gBACD,aAAa,YAAY,GAAG;uDAAC,CAAC,IAAM;4BAClC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,EAAE;4BAClC,GAAG,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,KAAK,EAAE;4BAC9B,EAAE,KAAK;4BACP,EAAE;yBACH;;YACH;QACF;0CAAG;QAAC;QAAc;KAAY;IAE9B,IAAA,0KAAS;oCAAC;YACR,eAAe,KAAK,SAAS,CAAC,SAAS,MAAM;QAC/C;mCAAG;QAAC;QAAS;KAAe;AAC9B;GA5BgB;;QACO,sIAAW;QACZ,sIAAW;QACR,sIAAW"}},
    {"offset": {"line": 4252, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/hooks/useSimulation.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport {\r\n  AVRIOPort,\r\n  AVRClock,\r\n  AVRTimer,\r\n  AVRUSART,\r\n  CPU,\r\n  avrInstruction,\r\n  portBConfig,\r\n  portDConfig,\r\n  timer0Config,\r\n  usart0Config,\r\n  type GPIOListener,\r\n} from 'avr8js';\r\n\r\ntype PinStates = Record<number, boolean>;\r\n\r\nfunction decodeBase64ToString(base64: string): string {\r\n  const normalized = base64.trim();\r\n  const binary = atob(normalized);\r\n  const bytes = new Uint8Array(binary.length);\r\n  for (let i = 0; i < binary.length; i++) {\r\n    bytes[i] = binary.charCodeAt(i);\r\n  }\r\n  return new TextDecoder('utf-8').decode(bytes);\r\n}\r\n\r\nfunction parseIntelHex(hex: string): Uint16Array {\r\n  // Minimal Intel HEX parser with support for:\r\n  // - 00: Data records\r\n  // - 01: End of file\r\n  // - 04: Extended linear address\r\n  let upper = 0;\r\n  const mem = new Map<number, number>();\r\n  let maxAddr = 0;\r\n\r\n  const lines = hex.split(/\\r?\\n/);\r\n  for (const rawLine of lines) {\r\n    const line = rawLine.trim();\r\n    if (!line || !line.startsWith(':')) continue;\r\n\r\n    const byteCount = Number.parseInt(line.slice(1, 3), 16);\r\n    const addr16 = Number.parseInt(line.slice(3, 7), 16);\r\n    const recordType = Number.parseInt(line.slice(7, 9), 16);\r\n    const data = line.slice(9, 9 + byteCount * 2);\r\n\r\n    if (recordType === 0x00) {\r\n      const base = (upper << 16) + addr16;\r\n      for (let i = 0; i < byteCount; i++) {\r\n        const b = Number.parseInt(data.slice(i * 2, i * 2 + 2), 16);\r\n        const addr = base + i;\r\n        mem.set(addr, b);\r\n        if (addr + 1 > maxAddr) maxAddr = addr + 1;\r\n      }\r\n    } else if (recordType === 0x01) {\r\n      break;\r\n    } else if (recordType === 0x04) {\r\n      upper = Number.parseInt(data, 16);\r\n    }\r\n  }\r\n\r\n  const byteLength = maxAddr % 2 === 0 ? maxAddr : maxAddr + 1;\r\n  const progBytes = new Uint8Array(byteLength);\r\n  for (const [addr, value] of mem.entries()) {\r\n    if (addr >= 0 && addr < progBytes.length) progBytes[addr] = value;\r\n  }\r\n\r\n  const words = new Uint16Array(progBytes.length / 2);\r\n  for (let i = 0; i < words.length; i++) {\r\n    const lo = progBytes[i * 2];\r\n    const hi = progBytes[i * 2 + 1];\r\n    words[i] = lo | (hi << 8);\r\n  }\r\n  return words;\r\n}\r\n\r\nclass AVRRunner {\r\n  readonly cpu: CPU;\r\n  readonly portB: AVRIOPort;\r\n  readonly portD: AVRIOPort;\r\n  readonly clock: AVRClock;\r\n  readonly timer0: AVRTimer;\r\n  readonly usart: AVRUSART;\r\n\r\n  constructor(hexText: string) {\r\n    const program = parseIntelHex(hexText);\r\n    this.cpu = new CPU(program);\r\n    this.portB = new AVRIOPort(this.cpu, portBConfig);\r\n    this.portD = new AVRIOPort(this.cpu, portDConfig);\r\n\r\n    // Provide basic Arduino timing (millis/delay rely on timer0 on Uno).\r\n    this.clock = new AVRClock(this.cpu, 16_000_000);\r\n    this.timer0 = new AVRTimer(this.cpu, timer0Config);\r\n    \r\n    // USART for Serial communication\r\n    this.usart = new AVRUSART(this.cpu, usart0Config, 16_000_000);\r\n  }\r\n}\r\n\r\nexport type UseSimulationControls = {\r\n  run: () => void;\r\n  stop: () => void;\r\n  pause: () => void;\r\n  isRunning: boolean;\r\n  pinStates: PinStates;\r\n  serialOutput: string[];\r\n  clearSerialOutput: () => void;\r\n};\r\n\r\nfunction isAvrPart(partType: string): boolean {\r\n  return (\r\n    partType === 'wokwi-arduino-uno' ||\r\n    partType === 'wokwi-arduino-nano' ||\r\n    partType === 'wokwi-arduino-mega'\r\n  );\r\n}\r\n\r\nexport function useSimulation(hexData: string | null | undefined, partType: string): UseSimulationControls {\r\n  const [isRunning, setIsRunning] = useState(false);\r\n  const [pinStates, setPinStates] = useState<PinStates>({});\r\n  const [serialOutput, setSerialOutput] = useState<string[]>([]);\r\n\r\n  const runnerRef = useRef<AVRRunner | null>(null);\r\n  const rafRef = useRef<number | null>(null);\r\n  const runningRef = useRef(false);\r\n  const serialBufferRef = useRef<string>('');\r\n  const stepFrameRef = useRef<() => void>(() => {});\r\n\r\n  const cyclesPerFrame = useMemo(() => Math.floor(16_000_000 / 60), []);\r\n\r\n  const clearSerialOutput = useCallback(() => {\r\n    setSerialOutput([]);\r\n    serialBufferRef.current = '';\r\n  }, []);\r\n\r\n  const updatePortPins = useCallback((port: 'B' | 'D', value: number) => {\r\n    setPinStates((prev) => {\r\n      const next: PinStates = { ...prev };\r\n      if (port === 'D') {\r\n        // PORTD bits 0-7 -> Digital 0-7\r\n        for (let bit = 0; bit < 8; bit++) {\r\n          const pin = bit;\r\n          next[pin] = (value & (1 << bit)) !== 0;\r\n        }\r\n      } else {\r\n        // PORTB bits 0-5 -> Digital 8-13\r\n        for (let bit = 0; bit < 6; bit++) {\r\n          const pin = 8 + bit;\r\n          next[pin] = (value & (1 << bit)) !== 0;\r\n        }\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  // Update the step function ref in an effect to avoid stale closure issues\r\n  useEffect(() => {\r\n    stepFrameRef.current = () => {\r\n      if (!runningRef.current) return;\r\n      const runner = runnerRef.current;\r\n      if (!runner) return;\r\n\r\n      // Run ~16MHz/60fps CPU cycles each frame.\r\n      let remaining = cyclesPerFrame;\r\n      while (remaining > 0) {\r\n        const before = runner.cpu.cycles;\r\n        avrInstruction(runner.cpu);\r\n        const delta = runner.cpu.cycles - before;\r\n        remaining -= delta > 0 ? delta : 1;\r\n      }\r\n\r\n      rafRef.current = requestAnimationFrame(stepFrameRef.current);\r\n    };\r\n  }, [cyclesPerFrame]);\r\n\r\n  const stepFrame = useCallback(() => {\r\n    stepFrameRef.current();\r\n  }, []);\r\n\r\n  const stop = useCallback(() => {\r\n    runningRef.current = false;\r\n    setIsRunning(false);\r\n\r\n    if (rafRef.current != null) {\r\n      cancelAnimationFrame(rafRef.current);\r\n      rafRef.current = null;\r\n    }\r\n\r\n    runnerRef.current = null;\r\n    setPinStates({});\r\n    setSerialOutput([]);\r\n    serialBufferRef.current = '';\r\n  }, []);\r\n\r\n  const pause = useCallback(() => {\r\n    runningRef.current = false;\r\n    setIsRunning(false);\r\n\r\n    if (rafRef.current != null) {\r\n      cancelAnimationFrame(rafRef.current);\r\n      rafRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const run = useCallback(() => {\r\n    if (!hexData) return;\r\n    if (!isAvrPart(partType)) {\r\n      // avr8js only simulates AVR8 cores; ESP32 is not supported here.\r\n      return;\r\n    }\r\n\r\n    if (!runnerRef.current) {\r\n      const hexText = decodeBase64ToString(hexData);\r\n      const runner = new AVRRunner(hexText);\r\n\r\n      const onPortB: GPIOListener = (value) => updatePortPins('B', value);\r\n      const onPortD: GPIOListener = (value) => updatePortPins('D', value);\r\n      runner.portB.addListener(onPortB);\r\n      runner.portD.addListener(onPortD);\r\n\r\n      // Listen for USART byte transmissions (Serial.print output)\r\n      runner.usart.onByteTransmit = (byte: number) => {\r\n        const char = String.fromCharCode(byte);\r\n        serialBufferRef.current += char;\r\n        \r\n        // When we see a newline, flush the buffer as a new line\r\n        if (char === '\\n') {\r\n          const line = serialBufferRef.current.trimEnd();\r\n          if (line) {\r\n            setSerialOutput((prev) => [...prev, line]);\r\n          }\r\n          serialBufferRef.current = '';\r\n        }\r\n      };\r\n\r\n      // Initialize state from current registers\r\n      updatePortPins('B', runner.cpu.data[portBConfig.PORT]);\r\n      updatePortPins('D', runner.cpu.data[portDConfig.PORT]);\r\n\r\n      runnerRef.current = runner;\r\n    }\r\n\r\n    if (runningRef.current) return;\r\n    runningRef.current = true;\r\n    setIsRunning(true);\r\n    rafRef.current = requestAnimationFrame(stepFrame);\r\n  }, [hexData, partType, stepFrame, updatePortPins]);\r\n\r\n  useEffect(() => {\r\n    // Reset simulation when program/target changes.\r\n    stop();\r\n  }, [hexData, partType, stop]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      stop();\r\n    };\r\n  }, [stop]);\r\n\r\n  return { run, stop, pause, isRunning, pinStates, serialOutput, clearSerialOutput };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4533, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/henry/Desktop/FUNDI/fundi-workbench/app/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useCallback, useEffect, useRef, useState } from 'react'\r\nimport {\r\n  FileCode,\r\n  FileText,\r\n  FolderTree,\r\n  Layers,\r\n  Maximize2,\r\n  PanelLeftClose,\r\n  PanelLeftOpen,\r\n  Play,\r\n  RotateCcw,\r\n  Settings,\r\n  Share2,\r\n  Square,\r\n  ZoomIn,\r\n  ZoomOut,\r\n} from 'lucide-react'\r\nimport {\r\n  Panel,\r\n  PanelGroup,\r\n  PanelResizeHandle,\r\n} from 'react-resizable-panels'\r\nimport {\r\n  addEdge,\r\n  Background,\r\n  BackgroundVariant,\r\n  Controls,\r\n  ReactFlow,\r\n  ReactFlowProvider,\r\n  useStore,\r\n  useEdgesState,\r\n  useNodesState,\r\n  useReactFlow,\r\n  type Connection,\r\n  type Edge,\r\n  type Node,\r\n  type NodeTypes,\r\n} from '@xyflow/react'\r\n\r\nimport ArduinoNode from '@/components/nodes/ArduinoNode'\r\nimport WokwiPartNode from '@/components/nodes/WokwiPartNode'\r\nimport ComponentLibrary, { FUNDI_PART_MIME } from '@/components/ComponentLibrary'\r\nimport StatusBadge from '@/components/StatusBadge'\r\nimport SelectionOverlay from '@/components/SelectionOverlay'\r\nimport WiringLayer from '@/components/WiringLayer'\r\nimport { TerminalPanel } from '@/components/terminal'\r\nimport { useDiagramSync } from '@/hooks/useDiagramSync'\r\nimport { useSimulation } from '@/hooks/useSimulation'\r\nimport { useAppStore } from '@/store/useAppStore'\r\nimport type { WirePoint } from '@/types/wire'\r\nimport { cn } from '@/utils/cn'\r\n\r\nconst nodeTypes = {\r\n  arduino: ArduinoNode,\r\n  wokwi: WokwiPartNode,\r\n} satisfies NodeTypes\r\n\r\nfunction translatePoints(points: WirePoint[] | undefined, delta: WirePoint): WirePoint[] | undefined {\r\n  if (!points?.length) return points\r\n  return points.map((p) => ({ x: p.x + delta.x, y: p.y + delta.y }))\r\n}\r\n\r\n/* ============================================\r\n   Canvas Toolbar Overlay\r\n   ============================================ */\r\nfunction CanvasToolbar({ \r\n  onZoomIn, \r\n  onZoomOut, \r\n  onFitView,\r\n  onResetView,\r\n}: { \r\n  onZoomIn: () => void\r\n  onZoomOut: () => void\r\n  onFitView: () => void\r\n  onResetView: () => void\r\n}) {\r\n  return (\r\n    <div className=\"absolute top-4 right-4 z-40 flex items-center gap-1 glass-panel rounded-lg p-1\">\r\n      <button\r\n        type=\"button\"\r\n        onClick={onZoomIn}\r\n        className=\"flex h-8 w-8 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n        title=\"Zoom In\"\r\n      >\r\n        <ZoomIn className=\"h-4 w-4\" />\r\n      </button>\r\n      <button\r\n        type=\"button\"\r\n        onClick={onZoomOut}\r\n        className=\"flex h-8 w-8 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n        title=\"Zoom Out\"\r\n      >\r\n        <ZoomOut className=\"h-4 w-4\" />\r\n      </button>\r\n      <div className=\"mx-1 h-5 w-px bg-ide-border\" />\r\n      <button\r\n        type=\"button\"\r\n        onClick={onFitView}\r\n        className=\"flex h-8 w-8 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n        title=\"Fit View\"\r\n      >\r\n        <Maximize2 className=\"h-4 w-4\" />\r\n      </button>\r\n      <button\r\n        type=\"button\"\r\n        onClick={onResetView}\r\n        className=\"flex h-8 w-8 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n        title=\"Reset View\"\r\n      >\r\n        <RotateCcw className=\"h-4 w-4\" />\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Unified Action Bar (Command Center)\r\n   ============================================ */\r\nfunction UnifiedActionBar({\r\n  isCompiling,\r\n  compilationError,\r\n  onRun,\r\n  hasProgram,\r\n  isRunning,\r\n  onStop,\r\n}: {\r\n  isCompiling: boolean\r\n  compilationError: string | null\r\n  onRun: () => void\r\n  hasProgram: boolean\r\n  isRunning: boolean\r\n  onStop: () => void\r\n}) {\r\n  return (\r\n    <div className=\"absolute bottom-6 left-1/2 z-50 -translate-x-1/2 animate-slide-up\">\r\n      <div className=\"floating-bar flex items-center gap-2 px-3 py-2\">\r\n        {/* Primary Run Button */}\r\n        <button\r\n          type=\"button\"\r\n          onClick={onRun}\r\n          disabled={isCompiling}\r\n          className={cn(\r\n            'group relative flex items-center gap-2 rounded-lg px-4 py-2',\r\n            'text-sm font-semibold transition-all duration-200',\r\n            'btn-press',\r\n            isCompiling\r\n              ? 'bg-ide-panel-hover text-ide-text-subtle cursor-not-allowed'\r\n              : 'bg-ide-success text-white hover:bg-ide-success/90 shadow-lg shadow-ide-success/20',\r\n          )}\r\n          title=\"Compile and run\"\r\n        >\r\n          {isCompiling ? (\r\n            <>\r\n              <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-white/30 border-t-white\" />\r\n              <span>Compiling...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Play className=\"h-4 w-4 fill-current\" />\r\n              <span>Run Simulation</span>\r\n            </>\r\n          )}\r\n        </button>\r\n\r\n        {/* Stop Button */}\r\n        <button\r\n          type=\"button\"\r\n          onClick={onStop}\r\n          disabled={!hasProgram}\r\n          className={cn(\r\n            'flex h-9 w-9 items-center justify-center rounded-lg',\r\n            'transition-all duration-200 btn-press',\r\n            !hasProgram\r\n              ? 'text-ide-text-subtle cursor-not-allowed'\r\n              : 'text-ide-text-muted hover:bg-ide-error/20 hover:text-ide-error',\r\n          )}\r\n          title=\"Stop simulation\"\r\n        >\r\n          <Square className=\"h-4 w-4\" />\r\n        </button>\r\n\r\n        <div className=\"mx-1 h-6 w-px bg-ide-border\" />\r\n\r\n        {/* Status Indicator */}\r\n        <div className=\"flex items-center gap-2 rounded-lg bg-ide-panel-bg/80 px-3 py-1.5\">\r\n          <div\r\n            className={cn(\r\n              'h-2 w-2 rounded-full transition-colors duration-300',\r\n              isCompiling\r\n                ? 'bg-ide-warning animate-pulse'\r\n                : compilationError\r\n                  ? 'bg-ide-error'\r\n                  : hasProgram\r\n                    ? isRunning\r\n                      ? 'bg-ide-success animate-pulse'\r\n                      : 'bg-ide-success'\r\n                    : 'bg-ide-text-subtle',\r\n            )}\r\n          />\r\n          <span className=\"text-xs font-medium text-ide-text-muted\">\r\n            {isCompiling\r\n              ? 'Compiling'\r\n              : compilationError\r\n                ? 'Error'\r\n                : hasProgram\r\n                  ? isRunning\r\n                    ? 'Running'\r\n                    : 'Ready'\r\n                  : 'Idle'}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Simulation Canvas Inner (ReactFlow)\r\n   ============================================ */\r\nfunction SimulationCanvasInner({ \r\n  canvasRef,\r\n  isRunning,\r\n}: { \r\n  canvasRef: React.RefObject<HTMLDivElement | null>\r\n  isRunning: boolean\r\n}) {\r\n  const addPart = useAppStore((s) => s.addPart)\r\n  const updatePartsPositions = useAppStore((s) => s.updatePartsPositions)\r\n  const selectedPartIds = useAppStore((s) => s.selectedPartIds)\r\n  const setSelectedPartIds = useAppStore((s) => s.setSelectedPartIds)\r\n  const toggleSelectedPartId = useAppStore((s) => s.toggleSelectedPartId)\r\n  const connections = useAppStore((s) => s.connections)\r\n  const updateWire = useAppStore((s) => s.updateWire)\r\n  const circuitParts = useAppStore((s) => s.circuitParts)\r\n\r\n  useDiagramSync()\r\n\r\n  const { zoomIn, zoomOut, fitView, setViewport } = useReactFlow()\r\n\r\n  const getCanvasRect = useCallback(() => {\r\n    return canvasRef.current?.getBoundingClientRect() ?? null\r\n  }, [canvasRef])\r\n\r\n  const [selectedEdge, setSelectedEdge] = useState<string | null>(null)\r\n  const [nodes, setNodes, onNodesChange] = useNodesState<Node>([])\r\n  \r\n  const initializedRef = useRef(false)\r\n\r\n  // Seed a default part once.\r\n  useEffect(() => {\r\n    if (initializedRef.current) return\r\n    if (nodes.length) return\r\n    initializedRef.current = true\r\n    const id = addPart({ type: 'arduino-uno', position: { x: 0, y: 0 } })\r\n    setNodes([\r\n      {\r\n        id,\r\n        type: 'wokwi',\r\n        position: { x: 0, y: 0 },\r\n        data: {\r\n          getCanvasRect,\r\n          partType: 'arduino-uno',\r\n        },\r\n        selected: true,\r\n      },\r\n    ])\r\n    setSelectedPartIds([id])\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [])\r\n\r\n  // Sync ReactFlow nodes with circuitParts from store\r\n  useEffect(() => {\r\n    if (!initializedRef.current) return\r\n    \r\n    const newNodes: Node[] = circuitParts.map((part) => ({\r\n      id: part.id,\r\n      type: 'wokwi',\r\n      position: { x: part.position.x, y: part.position.y },\r\n      data: {\r\n        getCanvasRect,\r\n        partType: part.type.replace('wokwi-', ''),\r\n      },\r\n      selected: selectedPartIds.includes(part.id),\r\n    }))\r\n    \r\n    const currentIds = new Set(nodes.map(n => n.id))\r\n    const newIds = new Set(newNodes.map(n => n.id))\r\n    const idsChanged = newIds.size !== currentIds.size || \r\n      [...newIds].some(id => !currentIds.has(id))\r\n    \r\n    if (newNodes.length > 0 && idsChanged) {\r\n      setNodes(newNodes)\r\n    }\r\n  }, [circuitParts, getCanvasRect, nodes, selectedPartIds, setNodes])\r\n\r\n  // Update node data when handlers change\r\n  useEffect(() => {\r\n    setNodes((nds) =>\r\n      nds.map((node) => {\r\n        if (node.type === 'arduino' || node.type === 'wokwi') {\r\n          return {\r\n            ...node,\r\n            data: {\r\n              ...node.data,\r\n              getCanvasRect,\r\n            },\r\n          }\r\n        }\r\n        return node\r\n      })\r\n    )\r\n  }, [getCanvasRect, setNodes])\r\n\r\n  // Keep ReactFlow selection in sync with Zustand selection.\r\n  useEffect(() => {\r\n    const selectedSet = new Set(selectedPartIds)\r\n    setNodes((nds) => nds.map((n) => ({ ...n, selected: selectedSet.has(n.id) })))\r\n  }, [selectedPartIds, setNodes])\r\n\r\n  const [edges, setEdges, onEdgesChange] = useEdgesState<Edge>([])\r\n\r\n  const onConnect = useCallback(\r\n    (params: Connection) =>\r\n      setEdges((eds) =>\r\n        addEdge(\r\n          {\r\n            ...params,\r\n            type: 'default',\r\n            animated: false,\r\n            style: { stroke: 'var(--ide-accent)', strokeWidth: 2.5 },\r\n          },\r\n          eds\r\n        )\r\n      ),\r\n    [setEdges]\r\n  )\r\n\r\n  const onEdgeClick = useCallback((_: React.MouseEvent, edge: Edge) => {\r\n    setSelectedEdge(edge.id)\r\n  }, [])\r\n\r\n  const onPaneClick = useCallback(() => {\r\n    setSelectedEdge(null)\r\n  }, [])\r\n\r\n  const onNodeClick = useCallback(\r\n    (e: React.MouseEvent, node: Node) => {\r\n      if ((e.target as HTMLElement | null)?.closest?.('[data-fundi-pin=\"true\"]')) return\r\n\r\n      if (e.shiftKey) {\r\n        toggleSelectedPartId(node.id)\r\n      } else {\r\n        setSelectedPartIds([node.id])\r\n      }\r\n    },\r\n    [setSelectedPartIds, toggleSelectedPartId]\r\n  )\r\n\r\n  // Group-drag engine\r\n  const dragStartNodesRef = useRef<Map<string, { x: number; y: number }>>(new Map())\r\n  const dragStartWirePointsRef = useRef<Map<string, WirePoint[] | undefined>>(new Map())\r\n  const dragWireModeRef = useRef<Map<string, 'both' | 'one'>>(new Map())\r\n  const [wirePointOverrides, setWirePointOverrides] = useState<Map<string, WirePoint[] | undefined> | null>(null)\r\n\r\n  const onNodeDragStart = useCallback(\r\n    (_: React.MouseEvent, node: Node) => {\r\n      if (!selectedPartIds.includes(node.id)) {\r\n        setSelectedPartIds([node.id])\r\n      }\r\n\r\n      const selectedSet = new Set(selectedPartIds.includes(node.id) ? selectedPartIds : [node.id])\r\n\r\n      dragStartNodesRef.current = new Map(\r\n        nodes\r\n          .filter((n) => selectedSet.has(n.id))\r\n          .map((n) => [n.id, { x: n.position.x, y: n.position.y }])\r\n      )\r\n\r\n      dragStartWirePointsRef.current = new Map()\r\n      dragWireModeRef.current = new Map()\r\n      for (const c of connections) {\r\n        if (!c.points?.length) continue\r\n        const fromMoving = selectedSet.has(c.from.partId)\r\n        const toMoving = selectedSet.has(c.to.partId)\r\n        if (!fromMoving && !toMoving) continue\r\n        dragStartWirePointsRef.current.set(c.id, c.points)\r\n        dragWireModeRef.current.set(c.id, fromMoving && toMoving ? 'both' : 'one')\r\n      }\r\n    },\r\n    [connections, nodes, selectedPartIds, setSelectedPartIds]\r\n  )\r\n\r\n  const onNodeDrag = useCallback(\r\n    (_: React.MouseEvent, node: Node) => {\r\n      const start = dragStartNodesRef.current.get(node.id)\r\n      if (!start) return\r\n      const delta = { x: node.position.x - start.x, y: node.position.y - start.y }\r\n\r\n      setNodes((nds) =>\r\n        nds.map((n) => {\r\n          const s = dragStartNodesRef.current.get(n.id)\r\n          if (!s) return n\r\n          return { ...n, position: { x: s.x + delta.x, y: s.y + delta.y } }\r\n        })\r\n      )\r\n\r\n      const overrides = new Map<string, WirePoint[] | undefined>()\r\n      for (const [wireId, basePoints] of dragStartWirePointsRef.current.entries()) {\r\n        const mode = dragWireModeRef.current.get(wireId)\r\n        if (!mode) continue\r\n        if (mode === 'both') {\r\n          overrides.set(wireId, translatePoints(basePoints, delta))\r\n        } else {\r\n          overrides.set(wireId, undefined)\r\n        }\r\n      }\r\n      setWirePointOverrides(overrides.size ? overrides : null)\r\n    },\r\n    [setNodes]\r\n  )\r\n\r\n  const onNodeDragStop = useCallback(() => {\r\n    const updates: Array<{ id: string; x: number; y: number }> = []\r\n    for (const [id] of dragStartNodesRef.current.entries()) {\r\n      const n = nodes.find((nn) => nn.id === id)\r\n      if (!n) continue\r\n      updates.push({ id, x: n.position.x, y: n.position.y })\r\n    }\r\n    updatePartsPositions(updates)\r\n\r\n    if (wirePointOverrides) {\r\n      for (const [wireId, pts] of wirePointOverrides.entries()) {\r\n        updateWire(wireId, pts)\r\n      }\r\n    }\r\n\r\n    dragStartNodesRef.current = new Map()\r\n    dragStartWirePointsRef.current = new Map()\r\n    dragWireModeRef.current = new Map()\r\n    setWirePointOverrides(null)\r\n  }, [nodes, updatePartsPositions, updateWire, wirePointOverrides])\r\n\r\n  // Drag-to-add handler\r\n  const transform = useStore((s) => s.transform as [number, number, number])\r\n  const handleDrop = useCallback(\r\n    (e: React.DragEvent) => {\r\n      const container = canvasRef.current\r\n      if (!container) return\r\n\r\n      const partType = e.dataTransfer.getData(FUNDI_PART_MIME)\r\n      if (!partType) return\r\n\r\n      e.preventDefault()\r\n\r\n      const rect = container.getBoundingClientRect()\r\n      const p = { x: e.clientX - rect.left, y: e.clientY - rect.top }\r\n      const [tx, ty, zoom] = transform\r\n      const flow = { x: (p.x - tx) / zoom, y: (p.y - ty) / zoom }\r\n\r\n      const id = addPart({ type: partType, position: { x: flow.x, y: flow.y } })\r\n      setNodes((nds) => [\r\n        ...nds,\r\n        {\r\n          id,\r\n          type: 'wokwi',\r\n          position: flow,\r\n          data: { getCanvasRect, partType },\r\n          selected: true,\r\n        },\r\n      ])\r\n\r\n      setSelectedPartIds([id])\r\n    },\r\n    [addPart, canvasRef, getCanvasRect, setNodes, setSelectedPartIds, transform]\r\n  )\r\n\r\n  const handleDragOver = useCallback((e: React.DragEvent) => {\r\n    if (e.dataTransfer.types.includes(FUNDI_PART_MIME)) {\r\n      e.preventDefault()\r\n      e.dataTransfer.dropEffect = 'copy'\r\n    }\r\n  }, [])\r\n\r\n  const handleResetView = useCallback(() => {\r\n    setViewport({ x: 0, y: 0, zoom: 1 }, { duration: 300 })\r\n  }, [setViewport])\r\n\r\n  return (\r\n    <div\r\n      ref={canvasRef}\r\n      className={cn(\r\n        'relative h-full w-full ide-canvas',\r\n        isRunning && 'simulation-active rounded-lg'\r\n      )}\r\n      onDrop={handleDrop}\r\n      onDragOver={handleDragOver}\r\n    >\r\n      <CanvasToolbar\r\n        onZoomIn={() => zoomIn({ duration: 200 })}\r\n        onZoomOut={() => zoomOut({ duration: 200 })}\r\n        onFitView={() => fitView({ duration: 300, padding: 0.2 })}\r\n        onResetView={handleResetView}\r\n      />\r\n\r\n      <SelectionOverlay containerRef={canvasRef} />\r\n\r\n      <ReactFlow\r\n        nodes={nodes}\r\n        edges={edges.map((edge) => ({\r\n          ...edge,\r\n          style: {\r\n            ...edge.style,\r\n            stroke: 'var(--ide-text-muted)',\r\n            strokeWidth: edge.id === selectedEdge ? 3 : 2,\r\n          },\r\n        }))}\r\n        nodeTypes={nodeTypes}\r\n        onNodesChange={onNodesChange}\r\n        onEdgesChange={onEdgesChange}\r\n        onConnect={onConnect}\r\n        onEdgeClick={onEdgeClick}\r\n        onPaneClick={onPaneClick}\r\n        onNodeClick={onNodeClick}\r\n        onNodeDragStart={onNodeDragStart}\r\n        onNodeDrag={onNodeDrag}\r\n        onNodeDragStop={onNodeDragStop}\r\n        fitView\r\n        className=\"h-full w-full\"\r\n        style={{ cursor: 'inherit', background: 'transparent' }}\r\n        defaultEdgeOptions={{\r\n          type: 'default',\r\n          animated: false,\r\n          style: { stroke: 'var(--ide-text-muted)', strokeWidth: 2 },\r\n        }}\r\n        connectionLineStyle={{ stroke: 'var(--ide-accent)', strokeWidth: 2 }}\r\n      >\r\n        <Background color=\"#333333\" variant={BackgroundVariant.Dots} gap={20} size={1} />\r\n        <Controls className=\"!left-4 !bottom-20\" />\r\n\r\n        <WiringLayer\r\n          containerRef={canvasRef}\r\n          wirePointOverrides={wirePointOverrides ?? undefined}\r\n        />\r\n      </ReactFlow>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction SimulationCanvas({ isRunning }: { isRunning: boolean }) {\r\n  const canvasRef = useRef<HTMLDivElement | null>(null)\r\n  return (\r\n    <ReactFlowProvider>\r\n      <SimulationCanvasInner canvasRef={canvasRef} isRunning={isRunning} />\r\n    </ReactFlowProvider>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Code Editor Panel\r\n   ============================================ */\r\ntype EditorTab = 'main.cpp' | 'diagram.json' | 'README.md'\r\n\r\nfunction CodeEditorPanel({ \r\n  code, \r\n  onCodeChange,\r\n  compilationError,\r\n}: { \r\n  code: string\r\n  onCodeChange: (code: string) => void\r\n  compilationError: string | null\r\n}) {\r\n  const [activeTab, setActiveTab] = useState<EditorTab>('main.cpp')\r\n\r\n  const tabs: { key: EditorTab; label: string; icon: React.ElementType }[] = [\r\n    { key: 'main.cpp', label: 'main.cpp', icon: FileCode },\r\n    { key: 'diagram.json', label: 'diagram.json', icon: Layers },\r\n    { key: 'README.md', label: 'README.md', icon: FileText },\r\n  ]\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden bg-ide-panel-surface\">\r\n      {/* Tab bar */}\r\n      <div className=\"flex h-9 shrink-0 items-center border-b border-ide-border bg-ide-panel-bg\">\r\n        {tabs.map((tab) => {\r\n          const Icon = tab.icon\r\n          const isActive = tab.key === activeTab\r\n          return (\r\n            <button\r\n              key={tab.key}\r\n              type=\"button\"\r\n              onClick={() => setActiveTab(tab.key)}\r\n              className={cn(\r\n                'flex h-full items-center gap-1.5 border-r border-ide-border px-3 text-xs font-medium transition-colors',\r\n                isActive\r\n                  ? 'bg-ide-panel-surface text-ide-text border-b-2 border-b-ide-accent'\r\n                  : 'text-ide-text-muted hover:text-ide-text hover:bg-ide-panel-hover'\r\n              )}\r\n            >\r\n              <Icon className=\"h-3.5 w-3.5\" />\r\n              <span>{tab.label}</span>\r\n            </button>\r\n          )\r\n        })}\r\n      </div>\r\n\r\n      {/* Error banner */}\r\n      {compilationError && (\r\n        <div className=\"shrink-0 border-b border-ide-error/30 bg-ide-error/10 px-4 py-2\">\r\n          <pre className=\"whitespace-pre-wrap break-words font-mono text-xs text-ide-error\">\r\n            {compilationError}\r\n          </pre>\r\n        </div>\r\n      )}\r\n\r\n      {/* Editor content */}\r\n      <div className=\"min-h-0 flex-1 p-2\">\r\n        <textarea\r\n          value={code}\r\n          onChange={(e) => onCodeChange(e.target.value)}\r\n          spellCheck={false}\r\n          className={cn(\r\n            'h-full w-full resize-none rounded-md bg-ide-panel-bg p-4',\r\n            'font-mono text-sm leading-6 text-ide-text',\r\n            'border border-ide-border',\r\n            'focus:outline-none focus:ring-1 focus:ring-ide-accent/50 focus:border-ide-accent/50',\r\n            'placeholder:text-ide-text-subtle'\r\n          )}\r\n          placeholder=\"// Write your Arduino code here...\"\r\n        />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Left Panel - The Assistant\r\n   ============================================ */\r\ntype LeftPanelTab = 'components' | 'files'\r\n\r\nfunction LeftPanel() {\r\n  const [activeTab, setActiveTab] = useState<LeftPanelTab>('components')\r\n\r\n  const tabs: { key: LeftPanelTab; label: string; icon: React.ElementType }[] = [\r\n    { key: 'components', label: 'Components', icon: Layers },\r\n    { key: 'files', label: 'Files', icon: FolderTree },\r\n  ]\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden bg-ide-panel-bg\">\r\n      {/* Tab header */}\r\n      <div className=\"flex h-10 shrink-0 items-center border-b border-ide-border bg-ide-panel-surface\">\r\n        {tabs.map((tab) => {\r\n          const Icon = tab.icon\r\n          const isActive = tab.key === activeTab\r\n          return (\r\n            <button\r\n              key={tab.key}\r\n              type=\"button\"\r\n              onClick={() => setActiveTab(tab.key)}\r\n              className={cn(\r\n                'flex h-full items-center gap-1.5 px-3 text-xs font-medium transition-colors',\r\n                isActive\r\n                  ? 'text-ide-accent border-b-2 border-ide-accent'\r\n                  : 'text-ide-text-muted hover:text-ide-text'\r\n              )}\r\n            >\r\n              <Icon className=\"h-3.5 w-3.5\" />\r\n              <span>{tab.label}</span>\r\n            </button>\r\n          )\r\n        })}\r\n      </div>\r\n\r\n      {/* Tab content */}\r\n      <div className=\"min-h-0 flex-1 overflow-hidden\">\r\n        {activeTab === 'components' && (\r\n          <div className=\"h-full overflow-auto p-4\">\r\n            <ComponentLibrary />\r\n          </div>\r\n        )}\r\n        {activeTab === 'files' && (\r\n          <div className=\"flex h-full items-center justify-center text-ide-text-subtle\">\r\n            <div className=\"text-center\">\r\n              <FolderTree className=\"mx-auto h-8 w-8 mb-2 opacity-50\" />\r\n              <p className=\"text-xs\">Project files</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Resize Handle Component\r\n   ============================================ */\r\nfunction ResizeHandle({ \r\n  direction = 'horizontal',\r\n  className,\r\n}: { \r\n  direction?: 'horizontal' | 'vertical'\r\n  className?: string\r\n}) {\r\n  return (\r\n    <PanelResizeHandle\r\n      className={cn(\r\n        'resize-handle group relative flex items-center justify-center',\r\n        direction === 'horizontal' \r\n          ? 'w-1.5 cursor-col-resize'\r\n          : 'h-1.5 cursor-row-resize',\r\n        className\r\n      )}\r\n    >\r\n      <div className={cn(\r\n        'absolute rounded-full bg-ide-border opacity-0 group-hover:opacity-100 transition-opacity',\r\n        direction === 'horizontal' \r\n          ? 'w-0.5 h-8'\r\n          : 'h-0.5 w-8'\r\n      )} />\r\n    </PanelResizeHandle>\r\n  )\r\n}\r\n\r\n/* ============================================\r\n   Main IDE Shell Layout\r\n   ============================================ */\r\nexport default function Home() {\r\n  const [leftPanelCollapsed, setLeftPanelCollapsed] = useState(false)\r\n\r\n  const code = useAppStore((s) => s.code)\r\n  const updateCode = useAppStore((s) => s.updateCode)\r\n  const compileAndRun = useAppStore((s) => s.compileAndRun)\r\n  const isCompiling = useAppStore((s) => s.isCompiling)\r\n  const compilationError = useAppStore((s) => s.compilationError)\r\n  const hex = useAppStore((s) => s.hex)\r\n  const compiledBoard = useAppStore((s) => s.compiledBoard)\r\n\r\n  const {\r\n    run: simRun,\r\n    stop: simStop,\r\n    isRunning: simIsRunning,\r\n    serialOutput,\r\n    clearSerialOutput,\r\n  } = useSimulation(hex, compiledBoard ?? '')\r\n\r\n  useEffect(() => {\r\n    if (!hex || !compiledBoard) return\r\n    if (isCompiling) return\r\n    if (compilationError) return\r\n    if (simIsRunning) return\r\n    simRun()\r\n  }, [compiledBoard, compilationError, hex, isCompiling, simIsRunning, simRun])\r\n\r\n  return (\r\n    <div className=\"relative h-screen overflow-hidden bg-ide-panel-bg text-ide-text\">\r\n      {/* Global Header - Compact Command Center (40px) */}\r\n      <header className=\"relative z-50 flex h-10 items-center justify-between border-b border-ide-border bg-ide-panel-surface px-3\">\r\n        {/* Left - Logo & Project */}\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Collapse toggle */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setLeftPanelCollapsed(!leftPanelCollapsed)}\r\n            className=\"flex h-7 w-7 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n            title={leftPanelCollapsed ? 'Expand sidebar' : 'Collapse sidebar'}\r\n          >\r\n            {leftPanelCollapsed ? (\r\n              <PanelLeftOpen className=\"h-4 w-4\" />\r\n            ) : (\r\n              <PanelLeftClose className=\"h-4 w-4\" />\r\n            )}\r\n          </button>\r\n\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"flex h-6 w-6 items-center justify-center rounded-md bg-ide-accent\">\r\n              <span className=\"text-xs font-bold text-white\">F</span>\r\n            </div>\r\n            <div>\r\n              <h1 className=\"text-xs font-semibold text-ide-text leading-none\">\r\n                FUNDI\r\n              </h1>\r\n              <p className=\"text-[9px] text-ide-text-muted leading-none mt-0.5\">\r\n                IoT Workbench\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Center - Device Status */}\r\n        <StatusBadge deviceName=\"Arduino Uno\" isConnected={true} />\r\n\r\n        {/* Right - Actions */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <button\r\n            type=\"button\"\r\n            className=\"flex h-7 items-center gap-1.5 rounded-md bg-ide-accent/10 px-3 text-xs font-medium text-ide-accent hover:bg-ide-accent/20 transition-colors\"\r\n            title=\"Publish to Gallery\"\r\n          >\r\n            <Share2 className=\"h-3.5 w-3.5\" />\r\n            <span className=\"hidden sm:inline\">Publish</span>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            className=\"flex h-7 w-7 items-center justify-center rounded-md text-ide-text-muted hover:bg-ide-panel-hover hover:text-ide-text transition-colors\"\r\n            title=\"Settings\"\r\n          >\r\n            <Settings className=\"h-4 w-4\" />\r\n          </button>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Main IDE Layout - Resizable Panels */}\r\n      <div className=\"h-[calc(100vh-40px)]\">\r\n        <PanelGroup direction=\"horizontal\" className=\"h-full\">\r\n          {/* Left Panel - Component Library (collapsible) */}\r\n          {!leftPanelCollapsed && (\r\n            <>\r\n              <Panel \r\n                defaultSize={20} \r\n                minSize={15} \r\n                maxSize={35}\r\n                className=\"bg-ide-panel-bg\"\r\n              >\r\n                <LeftPanel />\r\n              </Panel>\r\n              <ResizeHandle direction=\"horizontal\" />\r\n            </>\r\n          )}\r\n\r\n          {/* Middle Panel - The Workshop (Canvas + Code Editor) */}\r\n          <Panel defaultSize={leftPanelCollapsed ? 60 : 55} minSize={30}>\r\n            <PanelGroup direction=\"vertical\" className=\"h-full\">\r\n              {/* Top - Simulation Canvas (The Stage) */}\r\n              <Panel defaultSize={60} minSize={30}>\r\n                <div className=\"relative h-full overflow-hidden\">\r\n                  <SimulationCanvas isRunning={simIsRunning} />\r\n                  \r\n                  {/* Unified Action Bar */}\r\n                  <UnifiedActionBar\r\n                    isCompiling={isCompiling}\r\n                    compilationError={compilationError}\r\n                    onRun={() => void compileAndRun()}\r\n                    hasProgram={Boolean(hex && compiledBoard)}\r\n                    isRunning={simIsRunning}\r\n                    onStop={simStop}\r\n                  />\r\n                </div>\r\n              </Panel>\r\n\r\n              <ResizeHandle direction=\"vertical\" />\r\n\r\n              {/* Bottom - Code Editor */}\r\n              <Panel defaultSize={40} minSize={15}>\r\n                <CodeEditorPanel\r\n                  code={code}\r\n                  onCodeChange={updateCode}\r\n                  compilationError={compilationError}\r\n                />\r\n              </Panel>\r\n            </PanelGroup>\r\n          </Panel>\r\n\r\n          <ResizeHandle direction=\"horizontal\" />\r\n\r\n          {/* Right Panel - Terminal/Serial (always visible) */}\r\n          <Panel defaultSize={leftPanelCollapsed ? 40 : 25} minSize={15} maxSize={40}>\r\n            <TerminalPanel\r\n              serialOutput={serialOutput}\r\n              onClearSerial={clearSerialOutput}\r\n              isSimulationRunning={simIsRunning}\r\n            />\r\n          </Panel>\r\n        </PanelGroup>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}